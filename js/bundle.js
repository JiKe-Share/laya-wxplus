!function(){"use strict";!function(){class e{constructor(){this.pref=null}static GetInstance(){return null==this._instance&&(this._instance=new e),this._instance}ShowTips(e){if(null==this.pref)Laya.loader.load("DxPrefab/Tips.prefab",Laya.Handler.create(this,t=>{this.pref=t,this.ShowTips(e)}));else{var t=this.pref.create();t.zOrder=10001,t.text=e,Laya.stage.addChild(t)}}}var t,i,s,a;e._instance=null,function(e){e[e.huawei_H5=0]="huawei_H5"}(t||(t={}));class n{}n.UIRes="UI/",n.DebugLog=!0;class o extends Laya.Script{open(e=null){this.owner.visible||(this.owner.visible=!0),this.openArg=e,this.onOpen(e)}onOpen(e){}close(e=null){this.owner.visible&&(this.owner.visible=!1),this.onClose(e)}isOpen(){return this.owner.visible}onClose(e){}}class r{static getInstance(){return null==r.instance&&(r.instance=new r),r.instance}onInit(){this.rootNode=Laya.stage}loadUI(e,t){Laya.loader.create(e,Laya.Handler.create(this,function(i){let s=Laya.loader.getRes(e),a=new Laya.View;a.createView(s),t(a),Laya.stage.addChild(a)}))}showUI(e,t=null,i=null,s=999){let a=this,r=Laya.stage.getChildByName(e);null!=r?(r.getComponent(o).open(t),i&&i(r)):this.loadUI(n.UIRes+e+".json",function(e){a.rootNode||(a.rootNode=Laya.stage),a.rootNode.addChild(e),e.getComponent(o).open(t),i&&i(e)})}hideUI(e,t=null){let i=this.rootNode.getChildByName(e);null!=i&&i.getComponent(o).close(t)}showUIWithNode(e,t=null){e.getComponent(o).open(t)}}r.instance=null;class l{}l.onInit="onInit",l.getGGtype="getGGtype",l.showInsert="showInsert",l.showBanner="showBanner",l.showVideo="showVideo",l.more="more",l.yszc="yszc",l.exit="exit",l.pay="pay",l.doOrder="doOrder",l.showUI="showUI",l.hideBanner="hideBanner",l.hideInsertNativeAd="hideInsertNativeAd",l.toastShow="toastShow",l.addNativeNode="addNativeNode",l.hasShortcutInstalled="hasShortcutInstalled";class h{constructor(){this.bannerFlushTime=30,this.curBannerTime=0,this.insertCD=0,this.curInsertCDtime=0,this.hasPayNoAd="0",this.mapbtn=new Map,this.map_allNativeAd=new Map,window.SDK_Manager=this}static getInstance(){return null==this.mInstance&&(this.mInstance=new h),this.mInstance}onInit(){this.ui_manager=r.getInstance(),this.ui_manager.onInit()}Invoke(e,...t){console.log("==Invoke==:"+e),e==l.onInit&&this.onInit()}addNoAdsNode(e){this.mapbtn.set(e,!0)}}h.mInstance=null;class c{constructor(){this.wx=window.wx,this.rewardedVideoAd=null,this.GridAd=null,this.customAd=null,this.m_videoAdIsLoaded=!1,this.shareUrl="",this.recorder=null,this.timeCount=0,this.videoPath=null,this.recordTime=0,this.windowWidth=0,this.windowHeight=0,this.systemInfo=null,this.delay=!0,this.lastTimeInsert=0,this.intervalTime=0,this.ADcount=0,this.videoId="adunit-62453510fa695a5a",this.interstitialId="adunit-34b96259ec5951dc",this.bannerId="adunit-9feaee3590593d7a",this.custom1Id="adunit-2644825241e9e247",this.custom2Id="adunit-2644825241e9e247",this.custom3Id="adunit-dbc8f1d6a2c2768e",this.custom4Id="adunit-dbc8f1d6a2c2768e",this.custom5Id="adunit-b32649f9caa3bb0d",this.interstitialAd=null,this.videoAd=null,this.bannerAd=null,this.custom1Ad=null,this.custom2Ad=null,this.custom3Ad=null,this.custom4Ad=null,this.custom5Ad=null}share(e){throw new Error("Method not implemented.")}hideInsertNativeAd(){throw new Error("Method not implemented.")}createNative(e,t){throw new Error("Method not implemented.")}hasShortcutInstalled(e){throw new Error("Method not implemented.")}sendMessage(e,t){throw new Error("Method not implemented.")}getPlatform(){let e=null;return e=window.wx}onInit(e){this.initInterstitialAd(),this.initBannerAd(),this.initVideoAd(),this.initCustom5Ad(),this.initCustom1Ad(),this.initCustom2Ad(),this.initCustom3Ad(),this.initCustom4Ad(),this.GameClub(),this.showShareMenu()}GameClub(){const e=this.getPlatform();let t=e.getSystemInfoSync();e.createGameClubButton({icon:"light",style:{left:t.windowWidth-200,top:0,width:40,height:40}})}showShareMenu(){const e=this.getPlatform();e.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),e.onShareAppMessage(()=>({title:"国外山海经大乱斗，木棍人通通通",imageUrl:"https://yxcdn.wxshares.com/%E5%B1%B1%E6%B5%B7%E7%BB%8F/%E5%A4%96%E5%9B%BD%E5%B1%B1%E6%B5%B7%E7%BB%8F%E5%A4%A7%E4%B9%B1%E6%96%97/share.jpg"})),e.onShareTimeline(()=>({title:"国外山海经大乱斗，木棍人通通通",imageUrl:"https://yxcdn.wxshares.com/%E5%B1%B1%E6%B5%B7%E7%BB%8F/%E5%A4%96%E5%9B%BD%E5%B1%B1%E6%B5%B7%E7%BB%8F%E5%A4%A7%E4%B9%B1%E6%96%97/share.jpg"}))}onShare(e){this.getPlatform().shareAppMessage({title:"国外山海经大乱斗，木棍人通通通",imageUrl:"https://yxcdn.wxshares.com/%E5%B1%B1%E6%B5%B7%E7%BB%8F/%E5%A4%96%E5%9B%BD%E5%B1%B1%E6%B5%B7%E7%BB%8F%E5%A4%A7%E4%B9%B1%E6%96%97/share.jpg"})}showCustomAd(e=5){if(this.getPlatform())switch(e){case 1:this.custom1Ad&&this.custom1Ad.show();break;case 2:this.custom2Ad&&this.custom2Ad.show();break;case 3:this.custom3Ad&&this.custom3Ad.show();break;case 4:this.custom4Ad&&this.custom4Ad.show();break;default:this.custom5Ad&&this.custom5Ad.show()}else console.log("原生广告仅支持小游戏平台!")}hideCustomAd(e=5){if(this.getPlatform())switch(e){case 1:this.custom1Ad&&this.custom1Ad.hide();break;case 2:this.custom2Ad&&this.custom2Ad.hide();break;case 3:this.custom3Ad&&this.custom3Ad.hide();break;case 4:this.custom4Ad&&this.custom4Ad.hide();break;default:this.custom5Ad&&this.custom5Ad.hide()}else console.log("原生广告仅支持小游戏平台!")}initBannerAd(){const e=this.getPlatform();if(!e)return void console.log("banner广告仅支持小游戏平台!");let t=e.getSystemInfoSync(),i=t.windowWidth;t.windowHeight<=750&&(i=300),this.bannerAd=e.createBannerAd({adUnitId:this.bannerId,adIntervals:10,style:{height:t.windowHeight-80,left:0,top:500,width:i}}),this.bannerAd.onResize(e=>{this.bannerAd.style.top=t.windowHeight-this.bannerAd.style.realHeight,this.bannerAd.style.left=t.windowWidth/2-this.bannerAd.style.realWidth/2}),this.bannerAd.onError(e=>{console.error("banner广告初始化有误")})}showBanner(){this.bannerAd&&this.bannerAd.show()}hideBanner(){this.bannerAd&&this.bannerAd.hide()}initVideoAd(){let e=this;const t=this.getPlatform();t?(this.videoAd=t.createRewardedVideoAd({adUnitId:this.videoId}),this.videoAd.onLoad(()=>{e.m_videoAdIsLoaded=!0}),this.videoAd.onError(e=>{console.error("激励初始化有误")})):console.log("激励视频仅支持小游戏平台!")}showVideo(e,t,i){let s=this;const a=this.getPlatform();if(console.log("===============  正在拉取微信激励广告   ======================"),this.videoAd)this.videoAd.offClose(),this.videoAd.onClose(i=>{this.videoAd.offClose(),i&&i.isEnded||void 0===i?(e&&e(),s.videoAd.load()):(t&&t(),s.videoAd.load())}),this.videoAd.show().catch(()=>{s.videoAd.load().then(()=>s.videoAd.show()).catch(e=>{console.log("激励广告展示失败")})});else{this.videoAd=a.createRewardedVideoAd({adUnitId:this.videoId}),this.videoAd.show();const i=a=>{a&&a.isEnded||void 0===a?(e&&e(),s.videoAd.load()):(t&&t(),s.videoAd.load()),this.videoAd.offClose(i)};this.videoAd.onClose(i)}}showVideoAward(){this.videoType="",this.arg=null}showVideoFail(){this.videoType="",this.arg=null}initInterstitialAd(){const e=this.getPlatform();e?(console.log(this.interstitialId),this.interstitialAd=e.createInterstitialAd({adUnitId:this.interstitialId}),this.showInterstitialAd(),this.interstitialAd.onError(e=>{console.error("插屏初始化有误")})):console.log("banner广告仅支持小游戏平台!")}showInterstitialAd(){this.interstitialAd&&this.interstitialAd.show().catch(e=>{console.error("插屏加载失败")})}showInsertAd(){this.interstitialAd&&this.interstitialAd.show().catch(e=>{console.error("插屏加载失败")})}showInsertAd1(){this.interstitialAd&&this.interstitialAd.show().catch(e=>{console.error("插屏加载失败")})}initCustom1Ad(){const e=this.getPlatform();if(!e)return void console.log("原生广告初始化仅支持小游戏平台!");if(""==this.custom1Id)return void console.log("请配置原生广告id");let t=e.getSystemInfoSync();null==this.custom1Ad&&(this.custom1Ad=e.createCustomAd({adUnitId:this.custom1Id,style:{left:0,top:t.windowHeight/8,fixed:0}}),this.showCustomAd(1),this.custom1Ad.onError(e=>{console.error("原生广告初始化有误")}))}initCustom2Ad(){const e=this.getPlatform();if(!e)return void console.log("原生广告初始化仅支持小游戏平台!");if(""==this.custom2Id)return void console.log("请配置原生广告id");let t=e.getSystemInfoSync();null==this.custom2Ad&&(this.custom2Ad=e.createCustomAd({adUnitId:this.custom2Id,style:{left:t.windowWidth-58,top:t.windowHeight/7,fixed:0}}),this.showCustomAd(2),this.custom2Ad.onError(e=>{console.error("原生广告初始化有误")}))}initCustom3Ad(){const e=this.getPlatform();if(!e)return void console.log("原生广告初始化仅支持小游戏平台!");if(""==this.custom2Id)return void console.log("请配置原生广告id");let t=e.getSystemInfoSync();null==this.custom3Ad&&(this.custom3Ad=e.createCustomAd({adUnitId:this.custom3Id,style:{left:0,top:t.windowHeight/1.7,fixed:0}}),this.showCustomAd(3),this.custom3Ad.onError(e=>{console.error("原生广告初始化有误")}))}initCustom4Ad(){const e=this.getPlatform();if(!e)return void console.log("原生广告初始化仅支持小游戏平台!");if(""==this.custom2Id)return void console.log("请配置原生广告id");let t=e.getSystemInfoSync();null==this.custom4Ad&&(this.custom4Ad=e.createCustomAd({adUnitId:this.custom4Id,style:{left:t.windowWidth-58,top:t.windowHeight/1.7,fixed:0}}),this.showCustomAd(4),this.custom4Ad.onError(e=>{console.error("原生广告初始化有误")}))}initCustom5Ad(){const e=this.getPlatform();if(!e)return void console.log("原生广告初始化仅支持小游戏平台!");if(""==this.custom5Id)return void console.log("请配置原生广告id");let t=e.getSystemInfoSync();null==this.custom5Ad&&(this.custom5Ad=e.createCustomAd({adUnitId:this.custom5Id,style:{width:t.screenWidth/1.2,left:t.screenWidth/2-t.screenWidth/1.2/2,top:t.windowHeight/8,fixed:0}}),this.custom5Ad.onError(e=>{console.error("原生广告初始化有误")}))}showMoreGames(){this.showCustomAd(5)}hideMoreGames(){}vibrate(e){}}c.ISlp=!1,c.LpTime=0,c.lpstart=0,c.lpstop=0,function(e){e.game_tag="XYH_wanfa_bs",e.game_id=20018,e.game_user="XYH_wanfa_bs",e.YSZC=!1,e.YSZCInfo="",e.versoin=0,e.RESURL="",e.fogColor=new Laya.Vector3(.8,.4,0),e.ambientColor=new Laya.Vector3(.4,.4,.4),e.intensity=.3,e.sunAngle=-70,e.exposure=14.5,e.read=function(t){return Laya.LocalStorage.getItem(e.game_tag+"_"+e.game_id+"_"+t)},e.readJson=function(t){return Laya.LocalStorage.getJSON(e.game_tag+"_"+e.game_id+"_"+t)},e.save=function(t,i){Laya.LocalStorage.setItem(e.game_tag+"_"+e.game_id+"_"+t,i)},e.saveJson=function(t,i){Laya.LocalStorage.setJSON(e.game_tag+"_"+e.game_id+"_"+t,i)},e.copyList=function(e){for(var t=[],i=0;i<e.length;i++)t[t.length]=e[i];return t},e.removeListIffalse=function(e,t){for(var i=[],s=0;s<e.length;s++)t(e[s])&&(i[i.length]=e[s]);return i},e.Iffalse=function(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return!1;return!0}}(i||(i={}));class d extends cafe.table.BaseTable{constructor(){super(d.NAME);this.exp("q_chat",0)}getTbByTargetid(e){return this._tb.filter(t=>t.targetId==e)[0]}}d.NAME="chat";class u extends cafe.table.BaseTable{constructor(){super(u.NAME);this.exp("q_device",0)}getTbByDeviceId(e){return this._tb.filter(t=>t.deviceId==e)[0]}getTbByConfigId(e){return this._tb.filter(t=>t.configId==e)[0]}tb(){return this._tb}}u.NAME="device";class p extends cafe.table.BaseTable{constructor(){super(p.NAME);this.exp("q_drop",0)}getTbByDropId(e){return this._tb.filter(t=>t.dropId==e)[0]}getTbByProbability(e){return this._tb.filter(t=>t.probability>e)}getTbByCondition(e){return this._tb.filter(t=>e(t))}tb(){return this._tb}}p.NAME="drop";class m extends cafe.table.BaseTable{constructor(){super(m.NAME);this.exp("q_effect",0)}getTbByEffectId(e){return this._tb.filter(t=>t.effectId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}m.NAME="effect";class g extends cafe.table.BaseTable{constructor(){super(g.NAME);this.exp("q_effectAction",0)}getTbByEffectActionId(e){return this._tb.filter(t=>t.effectActionId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}g.NAME="effectAction";class y extends cafe.table.BaseTable{constructor(){super(y.NAME);this.exp("q_equip",0)}getTbByEquipId(e){return this._tb.filter(t=>t.equipId==e)[0]}getModByRoleId(e){return this._tb.filter(t=>t.equipId==e)[0].equipMod}tb(){return this._tb}}y.NAME="equip";class f extends cafe.table.BaseTable{constructor(){super(f.NAME);this.exp("q_func",0)}getFuncSwitch(e){return 1==this._tb.filter(t=>t.funcId==e)[0].funcSwitch}get AX_ARROW(){return this.getFuncSwitch(101)}tb(){return this._tb}}f.NAME="func";class _ extends cafe.table.BaseTable{constructor(){super(_.NAME);this.exp("q_furniture",0)}getTbByFurnitureId(e){return this._tb.filter(t=>t.furnitureId==e)[0]}getTbByModId(e){return this._tb.filter(t=>t.mod==e)[0]}getTbsByType(e){return this._tb.filter(t=>t.type==e)}tb(){return this._tb}}_.NAME="furniture";class v extends cafe.table.BaseTable{constructor(){super(v.NAME);this.exp("q_fuse",0)}getTbByFuseId(e){return this._tb.filter(t=>t.fuseId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}v.NAME="fuse";class b extends cafe.table.BaseTable{constructor(){super(b.NAME);this.exp("q_global",0)}getTbByGlobal(e){return this._tb.filter(t=>t.global_id==e)[0]}getValue(e){return this._tb.filter(t=>t.global_id==e)[0].global_value}tb(){return this._tb}}b.NAME="global";class w extends cafe.table.BaseTable{constructor(){super(w.NAME);this.exp("q_goods",0)}fetchGoodsTb(e){return this._tb.filter(t=>t.goodsId==e)[0]}getTbByType(e){return this._tb.filter(t=>t.type==e)}tb(){return this._tb}}w.NAME="goods";class T extends cafe.table.BaseTable{constructor(){super(T.NAME);this.exp("q_guide",0)}getTbByGuideId(e){return this._tb.filter(t=>t.guideId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))}tb(){return this._tb}}T.NAME="guide";class A extends cafe.table.BaseTable{constructor(){super(A.NAME);this.exp("q_home",0)}getTbByHomeId(e){return this._tb.filter(t=>t.homeId==e)[0]}getTbByLevel(e){return this._tb.filter(t=>t.level==e)[0]}tb(){return this._tb}}A.NAME="home";class x extends cafe.table.BaseTable{constructor(){super(x.NAME);x.LANGUAGE=x.CN,this.exp("q_language",0)}getTbByLanguageId(e){return this._tb.filter(t=>t.languageId==e)[0]}getCNByLanguageId(e){return this._tb.filter(t=>t.languageId==e)[0].cn}getENByLanguageId(e){return this._tb.filter(t=>t.languageId==e)[0].en}getContent(e){return this._tb.filter(t=>t.languageId==e)[0][x.LANGUAGE]}tb(){return this._tb}}x.NAME="language",x.CN="cn",x.EN="en";class k extends cafe.table.BaseTable{constructor(){super(k.NAME);this.exp("q_lottery",0)}getTbByLotteryId(e){return this._tb.filter(t=>t.lotteryItemId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}k.NAME="lottery";class E extends cafe.table.BaseTable{constructor(){super(E.NAME);this.exp("q_map",0)}getTbByMapID(){return this._tb.filter(e=>e.mapId)}getTbBymap(e){return this._tb.filter(t=>t.mapId==e)[0]}getTbByGameType(e){return this._tb.filter(t=>t.gametype==e)}getTbByTargetMap(e,t){var i=this._tb.filter(t=>t.mapId==e)[0],s=0,a=e=>{if(++s>10)return null;var i=e.mapEnter.split("|");if(-1==i.indexOf(t.toString())){for(var n,o=0;o<i.length;o++){var r=this._tb.filter(e=>e.mapId==Number(i[o]))[0],l=a(r);l&&(n=l)}return n}return e};return a(i)}getTbByType(e){return this._tb.filter(t=>t.type==e)}getTbByDefaultlock(e){return this._tb.filter(t=>t.defaultlock==e)}getTbByGamePkType(e){return this._tb.filter(t=>t.gamePkType==e)}tb(){return this._tb}}E.NAME="map";class I extends cafe.table.BaseTable{constructor(){super(I.NAME);this.exp("q_mapAni",0)}getTbByMapAniId(e){return this._tb.filter(t=>t.mapAniId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}I.NAME="mapAni";class C extends cafe.table.BaseTable{constructor(){super(C.NAME);this.exp("q_mission",0)}fetchMissionTb(e){return this._tb.filter(t=>t.missionId==e)[0]}getTbsByMissionType(e){return this._tb.filter(t=>t.missionType==e)}tb(){return this._tb}}C.NAME="mission";class L extends cafe.table.BaseTable{constructor(){super(L.NAME);this.exp("q_money",0)}getTbByMoneyId(e){return this._tb.filter(t=>t.moneyId==e)[0]}tb(){return this._tb}}L.NAME="money";class M extends cafe.table.BaseTable{constructor(){super(M.NAME);this.exp("q_monster",0)}getTbByMonsterId(e){return this._tb.filter(t=>t.monsterId==e)[0]}getTbByConfigId(e){return this._tb.filter(t=>t.configId==e)[0]}tb(){return this._tb}}M.NAME="monster";class S extends cafe.table.BaseTable{constructor(){super(S.NAME);this.exp("q_niudan",0)}getTbByNiuDanId(e){return this._tb.filter(t=>t.NiuDanId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}S.NAME="niudan";class P extends cafe.table.BaseTable{constructor(){super(P.NAME);this.exp("q_npc",0)}getTbByNpcId(e){return this._tb.filter(t=>t.npcId==e)[0]}getTbByConfigId(e){return this._tb.filter(t=>t.configId==e)[0]}tb(){return this._tb}}P.NAME="npc";class R extends cafe.table.BaseTable{constructor(){super(R.NAME);this.exp("q_planelayer",0)}getTbByplanelayerId(e){return this._tb.filter(t=>t.planelayerId==e)[0]}tb(){return this._tb}}R.NAME="planelayer";class D extends cafe.table.BaseTable{constructor(){super(D.NAME);this.exp("q_plot",0)}getTbByplotId(e){return this._tb.filter(t=>t.plotId==e)[0]}getTbByPlotGroup(e){return this._tb.filter(t=>t.plotGroup==e)}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}D.NAME="plot";class N extends cafe.table.BaseTable{constructor(){super(N.NAME);this.exp("q_remon",0)}getTbBySuoQuanId(e){return this._tb.filter(t=>t.suoQuanId==e)[0]}getTbByThingType(e){return this._tb.filter(t=>t.thingType==e)}tb(){return this._tb}}N.NAME="remon";class j extends cafe.table.BaseTable{constructor(){super(j.NAME);this.exp("q_role",0)}getTbByRoleId(e){return this._tb.filter(t=>t.roleId==e)[0]}getTypeByRoleId(e){return this._tb.filter(t=>t.roleId==e)[0].roleTypes.split("|")}getTblistByReturnRoleId(e){return this._tb.filter(t=>t.returnRole==e)}getModByRoleId(e){return this._tb.filter(t=>t.roleId==e)[0].roleMod}tb(){return this._tb}}j.NAME="role";class G extends cafe.table.BaseTable{constructor(){super(G.NAME);this.exp("q_roleLevel",0)}getTbByRoleLevelId(e){return this._tb.filter(t=>t.roleLevelId==e)[0]}getTbByLevel(e){return this._tb.filter(t=>t.level==e)[0]}tb(){return this._tb}}G.NAME="roleLevel";class B extends cafe.table.BaseTable{constructor(){super(B.NAME);this.exp("q_roleSkillMod",0)}getTbByRoleSkillModId(e){return this._tb.filter(t=>t.roleSkillModId==e)[0]}tb(){return this._tb}}B.NAME="roleSkillMod";class H extends cafe.table.BaseTable{constructor(){super(H.NAME);this.exp("q_route",0)}getTbByRouteId(e){return this._tb.filter(t=>t.routeId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}H.NAME="route";class O extends cafe.table.BaseTable{constructor(){super(O.NAME);this.exp("q_shop",0)}getTbByShopId(e){return this._tb.filter(t=>t.shopId==e)[0]}getTbByTargetId(e){return this._tb.filter(t=>t.targetId==e)[0]}fetchTbByIdType(e,t){return this._tb.filter(i=>i.targetId==e&&i.shopType==t)[0]}getTbByType(e,t=!1){return t?this._tb.filter(t=>t.shopType==e&&1==t.shopShow):this._tb.filter(t=>t.shopType==e)}tb(){return this._tb}}O.NAME="shop";class z extends cafe.table.BaseTable{constructor(){super(z.NAME);this.exp("q_signIn",0)}getTbByDay(e){return this._tb.filter(t=>t.day==e)[0]}tb(){return this._tb}}z.NAME="signin";class V extends cafe.table.BaseTable{constructor(){super(V.NAME);this.exp("q_skill",0)}getTbBySkillId(e){return this._tb.filter(t=>t.skillId==e)[0]}tb(){return this._tb}}V.NAME="skill";class F extends cafe.table.BaseTable{constructor(){super(F.NAME);this.exp("q_skillMod",0)}getTbBySkillModId(e){return this._tb.filter(t=>t.skillModId==e)[0]}tb(){return this._tb}}F.NAME="skillMod";class U extends cafe.table.BaseTable{constructor(){super(U.NAME);this.exp("q_sound",0)}getTbBysoundId(e){return this._tb.filter(t=>t.soundId==e)[0]}tb(){return this._tb}}U.NAME="sound";class q extends cafe.table.BaseTable{constructor(){super(q.NAME);this.exp("q_talk",0)}getTbBytalkId(e){return this._tb.filter(t=>t.talkId==e)[0]}getTbsByTalkList(e){for(var t=[],i=0;i<e.length;i++)t[t.length]=this.getTbByCondition(t=>t.talkId==Number(e[i]));return t}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}q.NAME="talk";class Y extends cafe.table.BaseTable{constructor(){super(Y.NAME);this.exp("q_task",0)}getTbByTaskId(e){return this._tb.filter(t=>t.taskId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}getTbByTaskPlot(e){return this._tb.filter(t=>-1!=t.taskPlotId.indexOf(e))[0]}getDesc(e){return this._tb.filter(t=>t.taskId==e)[0].taskDesc}getValue(e){return this._tb.filter(t=>t.taskId==e)[0].taskCount}tb(){return this._tb}}Y.NAME="task";class W extends cafe.table.BaseTable{constructor(){super(W.NAME);this.exp("q_test",0)}get isTest(){return 1==this._tb.filter(e=>7e4==e.testId)[0].testValue}get testMission(){var e=this._tb.filter(e=>7e4==e.testId)[0],t=this._tb.filter(e=>70001==e.testId)[0];return 1==e.testValue?t.testValue:0}tb(){return this._tb}}W.NAME="test";class X extends cafe.table.BaseTable{constructor(){super(X.NAME);this.exp("q_thing",0)}getTbByThingId(e){return this._tb.filter(t=>t.thingId==e)[0]}getTbByConfigIdAndType(e,t){return this._tb.filter(i=>i.type==e&&i.configId==t)[0]}getTbByConfigId(e){return this._tb.filter(t=>t.configId==e)[0]}getHpByConfigId(e){return this._tb.filter(t=>t.configId==e)[0].hp}getHpByConfigIdAndType(e,t){return this._tb.filter(i=>i.type==e&&i.configId==t)[0].hp}tb(){return this._tb}}X.NAME="thing";class K extends cafe.table.BaseTable{constructor(){super(K.NAME);this.exp("q_zhuanpan",0)}getTbByZhuanPanId(e){return this._tb.filter(t=>t.zhuanpanId==e)[0]}getTbByCondition(e){return this._tb.filter(t=>e(t))[0]}tb(){return this._tb}}K.NAME="zhuanpan",function(e){e.init=function(){cafe.table.init(a),cafe.table.reg(new d),cafe.table.reg(new u),cafe.table.reg(new p),cafe.table.reg(new m),cafe.table.reg(new g),cafe.table.reg(new y),cafe.table.reg(new f),cafe.table.reg(new _),cafe.table.reg(new v),cafe.table.reg(new b),cafe.table.reg(new w),cafe.table.reg(new T),cafe.table.reg(new A),cafe.table.reg(new x),cafe.table.reg(new k),cafe.table.reg(new E),cafe.table.reg(new I),cafe.table.reg(new C),cafe.table.reg(new L),cafe.table.reg(new M),cafe.table.reg(new S),cafe.table.reg(new P),cafe.table.reg(new R),cafe.table.reg(new D),cafe.table.reg(new j),cafe.table.reg(new G),cafe.table.reg(new B),cafe.table.reg(new H),cafe.table.reg(new O),cafe.table.reg(new z),cafe.table.reg(new V),cafe.table.reg(new F),cafe.table.reg(new U),cafe.table.reg(new q),cafe.table.reg(new Y),cafe.table.reg(new W),cafe.table.reg(new X),cafe.table.reg(new K),cafe.table.reg(new N)}}(s||(s={})),a||(a={});class J{}J.UNWALKABLE=1,J.WALKABLE=0,J.HIDE=2,J.TASK_TARGET_POINT=3,J.TASK_RANGE_UNWALKABL=4,J.TASK_RANGE_WALKABLE=5,J.TASK_AX_UNWALKABLE=6,J.PY_WALKABLE=7,J.PLANE_WALKABLE=8,J.PY_UNWALKABLE=9,J.FUNC_WALKABLE=10,J.GUIDE_WALKABLE=11,J.BUFF_WALKABL=12,J.GOLD_WALKABL=13,J.FOOT_UNWALKABL=14,J.BUFF=1,J.DATA=2,J.EFFECT=3,J.GOLD=4,J.GUIDE=5,J.PY=6,J.ROLE=7,J.TASK=8,J.THING=9,J.TIGGER=10,J.BUILD=11,J.MONSTER=12,J.MISSION=13,J.ENTER_MAP=14,J.DEVICE=15;class Z{}Z.EQUIP_ROLE="EQUIP_ROLE",Z.EQUIP_DEVICE="EQUIP_DEVICE",Z.EQUIP_NPC="EQUIP_NPC";class Q{}Q.wait=0,Q.move=1,Q.run=2,Q.back=3,Q.brake=4;class ${}$.none=0,$.land=1,$.startclimb=2,$.climb=3,$.rope1=4,$.rope2_1=5,$.rope2_2=6,$.rope3_1=7,$.rope3_2=8;const ee=["lv","move_speed"];class te{}te.KEYBOARD_NAME_RUN="J",te.KEYBOARD_NAME_ADDSPEEDRUN="K",te.KEYBOARD_NAME_BACK="Y",te.KEYBOARD_NAME_ATT="H",te.BTN_EVENT_NAME_RUN="BTN_EVENT_NAME_RUN",te.BTN_EVENT_NAME_ADDSPEEDRUN="BTN_EVENT_NAME_ADDSPEEDRUN",te.BTN_EVENT_NAME_BACK="BTN_EVENT_NAME_BACK",te.BTN_EVENT_NAME_ATT="BTN_NAME_ATT";class ie{}ie.startshow="startshow",ie.kemusan="kemusan",ie.qianxing="qianxing",ie.qianxingidle="qianxingidle",ie.daodiidle="daodiidle",ie.idle="idle",ie.idle1="idle1",ie.idle2="idle2",ie.walk="walk",ie.attack="attack",ie.attack0="attack0",ie.attack1="attack1",ie.attack2="attack2",ie.attack101="attack101",ie.attack102="attack102",ie.attack103="attack103",ie.attack106="attack106",ie.attack201="attack201",ie.attack202="attack202",ie.attack203="attack203",ie.run="run",ie.run1="run1",ie.run2="run2",ie.wait="wait",ie.loop="loop",ie.ride1="ride1",ie.ride2="ride2",ie.heixuanfeng="heixuanfeng",ie.tang1="tang1",ie.zuo="zuo",ie.jump="jump",ie.jump1="jump1",ie.jump2="jump2",ie.jump3="jump3",ie.jump4="jump4",ie.skill="skill",ie.fly="fly",ie.death="death",ie.ride="ride",ie.hit="hit",ie.yongbao="hug",ie.sajiao="sajiao",ie.dazhaohu="dazhaohu",ie.baoqi="baoqi",ie.baoqidaiji="baoqidaiji",ie.banyun="banyun",ie.banyundaiji="banyundaiji",ie.chuizi="chuizi",ie.lutou="lutou",ie.qiang="qiang",ie.npcqiang="npcqiang",ie.qi="qi",ie.che="che",ie.show="show",ie.pa="pa",ie.paidle="paidle",ie.shengsuo="shengsuo",ie.shengsuofeixing="shengsuofeixing",ie.zhuiluo="zhuiluo",ie.zhuiluoqishen="zhuiluoqishen",ie.fuckcar="fuckcar",ie.xiacar="xiacar",ie.motuo="motuo",ie.xiamotuo="xiamotuo",ie.fuckmotuo="fuckmotuo",ie.qiangidle="qiangidle",ie.liangqiang="liangqiang",ie.qingzhu="qingzhu",ie.huabang="huabang",ie.kuqi="kuqi";class se{}se.updateEquip="updateEquip",se.updateEquipButton="updateEquipButton",se.SIGNUICHANGE="SIGNUICHANGE",se.MONSTERFENGYING="MONSTERFENGYING",se.CHANGECAMERA="CHANGECAMERA",se.LOADTHING="LOADTHING",se.MONSTERSTARTSHOW="MONSTERSTARTSHOW",se.MONSTERSTARTSHOW2="MONSTERSTARTSHOW2",se.CLOSEQP="CLOSEQP",se.NPCTAOTAI="NPCTAOTAI",se.NPCXURUO="NPCXURUO",se.NPCQP="NPCQP",se.HAILANGSTOP="HAILANGSTOP",se.RESTARTHAILANG="RESTARTHAILANG",se.CANCELSKILL="CANCELSKILL",se.ClOSEPANELHANDLE="ClOSEPANELHANDLE",se.MONSTERFUYUAN="MONSTERFUHUO",se.GETBUFF="GETBUFF",se.NOFOLLOW="NOFOLLOW",se.ISFOLLOW="ISFOLLOW",se.PENPENCHEINITPOS="PENPENCHEINITPOS",se.PENPENCHEPAIHANBAN="PENPENCHEPAIHANBAN",se.PENPENCHEAIBEIZHUAN="PENPENCHEAIBEIZHUAN",se.DQ="DQ",se.INITCARSPEED="INITCARSPEED",se.PONPONCHE="PONPONCHE",se.NPCPOS="NPCPOS",se.UPDATEROLESPEED="UPDATEROLESPEED",se.INITROLEEQUIP="INITROLEEQUIP",se.INITNPCEQUIP="INITNPCEQUIP",se.SYSTEM_FOCUS_CHANGE="SYSTEM_FOCUS_CHANGE",se.KEY_BOARD_LISTENER="KEY_BOARD_LISTENER",se.KEY_BOARD_UP_LISTENER="KEY_BOARD_UP_LISTENER",se.LONG_DOWN_BTN_="LONG_DOWN_BTN_",se.DOWN_BTN_="DOWN_BTN_",se.GAME_CD_TIMER_START="GAME_CD_TIMER_START",se.GAME_CD_TIMER_ADD="GAME_CD_TIMER_ADD",se.GAME_CD_TIMER_PRASE="GAME_CD_TIMER_PRASE",se.GAME_CD_TIMER_WARN_SET="GAME_CD_TIMER_WARN_SET",se.GAME_CD_TIMER_WARN="GAME_CD_TIMER_WARN",se.GAME_CD_TIMER_END="GAME_CD_TIMER_END",se.GAME_ACTION_CD_TIME_START="GAME_ACTION_CD_TIME_START",se.GAME_ACTION_CD_TIME_END="GAME_ACTION_CD_TIME_END",se.GAME_ACTION_CD_TIME_STOP="GAME_ACTION_CD_TIME_STOP",se.GAME_ATT_FRIE="GAME_ATT_FRIE",se.GAME_ADD_SPEED="GAME_ADD_SPEED",se.GAME_BLOOD_EFFECT="GAME_BLOOD_EFFECT",se.GAME_ZD_EFFECT="GAME_ZD_EFFECT",se.GAME_WARN_EFFECT="GAME_WARN_EFFECT",se.GAME_WARN_READY_EFFECT="GAME_WARN_READY_EFFECT",se.GAME_WARN_ATTACK_EFFECT="GAME_WARN_ATTACK_EFFECT",se.GAME_BUFF_ADD_POWER="GAME_BUFF_ADD_POWER",se.GAME_BUFF_MAGNET="GAME_BUFF_MAGNET",se.GAME_BUFF_ADD_HP="GAME_BUFF_ADD_HP",se.GAME_RIDE_DOWN="GAME_RIDE_DOWN",se.GAME_ATT_STATE="GAME_ATT_STATE",se.GAME_ATT_FORCE_STOP="GAME_ATT_FORCE_STOP",se.GAME_TIGGER_REMOVE="GAME_TIGGER_REMOVE",se.ROLESHOP="ROLESHOP",se.NPCSHOP="NPCSHOP",se.GAME_WEAPON_EQUIP="GAME_WEAPON_EQUIP",se.GAME_CAR_EQUIP="GAME_CAR_EQUIP",se.GAME_TASK_COUNT_REF="GAME_TASK_COUNT_REF",se.GAME_TRIGGER_TASK_COUNT_REF="GAME_TRIGGER_TASK_COUNT_REF",se.GAME_TASK_REF="GAME_TASK_REF",se.GAME_CAMERA_INIT_REF="GAME_CAMERA_INIT_REF",se.GAME_START_REF="GAME_START_REF",se.GAME_TASK_CAR_REF="GAME_TASK_CAR_REF",se.GAME_TASK_END_REF="GAME_TASK_END_REF",se.GAME_PRASE_SOUND="GAME_PRASE_SOUND",se.GAME_LOGIC_YINBAO="GAME_LOGIC_YINBAO",se.GAME_LOGIC_YINBAO_BACK="GAME_LOGIC_YINBAO_BACK",se.NPCUNDEVICE="NPCUNDEVICE",se.MAP_MPT_REF="MAP_MPT_REF",se.MAP_MPT_LOADED="MAP_MPT_LOADED",se.MAP_ROLE_LOADED="MAP_ROLE_LOADED",se.MAP_STATE_CHANGE="MAP_STATE_CHANGE",se.ON_LOAD_MPT_PROGRESS="ON_LOAD_MPT_PROGRESS",se.SLIME_LEVEL_REF="SLIME_LEVEL_REF",se.PLAYER_GAMESCENE_PLAYER_COUNT="PLAYER_GAMESCENE_PLAYER_COUNT",se.ONE_PLAYER_CHANGE="ONE_PLAYER_CHANGE",se.GAME_REPLACE_PLAYER_MODE="GAME_REPLACE_PLAYER_MODE",se.GAME_RIDE_PLAYER_MODE="GAME_RIDE_PLAYER_MODE",se.GAME_UNRIDE_PLAYER_MODE="GAME_UNRIDE_PLAYER_MODE",se.GAME_PLAYER_DIE="GAME_PLAYER_DIE",se.GAME_PLAYER_ACTION_REF="GAME_PLAYER_ACTION_REF",se.GAME_NPC_CH="GAME_NPC_CH",se.OPEN_PANEL="OPEN_PANEL",se.CLOSE_PANEL="CLOSE_PANEL",se.CLOSE_GAME_PANEL="CLOSE_GAME_PANEL",se.TEST1="TEST1",se.TEST2="TEST2",se.SUOQUAN_MUSIC_QUESTION="SUOQUAN_MUSIC_QUESTION";class ae extends Laya.Script3D{constructor(){super(),this.isdispose=!1,this.active=!1,this.active=!1,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}onEnable(){super.onEnable()}binGuide(){this.owner.timerOnce(100,this,()=>{this.bin("GUIDE_DATA",this.handleGuideTransition)})}static getid(e){return e._lbs3id?e._lbs3id:(e._lbs3id=ae._lbs3id,ae._lbs3id++,e._lbs3id)}handleGuideTransition(){}addCom(e,t){if(!e)return null;var i=e.addComponent(t);return this.comMap[ae.getid(e)+"_"+t.name]={target:e,com:i},i}layaMonitor(e,t,i,...s){this.layaMap[ae.getid(i)+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}addClick(e,...t){this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t)}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}onClickHandler(e){}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[ae.getid(e)+"_"+t.name];delete this.comMap[ae.getid(e)+"_"+t.name],i&&i.com&&i.com.destroy()}onDestroy(){super.onDestroy(),this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),this.isdispose=!0}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}}ae._lbs3id=0;class ne extends ae{onEnable(){}init(e){this.handler=e}skillfire(){var e=this.handler;e&&e.runWith(["skillfire"])}skillhit(){var e=this.handler;e&&e.runWith(["skillhit"])}attack(){var e=this.handler;e&&e.runWith(["attack"])}onDestroy(){super.onDestroy()}}class oe extends ae{constructor(){super(...arguments),this._speed=1,this._count=0,this.ishang=!1}onEnable(){}init(e,t){this.handler=t,this.ani=e.getComponent(Laya.Animator);var i=e.getComponent(ne);i||(i=e.addComponent(ne)),i.init(new Laya.Handler(this,this.aniBack)),this.aniState=i}uninstall(){this.aniState||(this.aniState.destroy(),this.aniState=null)}play(e,t){this.state=e,this.skillHandler=t}set state(e){if(this.ani){this.skillHandler=null,this.curAniState=e;var t=this.ani.getControllerLayer(0).getAnimatorState(e);"walk"!=e||t||(this.curAniState=e,t=this.ani.getControllerLayer(0).getAnimatorState("run"),e="run"),t?(this._count=0,this.ani.play(e),this.speed=this._speed,this._state=e,this.ishang=!0):slog("错误没有动作：",e)}}get state(){return this._state}set speed(e){this._speed!=e&&this.ani&&(this.ani.speed=e),this._speed=e}get speed(){return this._speed}onUpdate(){let e=this;e.ani&&e.ani.getControllerLayer().getCurrentPlayState().normalizedTime>=1&&e._count>=1&&e.ishang&&(e.onPlayerEnd(e.ani.getControllerLayer().getCurrentPlayState().animatorState.name),e.ishang=!1),e._count++}onPlayerEnd(e){var t;this.handler&&(t=this.handler),this.aniBack("finish"),t&&t.runWith([e])}aniBack(e){var t=this.skillHandler;t&&t.runWith([e])}onDestroy(){super.onDestroy();let e=this;e.ani&&(e.ani.destroy(),e.ani=null)}}class re extends oe{onEnable(){let e=this;var t=e.owner.getChildByName("body"),i=t.getChildByName("mode");e.ani=i?i.getComponent(Laya.Animator):t.getComponent(Laya.Animator)}onPlayerEnd(e){e==ie.loop&&(this.state=ie.wait,cafe.event.dispatch(se.GAME_RIDE_DOWN))}onDestroy(){super.onDestroy()}}class le{}le.type_thing=1,le.type_effect=2,le.type_role=3,le.type_npc=4,le.type_carnpc=5,le.type_wznpc=6,le.type_device=7,le.type_monster=8,le.type_car=9,le.type_transfer=10,le.type_buff=11,le.type_gold=12,le.type_task=13,le.type_bath=14,le.type_camera=20,le.distancetype_noloading=4,le.distancetype_preloading=3,le.distancetype_replacemodel=2,le.distancetype_showmodel=1;class he{constructor(e){this.isdispose=!1,this.owner=e,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}static getid(e){return e._lcid?e._lcid:(e._lbs3id=he._lcid,he._lcid++,e._lcid)}addCom(e,t){var i=e.addComponent(t);return this.comMap[he.getid(e)+"_"+t.name]={target:e,com:i},i}layaMonitor(e,t,i,...s){this.layaMap[he.getid(i)+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}addClick(e,...t){this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t)}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}onClickHandler(e){}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[he.getid(e)+"_"+t.name];delete this.comMap[he.getid(e)+"_"+t.name],i&&i.com&&i.com.destroy()}destroy(){this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),this.isdispose=!0}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}}he._lcid=0;class ce{static get hostUrl(){return""}static fullPath(e){return""!=ce.hostUrl&&-1!=e.indexOf(ce.hostUrl)?e:ce.hostUrl+e}static fullD3Path(e){return""!=ce.hostUrl&&-1!=e.indexOf(ce.hostUrl)?e:ce.hostUrl+ce.d3res+e}static map(e){return ce.fullD3Path(`3dmap/${e}.lh`)}static role(e){return ce.fullD3Path(`role/${e}.lh`)}static get map_res(){return`${ce.hostUrl}${ce.d3res}scene/`}static get map_data(){return`${ce.hostUrl}${ce.dconfig}map/`}static get tigger_data(){return`${ce.hostUrl}${ce.dconfig}tiggerdata/`}static get effect_data(){return`${ce.hostUrl}${ce.dconfig}effectdata/`}static get effect_path(){return`${ce.hostUrl}${ce.dconfig}effectpath/`}static get thing_data(){return`${ce.hostUrl}${ce.dconfig}thing/`}static get mapdata_data(){return`${ce.hostUrl}${ce.dconfig}mapdata/`}static get role_data(){return`${ce.hostUrl}${ce.dconfig}roledata/`}static get role_path(){return`${ce.hostUrl}${ce.dconfig}rolepath/`}static get tigger_path(){return`${ce.hostUrl}${ce.dconfig}tigger/`}static get mapthing_data(){return`${ce.hostUrl}${ce.dconfig}mapthing/`}static getEffect(e){return`${ce.hostUrl}${ce.dconfig}effectpath/${e}.json`}static getEffectUrl(e){return`${ce.hostUrl}${ce.d3res}scene_effect/${e}`}static getRole(e){return`${ce.hostUrl}${ce.dconfig}rolepath/${e}.json`}static getRoletUrl(e){return`${ce.hostUrl}${ce.d3res}role/${e}`}static getMapThing(e){return`${ce.hostUrl}${ce.dconfig}mapthing/${e}.json`}static getPropUrl(e){return`${ce.hostUrl}${ce.d3res}prop_res/${e}`}static getPropEffectUrl(e){return`${ce.hostUrl}${ce.d3res}prop_effect/${e}`}static getBuildUrl(e){return`${ce.hostUrl}${ce.d3res}build/${e}`}static getMapUrl(e){return`${ce.hostUrl}${ce.d3res}3dmap/${e}`}}ce.versoin=10001,ce.d3res="res/res3D/",ce.db="res/dbres/",ce.dconfig="res/config/";class de extends he{constructor(){super()}static get inst(){return de._inst||(de._inst=new de),de._inst}localride(e){this.unride();var t=ea.scene.player.owner,i=Tn.inst.load3d.mapThingRes(ce.getPropUrl,4,t.dthing,String(e),ea.scene.mainscene.getChildByName("map"));i&&(ta.toTrBy9Tr(i,t),Ve.map.mptData.devicePush(i),this.ride=i)}localridepopoc(e){this.unride();var t=ea.scene.player.owner,i=Tn.inst.load3d.mapThingRes(ce.getPropUrl,4,t.dthing,String(e),ea.scene.mainscene.getChildByName("map"));i&&(ta.toTrBy9Tr(i,t),Ve.map.mptData.devicePush(i),this.ride=i)}loadCar(e,t){var i=Tn.inst.load3d.mapThingRes(ce.getPropUrl,5,e.dthing,String(t),ea.scene.mainscene.getChildByName("map"));return i?(ta.toTrBy9G(i,e.initPoint),Ve.map.mptData.devicePush(i),i):null}unride(){this.ride&&(this.ride.removeSelf(),this.ride.destroy(),this.ride=null)}dispose(){}}class ue{}ue.LevelA=0,ue.LevelB=1,ue.LevelC=2,ue.LevelD=3,ue.LevelE=4,ue.LevelF=5,ue.LevelG=6,ue.LevelH=7;class pe{}pe.rescfg_table=0,pe.rescfg_json=1,pe.reszip_type=0,pe.img2d_res=0,pe.res2d_atlas=1,pe.scene2d_res=2,pe.res2d_db=3,pe.res3d_group_role=100,pe.res3d_group_prop=200,pe.res3d_group_scene=300,pe.res3d_group_build=400,pe.res3d_group_3dmap=500,pe.sound_music=0,pe.sound_effect=1,pe.sound_voice=2,pe.resmap_type=0;class me{}me.rescfg=0,me.reszip=1,me.res2d=2,me.res3d=3,me.ressud=4,me.resmap=5,me.resmission=6;class ge{}ge.system=new class{constructor(){this.FOCUS_CHANGE="SYSTEM_FOCUS_CHANGE"}},ge.panel=new class{constructor(){this.OPEN_PANEL="EVENT_OPEN_PANEL",this.CLOSE_PANEL="EVENT_CLOSE_PANEL"}},ge.keyboard=new class{constructor(){this.KEY_BOARD_LISTENER="KEY_BOARD_LISTENER",this.KEY_BOARD_UP_LISTENER="KEY_BOARD_UP_LISTENER"}},ge.data=new class{constructor(){this.ref_map_data="ref_map_data"}},ge.pro=new class{constructor(){this.ref_pro_list="ref_pro_list",this.ref_cur_pro="ref_cur_pro"}},ge.game=new class{constructor(){this.PENPENCHEPLAYERMOVE="PENPENCHEPLAYERMOVE",this.DOOR="DOOR",this.LOAD_END_SHOW_UI="LOAD_END_SHOW_UI",this.Tips_SHOW_UI="Tips_SHOW_UI",this.ROLE_MOD_REPLACE_FINISH="ROLE_MOD_REPLACE_FINISH",this.DEVICE_MOD_REPLACE_FINISH="DEVICE_MOD_REPLACE_FINISH",this.UNDEVICE_MOD_REPLACE_FINISH="UNDEVICE_MOD_REPLACE_FINISH",this.ROLE_REPLACE_FINISH="ROLE_REPLACE_FINISH",this.ROLE_INSTALL_MOVE="ROLE_INSTALL_MOVE",this.ROLE_INSTALL_SKILL="ROLE_INSTALL_SKILL",this.ROLE_INSTALL_ACTION="ROLE_INSTALL_ACTION",this.ROLE_USE_ACTION="ROLE_USE_ACTION",this.ROLE_USE_ACTION_FINISH="ROLE_USE_ACTION_FINISH",this.ROLE_ADD_ACTION="ROLE_ADD_ACTION",this.ROLE_TRIGGER_ACTION="ROLE_TRIGGER_ACTION",this.MONSTER_INSTALL_STATE="MONSTER_INSTALL_STATE",this.USE_JUMP_ACTION="USE_JUMP_ACTION",this.ADD_JUMP_ACTION="ADD_JUMP_ACTION",this.USE_GRAVITY_ACTION="USE_GRAVITY_ACTION",this.STOP_GRAVITY_ACTION="STOP_GRAVITY_ACTION",this.ROLE_USE_SKILL="ROLE_USE_SKILL",this.SKILL_DATA_INIT_FINISH="SKILL_DATA_INIT_FINISH",this.MAP_TRANSFER_POINT="MAP_TRANSFER_POINT",this.MAP_START_REPLACE_FINISH="MAP_START_REPLACE_FINISH",this.MAP_REPLACE_FINISH="MAP_REPLACE_FINISH",this.NEXT_LAYER_POINT="NEXT_LAYER_POINT",this.GUIDE_HIDE="GUIDE_HIDE",this.REPLACE_FURNITURE="REPLACE_FURNITURE",this.CMD="CMD",this.TOOLCMD="TOOLCMD",this.ONCLIMB="ONCLIMB"}},ge.task=new class{constructor(){this.TASK_FINISH="TASK_FINISH",this.TASK_REF="TASK_REF"}};class ye{}ye.REPLACE_FURNITURE=20,ye.ENTER_HOME=21,ye.ENTER_MAP=22,ye.SHOW_TASK=40,ye.CAMERA_TASK=48,ye.TIPS=1,ye.TASK_TIGGER=2,ye.CAMERA_GLOBAL=8;class fe extends Laya.Script{constructor(){super()}static initSize(e,t){fe.sourceW=e,fe.sourceH=t,Laya.stage.on(Laya.Event.FOCUS_CHANGE,fe.thisobj,fe.onFocusChangeHandler),Laya.stage.on(Laya.Event.RESIZE,fe.thisobj,fe.onStageResize),fe.onStageResize()}static onFocusChangeHandler(){cafe.event.dispatch(ge.system.FOCUS_CHANGE,Laya.stage.isFocused)}static getGlobal(e){for(var t=new Laya.Point(0,0),i=e;i.parent;)t.x+=i.x+i.pivotX,t.y+=i.y+i.pivotY,i.anchorX,i=e.parent}static getSid(e){return e.$_GID}static onStageResize(e){if(Laya.stage.width!=Laya.Browser.width||Laya.stage.height!=Laya.Browser.height){Laya.stage.size(Laya.Browser.width,Laya.Browser.height);var t=Laya.Browser.width,i=Laya.Browser.height;slog("stage W & H:",Laya.Browser.width,Laya.Browser.height),fe.width=t,fe.height=i;var s=t/fe.sourceW,a=i/fe.sourceH;if(fe.width>fe.height){var n=fe.height/fe.width;Math.floor(1e3*n)>700?fe.SCREEN=fe.PAD:Math.floor(1e3*n)>500?fe.SCREEN=fe.AND500:Math.floor(1e3*n)<500&&(fe.SCREEN=fe.LONG_PIXE)}else if(fe.width<fe.height){n=fe.width/fe.height;Math.floor(1e3*n)>700?fe.SCREEN=fe.PAD:Math.floor(1e3*n)>500?fe.SCREEN=fe.AND500:Math.floor(1e3*n)<500&&(fe.SCREEN=fe.LONG_PIXE)}var o=fe.sourceW/t,r=fe.sourceH/i;fe.maxScale=s<a?a:s,fe.minScale=s>a?a:s,fe.minS=s>a?r:o,fe.maxS=s<a?r:o,cafe.event.dispatch(Laya.Event.RESIZE)}}onEnable(){super.onEnable(),this.owner?(this.pos_scale_dic={},this.owner.this_bg&&this.savepos(this.owner.this_bg),this.owner.mthis_bg&&this.savepos(this.owner.mthis_bg),this.owner.img_mapbg&&this.savepos(this.owner.img_mapbg),this.owner.group_left&&this.savepos(this.owner.group_left),this.owner.group_left_top&&this.savepos(this.owner.group_left_top),this.owner.group_left_bottom&&this.savepos(this.owner.group_left_bottom),this.owner.group_top&&this.savepos(this.owner.group_top),this.owner.group_bottom&&this.savepos(this.owner.group_bottom),this.owner.group_center&&this.savepos(this.owner.group_center),this.owner.group_right&&this.savepos(this.owner.group_right),this.owner.group_right_top&&this.savepos(this.owner.group_right_top),this.owner.group_right_bottom&&this.savepos(this.owner.group_right_bottom),this.owner.group_content&&this.savepos(this.owner.group_content),this.owner.group_content1&&this.savepos(this.owner.group_content1),this.owner.group_content2&&this.savepos(this.owner.group_content2),this.owner.group_panel&&this.savepos(this.owner.group_panel),this.owner.group_giverole&&this.savepos(this.owner.group_giverole),this.owner.group_actionflash&&this.savepos(this.owner.group_actionflash),this.owner.group_native&&this.savepos(this.owner.group_native),this.owner.group_native2&&this.savepos(this.owner.group_native2),cafe.event.on(Laya.Event.RESIZE,this.onResize,this),this.onResize()):serror("MateUiSize.onEnable===>owner为空这是怎么进来的")}savepos(e){this.pos_scale_dic[fe.getSid(e)]={x:e.x,y:e.y,centerX:e.centerX,centerY:e.centerY,left:e.left,right:e.right,top:e.top,bottom:e.bottom}}onResize(){var e=fe.width,t=fe.height;this.owner&&(this.owner.width=e,this.owner.height=t),this.auto9Size(),this.owner&&this.owner.onResize&&this.owner.onResize()}auto9Size(){this.owner?(this.owner.this_bg&&this.autoSize(this.owner.this_bg,!0),this.owner.mthis_bg&&(fe.SCREEN==fe.AND500?this.autoSize(this.owner.mthis_bg,!0):fe.SCREEN==fe.LONG_PIXE?this.autoSize2(this.owner.mthis_bg):this.autoSize(this.owner.mthis_bg,!0)),this.owner.img_mapbg&&this.autoSize(this.owner.img_mapbg),this.owner.group_left&&this.autoSize(this.owner.group_left),this.owner.group_left_top&&this.autoSize(this.owner.group_left_top),this.owner.group_left_bottom&&this.autoSize(this.owner.group_left_bottom),this.owner.group_top&&this.autoSize(this.owner.group_top),this.owner.group_bottom&&this.autoSize(this.owner.group_bottom),this.owner.group_center&&this.autoSize(this.owner.group_center),this.owner.group_right&&this.autoSize(this.owner.group_right),this.owner.group_right_top&&this.autoSize(this.owner.group_right_top),this.owner.group_right_bottom&&this.autoSize(this.owner.group_right_bottom),this.owner.group_content&&this.autoSize(this.owner.group_content),this.owner.group_content1&&this.autoSize(this.owner.group_content1),this.owner.group_content2&&this.autoSize(this.owner.group_content2),this.owner.group_native&&this.autoSize(this.owner.group_native),this.owner.group_native2&&this.autoSize(this.owner.group_native2),this.owner&&(fe.SCREEN==fe.PAD?(this.owner.group_panel&&this.autoSize(this.owner.group_panel),this.owner.group_giverole&&this.autoSize(this.owner.group_giverole),this.owner.group_actionflash&&this.autoSize(this.owner.group_actionflash)):(this.owner.group_panel&&this.autoSize(this.owner.group_panel,!0),this.owner.group_giverole&&this.autoSize(this.owner.group_giverole,!0),this.owner.group_actionflash&&this.autoSize(this.owner.group_actionflash,!0)))):serror("MateUiSize.onEnable===>owner为空这是怎么进来的")}autoSize(e,t=!1){t?(e.scale(fe.maxScale,fe.maxScale),this.autoPos(e,fe.maxScale)):(e.scale(fe.minScale,fe.minScale),this.autoPos(e,fe.minScale))}autoSize2(e){var t=fe.width/e.width,i=fe.height/e.height,s=t>i?t:i;if(e.scale(s,s),this.pos_scale_dic[fe.getSid(e)]){var a=this.pos_scale_dic[fe.getSid(e)];e.x=a.x*s,e.y=a.y*s,e.centerX=a.centerX*s,e.centerY=a.centerY*s,e.left=a.left*s,e.right=a.right*s,e.top=a.top*s,e.bottom=a.bottom*s}}autoPos(e,t){if(this.pos_scale_dic[fe.getSid(e)]){var i=this.pos_scale_dic[fe.getSid(e)];e.x=i.x*t,e.y=i.y*t,e.centerX=i.centerX*t,e.centerY=i.centerY*t,e.left=i.left*t,e.right=i.right*t,e.top=i.top*t,e.bottom=i.bottom*t}}onDisable(){cafe.event.off(Laya.Event.RESIZE,this.onResize,this),Laya.stage.off(Laya.Event.FOCUS_CHANGE,fe,fe.onFocusChangeHandler),super.onDisable()}}fe.sourceW=1136,fe.sourceH=540,fe.minScale=1,fe.maxScale=1,fe.minS=1,fe.maxS=1,fe.PAD=1,fe.LONG_PIXE=2,fe.AND500=3;class _e{static init(){_e.layers={},cafe.event.on(Laya.Event.RESIZE,_e.onResize,{}),_e.onResize()}static onResize(){for(var e in _e.layers){var t=_e.layers[e];t.x=0,t.y=0,t.width=fe.width,t.height=fe.height}}static setStage(e,t){for(var i=0;i<t.length;i++){var s=new Laya.Box;s.x=0,s.y=0,s.width=fe.width,s.height=fe.height,s.mouseThrough=!0,_e.layers[t[i]]=e.addChild(s)}}static getLayer(e){return _e.layers?_e.layers[e]:Laya.stage}static dispose(){for(var e in _e.layers)_e.layers[e].removeSelf(),delete _e.layers[e]}}_e.isWorking=!1;class ve{static init(e){ve.reslist=e}static getRes(e){for(var t=[],i=ve.reslist[e],s=[],a=0;a<i.length;a++){var n=i[a],o=n.substring(0,n.lastIndexOf(".")),r=n.substring(n.lastIndexOf(".")+1);if(e!=n)switch(r){case"atlas":t.push({url:o,type:me.res2d,restype:pe.res2d_atlas});break;case"png":case"jpg":t.push({url:n,type:me.res2d,restype:pe.img2d_res});break;case"scene":for(var l=ve.getRes(n),h=0;h<l.length;h++)t.push(l[h]),-1==l[h].url.lastIndexOf(".")?s.push(l[h].url+".atlas"):s.push(l[h].url);t.push({url:n,type:me.res2d,restype:pe.scene2d_res})}else t.push({url:n,type:me.res2d,restype:pe.scene2d_res})}return t}}class be{static init(){var e=be;e.panelurls={},e.casePaanelUrls={},be.thisobj={},cafe.event.on("CAFE_OPEN_PANEL",be.onCafeOpenPanelHandler,be.thisobj),cafe.event.on("CAFE_TIP_SHOW",be.onCafeOpenTipsHandler,be.thisobj),be.isPanelInit=!0}static onCafeOpenTipsHandler(e){window.TipsView.show(e.content)}static onCafeOpenPanelHandler(e){switch(slog("CAFE_OPEN_PANEL:",e),e.type){case 1:be.openpanel(e.path,e.params);break;case 6:be.openalphapanel(e.path,0,e.params)}}static getRes(e){var t=[],i=ve.reslist[e];if(!i)return[];for(var s=[],a=0;a<i.length;a++){var n=i[a],o=n.substring(0,n.lastIndexOf(".")),r=n.substring(n.lastIndexOf(".")+1);if(e!=n)switch(r){case"atlas":t.push({url:o,type:me.res2d,restype:pe.res2d_atlas});break;case"png":case"jpg":t.push({url:n,type:me.res2d,restype:pe.img2d_res});break;case"scene":for(var l=be.getRes(n),h=0;h<l.length;h++)t.push(l[h]),-1==l[h].url.lastIndexOf(".")?s.push(l[h].url+".atlas"):s.push(l[h].url);t.push({url:n,type:me.res2d,restype:pe.scene2d_res})}}return t}static opennobgpanel(e,t,i=!1){var s=be;if(!s.panelurls[e]){var a=s.panelurls[e];if(!a||!a.isWorking){cafe.event.dispatch(ge.game.GUIDE_HIDE);var n=new Laya.Box;if(n.mouseEnabled=!1,n.mouseThrough=!0,serror("打开界面: "+e),_e.getLayer(2).addChild(n),a={bg:null,box:n,panel:null,mouseEnabled:!1,isWorking:!0,isEnd:!1},s.panelurls[e]=a,cafe.event.dispatch(ge.panel.OPEN_PANEL),s.casePaanelUrls[e]){var o=s.casePaanelUrls[e];return o._param=t,n.addChild(o),s.isWorking=!1,o.name=e,a.panel=o,o.mouseEnabled=!1,void(a.isWorking=!1)}be.showsmallloadding(),cafe.event.dispatch("res_load",{urls:be.getRes(e),handler:initHandler(s,o=>{if(!o)return cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"界面不见了！！！"]),be.hidesmallloadding(),void s.closepanel(e);Laya.Dialog.load(e,initHandler(s,o=>{be.hidesmallloadding(),i&&(s.casePaanelUrls[e]=o),o._param=t,n.addChild(o),s.isWorking=!1,o.name=e,a.panel=o,o.mouseEnabled=!1,a.isWorking=!1}),s.smallprosshandler)}),priority:ue.LevelA,prosshandler:s.smallprosshandler})}}}static openalphapanel(e,t,i,s=!0,a=!1,n=!1){var o=be;if(!o.panelurls[e]){var r=o.panelurls[e];if(!r||!r.isWorking){var l=new Laya.Box;serror("打开界面: "+e),cafe.event.dispatch(ge.game.GUIDE_HIDE);var h=new Laya.Sprite;if(_e.getLayer(8).addChild(l),l.addChild(h),h.graphics.clear(),h.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,0),h.alpha=t,h.mouseEnabled=!0,h.mouseThrough=!0,r={bg:h,box:l,panel:null,mouseEnabled:s,isWorking:!0,isEnd:!1},o.panelurls[e]=r,cafe.event.dispatch(ge.panel.OPEN_PANEL),o.casePaanelUrls[e]){var c=o.casePaanelUrls[e];return c._param=i,l.addChild(c),o.isWorking=!1,c.name=e,a||h.on(Laya.Event.CLICK,c,be.onClickHandler),r.panel=c,void(r.isWorking=!1)}be.showsmallloadding(),cafe.event.dispatch("res_load",{urls:be.getRes(e),handler:initHandler(o,t=>{if(!t)return cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"界面不见了！！！"]),be.hidesmallloadding(),void o.closepanel(e);Laya.Dialog.load(e,initHandler(o,t=>{be.hidesmallloadding(),n&&(o.casePaanelUrls[e]=t),t._param=i,l.addChild(t),o.isWorking=!1,t.name=e,a||h.on(Laya.Event.CLICK,t,be.onClickHandler),r.panel=t,r.isWorking=!1}),o.smallprosshandler)}),priority:ue.LevelA,prosshandler:o.smallprosshandler})}}}static openpanel(e,t,i=!0,s=!1,a=!1){var n=be;if(!n.panelurls[e]){var o=n.panelurls[e];if(!o||!o.isWorking){var r=new Laya.Box;serror("打开界面: "+e),cafe.event.dispatch(ge.game.GUIDE_HIDE);var l=new Laya.Sprite;if(_e.getLayer(2).addChild(r),r.addChild(l),l.graphics.clear(),l.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,0),l.alpha=.7,l.mouseEnabled=!0,l.mouseThrough=!0,o={bg:l,box:r,panel:null,mouseEnabled:i,isWorking:!0,isEnd:!1},n.panelurls[e]=o,cafe.event.dispatch(ge.panel.OPEN_PANEL),n.casePaanelUrls[e]){var h=n.casePaanelUrls[e];return h._param=t,r.addChild(h),n.isWorking=!1,h.name=e,s||l.on(Laya.Event.CLICK,h,be.onClickHandler),o.panel=h,void(o.isWorking=!1)}be.showsmallloadding(),cafe.event.dispatch("res_load",{urls:be.getRes(e),handler:initHandler(n,i=>{if(slog("res_load"),!i)return cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"界面不见了！！！"]),be.hidesmallloadding(),void n.closepanel(e);console.log(e),Laya.Dialog.load(e,initHandler(n,i=>{a&&(n.casePaanelUrls[e]=i),i._param=t,r.addChild(i),n.isWorking=!1,i.name=e,s||l.on(Laya.Event.CLICK,i,be.onClickHandler),o.panel=i,o.isWorking=!1,be.hidesmallloadding()}),n.smallprosshandler)}),priority:ue.LevelA,prosshandler:n.smallprosshandler})}}}static openTopTipPanel(e,t,i=!0,s=!1,a=!1){var n=be;if(!n.panelurls[e]){var o=n.panelurls[e];if(!o||!o.isWorking){var r=new Laya.Box;serror("打开最顶界面: "+e),cafe.event.dispatch(ge.game.GUIDE_HIDE);var l=new Laya.Sprite;if(_e.getLayer(8).addChild(r),r.addChild(l),l.graphics.clear(),l.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,0),l.alpha=.9,l.mouseEnabled=!0,l.mouseThrough=!0,o={bg:l,box:r,panel:null,mouseEnabled:i,isWorking:!0,isEnd:!1},n.panelurls[e]=o,cafe.event.dispatch(ge.panel.OPEN_PANEL),n.casePaanelUrls[e]){var h=n.casePaanelUrls[e];return h._param=t,r.addChild(h),h.show&&h.show(),n.isWorking=!1,h.name=e,s||l.on(Laya.Event.CLICK,h,be.onClickHandler),o.panel=h,void(o.isWorking=!1)}be.showsmallloadding(),cafe.event.dispatch("res_load",{urls:be.getRes(e),handler:initHandler(n,i=>{if(!i)return cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"界面不见了！！！"]),be.hidesmallloadding(),void n.closepanel(e);Laya.Dialog.load(e,initHandler(n,i=>{be.hidesmallloadding(),a&&(n.casePaanelUrls[e]=i),i._param=t,r.addChild(i),n.isWorking=!1,i.name=e,s||l.on(Laya.Event.CLICK,i,be.onClickHandler),o.panel=i,o.isWorking=!1}),n.smallprosshandler)}),priority:ue.LevelA,prosshandler:n.smallprosshandler})}}}static initsmallloadding(){var e=this;Laya.Dialog.load("localui/smallloadding.scene",initHandler(e,t=>{slog("smallloadding finish");var i=t,s=new Laya.Handler(e,e=>{i&&(i.value=e)});_e.getLayer(7).addChild(i),e.smallloaddingpanel=t,be.smallprosshandler=s,i.visible=!1}))}static showsmallloadding(){this.smallloaddingpanel.visible=!0}static hidesmallloadding(){this.smallloaddingpanel&&(this.smallloaddingpanel.visible=!1)}static showloadding(){var e=this;e.smallloaddingpanel||e.initsmallloadding(),Laya.Dialog.load("localui/loadding.scene",initHandler(e,t=>{var i=t,s=new Laya.Handler(e,e=>{i&&(i.value=e)}),a=new Laya.Handler(e,e=>{i&&i.setTitle(e)});_e.getLayer(7).addChild(i),e.loaddingpanel=t,be.prosshandler=s,be.titlehandler=a}))}static hideloadding(){this.loaddingpanel&&(this.loaddingpanel.removeSelf(),this.loaddingpanel=null)}static onClickHandler(e){be.panelurls[this.name].mouseEnabled&&be.closepanel(this.name)}static getPanelState(e){return null!=this.panelurls[e]}static IsOpenPanel(){var e=0;for(var t in this.panelurls)e++;return e>0}static IsOpen(e){return null!=this.panelurls[e]}static closepanel(e){var t=be,i=t.panelurls[e];if(!i||!i.isEnd){var s=()=>{i&&(i.bg&&(i.bg.off(Laya.Event.CLICK,be,be.onClickHandler),i.bg.graphics.clear(),i.bg.removeSelf()),i.panel&&i.panel.removeSelf(),i.box&&i.box.removeSelf(),delete t.panelurls[e]),cafe.event.dispatch(ge.panel.CLOSE_PANEL)};i&&i.panel&&i.panel.end?(i.isEnd=!0,i.panel.end.play(0,!1),setTimeout(()=>{s()},800)):s()}}static closeAll(){for(var e in this.panelurls)be.closepanel(e);this.panelurls={}}}be.isWorking=!1,be.isPanelInit=!1;class we{}we.AdvertTestPanel="res/modules/advert/AdvertTestPanel.scene",we.CarLibItemView="res/modules/carlib/CarLibItemView.scene",we.CarLibPanel="res/modules/carlib/CarLibPanel.scene",we.CurrencyBar="res/modules/common/CurrencyBar.scene",we.GameStrength="res/modules/common/GameStrength.scene",we.GameStrengthView="res/modules/common/GameStrengthView.scene",we.MoneyBuyView="res/modules/common/MoneyBuyView.scene",we.MoneyTipsView="res/modules/common/MoneyTipsView.scene",we.MoneyView="res/modules/common/MoneyView.scene",we.TipsView="res/modules/common/TipsView.scene",we.DropAdiPanel="res/modules/drop/DropAdiPanel.scene",we.DropBuffPanel="res/modules/drop/DropBuffPanel.scene",we.DropDependPanel="res/modules/drop/DropDependPanel.scene",we.DropEquipPanel="res/modules/drop/DropEquipPanel.scene",we.DropRewardPanel="res/modules/drop/DropRewardPanel.scene",we.EndLostPanel="res/modules/end/EndLostPanel.scene",we.EndTimeOutPanel="res/modules/end/EndTimeOutPanel.scene",we.EndUpPanel="res/modules/end/EndUpPanel.scene",we.EndUpPanel1="res/modules/end/EndUpPanel1.scene",we.EndUpPanel2="res/modules/end/EndUpPanel2.scene",we.EndUpPanel3="res/modules/end/EndUpPanel3.scene",we.EndWinPanel="res/modules/end/EndWinPanel.scene",we.EndWinPanel2="res/modules/end/EndWinPanel2.scene",we.npcEndLostPanel="res/modules/end/npcEndLostPanel.scene",we.GameScene="res/modules/game/GameScene.scene",we.SteeringWheel="res/modules/game/item/SteeringWheel.scene",we.TaskProgress="res/modules/game/item/TaskProgress.scene",we.Timer="res/modules/game/item/Timer.scene",we.MainUiTaskItem="res/modules/game/MainUiTaskItem.scene",we.MainUiView="res/modules/game/MainUiView.scene",we.MainUiView2="res/modules/game/MainUiView2.scene",we.GoldPanel="res/modules/game/panel/GoldPanel.scene",we.RoleTrialPanel="res/modules/game/panel/RoleTrialPanel.scene",we.BigBtnProgressView="res/modules/game/view/BigBtnProgressView.scene",we.BtnProgressView="res/modules/game/view/BtnProgressView.scene",we.BuffItemView="res/modules/game/view/BuffItemView.scene",we.Die_CountdownView="res/modules/game/view/Die_CountdownView.scene",we.FightHeroInfoView="res/modules/game/view/FightHeroInfoView.scene",we.GameFinishView="res/modules/game/view/GameFinishView.scene",we.HeroItemView="res/modules/game/view/HeroItemView.scene",we.DataItemView="res/modules/game/view/item/DataItemView.scene",we.JackBtnDirView="res/modules/game/view/JackBtnDirView.scene",we.JackCarFuncBtnView="res/modules/game/view/JackCarFuncBtnView.scene",we.JackCarSpeedFuncBtnView="res/modules/game/view/JackCarSpeedFuncBtnView.scene",we.JackCarUpBtnDirView="res/modules/game/view/JackCarUpBtnDirView.scene",we.JackDirView="res/modules/game/view/JackDirView.scene",we.JackView1="res/modules/game/view/JackView1.scene",we.JackView2="res/modules/game/view/JackView2.scene",we.RankingItem="res/modules/game/view/RankingItem.scene",we.TaskArrowView="res/modules/game/view/TaskArrowView.scene",we.GuideImgPanel="res/modules/guide/GuideImgPanel.scene",we.GuidePanel="res/modules/guide/GuidePanel.scene",we.GuidePPTPanel="res/modules/guide/GuidePPTPanel.scene",we.hallListItemView="res/modules/hall/hallListItemView.scene",we.HallScene="res/modules/hall/HallScene.scene",we.FurnitureIcon="res/modules/home/FurnitureIcon.scene",we.FurnitureSelectPanel="res/modules/home/FurnitureSelectPanel.scene",we.FurnitureView="res/modules/home/FurnitureView.scene",we.GameUphousePanel="res/modules/home/GameUphousePanel.scene",we.HomeShopItemView="res/modules/home/HomeShopItemView.scene",we.HomeShopPanel="res/modules/home/HomeShopPanel.scene",we.LevelItemView="res/modules/level/LevelItemView.scene",we.LevelPanel="res/modules/level/LevelPanel.scene",we.LoginScene="res/modules/login/LoginScene.scene",we.MainPanel="res/modules/main/MainPanel.scene",we.PausePanel="res/modules/pause/PausePanel.scene",we.TalkView="res/modules/plot/TalkView.scene",we.GetRolePanel="res/modules/role/GetRolePanel.scene",we.GetRoleTestPanel="res/modules/role/GetRoleTestPanel.scene",we.NpcListItemView="res/modules/role/NpcListItemView.scene",we.NpcListItemView1="res/modules/role/NpcListItemView1.scene",we.NpcListPanel="res/modules/role/NpcListPanel.scene",we.RoleListItemView="res/modules/role/RoleListItemView.scene",we.RoleListItemView2="res/modules/role/RoleListItemView2.scene",we.RoleListPanel="res/modules/role/RoleListPanel.scene",we.SettingPanel="res/modules/setting/SettingPanel.scene",we.SettingView="res/modules/setting/SettingView.scene",we.SharePanel="res/modules/share/SharePanel.scene",we.GetEquipTestPanel="res/modules/shop/GetEquipTestPanel.scene",we.GetWinRewardPanel="res/modules/shop/GetWinRewardPanel.scene",we.HallPanel4="res/modules/shop/HallPanel4.scene",we.Jili2Panel="res/modules/shop/Jili2Panel.scene",we.JiliItem="res/modules/shop/JiliItem.scene",we.JiliPanel="res/modules/shop/JiliPanel.scene",we.NdRewardItem="res/modules/shop/NdRewardItem.scene",we.NiuDanPanel="res/modules/shop/NiuDanPanel.scene",we.npcShopItemView="res/modules/shop/npcShopItemView.scene",we.npcShopPanel="res/modules/shop/npcShopPanel.scene",we.ShopBtnItemView="res/modules/shop/ShopBtnItemView.scene",we.ShopItemView="res/modules/shop/ShopItemView.scene",we.ShopItemView2="res/modules/shop/ShopItemView2.scene",we.ShopPanel="res/modules/shop/ShopPanel.scene",we.ShopPanel2="res/modules/shop/ShopPanel2.scene",we.UnlockShopPanel="res/modules/shop/UnlockShopPanel.scene",we.ZhuanPanPanel="res/modules/shop/ZhuanPanPanel.scene",we.SignInItem="res/modules/signIn/SignInItem.scene",we.SignInItem2="res/modules/signIn/SignInItem2.scene",we.SignInItem3="res/modules/signIn/SignInItem3.scene",we.SignInPanel="res/modules/signIn/SignInPanel.scene",we.SkillUnlockPanel="res/modules/skill/SkillUnlockPanel.scene",we.SuccessItemView="res/modules/success/SuccessItemView.scene",we.SuccessPanel="res/modules/success/SuccessPanel.scene",we.TaskAcceptLevelPanel="res/modules/task/TaskAcceptLevelPanel.scene",we.TaskAcceptOrderPanel="res/modules/task/TaskAcceptOrderPanel.scene",we.TaskAcceptPanel="res/modules/task/TaskAcceptPanel.scene",we.TaskCallTipsView="res/modules/task/TaskCallTipsView.scene",we.TaskFinishPanel="res/modules/task/TaskFinishPanel.scene",we.TaskSuccessItemView="res/modules/task/TaskSuccessItemView.scene",we.TaskSuccessPanel="res/modules/task/TaskSuccessPanel.scene",we.Game="res/modules/tes/Game.scene",we.TestSocket="res/modules/test/TestSocket.scene",we.AlertActionTipPanel="res/modules/tips/AlertActionTipPanel.scene";class Te{constructor(){this.isactive=!1}bin(e){this.owner=e,this.isactive=!0}unbin(){this.owner&&(this.owner=null)}}class Ae extends Laya.Dialog{constructor(){super(),this.isdispose=!1,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}onEnable(){super.onEnable();cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),this.panelapi&&this.panelapi.bin(this)}binGuide(){this.timerOnce(100,this,()=>{this.bin("GUIDE_DATA",this.handleGuideTransition)})}handleGuideTransition(){}open(e,t){this._param=t,super.open(e,t)}playflash(){for(var e=["group_panel","group_center","group_content"],t=0;t<e.length;t++){var i=this[e[t]];i&&this.onePlayFlash(i)}}onePlayFlash(e){var t=this,i=e.scaleX*fe.maxScale,s=e.scaleY*fe.maxScale;e.scale(.1,.1),e.alpha=.1,Laya.Tween.clearTween(e),Laya.Tween.to(e,{scaleX:1.2*i,scaleY:1.2*s,alpha:1},180,null,initHandler(t,()=>{Laya.Tween.clearTween(e),Laya.Tween.to(e,{scaleX:i,scaleY:s},80,null,initHandler(t,()=>{Laya.Tween.clearTween(e)}))}))}clearPlayFlash(){for(var e=["group_panel","group_center","group_content"],t=0;t<e.length;t++){var i=this[e[t]];i&&Laya.Tween.clearTween(i)}}addCom(e,t){var i=e.addComponent(t);return this.comMap[e.$_GID+"_"+t.name]={target:e,com:i},i}layaMonitor(e,t,i,...s){this.layaMap[i.$_GID+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}addClick(e,...t){e&&this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t)}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}onClickHandler(e){}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[e.$_GID+"_"+t.name];delete this.comMap[e.$_GID+"_"+t.name],i&&i.com&&i.com.destroy()}onDisable(){this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),this.clearPlayFlash(),be.isPanelInit&&be.closepanel(this.name),this.panelapi&&this.panelapi.unbin(),super.onDisable(),this.isdispose=!0}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}}class xe extends Laya.Scene{constructor(){super(),this.isdispose=!1,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}onEnable(){super.onEnable();this.sceneapi&&this.sceneapi.bin(this)}binGuide(){this.timerOnce(100,this,()=>{this.bin("GUIDE_DATA",this.handleGuideTransition)})}handleGuideTransition(){}open(e,t){this._param=t,super.open(e,t)}addCom(e,t){t.isOne&&((i=e.getComponent(t))&&i.destroy());var i=e.addComponent(t);return this.comMap[e.$_GID+"_"+t.name]={target:e,com:i},i}addClick(e,...t){e?this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t):syslog("添加按扭事件失败")}layaMonitor(e,t,i,...s){this.layaMap[i.$_GID+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}onClickHandler(e,...t){}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[e.$_GID+"_"+t.name];delete this.comMap[e.$_GID+"_"+t.name],i&&i.com&&i.com.destroy()}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}onDisable(){this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),this.sceneapi&&this.sceneapi.unbin(),super.onDisable(),this.isdispose=!0}}class ke extends Laya.View{constructor(){super(),this.isdispose=!1,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}onEnable(){super.onEnable()}binGuide(){this.timerOnce(100,this,()=>{})}handleGuideTransition(){}open(e,t){this._param=t,super.open(e,t)}addCom(e,t){var i=e.addComponent(t);return this.comMap[e.$_GID+"_"+t.name]={target:e,com:i},i}layaMonitor(e,t,i,...s){this.layaMap[i.$_GID+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}addClick(e,...t){e?this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t):syslog("添加按扭事件对象为空")}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[e.$_GID+"_"+t.name];delete this.comMap[e.$_GID+"_"+t.name],i&&i.com&&i.com.destroy()}onClickHandler(e){}onDisable(){this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),super.onDisable(),this.isdispose=!0}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}}var Ee,Ie,Ce,Le,Me,Se,Pe,Re,De,Ne,je,Ge,Be,He,Oe,ze,Ve,Fe=Laya.ClassUtils.regClass;!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("dialog/yszc2Dia")}}e.yszc2DiaUI=t,Fe("ui.dialog.yszc2DiaUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("dialog/yszcDia_c_001")}}e.yszcDia_c_001UI=i,Fe("ui.dialog.yszcDia_c_001UI",i)}(e.dialog||(e.dialog={}))}(Ee||(Ee={})),function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("localui/loadding")}}e.loaddingUI=t,Fe("ui.localui.loaddingUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("localui/smallloadding")}}e.smallloaddingUI=i,Fe("ui.localui.smallloaddingUI",i);class s extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("localui/YSTipsPanel")}}e.YSTipsPanelUI=s,Fe("ui.localui.YSTipsPanelUI",s)}(e.localui||(e.localui={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){class t extends xe{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/commonui/CommonUI")}}e.CommonUIUI=t,Fe("ui.res.commonui.CommonUIUI",t)}(e.commonui||(e.commonui={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/advert/AdvertTestPanel")}}e.AdvertTestPanelUI=t,Fe("ui.res.modules.advert.AdvertTestPanelUI",t)}(e.advert||(e.advert={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/common/GameStrengthView")}}e.GameStrengthViewUI=t,Fe("ui.res.modules.common.GameStrengthViewUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/common/MoneyBuyView")}}e.MoneyBuyViewUI=i,Fe("ui.res.modules.common.MoneyBuyViewUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/common/MoneyTipsView")}}e.MoneyTipsViewUI=s,Fe("ui.res.modules.common.MoneyTipsViewUI",s);class a extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/common/MoneyView")}}e.MoneyViewUI=a,Fe("ui.res.modules.common.MoneyViewUI",a);class n extends ke{constructor(){super()}createChildren(){super.createChildren(),this.createView(n.uiView)}}n.uiView={type:"View",props:{runtime:"uishell/modules/tips_ui/TipsView.ts",autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{var:"box_view"},compId:5,child:[{type:"Image",props:{top:0,skin:"localImg/img_boxbg.png",sizeGrid:"8,8,8,8",right:0,left:0,bottom:0},compId:3},{type:"Label",props:{var:"txt_content",valign:"middle",fontSize:30,font:"Microsoft YaHei",color:"#ffffff",centerY:0,centerX:0,bold:!0,align:"center"},compId:4}]}],loadList:["localImg/img_boxbg.png"],loadList3D:[]},e.TipsViewUI=n,Fe("ui.res.modules.common.TipsViewUI",n)}(e.common||(e.common={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/drop/DropAdiPanel")}}e.DropAdiPanelUI=t,Fe("ui.res.modules.drop.DropAdiPanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/drop/DropBuffPanel")}}e.DropBuffPanelUI=i,Fe("ui.res.modules.drop.DropBuffPanelUI",i);class s extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/drop/DropDependPanel")}}e.DropDependPanelUI=s,Fe("ui.res.modules.drop.DropDependPanelUI",s);class a extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/drop/DropEquipPanel")}}e.DropEquipPanelUI=a,Fe("ui.res.modules.drop.DropEquipPanelUI",a);class n extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/drop/DropRewardPanel")}}e.DropRewardPanelUI=n,Fe("ui.res.modules.drop.DropRewardPanelUI",n)}(e.drop||(e.drop={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndLostPanel")}}e.EndLostPanelUI=t,Fe("ui.res.modules.end.EndLostPanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndTimeOutPanel")}}e.EndTimeOutPanelUI=i,Fe("ui.res.modules.end.EndTimeOutPanelUI",i);class s extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndUpPanel")}}e.EndUpPanelUI=s,Fe("ui.res.modules.end.EndUpPanelUI",s);class a extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndUpPanel1")}}e.EndUpPanel1UI=a,Fe("ui.res.modules.end.EndUpPanel1UI",a);class n extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndUpPanel3")}}e.EndUpPanel3UI=n,Fe("ui.res.modules.end.EndUpPanel3UI",n);class o extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/end/EndWinPanel")}}e.EndWinPanelUI=o,Fe("ui.res.modules.end.EndWinPanelUI",o)}(e.end||(e.end={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends xe{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/GameScene")}}e.GameSceneUI=t,Fe("ui.res.modules.game.GameSceneUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/MainUiTaskItem")}}e.MainUiTaskItemUI=i,Fe("ui.res.modules.game.MainUiTaskItemUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/MainUiView")}}e.MainUiViewUI=s,Fe("ui.res.modules.game.MainUiViewUI",s)}(e.game||(e.game={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/item/SteeringWheel")}}e.SteeringWheelUI=t,Fe("ui.res.modules.game.item.SteeringWheelUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/item/TaskProgress")}}e.TaskProgressUI=i,Fe("ui.res.modules.game.item.TaskProgressUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/item/Timer")}}e.TimerUI=s,Fe("ui.res.modules.game.item.TimerUI",s)}(e.item||(e.item={}))}(e.game||(e.game={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/panel/GoldPanel")}}e.GoldPanelUI=t,Fe("ui.res.modules.game.panel.GoldPanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/panel/RoleTrialPanel")}}e.RoleTrialPanelUI=i,Fe("ui.res.modules.game.panel.RoleTrialPanelUI",i)}(e.panel||(e.panel={}))}(e.game||(e.game={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.createView(t.uiView)}}t.uiView={type:"View",props:{width:160,height:162},compId:2,child:[{type:"Button",props:{width:160,var:"btn_click",stateNum:2,skin:"res/modules/game/btn_anniudi1.png",height:160,drawCallOptimize:!0,centerY:0,centerX:0},compId:7},{type:"Image",props:{width:140,var:"img_icon",height:140,centerY:0,centerX:0},compId:8},{type:"Image",props:{width:153,var:"img_shadow",height:145,centerY:0,centerX:0},compId:11},{type:"Image",props:{width:44,var:"img_lock",skin:"res/modules/game/img_dai.png",height:41,centerY:0,centerX:0,alpha:.8},compId:13},{type:"Box",props:{y:-1,x:0,var:"box_progress"},compId:10,child:[{type:"Image",props:{y:1,x:1,width:160,skin:"res/modules/game/img_jiasulengquebg.png",height:160,drawCallOptimize:!0},compId:5},{type:"Image",props:{width:160,skin:"res/modules/game/img_jiasulengque.png",height:160,drawCallOptimize:!0},compId:6,child:[{type:"Sprite",props:{y:82,x:80,var:"sp_mask",renderType:"mask"},compId:9}]}]}],loadList:["res/modules/game/btn_anniudi1.png","res/modules/game/img_dai.png","res/modules/game/img_jiasulengquebg.png","res/modules/game/img_jiasulengque.png"],loadList3D:[]},e.BigBtnProgressViewUI=t,Fe("ui.res.modules.game.view.BigBtnProgressViewUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.createView(i.uiView)}}i.uiView={type:"View",props:{width:110,height:110,autoDestroyAtClosed:!0},compId:2,child:[{type:"Button",props:{y:15,x:15,width:110,var:"btn_click",stateNum:2,skin:"res/modules/game/btn_anniudi2.png",height:110,drawCallOptimize:!0,centerY:0,centerX:0},compId:3},{type:"Image",props:{y:-12,x:-13,var:"img_icon",mouseEnabled:!1,centerY:0,centerX:0},compId:4},{type:"Image",props:{width:102,var:"img_shadow",height:100,centerY:0,centerX:0},compId:10},{type:"Image",props:{width:44,var:"img_lock",height:38,centerY:0,centerX:0},compId:11,child:[{type:"Image",props:{width:29,skin:"res/common/luxiang2.png",height:27,centerY:32,centerX:36,alpha:.5},compId:12,child:[{type:"SkeletonPlayer",props:{y:-23,x:-21,url:"res/dbres/anniu1/anniu.sk",runtime:"Laya.Skeleton"},compId:13}]}]},{type:"Box",props:{y:-1,x:1,visible:!0,var:"box_progress"},compId:8,child:[{type:"Image",props:{width:108,skin:"res/modules/game/img_jiasulengquebg.png",mouseEnabled:!1,height:106,drawCallOptimize:!0},compId:5},{type:"Image",props:{width:108,skin:"res/modules/game/img_jiasulengque.png",mouseEnabled:!1,height:106,drawCallOptimize:!0},compId:6,child:[{type:"Sprite",props:{y:53,x:54,visible:!0,var:"sp_mask",renderType:"mask"},compId:7}]}]}],loadList:["res/modules/game/btn_anniudi2.png","res/common/luxiang2.png","res/dbres/anniu1/anniu.sk","res/modules/game/img_jiasulengquebg.png","res/modules/game/img_jiasulengque.png"],loadList3D:[]},e.BtnProgressViewUI=i,Fe("ui.res.modules.game.view.BtnProgressViewUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/BuffItemView")}}e.BuffItemViewUI=s,Fe("ui.res.modules.game.view.BuffItemViewUI",s);class a extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/FightHeroInfoView")}}e.FightHeroInfoViewUI=a,Fe("ui.res.modules.game.view.FightHeroInfoViewUI",a);class n extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/HeroItemView")}}e.HeroItemViewUI=n,Fe("ui.res.modules.game.view.HeroItemViewUI",n);class o extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackBtnDirView")}}e.JackBtnDirViewUI=o,Fe("ui.res.modules.game.view.JackBtnDirViewUI",o);class r extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackCarFuncBtnView")}}e.JackCarFuncBtnViewUI=r,Fe("ui.res.modules.game.view.JackCarFuncBtnViewUI",r);class l extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackCarSpeedFuncBtnView")}}e.JackCarSpeedFuncBtnViewUI=l,Fe("ui.res.modules.game.view.JackCarSpeedFuncBtnViewUI",l);class h extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackCarUpBtnDirView")}}e.JackCarUpBtnDirViewUI=h,Fe("ui.res.modules.game.view.JackCarUpBtnDirViewUI",h);class c extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackDirView")}}e.JackDirViewUI=c,Fe("ui.res.modules.game.view.JackDirViewUI",c);class d extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackView1")}}e.JackView1UI=d,Fe("ui.res.modules.game.view.JackView1UI",d);class u extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/JackView2")}}e.JackView2UI=u,Fe("ui.res.modules.game.view.JackView2UI",u);class p extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/RankingItem")}}e.RankingItemUI=p,Fe("ui.res.modules.game.view.RankingItemUI",p);class m extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/game/view/TaskArrowView")}}e.TaskArrowViewUI=m,Fe("ui.res.modules.game.view.TaskArrowViewUI",m)}(e.view||(e.view={}))}(e.game||(e.game={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/guide/GuideImgPanel")}}e.GuideImgPanelUI=t,Fe("ui.res.modules.guide.GuideImgPanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/guide/GuidePanel")}}e.GuidePanelUI=i,Fe("ui.res.modules.guide.GuidePanelUI",i);class s extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/guide/GuidePPTPanel")}}e.GuidePPTPanelUI=s,Fe("ui.res.modules.guide.GuidePPTPanelUI",s)}(e.guide||(e.guide={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/hall/hallListItemView")}}e.hallListItemViewUI=t,Fe("ui.res.modules.hall.hallListItemViewUI",t);class i extends xe{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/hall/HallScene")}}e.HallSceneUI=i,Fe("ui.res.modules.hall.HallSceneUI",i)}(e.hall||(e.hall={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends xe{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/login/LoginScene")}}e.LoginSceneUI=t,Fe("ui.res.modules.login.LoginSceneUI",t)}(e.login||(e.login={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/main/MainPanel")}}e.MainPanelUI=t,Fe("ui.res.modules.main.MainPanelUI",t)}(e.main||(e.main={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/pause/PausePanel")}}e.PausePanelUI=t,Fe("ui.res.modules.pause.PausePanelUI",t)}(e.pause||(e.pause={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/plot/TalkView")}}e.TalkViewUI=t,Fe("ui.res.modules.plot.TalkViewUI",t)}(e.plot||(e.plot={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/GetRolePanel")}}e.GetRolePanelUI=t,Fe("ui.res.modules.role.GetRolePanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/GetRoleTestPanel")}}e.GetRoleTestPanelUI=i,Fe("ui.res.modules.role.GetRoleTestPanelUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/NpcListItemView")}}e.NpcListItemViewUI=s,Fe("ui.res.modules.role.NpcListItemViewUI",s);class a extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/NpcListItemView1")}}e.NpcListItemView1UI=a,Fe("ui.res.modules.role.NpcListItemView1UI",a);class n extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/NpcListPanel")}}e.NpcListPanelUI=n,Fe("ui.res.modules.role.NpcListPanelUI",n);class o extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/RoleListItemView")}}e.RoleListItemViewUI=o,Fe("ui.res.modules.role.RoleListItemViewUI",o);class r extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/RoleListItemView2")}}e.RoleListItemView2UI=r,Fe("ui.res.modules.role.RoleListItemView2UI",r);class l extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/role/RoleListPanel")}}e.RoleListPanelUI=l,Fe("ui.res.modules.role.RoleListPanelUI",l)}(e.role||(e.role={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/share/SharePanel")}}e.SharePanelUI=t,Fe("ui.res.modules.share.SharePanelUI",t)}(e.share||(e.share={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/GetEquipTestPanel")}}e.GetEquipTestPanelUI=t,Fe("ui.res.modules.shop.GetEquipTestPanelUI",t);class i extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/GetWinRewardPanel")}}e.GetWinRewardPanelUI=i,Fe("ui.res.modules.shop.GetWinRewardPanelUI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/NdRewardItem")}}e.NdRewardItemUI=s,Fe("ui.res.modules.shop.NdRewardItemUI",s);class a extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/NiuDanPanel")}}e.NiuDanPanelUI=a,Fe("ui.res.modules.shop.NiuDanPanelUI",a);class n extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/npcShopItemView")}}e.npcShopItemViewUI=n,Fe("ui.res.modules.shop.npcShopItemViewUI",n);class o extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/npcShopPanel")}}e.npcShopPanelUI=o,Fe("ui.res.modules.shop.npcShopPanelUI",o);class r extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/ShopItemView")}}e.ShopItemViewUI=r,Fe("ui.res.modules.shop.ShopItemViewUI",r);class l extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/ShopItemView2")}}e.ShopItemView2UI=l,Fe("ui.res.modules.shop.ShopItemView2UI",l);class h extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/ShopPanel")}}e.ShopPanelUI=h,Fe("ui.res.modules.shop.ShopPanelUI",h);class c extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/shop/ZhuanPanPanel")}}e.ZhuanPanPanelUI=c,Fe("ui.res.modules.shop.ZhuanPanPanelUI",c)}(e.shop||(e.shop={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/signIn/SignInItem")}}e.SignInItemUI=t,Fe("ui.res.modules.signIn.SignInItemUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.createView(i.uiView)}}i.uiView={type:"View",props:{width:192,height:142,autoDestroyAtClosed:!0},compId:2,child:[{type:"Box",props:{y:0,x:0,width:192,visible:!0,var:"box_day",top:0,left:0,height:142},compId:28,child:[{type:"Image",props:{visible:!1,skin:"res/modules/signIn/g.png",scaleY:1.9,scaleX:1.9,centerY:0,centerX:0},compId:44},{type:"Image",props:{visible:!1,var:"img_select",top:0,right:0,left:0,bottom:0},compId:31},{type:"Image",props:{y:14.5,width:114,visible:!0,var:"img_icon",scaleY:1,scaleX:1,height:113,centerX:0},compId:33},{type:"Label",props:{visible:!1,top:144,text:"第    天",strokeColor:"#0099ff",stroke:2,fontSize:20,font:"Microsoft YaHei",color:"#ffffff",centerX:0,bold:!1},compId:38},{type:"Label",props:{width:72,visible:!0,var:"txt_selectReward",valign:"middle",text:"X800",strokeColor:"#645d02",stroke:5,pivotY:12,pivotX:36,italic:!1,height:23,fontSize:28,font:"Microsoft YaHei",color:"#ffffff",centerX:0,bottom:10,bold:!0,align:"center"},compId:42},{type:"Image",props:{width:170,var:"img_signin",top:0,right:0,left:0,height:170,bottom:0},compId:37,child:[{type:"Image",props:{top:0,skin:"res/common/img_bj2.png",right:0,left:0,bottom:0,alpha:.4},compId:49},{type:"Image",props:{width:93,skin:"res/modules/signIn/img_finish.png",height:67,centerY:0,centerX:0},compId:34}]}]}],loadList:["res/modules/signIn/g.png","res/common/img_bj2.png","res/modules/signIn/img_finish.png"],loadList3D:[]},e.SignInItem2UI=i,Fe("ui.res.modules.signIn.SignInItem2UI",i);class s extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/signIn/SignInItem3")}}e.SignInItem3UI=s,Fe("ui.res.modules.signIn.SignInItem3UI",s);class a extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/signIn/SignInPanel")}}e.SignInPanelUI=a,Fe("ui.res.modules.signIn.SignInPanelUI",a)}(e.signIn||(e.signIn={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/skill/SkillUnlockPanel")}}e.SkillUnlockPanelUI=t,Fe("ui.res.modules.skill.SkillUnlockPanelUI",t)}(e.skill||(e.skill={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/task/TaskFinishPanel")}}e.TaskFinishPanelUI=t,Fe("ui.res.modules.task.TaskFinishPanelUI",t);class i extends ke{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/task/TaskSuccessItemView")}}e.TaskSuccessItemViewUI=i,Fe("ui.res.modules.task.TaskSuccessItemViewUI",i);class s extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/task/TaskSuccessPanel")}}e.TaskSuccessPanelUI=s,Fe("ui.res.modules.task.TaskSuccessPanelUI",s)}(e.task||(e.task={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/tes/Game")}}e.GameUI=t,Fe("ui.res.modules.tes.GameUI",t)}(e.tes||(e.tes={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={})),function(e){!function(e){!function(e){!function(e){class t extends Ae{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("res/modules/tips/AlertActionTipPanel")}}e.AlertActionTipPanelUI=t,Fe("ui.res.modules.tips.AlertActionTipPanelUI",t)}(e.tips||(e.tips={}))}(e.modules||(e.modules={}))}(e.res||(e.res={}))}(Ee||(Ee={}));class Ue extends Ee.res.modules.common.TipsViewUI{constructor(e){super();e&&(this.text=e)}static show(e){_e.getLayer(10).addChild(new Ue(e))}set text(e){this.txt_content.text=e,this.box_view.width=this.txt_content.width+40,this.box_view.height=this.txt_content.height+20,this.box_view.x=(fe.sourceW-this.box_view.width)/2}get text(){return this.txt_content.text}onEnable(){var e=this;super.onEnable(),e.scaleX=fe.minScale,e.scaleY=fe.minScale,e.centerY=20,e.alpha=0,Laya.Tween.to(e,{centerY:-10,alpha:1},300,null,initHandler(e,()=>{Laya.Tween.to(e,{},1e3,null,initHandler(e,()=>{Laya.Tween.to(e,{centerY:-20,alpha:0},300,null,initHandler(e,()=>{Laya.Tween.clearTween(e),e.removeSelf()}))}))}))}onDisable(){super.onDisable()}}class qe extends Te{onRunHandler(e){var t=this.owner;be.closepanel(we.DropRewardPanel);var i=Ve.shop.maps[t.info.shopId],s=Ve.role.getInfoByRoleId(t.info.targetId);if(s)if(s.isHave){Ue.show("由于已有该商品，将会把商品转换为相等价值的金币"),ea.scene.GamePause=!1;var a=ea.money.strToInfo(i.tb.price);Ve.user.addGold(0==a.count?2e3:a.count,ea.scene.moneypos,null,()=>{Ve.role.haveRole(s.tb.returnRole,!1),Ve.role.selectRole(s.roleId,!1),e&&e.runWith([1])})}else ea.scene.GamePause=!1,Ve.role.haveRole(s.tb.returnRole,!1),Ve.role.selectRole(s.roleId,!1),e&&e.runWith([1])}unbin(){super.unbin()}}class Ye{static init(){var e=Ye;e._lfid=1,e.frame=0,e._frameMap={},Laya.stage.frameLoop(1,e,e.onFrame)}static onFrame(){var e=Ye;e.frame++;var t=e.frame;for(var i in e._frameMap){var s=e._frameMap[i],a=t-s.startframe;a%s.frame==0&&s.handler&&s.handler.runWith([a])}}static getLfid(e){var t=Ye;return e._lfid?e._lfid:(e._lfid=t._lfid,t._lfid++,e._lfid)}static add(e,t,i,s=!0){var a=Ye,n=a.getLfid(t);if(!a._frameMap[n]){var o=a.frame,r=new Laya.Handler(t,i);a._frameMap[n]={startframe:o,frame:e,handler:r},s&&r.runWith([0])}}static remove(e,t){var i=Ye,s=i.getLfid(e);delete i._frameMap[s]}static dispose(){var e=Ye;e._lfid=1,e.frame=0,e._frameMap={}}}class We{static openscene(e,t){return serror("打开场景: "+e),new cafe.com.too((t,i)=>{be.titlehandler&&be.titlehandler.runWith(["UI"]),Laya.Scene.load(e,initHandler(We,i=>{serror("场景加载完成0 "),We.scene&&(We.scene.removeSelf(),We.scene.destroy()),serror("场景加载完成1 ",null==i),_e.getLayer(0).addChild(i),serror("场景加载完成2 ");var s=Laya.stage.getChildByName("root");serror("场景加载完成3 "),s&&s.removeSelf(),We.scene=i,serror("场景加载完成: "+e),t(i)}),be.prosshandler)})}static getScene(){return We.scene}static closescene(e){ea.scene.player&&ea.scene.player.owner&&(ea.scene.player.owner.removeSelf(),ea.scene.player.owner.destroy(),ea.scene.player.destroy(),ea.scene.player=null),ea.scene.mainscene&&(ea.scene.mainscene.removeSelf(),ea.scene.mainscene.destroy(),ea.scene.mainscene=null),Laya.Scene.close(e)}}class Xe{static getBodys(e,t){var i=[],s=e;if(s&&s.numChildren)for(var a=s.numChildren,n=0;n<a;n++){var o=s.getChildAt(n);if(o&&(o.name==t&&i.push(o),o.numChildren>0)){var r=Xe.getBodys(o,t);i.push(...r)}}return i}static getMeshBody(e){var t=e;if(e.meshRenderer)return e;if(t&&t.numChildren)for(var i,s=t.numChildren,a=0;a<s;a++){var n=t.getChildAt(a);if(n){if(n.meshRenderer&&(i=n))break;if(n.numChildren>0&&(i=Xe.getMeshBody(n)))break}}return i}static getBody(e,t){var i=e;if(i&&i.numChildren)for(var s,a=i.numChildren,n=0;n<a;n++){var o=i.getChildAt(n);if(o){if(o.name==t&&(s=o))break;if(o.numChildren>0&&(s=Xe.getBody(o,t)))break}}return s}static getBody2(e,t){for(var i,s=e,a=s.numChildren,n=0;n<a;n++){var o=s.getChildAt(n);if(o){if(-1!=t.indexOf(o.name)&&(i=o))break;if(o.numChildren>0&&(i=Xe.getBody2(o,t)))break}}return i}static getSprite3DListByDistance(e,t,i=5,s=!1){if(!e)return[];for(var a=[],n=0;n<t.length;n++){var o=e.transform.position.clone(),r=t[n].transform.position.clone();r.y+=1;var l=getDistance({x:o.x,y:o.z},{x:r.x,y:r.z}),h=getDistance({x:o.z,y:o.y},{x:r.z,y:r.y});if(l<=i&&h<=i)if(s){let e=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(r,ea.scene.camera.projectionViewMatrix,e),e.w>=0&&(a[a.length]=t[n])}else a[a.length]=t[n]}return a}static getSprite3DByMinDistance(e,t,i=5,s){if(!e)return null;for(var a,n,o=0;o<t.length;o++){var r=e.transform.position.clone();if(t[o]&&t[o].transform){var l=t[o].transform.position.clone();s&&s.pivot&&(l.x+=s.pivot.x,l.y+=s.pivot.y,l.z+=s.pivot.z);var h=getDistance({x:r.x,y:r.z},{x:l.x,y:l.z}),c=getDistance({x:r.z,y:r.y},{x:l.z,y:l.y});if(h<=i&&c<=i)if(s&&s.isCamera){let e=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(l,ea.scene.camera.projectionViewMatrix,e),e.w>=0&&(a||(a=h+c),a>=h+c&&(a=h+c,n=t[o]))}else a||(a=h+c),a>=h+c&&(a=h+c,n=t[o])}}return n}static is3DBallHit(e,t,i,s){var a=e.clone(),n=t.clone(),o=i+s,r=getDistance({x:a.x,y:a.z},{x:n.x,y:n.z}),l=getDistance({x:a.z,y:a.y},{x:n.z,y:n.y});return r<=o&&l<=o}static getSprite3DAngle(e,t){var i=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);return{rox:calcPosAngle({x:e.y,y:-e.z},{x:t.y,y:-t.z},!0),roy:i}}static getCameraPosByVec3(e){let t=new Laya.Vector4(0,0,0,0);return ea.scene.camera.viewport.project(e.clone(),ea.scene.camera.projectionViewMatrix,t),t.w>=0?{x:t.x/Laya.stage.clientScaleX,y:t.y/Laya.stage.clientScaleY}:null}static getModelSprite(e){for(var t=e;t&&!t.tbId;)t=t.parent;return t||null}static searchBody(e,t){for(var i=[],s=e,a=s.numChildren,n=0;n<a;n++){var o=s.getChildAt(n);if(o&&(-1!=o.name.search(t)&&i.push(o),o.numChildren>0)){var r=Xe.searchBody(o,t);i.push(...r)}}return i}static setBodyMainPy(e,t){for(var i=e,s=i.numChildren,a=0;a<s;a++){var n=i.getChildAt(a);if(n){if(n.getComponent(Laya.PhysicsCollider))n.main=t;else n.getComponent(Laya.Rigidbody3D)&&(n.main=t);n.numChildren>0&&Xe.setBodyMainPy(n,t)}}}}!function(e){let t;!function(e){e[e["家园背景音乐"]=11001]="家园背景音乐",e[e["主地图背景音乐"]=11002]="主地图背景音乐",e[e["矿洞地图背景音乐"]=11003]="矿洞地图背景音乐",e[e["暂停"]=12001]="暂停",e[e["点击按扭"]=12002]="点击按扭",e[e["金币"]=12003]="金币",e[e["结算金币滚动效果"]=12004]="结算金币滚动效果",e[e["任务完成"]=12005]="任务完成",e[e["解锁新角色"]=12006]="解锁新角色",e[e["角色死亡"]=13001]="角色死亡",e[e["主角普通攻击"]=13002]="主角普通攻击",e[e["跳跃音效"]=13003]="跳跃音效",e[e["落地音效"]=13004]="落地音效",e[e["开车音效"]=13005]="开车音效",e[e["敌人普通攻击"]=14001]="敌人普通攻击",e[e["敌人击飞死亡音效"]=14002]="敌人击飞死亡音效",e[e["回答正确音效"]=17001]="回答正确音效",e[e["回答错误音效"]=17002]="回答错误音效"}(t=e.id||(e.id={})),e.exit=[".mp3",".ogg",".wav"]}(Ie||(Ie={}));class Ke{}Ke.ACTION=1,Ke.GOLD=2,Ke.YB=3,Ke.DHJ=4,Ke.VIDEO=5,function(e){class t{}t._prop_effect_10004_lh=0,t._prop_effect_10008_lh=1,t._prop_effect_10012_lh=2,t._prop_effect_10015_lh=3,t._prop_effect_10016_lh=4,t._prop_effect_10018_lh=5,t._prop_effect_30012_lh=6,t._prop_effect_30016_lh=7,t._prop_effect_30017_lh=8,t._prop_effect_30018_lh=9,t._prop_effect_30019_lh=10,t._prop_effect_30020_lh=11,t._prop_effect_30021_lh=12,t._prop_effect_30026_lh=13,t._prop_effect_30027_lh=14,t._prop_effect_32001_lh=15,t._prop_effect_32002_lh=16,t._prop_effect_32003_lh=17,t._prop_effect_33001_lh=18,t._prop_effect_33002_lh=19,t._prop_effect_33003_lh=20,t._prop_effect_33004_lh=21,t._prop_effect_33005_lh=22,t._prop_effect_33006_lh=23,t._prop_effect_33009_lh=24,t._prop_effect_33010_lh=25,t._prop_effect_33011_lh=26,t._prop_effect_33012_lh=27,t._prop_effect_33013_lh=28,t._prop_effect_40001_lh=29,t._prop_effect_80002_lh=30,t._prop_effect_80003_lh=31,t._prop_effect_90001_lh=32,t._prop_effect_90002_lh=33,t._prop_effect_90008_lh=34,e.res_enum=t,e.res_dic={0:"prop_effect/10004.lh",1:"prop_effect/10008.lh",2:"prop_effect/10012.lh",3:"prop_effect/10015.lh",4:"prop_effect/10016.lh",5:"prop_effect/10018.lh",6:"prop_effect/30012.lh",7:"prop_effect/30016.lh",8:"prop_effect/30017.lh",9:"prop_effect/30018.lh",10:"prop_effect/30019.lh",11:"prop_effect/30020.lh",12:"prop_effect/30021.lh",13:"prop_effect/30026.lh",14:"prop_effect/30027.lh",15:"prop_effect/32001.lh",16:"prop_effect/32002.lh",17:"prop_effect/32003.lh",18:"prop_effect/33001.lh",19:"prop_effect/33002.lh",20:"prop_effect/33003.lh",21:"prop_effect/33004.lh",22:"prop_effect/33005.lh",23:"prop_effect/33006.lh",24:"prop_effect/33009.lh",25:"prop_effect/33010.lh",26:"prop_effect/33011.lh",27:"prop_effect/33012.lh",28:"prop_effect/33013.lh",29:"prop_effect/40001.lh",30:"prop_effect/80002.lh",31:"prop_effect/80003.lh",32:"prop_effect/90001.lh",33:"prop_effect/90002.lh",34:"prop_effect/90008.lh"},e.res={"prop_effect/10004.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/zhuanqianpaoku.jpg","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/10008.lh":["Assets/modules/effect/Explosions/Textures/particle_01.jpg","Assets/modules/effect/Explosions/Textures/Explosion_001.jpg"],"prop_effect/10012.lh":["Assets/modules/effect/huojianshangche/Textures/glow.png","Assets/FX/jiantou/view.png"],"prop_effect/10015.lh":["Assets/modules/effect/huojianshangche/Textures/glow.png","Assets/FX/jiantou/view.png"],"prop_effect/10016.lh":["Assets/modules/effect/task/Re/GTH.png","Assets/modules/effect/task/Re/Light.png","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/10018.lh":["Assets/modules/effect/task/Re/GTH.png","Assets/modules/effect/task/Re/Light.png","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/30012.lh":["Assets/FX/jiantou/wendian.png"],"prop_effect/30016.lh":["Assets/Textures/bingxuedashijie/666.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30017.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/daojutietu.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30018.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/daojutietu.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30019.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/daojutietu.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30020.lh":["Assets/Textures/bingxuedashijie/666.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30021.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/daojutietu.jpg","Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/30026.lh":["Assets/FX/CartoonFX/Textures/CFX_T_Smoke_4Frames.png","Assets/FX/CartoonFX/Textures/CFX_T_Star Add.jpg","Assets/FX/CartoonFX/Textures/CFX_T_Anim4_RoundedLines.jpg","Assets/FX/CartoonFX/Textures/CFX_T_Star.png"],"prop_effect/30027.lh":["Assets/FX/CartoonFX/Textures/CFX_T_Star Add.jpg"],"prop_effect/32001.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/C603C4A8749742AF4539965DA1D696B9.jpg","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/32002.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/C603C4A8749742AF4539965DA1D696B7.jpg","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/32003.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/C603C4A8749742AF4539965DA1D696B8.jpg","Assets/modules/effect/task/Re/Flow.png"],"prop_effect/33001.lh":["Assets/FX/fazhengguangquan/hongse.jpg"],"prop_effect/33002.lh":["Assets/FX/fazhengguangquan/huangse.jpg"],"prop_effect/33003.lh":["Assets/FX/fazhengguangquan/lanse.jpg"],"prop_effect/33004.lh":["Assets/FX/fazhengguangquan/fengyin.jpg","Assets/FX/fazhengguangquan/image1.png"],"prop_effect/33005.lh":["Assets/FX/fazhengguangquan/zhaohuan.jpg"],"prop_effect/33006.lh":["Assets/FX/bianshenyanwu/baozhayanwu.png"],"prop_effect/33009.lh":["Assets/FX/Textures/yanwukuosan_6x6.png"],"prop_effect/33010.lh":["Assets/FX/Textures/FX_SnowFlake.png"],"prop_effect/33011.lh":["Assets/FX/Textures/heart_r.png"],"prop_effect/33012.lh":["Assets/FX/Textures/xingxing.png"],"prop_effect/33013.lh":["Assets/FX/Textures/ray014.png"],"prop_effect/40001.lh":["Assets/daoju/daoju3/Textures/Skyscraper666.jpg","Assets/FX/Vulcan/Textures/vulcan_muzzle.jpg"],"prop_effect/80002.lh":["Assets/FX/shangchediantexiao/bai.jpg","Assets/FX/mudidi/Textures/l00030.png"],"prop_effect/80003.lh":["Assets/FX/shangchediantexiao/bai.jpg","Assets/FX/mudidi/Textures/l00030.png"],"prop_effect/90001.lh":["Assets/FX/Textures/bai.jpg"],"prop_effect/90002.lh":["Assets/FX/Textures/FX_Star_2.png"],"prop_effect/90008.lh":["Assets/modules/thing/shanxing/tex/jjqlv.png","Assets/modules/thing/shanxing/tex/jjqhong.png"]},e.config={"prop_effect/10004.lh":["Assets/Models/paokudaoju/jinbi-jinbi.lm","Assets/Materials/paokudaoju/daoju3.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/10008.lh":["Assets/modules/effect/Explosions/Materials/Explosion_Flare_001.lmat","Assets/modules/effect/Explosions/Materials/Explosion_Flames_001.lmat"],"prop_effect/10012.lh":["Assets/modules/res/img/Materials/xiangao_11.lmat","Assets/modules/effect/huojianshangche/Materials/FX Glow 2.lmat","Assets/FX/jiantou/Materials/mfd.lmat"],"prop_effect/10015.lh":["Assets/modules/res/img/Materials/xiangao_11.lmat","Assets/modules/effect/huojianshangche/Materials/FX Glow 2.lmat","Assets/FX/jiantou/Materials/mfd.lmat","Assets/FX/jiantou/pian-Plane001.lm"],"prop_effect/10016.lh":["Assets/modules/effect/task/Re/GTH.lmat","Assets/modules/effect/task/Re/Light.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/10018.lh":["Assets/modules/effect/task/Re/GTH.lmat","Assets/modules/effect/task/Re/Light.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/30012.lh":["Assets/FX/jiantou/Materials/2.lmat"],"prop_effect/30016.lh":["Assets/Models/paokudaoju/huojian-huojian.lm","Assets/Models/paokudaoju/huojian.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30017.lh":["Assets/Models/paokudaoju/xiangjiaopi-xiangjiaopi.lm","Assets/Materials/paokudaoju/daoju1.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30018.lh":["Assets/Models/paokudaoju/yaoji01-yaoji01.lm","Assets/Materials/paokudaoju/daoju4.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30019.lh":["Assets/Models/paokudaoju/zhadang-zhadang.lm","Assets/Materials/paokudaoju/daoju1.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30020.lh":["Assets/Models/paokudaoju/feixingxie-feixingxie.lm","Assets/Models/paokudaoju/feixingxie.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30021.lh":["Assets/Models/paokudaoju/yaoji02-yaoji02.lm","Assets/Materials/paokudaoju/daoju4.lmat","Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/30026.lh":["Assets/FX/CartoonFX/Materials/Misc/CFX_Smoke_4frms.lmat","Assets/FX/CartoonFX/Materials/Misc/CFX_Star Add.lmat","Assets/FX/CartoonFX/Materials/Animated/CFX_Anim_Poof_AddSoft.lmat","Assets/FX/CartoonFX/Materials/Electric/CFX_YellowStar.lmat"],"prop_effect/30027.lh":["Assets/FX/CartoonFX/Materials/Misc/CFX_Star Add.lmat"],"prop_effect/32001.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/jinbi-jinbi.lm","Assets/Materials/paokuxuqiu/shuishangleyuan/lvbi.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/32002.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/jinbi-jinbi.lm","Assets/Materials/paokuxuqiu/shuishangleyuan/jinbi.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/32003.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/jinbi-jinbi.lm","Assets/Materials/paokuxuqiu/shuishangleyuan/hongbi.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"prop_effect/33001.lh":["Assets/FX/fazhengguangquan/hongse.lmat"],"prop_effect/33002.lh":["Assets/FX/fazhengguangquan/huangse.lmat"],"prop_effect/33003.lh":["Assets/FX/fazhengguangquan/lanse.lmat"],"prop_effect/33004.lh":["Assets/FX/fazhengguangquan/fengyin.lmat","Assets/FX/fazhengguangquan/fengyin1.lmat","Assets/FX/fazhengguangquan/suolian-suolian.lm"],"prop_effect/33005.lh":["Assets/FX/fazhengguangquan/zhaohuan.lmat"],"prop_effect/33006.lh":["Assets/FX/bianshenyanwu/Materials/bianshen.lmat"],"prop_effect/33009.lh":["Assets/FX/Materials/yanwukuosan_7x7.lmat"],"prop_effect/33010.lh":["Assets/FX/Materials/FX_SnowFlake.lmat"],"prop_effect/33011.lh":["Assets/FX/Materials/heart_r.lmat"],"prop_effect/33012.lh":["Assets/FX/Materials/xingxing1.lmat"],"prop_effect/33013.lh":["Assets/FX/Materials/effects_textures 1.lmat"],"prop_effect/40001.lh":["Assets/daoju/daoju3/feixingqi_1-Object001.lm","Assets/daoju/daoju3/Materials/feixingqi_1-Object001.lmat","Assets/FX/Vulcan/Materials/feijifeixing2.lmat","Library/unitydefaultresources-Plane.lm"],"prop_effect/80002.lh":["Assets/FX/shangchediantexiao/Materials/bai.lmat","Assets/FX/shangchediantexiao/babianxing-babianxing.lm","Assets/FX/mudidi/Materials/quan 1.lmat"],"prop_effect/80003.lh":["Assets/FX/shangchediantexiao/Materials/bai.lmat","Assets/FX/shangchediantexiao/babianxing-babianxing.lm","Assets/FX/mudidi/Materials/quan 1.lmat"],"prop_effect/90001.lh":["Assets/FX/Materials/bai.lmat","Assets/FX/Models/babianxing-babianxing.lm"],"prop_effect/90002.lh":["Assets/FX/Materials/FX_Star_1.lmat"],"prop_effect/90008.lh":["Assets/modules/thing/shanxing/tex/shanxing-shan.lm","Assets/modules/thing/shanxing/tex/Materials/jjqlv.lmat","Assets/modules/thing/shanxing/tex/Materials/jjqhong.lmat"]}}(Ce||(Ce={}));class Je{constructor(){}static createImg(e,t,i,s){}static create(e,t,i,s,a){var n,o,r,l=this;s||(s=new Laya.Point(fe.width/2,fe.height/2)),i||(i=new Laya.Point(0,0)),e>=5?(n=5,r=Math.floor(e/n),(o=e%n)>0&&(n+=1)):(n=Math.ceil(e/t.moneyFlashCount),r=Math.floor(e/n),o=e%e+1);var h=0,c=c=>{var d=c,u=new Laya.Tween,p=new Laya.Tween,m=e=>{p.clear(),p.to(e,{scaleX:.2*fe.minScale,scaleY:.6*fe.minScale},80,null,initHandler(l,()=>{p.to(e,{scaleX:.6*fe.minScale,scaleY:.5*fe.minScale},80,null,initHandler(l,m,[e]))}))},g=(s,r)=>{var c=i||new Laya.Point(0,0),d=We.getScene();d&&(t.moneyId==Ke.GOLD&&d.img_gold&&(c=d.img_gold.localToGlobal(new Laya.Point(0,0))),t.moneyId==Ke.ACTION&&d.img_action&&(c=d.img_action.localToGlobal(new Laya.Point(0,0))),t.moneyId==Ke.DHJ&&d.img_gold&&(c=d.img_gold.localToGlobal(new Laya.Point(0,0)))),u.to(s,{x:c.x,y:c.y},500,null,initHandler(l,()=>{s&&(s.removeSelf(),s.destroy(),s=null),n<=++h?(Ve.user.setMoney(t.moneyId,Ve.user.moneyMap[t.moneyId].count+(0==o?Math.floor(e/n):o)),a&&a()):Ve.user.setMoney(t.moneyId,Ve.user.moneyMap[t.moneyId].count+(0==o?Math.floor(e/n):Math.floor(e/(n-1))))}))},y=new Laya.Image;Tn.inst.setImageIcon(y,"res/icon/money/"+t.moneyIcon+".png");var f=s.x,_=s.y;y.anchorX=.5,y.anchorY=.5,y.x=f,y.y=_,m(y),y.alpha=0,((e,t,i)=>{e.addChild(t),t.alpha=1;var a=new Laya.Point(s.x,s.y);a.x=a.x-50*fe.minScale,a.y=a.y-50*fe.minScale;var h=new Laya.Point(Math.random()*(100*fe.minScale)+a.x,Math.random()*(100*fe.minScale)+a.y);u.to(t,{x:h.x,y:h.y},180,null,initHandler(l,()=>{u.to(t,{},30*i,null,initHandler(l,g,[t,d==n&&0!=o?o:r]))}))})(_e.getLayer(9),y,c)},d=(new Date).getTime();if(d-Je.goldtime>500&&ea.scene.player){Je.goldtime=d;var u=Xe.getBody(ea.scene.player.owner,"80003");u?(u.active=!1,u.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80003_lh],ea.scene.player.owner,1,null,initHandler(l,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)}))}for(var p=0;p<n;p++)c(p)}static create3d(e,t,i,s){var a=this,n=()=>{if(!ea.scene.GamePause){var o=i.position.clone(),r=t.position.clone(),l=o.x,h=o.y,c=o.z,d=calcPosAngle({x:l,y:c},{x:r.x,y:r.z}),u=calcPosAngle({x:h,y:c},{x:r.y,y:r.z}),p=calcAngleDist({x:l,y:c},.2,d),m=calcAngleDist({x:h,y:c},.2,u);i.position=new Laya.Vector3(p.x,m.x,p.y),Xe.is3DBallHit(i.position,r,.25,.25)&&(Ye.remove(i,n),Tn.inst.sound.play(Ie.id.金币),s&&s(),a.create(e,Ve.user.moneyMap[Ke.GOLD].tb,ea.scene.moneypos))}};Ye.add(1,i,n)}}Je.goldtime=0;class Ze extends Te{onRunHandler(e){var t=this.owner;if(t){switch(be.closepanel(we.DropBuffPanel),ea.scene.GamePause=!1,t.info.type){case 201:cafe.event.dispatch(se.GAME_BUFF_ADD_POWER,t.info);break;case 202:cafe.event.dispatch(se.GAME_BUFF_MAGNET,t.info);break;case 203:Je.create(Number(t.info.value),Ve.user.moneyMap[Ke.GOLD].tb,ea.scene.moneypos);break;case 204:ea.scene.player.info.attribute.addHp(Number(t.info.value));break;case 205:cafe.event.dispatch(se.GAME_BUFF_ADD_POWER,t.info);break;case 206:Ve.game.setCharm(5);break;case 207:Ue.show("吃了披萨，获得增加攻击力buff"),Ve.game.isPisa=!0,setTimeout(()=>{Ue.show("攻击buff已失效"),Ve.game.isPisa=!1},6e4);break;case 208:Ue.show("喝下加速饮料，获得加速buff"),Ve.game.isYinliao=!0,setTimeout(()=>{Ue.show("加速buff已失效"),Ve.game.isYinliao=!1},6e4);break;case 209:Ue.show("天妇罗"),ea.scene.player.info.attribute.addHp(15);break;case 210:Ve.game.setCharm(10);break;case 211:Ue.show("鳕鱼排"),ea.scene.player.info.attribute.addHp(20)}e&&e.runWith([1])}}}class Qe{static isDistanceIn(e,t,i,s=!1){var a,n;if(e.length)a={x:e[0],y:e[1],z:e[2]};else{var o=s?e.localPosition:e.position;a={x:o.x,y:o.y,z:o.z}}if(t.length)n={x:t[0],y:t[1],z:t[2]};else{var r=s?t.localPosition:t.position;n={x:r.x,y:r.y,z:r.z}}var l=getDistance({x:a.x,y:a.z},{x:n.x,y:n.z}),h=getDistance({x:a.z,y:a.y},{x:n.z,y:n.y});return l<=i&&h<=i}static get3Distance(e,t,i=!1){var s,a;if(e.length)s={x:e[0],y:e[1],z:e[2]};else{var n=i?e.localPosition:e.position;s={x:n.x,y:n.y,z:n.z}}if(t.length)a={x:t[0],y:t[1],z:t[2]};else{var o=i?t.localPosition:t.position;a={x:o.x,y:o.y,z:o.z}}return[getDistance({x:s.x,y:s.z},{x:a.x,y:a.z}),getDistance({x:s.z,y:s.y},{x:a.z,y:a.y})]}static get3DRangeDistance(e,t,i=!1){var s,a,n,o,r,l;e.length?(s=e[0],a=e[1],n=e[2]):e.x?(s=e.x,a=e.y,n=e.z):i?(s=e.localPosition.x,a=e.localPosition.y,n=e.localPosition.z):(s=e.position.x,a=e.position.y,n=e.position.z),t.length?(o=t[0],r=t[1],l=t[2]):t.x?(o=t.x,r=t.y,l=t.z):i?(o=t.localPosition.x,r=t.localPosition.y,l=t.localPosition.z):(o=t.position.x,r=t.position.y,l=t.position.z);var h=window.Math.abs(s-o),c=window.Math.abs(a-r),d=window.Math.abs(n-l);return window.Math.sqrt(h*h+c*c+d*d)}static getSprite3DListByDistance(e,t,i=20){var s,a,n=e.transform.localPosition;s={x:n.x,y:n.y,z:n.z};for(var o=[],r=[],l=0;l<t.length;l++){var h=t[l];if(h&&e!=h){var c=h.transform.localPosition;a={x:c.x,y:c.y,z:c.z};var d=getDistance({x:s.x,y:s.z},{x:a.x,y:a.z}),u=getDistance({x:s.z,y:s.y},{x:a.z,y:a.y});d<=i&&u<=i?o.push(h):r.push(h)}}return{in:o,out:r}}static getDistanceByPos(e,t){var i=e,s=t;return getDistance({x:i.x,y:i.z},{x:s.x,y:s.z})}static getDistance(e,t){var i=e.position,s=t.position;return getDistance({x:i.x,y:i.z},{x:s.x,y:s.z})}static getPosToForwardPos(e,t,i=!1){var s=i?e.localPosition:e.position,a={x:s.x,y:s.z},n=getDistanceAngleEToPos(a,t,i?e.localRotationEulerY:e.rotationEuler.y),o=calcPosAngle({x:a.x,y:-a.y},{x:n.x,y:-n.y});return calcAngleDist(a,t,o)}static getPosToBackwardPos(e,t,i=!1){var s=i?e.localPosition:e.position,a=t<0,n={x:s.x,y:s.z},o=getDistanceAngleEToPos(n,t,i?e.localRotationEulerY:e.rotationEuler.y),r=calcPosAngle({x:n.x,y:-n.y},{x:o.x,y:-o.y});return calcAngleDist(n,a?t:-t,r)}static getPosToBackwardPos2(e,t,i=!1){var s=i?e.localPosition:e.position,a=t<0,n={x:s.x,y:s.y},o=getDistanceAngleEToPos(n,t,i?e.localRotationEulerX:e.rotationEuler.x),r=calcPosAngle({x:n.x,y:-n.y},{x:o.x,y:-o.y});return calcAngleDist(n,a?t:-t,r)}static hitC(e,t,i){if(null===t||null==t.transform)return!1;if(t===e)return!1;let s=new Laya.Point(t.transform.position.x,t.transform.position.z);return AREA(i.pos,i.d1?i.d1:1,s,i.d2?i.d2:1)>0}static to3DAngle(e){return e<=180?e:-(180-(e-180))}static getAngleState(e,t){e<0&&(e=180-(-180-e)),t<0&&(t=180-(-180-t)),e>=0&&e<=90&&t>=270&&t<=360&&(e+=90,t=360-t),t>=0&&t<=90&&e>=270&&e<=360&&(t+=90,e=360-e);var i=e-t;return i>=0&&i<=45||i<=0&&i>=-45?1:0}static setSpriteRo(e,t,i,s){if(e["localRotationEuler"+t]<i){switch(t){case"X":e.rotate(new Laya.Vector3(s,0,0),!0,!0);break;case"Y":e.rotate(new Laya.Vector3(0,s,0),!0,!0);break;case"Z":e.rotate(new Laya.Vector3(0,0,s),!0,!0)}e["localRotationEuler"+t]>=i&&(e["localRotationEuler"+t]=i)}else if(e["localRotationEuler"+t]>i){switch(t){case"X":e.rotate(new Laya.Vector3(-s,0,0),!0,!0);break;case"Y":e.rotate(new Laya.Vector3(0,-s,0),!0,!0);break;case"Z":e.rotate(new Laya.Vector3(0,0,-s),!0,!0)}e["localRotationEuler"+t]<=i&&(e["localRotationEuler"+t]=i)}return e["localRotationEuler"+t]==i}static setSpriteRoEuler(e,t,i,s){return e["localRotationEuler"+t]<i?(e["localRotationEuler"+t]+=s,e["localRotationEuler"+t]>=i&&(e["localRotationEuler"+t]=i)):e["localRotationEuler"+t]>i&&(e["localRotationEuler"+t]-=s,e["localRotationEuler"+t]<=i&&(e["localRotationEuler"+t]=i)),e["localRotationEuler"+t]==i}static setSpriteScaleEuler(e,t,i,s){for(var a=!0,n=0;n<t.length;n++){var o=t[n];e["localScale"+o]<i?(e["localScale"+o]+=s,e["localScale"+o]>=i&&(e["localScale"+o]=i)):e["localScale"+o]>i&&(e["localScale"+o]-=s,e["localScale"+o]<=i&&(e["localScale"+o]=i)),e["localScale"+o]!=i&&(a=!1)}return a}static setSpritePosEuler(e,t,i,s){for(var a=!0,n=0;n<t.length;n++){var o=t[n];e["localPosition"+o]<i[n]?(e["localPosition"+o]+=s,e["localPosition"+o]>=i[n]&&(e["localPosition"+o]=i[n])):e["localPosition"+o]>i[n]&&(e["localPosition"+o]-=s,e["localPosition"+o]<=i[n]&&(e["localPosition"+o]=i[n])),e["localPosition"+o]!=i[n]&&(a=!1)}return a}static setSpritePos(e,t,i,s){if(e["localPosition"+t]<i){switch(t){case"X":e.translate(new Laya.Vector3(s,0,0),!0);break;case"Y":e.translate(new Laya.Vector3(0,s,0),!0);break;case"Z":e.translate(new Laya.Vector3(0,0,s),!0)}e["localPosition"+t]>=i&&(e["localPosition"+t]=i)}else if(e["localPosition"+t]>i){switch(t){case"X":e.translate(new Laya.Vector3(-s,0,0),!0);break;case"Y":e.translate(new Laya.Vector3(0,-s,0),!0);break;case"Z":e.translate(new Laya.Vector3(0,0,-s),!0)}e["localPosition"+t]<=i&&(e["localPosition"+t]=i)}return e["localPosition"+t]==i}static getGlobalPos(e,t={x:0,y:0,z:0},i){if(!i)return new Laya.Point(0,0);let s=e.transform.position.clone();t&&(s.x+=t.x,s.y+=t.y,s.z+=t.z);let a=new Laya.Vector4(0,0,0,0);return i.viewport.project(s,i.projectionViewMatrix,a),a.w>=0?{x:a.x/Laya.stage.clientScaleX-100,y:a.y/Laya.stage.clientScaleY}:null}static getTAndSpeedToXYObj(e,t,i,s){let a={x:e.x,y:e.z},n={x:e.y,y:e.z},o=getDistanceAngleEToPos(a,-s,-t),r=getDistanceAngleEToPos(n,-s,i),l=calcPosAngle({x:a.x,y:-a.y},{x:o.x,y:-o.y}),h=calcPosAngle({x:n.x,y:n.y},{x:r.x,y:r.y});return l=Math.round(180*l/Math.PI)+90,h=Math.round(180*h/Math.PI)+90,{p:{x:e.x,y:e.y,z:e.z},pos:{x:o.x,y:r.x,z:o.y},angle:l,angle2:h}}static getTAndSpeedToXYObj2(e,t,i,s){let a={x:e.x,y:e.z},n={x:e.y,y:e.z},o=getDistanceAngleEToPos(a,-s,-t),r=getDistanceAngleEToPos(n,-s,i);return new Laya.Vector3(o.x,r.x,o.y)}static get3DPosToAngleYX(e,t,i=!1){var s=getDistance({x:e.x,y:e.z},{x:t.x,y:t.z});let a=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z}),n=180*a/Math.PI+90,o=calcPosAngle({x:e.y,y:0},{x:t.y,y:s}),r=180*o/Math.PI-90;return i?{y:n,x:r}:{y:a,x:o}}static calcTrajectoryParamsone(e,t,i){let s={x:e.localPositionX,y:e.localPositionZ},a=getDistanceAngleEToPos(s,-t,-i),n=calcPosAngle({x:s.x,y:-s.y},{x:a.x,y:-a.y});return{p:s,pos:a,angle:n=Math.round(180*n/Math.PI)+90}}static calcTrajectoryParamstwo(e,t,i){let s={x:e.x,y:e.z},a=getDistanceAngleEToPos(s,-t,-i),n=calcPosAngle({x:s.x,y:-s.y},{x:a.x,y:-a.y});return{p:s,pos:a,angle:n=Math.round(180*n/Math.PI)+90}}}class $e{constructor(){this.is_add_speed=!1,this.is_move=!0}set tb(e){this._tb=e,this.thingHandler&&this.thingHandler.run()}get tb(){return this._tb}}class et extends Ee.res.modules.game.view.BuffItemViewUI{constructor(){super()}onEnable(){super.onEnable()}init_info(e){this.img_buff_icon.skin="res/icon/smallskill/"+e+".png"}onDisable(){super.onDisable()}}class tt extends Ee.res.modules.game.view.FightHeroInfoViewUI{constructor(){super(),this.isdispose=!1;this.addCom(this,fe)}onEnable(){super.onEnable();this.buffitem_dic={}}init_info(e){this.target=e;this.target&&this.target.state}addbuff(e){let t=new et;t.init_info(e),this.box_buff.addChild(t),this.buffitem_dic[e]=t,this.buff_array()}removebuff(e){this.buffitem_dic[e]&&(this.buffitem_dic[e].removeSelf(),delete this.buffitem_dic[e],this.buff_array())}buff_array(){let e=this,t=0;for(let i in e.buffitem_dic){let s=e.buffitem_dic[i];s.height=40,s.width=40,s.x=45*t,e.box_buff.width=45*t+40,t++}}onDisable(){this.isdispose||ea.scene.isGameing||(this.isdispose=!0,Laya.Tween.clearTween(this))}}class it extends Laya.Script{constructor(){super(),this.isdispose=!1,this.active=!1,this.active=!1,this.eventmap={},this.datamap={},this.layaMap={},this.comMap={}}initAction(e){}setGroup(e,t,i){return this.groupTarget=e,this.actionId=t,this.initAction(i),this}run(e){}stopScript(){this.groupTarget.stop(this.actionId)}startScript(e,t){this.groupTarget.start(e,t)}static getid(e){return e._lbsid?e._lbsid:(e._lbsid=it._lbsid,it._lbsid++,e._lbsid)}onEnable(){super.onEnable()}binGuide(){this.owner.timerOnce(100,this,()=>{this.bin("GUIDE_DATA",this.handleGuideTransition)})}handleGuideTransition(){}addCom(e,t){var i=e.addComponent(t);return this.comMap[it.getid(e)+"_"+t.name]={target:e,com:i},i}layaMonitor(e,t,i,...s){this.layaMap[it.getid(i)+"_"+e]={type:e,target:i,handler:t},i.on(e,this,t,s)}addClick(e,...t){this.layaMonitor(Laya.Event.CLICK,this.onClickHandler,e,...t)}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}bin(e,t,i,s){this.datamap[e+"_"+i]={type:e,changeType:i,handler:t},cafe.data.on(e,t,this,i,s)}onClickHandler(e){}getCom(e,t){return e.getComponent(t)}removeCom(e,t){var i=this.comMap[it.getid(e)+"_"+t.name];delete this.comMap[it.getid(e)+"_"+t.name],i&&i.com&&i.com.destroy()}onDestroy(){super.onDestroy(),this.clearMonitor(),this.clearLayaMonitor(),this.clearBin(),this.clearCom(),this.isdispose=!0}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}clearLayaMonitor(){for(var e in this.layaMap){var t=this.layaMap[e];t.target.off&&t.target.off(t.type,this,t.handler),delete this.layaMap[e]}}clearBin(){for(var e in this.datamap){var t=this.datamap[e];cafe.data.off(t.type,t.handler,this,t.changeType),delete this.datamap[e]}}clearCom(){for(var e in this.comMap){var t=this.comMap[e];delete this.comMap[e],t&&t.com&&t.com.destroy()}}}it._lbsid=0;class st extends it{constructor(){super(),this.uiWidth=200,this.move_speed=0,this.thingHeight=.02,this.isdispose=!1}onEnable(){}init(...e){this.initView()}initView(){this.headview&&this.headview.parent&&this.headview.removeSelf(),this.headview=new tt,this.headview.txt_hp.text=this.thing_hp+"/"+this.max_hp,_e.getLayer(1).addChild(this.headview),this.headview.visible=!0}show(){this.headview&&(this.headview.visible=!0)}hide(){this.headview&&(this.headview.visible=!1)}initAttribute(e){let t=this;for(let i=0;i<e.length;i++)t[ee[i]]=e[i]}addHp(e){this.thing_hp+=e,this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp),this.headview&&(this.headview.txt_hp.text=this.thing_hp+"/"+this.max_hp);var t=200*(Math.round(this.thing_hp/this.max_hp*100)/100);t<10&&(t=10),this.headview&&(this.headview.img_hp.width=t),this.thing_hp}hitHurt(e){this.thing_hp-=e,this.thing_hp<0&&(this.thing_hp=0),this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp),this.headview?this.headview.txt_hp.text=this.thing_hp+"/"+this.max_hp:this.initView();var t=200*(Math.round(this.thing_hp/this.max_hp*100)/100);t<10&&(t=10),this.headview&&(this.headview.img_hp.width=t),this.thing_hp}initViewInfo(){this.headview&&this.headview.init_info(this.owner)}setValue(e,t){this[ee[e]]=t}getValue(e){return this[ee[e]]}onUpdate(){if(ea.scene.isGameing&&(!this.headview||this.headview.visible)&&this.headview&&ea.scene.camera&&ea.scene.mainscene){let e=this.owner.transform.position.clone();e.y+=this.thingHeight;let t=new Laya.Vector4(0,0,0,0);if(ea.scene.camera.viewport.project(e,ea.scene.camera.projectionViewMatrix,t),t.w>=0)this.headview.visible=!0,this.headview.pos(t.x/Laya.stage.clientScaleX-this.headview.group_content.width*this.headview.group_content.scaleX/2,t.y/Laya.stage.clientScaleY);else{if(1==Ve.game.isRidePonpon)return;this.headview.visible=!1}}}onDestroy(){this.isdispose||(this.isdispose=!0,this.headview&&this.headview.parent&&this.headview.removeSelf(),this.headview=null,super.onDestroy())}}class at extends st{constructor(){super(),this.uiWidth=200,this.thingHeight=.12}onEnable(){super.onEnable()}init(e,t){let i=this;i.thing_id=e,i.thing_hp||(i.thing_hp=t),i.max_hp=t,Ve.role.equip_role?(i.max_hp=this.Max_hp(Ve.role.equip_role),i.max_Attack=i.max_attack(Ve.role.equip_role),i.max_Speed=i.max_speed(Ve.role.equip_role),i.max_Defense=i.max_defense(Ve.role.equip_role)):i.max_hp=t,ea.scene.ui.img_rolehp.width=i.uiWidth,i.monitor(se.INITROLEEQUIP,i.InitEquip),i.hitHurt(0)}InitEquip(e){this.max_hp=this.Max_hp(e),this.max_Attack=this.max_attack(e),this.max_Speed=this.max_speed(e),this.max_Defense=this.max_defense(e),this.thing_hp+=Ve.equip.GetEquipHp(),this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp),this.headview&&(this.headview.txt_hp.text=this.thing_hp+"/"+this.max_hp),ea.scene.ui&&(ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString()),cafe.event.dispatch(se.UPDATEROLESPEED)}Max_hp(e){return Ve.equip.GetEquipHp()>0?a.role.getTbByRoleId(e).hp+Ve.equip.GetEquipHp():a.role.getTbByRoleId(e).hp}max_speed(e){return a.role.getTbByRoleId(e).speed+Ve.equip.GetEquipSpeed()}max_attack(e){return a.role.getTbByRoleId(e).attack+Ve.equip.GetEquipAttack()}max_defense(e){return a.role.getTbByRoleId(e).defense+Ve.equip.GetEquipDefense()}hitHurt(e){this.thing_hp-=e,this.thing_hp<0&&(this.thing_hp=0);var t=Math.round(this.thing_hp/this.max_hp*100)/100,i=this.uiWidth*t;i<10&&(i=10),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=i,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString()),this.thing_hp<=0&&cafe.event.dispatch(se.GAME_PLAYER_DIE)}addHp(e){this.thing_hp+=e,this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp);var t=Math.round(this.thing_hp/this.max_hp*100)/100,i=this.uiWidth*t;i<10&&(i=10),this.headview&&(this.headview.img_hp.width=i),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=i,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString()),this.thing_hp}addBsHp(e){this.thing_hp+=Math.floor(this.max_hp*(e/100)),this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp);e=Math.round(this.thing_hp/this.max_hp*100)/100;var t=this.uiWidth*e;t<10&&(t=10),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=t,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString()),this.thing_hp}revive(){this.thing_hp=this.max_hp;var e=Math.round(this.thing_hp/this.max_hp*100)/100,t=this.uiWidth*e;t<10&&(t=10),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=t,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString())}onDestroy(){this.headview&&(this.headview.visible=!1),ea.scene.isGameing||super.onDestroy()}}class nt extends it{constructor(){super(),this.movestate=0,this.isBrake=!1,this.updateCount=1}onEnable(){Ye.add(this.updateCount,this,this.onFrameRun)}onFrameRun(e){}clear_ai(){let e=this;e.aiAction&&(e.aiAction.destroy(),e.aiAction=null)}onDestroy(){super.onDestroy(),Ye.remove(this,this.onFrameRun)}}class ot extends ae{constructor(){super()}onEnable(){this.actmap||(this.actmap={})}clear(){for(var e in this.actmap)this.actmap[e]&&(this.actmap[e].uninstall(),this.actmap[e].destroy(),delete this.actmap[e])}isInstall(e){return!(!this.actmap||!this.actmap[e])&&this.actmap[e].active}install(e,t,i){var s=new t(this.owner,e,i);s?s.install?(this.actmap[e]&&this.uninstall(e),s.install(i),Ye.remove(this,this.onUpdateFrame),Ye.add(1,this,this.onUpdateFrame),this.actmap[e]=s):serror("BUG，你这个行为不是继承BaseAct",e):serror("BUG，拿不到这个位置的行为",e)}uninstall(e){this.actmap[e].uninstall(),Ye.remove(this,this.onUpdateFrame)}getAct(e){return this.actmap[e]}onUpdateFrame(e){for(var t in this.actmap){var i=this.actmap[t];i.active&&i.onUpdate(e)}}onDestroy(){super.onDestroy(),this.clear()}}class rt extends ae{constructor(){super()}onEnable(){this.skillmap={},this.useSkillPos=-1,this.monitor(ge.game.ROLE_USE_ACTION,this.onSkillUse),this.monitor(ge.game.ROLE_USE_ACTION_FINISH,this.onSkillFinish)}clear(){for(var e in this.onSkillFinish(),this.skillmap)this.skillmap[e]&&(this.skillmap[e].uninstall(),this.skillmap[e].destroy(),delete this.skillmap[e])}isInstall(e){return!(!this.skillmap||!this.skillmap[e])&&this.skillmap[e].active}install(e,t,i){var s=new t(this.owner,e,i);s?s.install?(s.install(i),this.skillmap[e]=s):serror("BUG，你这个行为不是继承BaseAct",e):serror("BUG，拿不到这个位置的行为",e)}uninstall(e){this.skillmap[e].uninstall()}getSkill(e){return this.skillmap[e]}onSkillUse(e){this.useSkillPos=e}onSkillFinish(){this.useSkillPos=-1}onUpdate(){for(var e in this.skillmap){var t=this.skillmap[e];t.active&&t.onUpdate()}}onDestroy(){super.onDestroy(),this.clear()}}class lt extends it{constructor(){super()}onEnable(){this.statemap||(this.statemap={}),Ye.add(1,this,this.onUpdateFrame)}clear(){for(var e in Ye.remove(this,this.onUpdateFrame),this.statemap)this.statemap[e]&&(this.statemap[e].uninstall(),this.statemap[e].destroy(),delete this.statemap[e])}isInstall(e){return!(!this.statemap||!this.statemap[e])&&this.statemap[e].active}install(e,t,i){var s;this.statemap[e]&&(this.uninstall(e),s=this.statemap[e],i&&i.taskId&&s.push(i.taskId)),s||(s=new t(this.owner,e,i)),s?s.install?(s.install(i),this.statemap[e]=s):serror("BUG，你这个行为不是继承BaseTaskState",e):serror("BUG，拿不到这个位置的行为",e)}uninstall(e){this.statemap[e].uninstall()}getState(e){return this.statemap[e]}onUpdateFrame(e){for(var t in this.statemap){var i=this.statemap[t];i.active&&i.onUpdate(e)}}onDestroy(){super.onDestroy(),this.clear()}}class ht extends ae{constructor(){super(...arguments),this.triggerActive=!0}onEnable(){this.thingbody||(this.thingbody=this.owner),this.type=3,this.tid=this.owner.tid,this.effects={}}initThing(){this.ani||(this.ani=this.addCom(this.owner,oe),this.ani.init(this.thingbody,new Laya.Handler(this,this.onPlayerEnd))),this.info||(this.info=new $e,this.info.attribute=this.addCom(this.owner,at)),this.action||(this.action=this.addCom(this.owner,ot)),this.effectaction||(this.effectaction=this.addCom(this.owner,ot)),this.buffaction||(this.buffaction=this.addCom(this.owner,ot)),this.state||(this.state=this.addCom(this.owner,lt)),this.skill||(this.skill=this.addCom(this.owner,rt)),this.ai||(this.ai=this.addCom(this.owner,nt))}set action(e){this._action=e}get action(){return this._action}set effectaction(e){this._effectaction=e}get effectaction(){return this._effectaction}set state(e){this._state=e}get state(){return this._state}set buffaction(e){this._buffaction=e}get buffaction(){return this._buffaction}set skill(e){this._skill=e}get skill(){return this._skill}playAni(e,t){this.ani&&(t?this.ani.play(e,t):this.ani.state=e)}onPlayerEnd(e){slog("onPlayerEnd: "+e)}runLoopingParticle(e,t){let i=this;Tn.inst.load3d.particleRes(e,initHandler(i,s=>{s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,0,0),i.effects[e]=t.addChild(s)}))}hit(e){this.tbthing.type&&this.tbthing.type>2||(e?this.playAni(e):this.playAni(ie.hit))}trailSprite3DRes(e,t){let i=this;Tn.inst.load3d.particleRes(e,initHandler(i,s=>{s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,.3,0),s._geometryFilter.widthMultiplier=.8,s._geometryFilter.time=1,i.effects[e]=t.addChild(s)}))}stopParticleRes(){let e=this;if(e.effects)for(let t in e.effects)e.effects[t].removeSelf(),delete e.effects[t]}onDestroy(){super.onDestroy();this.action&&this.action.destroy(),this.effectaction&&this.effectaction.destroy(),this.buffaction&&this.buffaction.destroy(),this.ani&&this.ani.destroy(),delete ea.scene.things[this.owner.name]}}class ct extends he{constructor(){super(),this.onActiveRefTime=10;Ye.add(this.onActiveRefTime,this,this.onEnterFrame)}onEnterFrame(e){var t;ea.scene.player&&(ea.scene.player.owner&&(t=mi.device.currentMountGear?mi.device.currentMountGear:ea.scene.player.owner,this.onActiveRef(),mi.device.onDeviceRef(),Ve.map.mptData.refThing(t.transform),mi.task.onTaskTigger()))}onActiveRef(){ea.scene.player&&ea.scene.player.owner&&!ea.scene.things.player&&(ea.scene.things[ea.scene.player.owner.name]=ea.scene.player.owner);for(var e=Ve.map.mptData.mptModel[J.ROLE].things,t=Qe.getSprite3DListByDistance(ea.scene.player.owner,e,200),i=0;i<t.in.length;i++){(s=t.in[i].getComponent(ht)).info&&s.info.attribute&&s.info.attribute.show(),s.active=!0,s.ai&&(s.ai.active=!0)}for(i=0;i<t.out.length;i++){var s;(s=t.out[i].getComponent(ht)).isHeroRideCar||-1==s.owner.name.indexOf("monster")&&(s.active=!1,s.info&&s.info.attribute&&s.info.attribute.hide(),s.ani&&s.ani.state!=ie.run&&s.ani.state!=ie.baoqi&&s.playAni(ie.idle))}}destroy(){Ye.remove(this,this.onEnterFrame)}}class dt extends he{constructor(e){super(),this.onActiveRefTime=300;this.owner=e,Ye.add(this.onActiveRefTime,this,this.onFrameUpdate)}onFrameUpdate(){Ve.map&&Ve.map.mptData&&Ve.map.mptData.checkBath()&&Ve.user.addGold(10,ea.scene.moneypos,null,()=>{})}destroy(){super.destroy();Ye.remove(this,this.onFrameUpdate)}}class ut extends he{constructor(){super();this.monitor(ge.game.CMD,this.gamerun),this.monitor(ge.game.TOOLCMD,this.toolrun)}toolrun(e){var t=e.split("|");this.run(Number(t[0]),t[1])}gamerun(e){this.run(Number(e[0]),e[1])}run(e,t){this.rxp(e,t)}rxp(e,t){switch(e){case ye.ENTER_MAP:cafe.event.dispatch(ge.game.MAP_TRANSFER_POINT,Number(t));break;case ye.ENTER_HOME:break;case ye.REPLACE_FURNITURE:slog("家具触发");break;case 0:if(be.IsOpenPanel())switch(Number(t)){case ye.REPLACE_FURNITURE:}break;case ye.TIPS:Ue.show(t)}}destroy(){super.destroy()}}class pt{get count(){return this._count}set count(e){this._count=e,this.handler&&this.handler.runWith([e])}static getTweenid(e){var t=pt;return e._tweenid?e._tweenid:(e._tweenid=t._tweenid,t._tweenid++,e._tweenid)}static conTween(e,t){var i=pt,s=100*pt.getTweenid(e)+t;return null!=i.dic[s]}static clearFish(e,t){var i=pt,s=100*pt.getTweenid(e)+t;null!=i.dic[s]&&(i.dic[s].tween.clear(),delete i.dic[s])}static showOneVisibleEffect(e,t,i,s){var a=pt,n=100*pt.getTweenid(e)+t;null!=a.dic[n]&&(a.dic[n].tween.clear(),delete a.dic[n]);var o=new pt,r=new Laya.Tween;e.visible=!0,r.to(o,{},i,null,initHandler(a,()=>{r.clear(),delete a.dic[n],e.visible=!1,s&&s.run()})),pt.dic[n]={target:e,util:o,tween:r}}static countFish(e,t,i,s,a,n,o,r){var l=pt,h=100*pt.getTweenid(e)+t;null!=l.dic[h]&&(l.dic[h].tween.clear(),delete l.dic[h]);var c=new pt;c.handler=o,c._count=s;var d=new Laya.Tween;d.to(c,{count:a},i,n,initHandler(l,()=>{d.clear(),delete l.dic[h],r&&r.run()})),pt.dic[h]={target:e,util:c,tween:d}}static SpringAni(e,t=200,i=0,s=1,a=1.2,n){Laya.Tween.clearAll(e);var o=new Laya.Tween;e.scaleX=i,e.scaleY=i,o.to(e,{scaleX:a,scaleY:a},t,Laya.Ease.linearNone,initHandler(this,()=>{o.clear(),o.to(e,{scaleX:s,scaleY:s},t,Laya.Ease.linearNone,initHandler(this,()=>{o.clear(),n&&n.run()}))}))}static BreathEffect(e,t=1e3,i=1.1){Laya.Tween.clearAll(e);var s=new Laya.Vector2(e.scaleX,e.scaleY),a=new Laya.Tween;Laya.timer.clearAll(e),Laya.timer.loop(t,null,()=>{a.to(e,{scaleX:s.x*i,scaleY:s.y*i},t/2,null,initHandler(this,()=>{a.clear(),a.to(e,{scaleX:s.x,scaleY:s.y},t/2,null,initHandler(this,()=>{a.clear()}))}))})}static FlickerEffect(e,t=500,i=2,s){Laya.Tween.clearAll(e);var a=new Laya.Tween;e.alpha=0,a.to(e,{alpha:1},t,Laya.Ease.linearNone,initHandler(this,()=>{a.clear(),a.to(e,{alpha:0},t,Laya.Ease.linearNone,initHandler(this,()=>{a.clear(),i>1?this.FlickerEffect(e,t,--i,s):(e.alpha=1,s&&s.run())}))}))}}pt.dic={},pt._tweenid=0;class mt extends cafe.data.BaseData{constructor(){super(mt.NAME);this.init()}init(){var e=this.read();this.isVibrate=e&&null!=e.isVibrate&&1!=e.isVibrate?0:1,this.isSound=e&&null!=e.isSound&&1!=e.isSound?0:1}switchVibrate(e){this.isVibrate=e?1:0,this.save()}switchSound(e){this.isSound=e?1:0,Tn.inst.sound.switchBg(e),this.save(),this.invalidate()}save(){var e={isVibrate:this.isVibrate,isSound:this.isSound};i.saveJson(mt.NAME,e)}read(){return i.readJson(mt.NAME)}}mt.NAME="SETTING_DATA";class gt extends he{constructor(e){super(),this.maxbloodW=159,this._blood=0,this.maxbloodExpW=300,this._bloodExp=0,this.isSpawnHealth=!1;this.owner=e,this.blood=Ve.core.curBlood,this.bloodExp=Ve.core.curBloodExp,this.checkSound(0),this.monitor(mt.NAME,this.onSettingChange)}onSettingChange(){this.xxsound&&(this.xxsound.volume=Ve.setting.isSound?1:0)}checkSound(e){}get blood(){return this._blood}set blood(e){this._blood=e;var t=this._blood/Ve.core.levelTb.maxblood,i=Math.floor(this.maxbloodW*t);i<1&&(i=1),this.xxsound&&(this.xxsound.volume=Ve.setting.isSound?1:0)}get bloodExp(){return this._bloodExp}set bloodExp(e){}SpawnHealth(){ea.scene.player.info.tb}bloodflash(e,t=100,i){var s=this;pt.countFish(s,1,t,s.blood,e,null,new Laya.Handler(s,e=>{s.blood=e,cafe.event.dispatch(se.GAME_BLOOD_EFFECT,!0)}),initHandler(s,()=>{s.isSpawnHealth&&s.SpawnHealth(),cafe.event.dispatch(se.GAME_BLOOD_EFFECT,!1),s.xxsound&&(s.xxsound.volume=0),i&&i.run()}))}bloodExpflash(e,t=100,i){var s=this;pt.countFish(s,2,t,s.bloodExp,e,null,new Laya.Handler(s,e=>{s.bloodExp=e}),initHandler(s,()=>{i&&i.run()}))}startBlood(){this.isSpawnHealth=!0,this.SpawnHealth()}stopBlood(){this.isSpawnHealth=!1,this.bloodTarget=null}destroy(){this.xxsound&&(this.xxsound.volume=0,this.xxsound.stop(),this.xxsound=null)}}!function(e){e[e.baidu_H5=1]="baidu_H5",e[e.oppo_H5=2]="oppo_H5",e[e.qqplay_H5=3]="qqplay_H5",e[e.toutiao_H5=4]="toutiao_H5",e[e.vivo_H5=5]="vivo_H5",e[e.weixin_H5=6]="weixin_H5",e[e.x4399_H5=7]="x4399_H5",e[e.xiaomi_H5=8]="xiaomi_H5",e[e.huawei_H5=9]="huawei_H5",e[e.android=10]="android"}(Le||(Le={}));class yt{constructor(){this.platformAPI=null,this.platform=null,this.intervalADTime=0}static getInstance(){return null===this.mInstance&&(this.mInstance=new yt),this.mInstance}onInit(e){switch(this.platform){case Le.toutiao_H5:}this.platformAPI&&null!==this.platformAPI&&this.platformAPI.onInit(e)}onLogin(){this.platformAPI&&this.platformAPI.onLogin()}onShare(e){this.platformAPI&&this.platformAPI.onShare(e)}createBanner(){this.platformAPI&&this.platformAPI.createBanner()}showBanner(e){this.platformAPI&&this.platformAPI.showBanner(e)}hideBanner(){this.platformAPI&&this.platformAPI.hideBanner()}showVideo(e,t,i,s,a){console.log("toutiaoApi_______________showVideo"),io.getInstance().displayIncentivizedAd(()=>{i&&i()})}showVideoAward(){this.platformAPI&&this.platformAPI.showVideoAward()}showVideoFail(){this.platformAPI&&this.platformAPI.showVideoFail()}createInsertAd(){this.platform==Le.toutiao_H5?this.platformAPI&&this.platformAPI.showInsertAd():this.platformAPI&&this.platformAPI.createInsertAd()}showInsertAd(){this.platformAPI&&this.platformAPI.showInsertAd()}vibrate(e){this.platformAPI&&this.platformAPI.vibrate(e)}}yt.mInstance=null;class ft extends he{constructor(e){super(),this.Devices=[],this.curpanel=!1;this.owner=e,this.monitor(ge.game.MAP_REPLACE_FINISH,this.onMapReplace)}onMapReplace(){this.rideCar&&this.rideCar()}rideTargetDevice(e){e||!this.curRide?this.curRide!=e&&(this.curRide=e,this.rideDevice()):this.rideDevice()}rideDevice(){var e=this;if(e.curRide){var t=e.curRide.getComponent(ht);if(t&&t.installBone){var s=Xe.getBody(ea.scene.player.owner,"30022"),a=Xe.getBody(ea.scene.player.owner,"30023");if(a&&(a.active=!1),s&&(s.active=!1),Ve.game.isbig=!1,Ve.game.issmall=!1,Ve.game.isjiansu=!1,Ve.game.isjiasu=!1,ea.scene.player.thingbody.transform.localScale=new Laya.Vector3(1,1,1),ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),ea.scene.player.playAni(e.curRide.tb.roleani),e.curRide.exitCar)return cafe.event.dispatch(ge.game.MAP_TRANSFER_POINT,Ve.map.map.exitMapId),void(e.rideCar=(()=>{ea.car.localride(e.curRide.tbId),e.rideCar=null}));if(0==e.curRide.tb.isShowRole?ea.scene.player.owner.active=!1:(ea.scene.player.owner.active=!0,ea.scene.player.triggerActive=!1,ea.scene.player.ClearTrigger()),e.currentMountGear=e.curRide,Ve.game.isRideZuoqi="qi"==e.curRide.tb.roleani||"fly"==e.curRide.tb.roleani||"qima"==e.curRide.tb.roleani,Ve.game.isRideZuoqi&&(Ve.game.ZuoqiState=1),11436005==e.curRide.tb.configId&&i.save("firstTL","1"),6!=e.curRide.tb.deviceType)ea.scene.cameraCode.lockTarget=e.currentMountGear,ea.scene.cameraCode.initOnePlay2();else Xe.getBody(e.curRide,"group_camera").addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=new Laya.Vector3(0,0,0),ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,180,0);70039==e.curRide.tbId&&(Ve.game.isRidePonpon=!0),e.owner.btn_jiashi.getChildByName("img_shangche").visible=!1,e.owner.btn_jiashi.getChildByName("img_youwan").visible=!1,e.owner.btn_jiashi.getChildByName("img_xiache").visible=!0,cafe.event.dispatch(ge.game.DEVICE_MOD_REPLACE_FINISH,e.curRide.tbId),200006==e.curRide.tb.defaultEquipSkillMod&&(ea.scene.switchControl(!0),cafe.event.dispatch(se.INITCARSPEED)),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.currentMountGear.tb.deviceId,taskType:30,count:1});var n=e.currentMountGear.tb.deviceId;switch(ea.scene.player&&ea.scene.player.FlyBagHidden(),n){case 70049:Ve.game.isUnLockQiMa=!0;break;case 70065:case 70056:break;case 70046:Ve.game.isUnLockCar=!0}var o=Xe.getBody(e.currentMountGear,"videoNode");o&&(o.active=!1);var r=Xe.getBody(e.currentMountGear,"guangquan");r&&(r.active=!1);var l=Xe.getBody(e.currentMountGear,"mode");l&&(l.active=!1),0!=e.currentMountGear.tb.deviceTime&&ea.scene.ui.deviceJinDu(e.currentMountGear.tb.deviceTime)}else e.curRide&&e.curRide.tb?Ue.show(e.curRide.tb.unloadtip):Ue.show("设备正在维修中，请耐心等待")}else Ue.show("离设备太远，请走近设备再试一次")}unDevice(e){if(ea.scene.player&&ea.scene.player.owner){if(ea.scene.player.owner.active=!0,ea.scene.player.triggerActive=!0,this.currentMountGear){var t=ea.scene.player.owner.transform,i=this.currentMountGear.getComponent(ht),s=i.uninstallBone.transform;Ve.game.isSaiChe?t.position=new Laya.Vector3(135,.12,240):(t.position=s.position.clone(),t.rotation=s.rotation.clone());var a=Xe.getBody(mi.device.currentMountGear,mi.device.currentMountGear.tb.npcinstallBoneName);a&&a.numChildren>0&&Ve.game.curNpc==a.getChildAt(0)&&(ea.scene.mainscene.getChildByName("map").addChild(Ve.game.curNpc),Ve.game.curNpc.getComponent(ht).isHeroRideCar=!1),ea.scene.switchControl(!1),i.uninstall&&i.uninstall(),200006==this.currentMountGear.tb.defaultEquipSkillMod&&cafe.event.dispatch(se.INITCARSPEED)}Ve.game.isRidePonpon=!1,cafe.event.dispatch(ge.game.UNDEVICE_MOD_REPLACE_FINISH),Ve.game.carmove_camera=!0,Ve.game.isSaiChe&&(this.currentMountGear.removeSelf(),this.currentMountGear.destroy(),Ve.game.isSaiChe=!1),this.fire&&this.fire.stop(),this.CarMove&&this.CarMove.stop(),this.currentMountGear&&this.currentMountGear.tb&&1==this.currentMountGear.tb.lockType&&(Ve.game.changeridelock=!0,Ve.game.isUnLockQiMa=!1,Ve.game.isUnLockCar=!1,Laya.timer.once(5e3,this,()=>{Ve.game.changeridelock=!1})),this.currentMountGear=null,ea.scene.cameraCode.lockTarget=ea.scene.player.owner,ea.scene.cameraCode.initOnePlay2(),e&&e.run()}}unDeviceByMap(){if(ea.scene.player.owner.active=!0,ea.scene.player.triggerActive=!0,ea.scene.player.owner){if(this.currentMountGear){var e=ea.scene.player.owner.transform,t=this.currentMountGear.getComponent(ht),i=t.uninstallBone.transform;e.position=i.position.clone(),e.rotation=i.rotation.clone(),ea.scene.switchControl(!1),t.uninstall&&t.uninstall(),this.currentMountGear.removeSelf(),this.currentMountGear.destroy()}this.currentMountGear=null,ea.scene.cameraCode.lockTarget=ea.scene.player.owner,ea.scene.cameraCode.initOnePlay2(),cafe.event.dispatch(ge.game.UNDEVICE_MOD_REPLACE_FINISH),Ve.game.isRidePonpon=!1}}onDeviceRef(){var e;if(this.currentMountGear){this.curRide=null,(20061002==this.currentMountGear.tb.configId||1==Ve.game.isSaiChe||Ve.game.isBaoQi)&&(this.owner.box_fight.visible=!1),Ve.guide.isGuideBoolean(6)&&Ve.guide.refSetup(),"200002"!=this.currentMountGear.tb.equipSkillMods&&"200007"!=this.currentMountGear.tb.equipSkillMods?this.owner.box_fight.visible=!1:0==this.owner.box_fight.visible&&(this.owner.box_fight.visible=!0);var t=this.currentMountGear.getComponent(ht);return"200002"==this.currentMountGear.tb.equipSkillMods&&t&&!t.dMoveTrigger&&!t.dMoveTrigger.isTrigger&&this.currentMountGear.transform.localPositionY,void((1==this.currentMountGear.tb.lockType||this.currentMountGear.tb.deviceTime>0)&&(ea.scene.ui.btn_jiashi.visible=!1))}if(Ve.game.isBaoQi||3==Ve.game.MaoMaoGameType||(this.owner.box_fight.visible=!0),ea.scene.player.moveTrigger&&(e=ea.scene.player.moveTrigger.kinematics),e){var s=Ve.map.mptData.devices;if(this.curdeviceid=0,e&&0==e.length)this.owner.btn_jiashi.visible=!1;else{for(var a=0;a<e.length;a++){var n=e[a];if(n.main&&(n=n.main),n.tb&&(40005==n.tb.deviceId||40006==n.tb.deviceId))return;if(n.tb&&(this.curdeviceid=n.tb.deviceId),n.tb&&3!=n.tb.deviceType){this.owner.btn_jiashi.getChildByName("img_shangche").visible=6!=n.tb.deviceType,this.owner.btn_jiashi.getChildByName("img_youwan").visible=6==n.tb.deviceType,this.owner.btn_jiashi.getChildByName("img_xiache").visible=!1;var o=s.indexOf(n);if(-1!=o&&!this.curpanel){this.curRide=s[o];ea.money.strToInfo(this.curRide.tb.price);switch(n.tb.lockType){case 1:if(Ve.game.changeridelock||Ve.game.isbig||Ve.game.issmall)return;return ea.scene.player.moveTrigger.ClearTrigger(),void yt.getInstance().showVideo(null,null,()=>{mi.device.rideDevice(),ea.scene.GamePause=!1});case 2:r.visible=!1;var r=this.owner.btn_jiashi.getChildByName("img_video");ea.scene.ui.btn_jiashi.visible=!0;var l=i.read("DeviceNoTime");l||(r.visible=!0),l&&-1==l.indexOf(n.tb.deviceId.toString())&&(r.visible=!0);break;case 3:ea.scene.ui.btn_jiashi.visible=!0,(r=this.owner.btn_jiashi.getChildByName("img_video")).visible=!1;break;default:ea.scene.ui.btn_jiashi.visible=!0,(r=this.owner.btn_jiashi.getChildByName("img_video")).visible=!0}return void(Ve.guide.isGuideBoolean(6)&&Ve.guide.refSetup())}}}this.curpanel=!1,this.curRide=null,this.owner.btn_jiashi.visible=!1,Ve.guide.isGuideBoolean(6)&&Ve.guide.refSetup()}}}destroy(){super.destroy(),Ve.game.changeridelock=!1}}class _t extends it{onEnable(){super.onEnable();this.tr=this.owner.transform}savedata(){var e=this.owner.transform;this.save3dData={x:e.localPosition.x,y:e.localPosition.y,z:e.localPosition.z,l:e.localScale.x,h:e.localScale.y,w:e.localScale.z}}refSaveData(){var e=this.owner.transform,t=this.save3dData;e&&t&&(e.localPositionX=t.x,e.localPositionY=t.y,e.localPositionZ=t.z,e.localScaleX=t.l,e.localScaleY=t.h,e.localScaleZ=t.w)}vibrate(e){var t=this,i=t.owner.transform;Laya.Tween.clearTween(i),t.savedata();var s=t.save3dData;Laya.Tween.to(i,{localPositionX:s.x+.1,localPositionY:s.y+.1,localPositionZ:s.z+.1},20,null,initHandler(t,()=>{Laya.Tween.clearTween(i),Laya.Tween.to(i,{localPositionX:s.x+.1,localPositionY:s.y-.1,localPositionZ:s.z-.1},20,null,initHandler(t,()=>{Laya.Tween.clearTween(i),Laya.Tween.to(i,{localPositionX:s.x-.1,localPositionY:s.y+.1,localPositionZ:s.z-.1},20,null,initHandler(t,()=>{Laya.Tween.clearTween(i),Laya.Tween.to(i,{localPositionX:s.x-.1,localPositionY:s.y-.1,localPositionZ:s.z+.1},20,null,initHandler(t,()=>{Laya.Tween.clearTween(i),t.refSaveData(),e&&e.run()}))}))}))}))}jump(e,t="Y",i){var s=this,a=i.split("_"),n=Number(a[0]),o=Number(a[1]),r=Number(a[2]),l=s.owner.transform;Laya.Tween.clearTween(l);s.owner.transform.localPositionX;var h=s.owner.transform.localPositionY,c=s.owner.transform.localPositionZ;l["localPosition"+t]="Y"==t?h+n:c+n;var d={};d["localPosition"+t]="Y"==t?h+o:c+o,Laya.Tween.to(l,d,80,null,initHandler(s,()=>{Laya.Tween.clearTween(l),Laya.Tween.clearTween(l),d["localPosition"+t]="Y"==t?h+r:c+r,Laya.Tween.to(l,d,180,null,initHandler(s,()=>{Laya.Tween.clearTween(l),e&&e.run()}))}))}scale(e,t="Y",i){var s=this,a=i.split("_"),n=s.owner.transform;Laya.Tween.clearTween(n),s.savedata();var o=s.save3dData,r=()=>{if(a.length>0){var t=Number(a.shift()),i={};i.localScaleX=o.l*t,i.localScaleY=o.h*t,i.localScaleZ=o.w*t,Laya.Tween.clearTween(n),Laya.Tween.to(n,i,120,null,initHandler(s,()=>{Laya.Tween.clearTween(n),r()}))}else e&&e.run()};r()}play(e,t="Y",i){var s=this,a=i.split("_"),n=s.owner.transform;Laya.Tween.clearTween(n),s.savedata();var o=s.save3dData,r=()=>{if(a.length>0){var t=Number(a.shift()),i={};i.localScaleX=o.l*t,i.localScaleY=o.h*t,i.localScaleZ=o.w*t,Laya.Tween.clearTween(n),Laya.Tween.to(n,i,120,null,initHandler(s,()=>{Laya.Tween.clearTween(n),r()}))}else e&&e.run()};r()}onceRo(e,t="Y",i,s){var a=this,n=i.split("_"),o=(Number(n[0]),a.owner.transform);Laya.Tween.clearTween(o);var r=()=>{s>0?(a.state="ro",a.dir=t,a.value=Number(i),Laya.Tween.clearTween(a.owner),Laya.Tween.to(a.owner,{},120,null,initHandler(a,()=>{Laya.Tween.clearTween(a.owner),r()}))):(a.state=null,a.dir=null,a.value=null,e&&e.run()),s--};r()}ro(e,t="Y",i){this.state="ro",this.dir=t,this.value=Number(i),this.handler=e}playNext(){this.state=null,this.dir=null,this.value=null,this.handler&&this.handler.run()}onUpdate(){if(null!=this.state&&"ro"==this.state&&this.tr.rotate(new Laya.Vector3("X"==this.dir?this.value:0,"Y"==this.dir?this.value:0,"Z"==this.dir?this.value:0),!1,!1),ea.scene.player&&ea.scene.player.owner&&ea.scene.player.owner.transform){var e=ea.scene.player.owner.transform.position.clone(),t=this.owner.transform.position.clone(),i=getDistance({x:t.x,y:t.z},{x:e.x,y:e.z});i>=20&&1==this.owner.active?this.owner.active=!1:i<20&&(this.owner.active=!0),this.owner.active}}onDestroy(){super.onDestroy()}}class vt{}vt.GetWinRewardPanel="GetWinRewardPanel",vt.DropEquipPanel="DropEquipPanel",vt.DropRewardPanel="DropRewardPanel",vt.BossTipsPanel="BossTipsPanel",vt.DropRolePanel="DropRolePanel",vt.TaskAcceptPanel="TaskAcceptPanel",vt.TaskAcceptLevelPanel="TaskAcceptLevelPanel",vt.TaskFinishPanel="TaskFinishPanel",vt.EndWinPanel="EndWinPanel",vt.EndUpPanel="EndUpPanel",vt.PANEL_NOBG=1,vt.PANEL_DEFAULT=2,vt.PANEL_ALPHA_BG=3,vt.PANEL_TOP_TIPS=4;class bt{static getClassByStr(e){switch(e){case"3d":return _t}return null}static getAction(e){var t={},i=e.split("_");return i.length>2?(t.cls=bt.getClassByStr(i[0]),t.action=i[1],t.value=i[2]):i.length>1&&(t.cls=bt.getClassByStr(i[0]),t.action=i[1]),t}static getTargetByPath(e,t){for(var i=t.split("/"),s=e,a=0;a<i.length;a++)s=s.getChildByName(i[a]);return s}}class wt{static playCom(e,t,i){var s,a=wt;"local"==t.effectActionTarget?s=e:"0"!=t.effectActionTarget&&(s=bt.getTargetByPath(e,t.effectActionTarget));var n=bt.getAction(t.effectAction);if(n){var o=s.getComponent(n.cls);o||(o=s.addComponent(n.cls)),o[n.action](initHandler(a,i),n.value,t.effectValue,t.effectCount)}}}class Tt{static play(e,t,i){if(e){var s=this,n=a.effect.getTbByEffectId(t);if(n)if(1==n.effectType){var o=(e,t,i)=>{var s=a.effectAction.getTbByEffectActionId(t);3==s.effectActionType&&wt.playCom(e,s,i)},r=(e,t)=>{if(e.state="exit","0"!=n.effectExit)for(var i=n.effectExit.split("|"),s=i.length,a=0,r=()=>{++a>=s&&t()},l=0;l<s;l++)o(e,Number(i[l]),r);else t()},l=(e,t)=>{if(e.state="wait",e.time=(new Date).valueOf(),"0"!=n.effectWait)for(var i=n.effectWait.split("|"),s=i.length,a=0,l=()=>{++a>=s&&r(e,t)},h=0;h<s;h++)o(e,Number(i[h]),l);else r(e,t)};Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum[`_prop_effect_${n.effectName}_lh`]],ea.scene.mainscene.getChildByName("map"),1,i.mat,initHandler(Tt.thisobj,t=>{e.localPosition?t.transform.localPosition=e.localPosition.clone():t.transform.localPosition=e.clone(),i&&i.handler&&i.handler.runWith([t]),((e,t)=>{if(e.state="enter","0"!=n.effectEnter)for(var i=n.effectEnter.split("|"),s=i.length,a=0,r=()=>{++a>=s&&l(e,t)},h=0;h<s;h++)o(e,Number(i[h]),r);else l(e,t)})(t,()=>{if(2==Math.floor(t.type/100)){var e=a.drop.getTbByDropId(t.dropId);be.openpanel(we.DropBuffPanel,{info:e}),t.removeSelf(),t.destroy(),t=null}else if(102==t.type)Je.create3d(t.value,ea.scene.player.owner.transform,t.transform,()=>{t.removeSelf(),t.destroy(),t=null});else if(104==t.type)ea.scene.player.info.attribute.addHp(t.value),t.removeSelf(),t.destroy(),t=null;else if(301==t.type)Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:t.shoptb}),t.removeSelf(),t.destroy(),t=null;else if(401==t.type)yt.getInstance().showVideo(null,null,()=>{ea.drop.dropequip.onRunHandler(t.shoptb,null)}),t.removeSelf(),t.destroy(),t=null;else if(402==t.type)yt.getInstance().showVideo(null,null,()=>{ea.drop.dropequip.onRunHandler(t.shoptb,null)}),t.removeSelf(),t.destroy(),t=null,ea.drop.dropMode=t;else if(501==t.type)Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:t.shoptb}),t.removeSelf(),t.destroy(),t=null;else if(601==t.type){var i=Xe.getBody(ea.scene.player.owner,"npc2"),n=Xe.getBody(ea.scene.player.owner,"80002");if(i){n?(n.active=!1,n.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80002_lh],ea.scene.player.owner,1,null,initHandler(Tt.thisobj,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)})),Ue.show("恭喜获得新装扮"),Tn.inst.sound.play(15043);var o=i.skinnedMeshRenderer.material;Laya.Texture2D.load(t.text,initHandler(s,e=>{o&&Laya.timer.once(300,Tt.thisobj,()=>{o.albedoTexture=e})}))}t.removeSelf(),t.destroy(),t=null}else if(602==t.type)Ve.game.showeffect(),Ue.show("恭喜获得新装扮"),Tn.inst.sound.play(15043),Ve.shop.useEquip(t.shoptb.shopId,t.shoptb.addValue),ea.weapon.equipWeapon(Ve.shop.equip_weapon),t.removeSelf(),t.destroy(),t=null;else if(701==t.type||705==t.type){(r=Xe.getBody(ea.scene.player.owner,"30023"))&&(r.active=!0),(l=Xe.getBody(ea.scene.player.owner,"30022"))&&(l.active=!1),Ve.game.isjiansu=!1,Ve.game.isjiasu=!0,Ue.show("移速提高"),Tn.inst.sound.play(15045),Ve.game.issmall||Ve.game.isbig||ea.scene.ui.DaojuJinDu(3),Laya.timer.once(3e3,Tt.thisobj,()=>{Ve.game.isjiasu=!1;var e=Xe.getBody(ea.scene.player.owner,"30023");e&&(e.active=!1)}),t.removeSelf(),t.destroy(),t=null}else if(702==t.type||704==t.type){Ve.game.showeffect(),Ve.game.isjiansu=!0,Ve.game.isjiasu=!1,Ue.show("移速降低"),702==t.type&&Tn.inst.sound.play(15046),704==t.type&&Tn.inst.sound.play(15047);var r,l=Xe.getBody(ea.scene.player.owner,"30022");(r=Xe.getBody(ea.scene.player.owner,"30023"))&&(r.active=!1),l&&(l.active=!0),Ve.game.issmall||Ve.game.isbig||ea.scene.ui.DaojuJinDu(2),Laya.timer.once(2e3,Tt.thisobj,()=>{var e=Xe.getBody(ea.scene.player.owner,"30022");Ve.game.isjiansu=!1,e&&(e.active=!1)}),t.removeSelf(),t.destroy(),t=null}else if(703==t.type){if(mi.device.currentMountGear)return;ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),ea.scene.player.owner.transform.localScale=new Laya.Vector3(.3,.3,.3),Ve.game.isbig=!1,Ve.game.issmall=!0,Ue.show("体型变小"),Tn.inst.sound.play(15044),0==Ve.game.MaoMaoGameType&&ea.scene.cameraCode.initOnePlay2(),Laya.timer.clear(Tt.thisobj,Tt.smallhan),Laya.timer.clear(Tt.thisobj,Tt.bighan),ea.scene.ui.DaojuJinDu(10,initHandler(Tt,()=>{Tt.smallhan()})),Ve.game.LiuchengCube&&Ve.game.LiuchengCube.active&&(Ve.game.LiuchengCube.active=!1,Ve.game.LiuchengCube.removeSelf(),Ve.game.LiuchengCube.destroy()),t.removeSelf(),t.destroy(),t=null}else if(706==t.type){if(mi.device.currentMountGear)return;ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),ea.scene.player.owner.transform.localScale=new Laya.Vector3(2,2,2),Ve.game.issmall=!1,Ve.game.isbig=!0,Ue.show("体型变大"),Tn.inst.sound.play(15044),0==Ve.game.MaoMaoGameType&&ea.scene.cameraCode.initOnePlay2(),ea.scene.ui.DaojuJinDu(10,initHandler(Tt,()=>{Tt.bighan()})),Laya.timer.clear(Tt.thisobj,Tt.smallhan),Laya.timer.clear(Tt.thisobj,Tt.bighan),t.removeSelf(),t.destroy(),t=null}})}))}else if(2==n.effectType)Tn.inst.load3d.runOneTimeParticle(Ce.res_enum[`_prop_effect_${n.effectName}_lh`],e,i&&i.handler,i&&i.parent,i);else if(0==n.effectType){var h=ce.d3res+Ce.res_dic[Ce.res_enum[`_prop_effect_${n.effectName}_lh`]];Tn.inst.load3d.particleRes(h,initHandler(s,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),i&&i.size&&(e.transform.localScale=new Laya.Vector3(i.size,i.size,i.size)),i&&i.parent&&i.parent.addChild(e),i&&i.handler&&i.handler.runWith([e])}))}else if(3==n.effectType){var c=a.effectAction.getTbByEffectActionId(Number(n.effectPlay));Tn.inst.loadDb.res(c.effectActionTarget,initHandler(s,t=>{if(i&&i.parent){if(!i.parent.stage)return void t.destroy();i.parent.addChild(t)}t.play(c.effectAction,0==c.effectCount),t.x=e.x,t.y=e.y,i&&i.handler&&i.handler.runWith([t])}))}}}static bighan(){ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),Ve.role.selectRole(Ve.role.equip_role),Ve.game.isbig=!1,ea.scene.cameraCode.initOnePlay2(),ea.scene.player.moveTrigger.ClearTrigger(),ea.scene.player.ClearTrigger()}static smallhan(){ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),Ve.role.selectRole(Ve.role.equip_role),Ve.game.issmall=!1,ea.scene.cameraCode.initOnePlay2(),ea.scene.player.moveTrigger.ClearTrigger(),ea.scene.player.ClearTrigger()}}Tt.thisobj={};class At{}At.REF_ROLE_HP="REF_ROLE_HP",At.ANI_ROLE_HIT="ANI_ROLE_HIT",At.ANI_MONSTER_HIT="ANI_MONSTER_HIT",At.ANI_COMMON_EFFECT="ANI_COMMON_EFFECT",At.ANI_EFFECT="ANI_EFFECT",At.UI_MAINUI="UI_MAINUI",At.D3_GLOBAL_ANI="D3_GLOBAL_ANI",At.CONNECT_NAME="connect";class xt{static connect(e,t){switch(e){case At.ANI_ROLE_HIT:if(t&&t.length>0)i=(h=ta.setList(t))(),s=h(),a=h(),n=h();Tt.play(i.mode.transform,10017,{size:s,time:a,h:n});break;case At.ANI_MONSTER_HIT:if(t&&t.length>0)i=(h=ta.setList(t))(),s=h(),a=h(),n=h();Tt.play(i.transform,10017,{size:s,time:a,h:n});break;case At.ANI_COMMON_EFFECT:var i,s,a,n;if(t&&t.length>0)i=(h=ta.setList(t))(),r=h(),s=h(),a=h(),n=h();Tt.play(i.transform,r,{size:s,time:a,h:n});break;case At.ANI_EFFECT:var o,r,l,h;if(t&&t.length>0)o=(h=ta.setList(t))(),r=h(),l=h();Tt.play(o,r,l)}}}class kt{}kt.REF_ROLE_HP="REF_ROLE_HP",kt.ANI_ROLE_HIT="ANI_ROLE_HIT",kt.ANI_MONSTER_HIT="ANI_MONSTER_HIT",kt.ANI_COMMON_EFFECT="ANI_COMMON_EFFECT",kt.ANI_EFFECT="ANI_EFFECT",kt.UI_MAINUI="UI_MAINUI",kt.D3_GLOBAL_ANI="D3_GLOBAL_ANI",kt.CONNECT_NAME="connect";class Et{static openpanel(e,t=2,i,s){if(!we[e])return serror("没有镜像界面:",e),void Ue.show("没有找到要搬运的内容");switch(t){case vt.PANEL_NOBG:if(s&&s.length>0)r=(l=ta.setList(s))();be.opennobgpanel(we[e],i,r);break;case vt.PANEL_DEFAULT:if(s&&s.length>0)n=(l=ta.setList(s))(),o=l(),r=l();be.openpanel(we[e],i,n,o,r);break;case vt.PANEL_ALPHA_BG:var a;if(s&&s.length>0)a=(l=ta.setList(s))(),n=l(),o=l(),r=l();be.openalphapanel(we[e],a,i,n,o,r);break;case vt.PANEL_TOP_TIPS:var n,o,r,l;if(s&&s.length>0)n=(l=ta.setList(s))(),o=l(),r=l();be.openTopTipPanel(we[e],i,n,o,r)}}static connect(e,t,i){switch(e){case kt.UI_MAINUI:if(!ea.scene.ui[kt.CONNECT_NAME])return void serror("连接失败，没有连接UI:",e);ea.scene.ui[kt.CONNECT_NAME](t,i);break;case kt.D3_GLOBAL_ANI:if(!xt[kt.CONNECT_NAME])return void serror("连接失败，没有连接:",e);xt[kt.CONNECT_NAME](t,i);break;default:serror("连接失败，没有连接:",e)}}}class It extends he{constructor(){super(),this.droplist=[10015];this.list=[]}addDrop(e){for(var t=this,i=0,s=a.drop.tb(),n=[],o=0,r=0;r<s.length;r++)o+=s[r].probability,n[r]=o;i=Math.round(Math.random()*o);var l=n.length;for(r=0;r<n.length;r++)i<=n[r]&&(l=Math.min(l,r));var h,c=s[l],d=c.dropId,u=null,p=c.value.split("~"),m=Number(p[1])-Number(p[0]),g=(i=Number(m),Number(c.effectId));102==c.type?(i=Math.round(Math.random()*m+Number(p[0])))>500&&(g=10022):301==c.type||401==c.type?u={texture:"res/icon/shopmode/"+(h=a.shop.getTbByShopId(Number(c.value))).shopMode+".png"}:402==c.type&&(h=a.shop.getTbByShopId(Number(c.value))),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[e.transform,g,{mat:u,handler:initHandler(t,e=>{e.dropId=d,e.type=c.type,e.value=i,301!=c.type&&401!=c.type&&402!=c.type||(e.shoptb=h),t.list[t.list.length]=e})}])}addGold(e){var t=this,i=a.drop.getTbByCondition(e=>102==e.type)[0],s=i.dropId,n=i.value.split("~"),o=Number(n[1])-Number(n[0]),r=Math.round(Math.random()*o+Number(n[0])),l=Number(i.effectId);102==i.type&&(r=Math.round(Math.random()*o+Number(n[0])));var h=new Laya.Vector3(e[0],e[1],e[2]);Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[h,l,{mat:null,handler:initHandler(t,e=>{e.dropId=s,e.type=i.type,e.value=r,t.list[t.list.length]=e})}])}addRomDrop(e){for(var t=this,i=0,s=a.drop.getTbByProbability(0),n=[],o=0,r=0;r<s.length;r++)o+=s[r].probability,n[r]=o;i=Math.round(Math.random()*o);var l=n.length;for(r=0;r<n.length;r++)i<=n[r]&&(l=Math.min(l,r));var h=s[l],c=h.dropId;console.log("随机数："+i),console.log("掉落物件id："+c);var d,u=null,p=h.value.split("~"),m=Number(p[1])-Number(p[0]),g=(i=Number(m),Number(h.effectId));102==h.type?(i=Math.round(Math.random()*m+Number(p[0])))>500&&(g=10022):301!=h.type&&401!=h.type||(u={texture:"res/icon/shopmode/"+(d=a.shop.getTbByShopId(Number(h.value))).shopMode+".png"});var y=new Laya.Vector3(e[0],e[1],e[2]);Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[y,g,{mat:u,handler:initHandler(t,e=>{e.dropId=c,e.type=h.type,e.value=i,301!=h.type&&401!=h.type||(e.shoptb=d),t.list[t.list.length]=e})}])}addLockDrop(e,t){var i,s=this,n=a.drop.getTbByDropId(e),o=n.dropId,r=null,l=n.value.split("~"),h=Number(l[1])-Number(l[0]),c=Number(h),d=Number(n.effectId);102==n.type?(c=Math.round(Math.random()*h+Number(l[0])))>500&&(d=10022):301==n.type||401==n.type||501==n.type||602==n.type?r={texture:"res/icon/shopmode/"+(i=a.shop.getTbByShopId(Number(n.value))).shopMode+".png"}:601==n.type?r={texture:"res/icon/equip/"+n.resId+".png"}:402==n.type&&(i=a.shop.getTbByShopId(Number(n.value)));var u=new Laya.Vector3(t[0],t[1],t[2]);Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[u,d,{mat:r,handler:initHandler(s,e=>{e.dropId=o,e.type=n.type,e.value=c,301!=n.type&&401!=n.type&&501!=n.type&&602!=n.type&&402!=n.type||(e.shoptb=i),601==n.type&&(e.text="res/icon/skin/"+n.resId+".jpg"),s.list[s.list.length]=e})}])}addDropWeapon(e,t){var i,s=this,n=a.drop.getTbByDropId(e),o=n.dropId,r=n.value.split("~"),l=Number(r[1])-Number(r[0]),h=Number(l),c=Number(n.effectId);301!=n.type&&401!=n.type&&501!=n.type||(i=a.shop.getTbByShopId(Number(n.value))),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[t,c,{mat:null,handler:initHandler(s,e=>{e.dropId=o,e.type=n.type,e.value=h,301!=n.type&&401!=n.type&&501!=n.type||(e.shoptb=i),s.list[s.list.length]=e})}])}addBuff(e){for(var t=this,i=a.drop.tb(),s=[],n=0,o=[],r=0;r<i.length;r++)1==Math.floor(i[r].type/400)&&i[r].probability>0&&o.push(i[r]);for(r=0;r<o.length;r++)n+=o[r].probability,s[r]=n;var l=Math.round(Math.random()*n),h=s.length;for(r=0;r<s.length;r++)l<=s[r]&&(h=Math.min(h,r));var c,d=o[h],u=d.dropId,p=null;401==d.type&&(p={texture:"res/icon/shopmode/"+(c=a.shop.getTbByShopId(d.value)).shopMode+".png"}),402==d.type&&(c=a.shop.getTbByShopId(d.value));var m=new Laya.Vector3(e[0],e[1],e[2]);Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[m,d.effectId,{mat:p,handler:initHandler(t,e=>{e.dropId=u,e.type=d.type,301!=d.type&&401!=d.type&&402!=d.type||(e.shoptb=c),t.list[t.list.length]=e})}])}hitDrop(e,t){if(!e)return[];new Laya.Point(e.transform.position.x,e.transform.position.z);var i=[];if(ea.scene.isGameEnd)return i;for(var s=0;s<this.list.length;s++){let a=this.list[s];null==a||null==a.state||null==a.time||(new Date).valueOf()-a.time<500||!a.scene||Xe.is3DBallHit(e.transform.position,a.transform.position,10006==a.dropId&&t?10:.5,.5)&&(i[i.length]=a,this.list.splice(s,1),s--)}return i}removeDrop(e){var t=this.list.indexOf(e);this.list.splice(t,1)[0].getComponent(_t).playNext()}destroy(){}}class Ct extends he{constructor(e){super();this.owner=e,this.totalprogress=0,this.monitor(se.GAME_CD_TIMER_END,this.onCheckGameState),this.monitor(se.MAP_MPT_LOADED,this.onMapMptLoaded),this.monitor(se.GAME_PLAYER_DIE,this.onPlayerDie),this.initUI()}onPlayerDie(){var e=this;be.openalphapanel(we.EndLostPanel,.6,{handler:initHandler(e,t=>{switch(t){case 1:cafe.event.dispatch(se.RESTARTHAILANG);var i=ea.scene.player;ea.scene.player.info.attribute.revive(),ea.scene.GamePause=!1,Ve.game.roleRoadPoi=[],Ve.game.fuhuoTime=(new Date).getTime(),ea.scene.ui.CancelDevide(),Ve.game.RisePoi?(i.owner.transform.position=Ve.game.RisePoi,i.owner.transform.rotationEuler=Ve.game.RiseRot):ta.toTrBy9G(i.owner,i.owner.initPoint),Ve.game.RiseTime--,Ve.role.selectRole(Ve.role.equip_role),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),cafe.event.dispatch(se.CANCELSKILL),ea.scene.GamePause=!1;break;case 0:mi.device.currentMountGear?mi.device.unDevice(initHandler(e,()=>{We.openscene(we.HallScene).start()})):We.openscene(we.HallScene).start(),ea.scene.GamePause=!1}})})}overTask(){var e=mi.task.list.shift();this.finishTask(e)}initUI(){}finishTask(e){}onTaskCountRef(e){}onMapMptLoaded(){}onCheckGameState(e=0){}set totalprogress(e){this._totalprogress=e}get totalprogress(){return this._totalprogress}destroy(){super.destroy()}}class Lt{static reportEnter(e){if(null==Lt.index){var t=i.read("SDKEnterGameType");Lt.index=null!=t?Number(t):0}if(!(Lt.index>=e)){switch(e){case 0:Lt.report({params:{type:"enterGameGroup",data:{group:"0_初始化加载"}}});break;case 1:Lt.report({params:{type:"enterGameGroup",data:{group:"1_加载中"}}});break;case 2:Lt.report({params:{type:"enterGameGroup",data:{group:"2_进入首页"}}});break;case 3:Lt.report({params:{type:"enterGameGroup",data:{group:"3_点击开始游戏"}}});break;case 4:Lt.report({params:{type:"enterGameGroup",data:{group:"4_加载游戏中"}}});break;case 5:Lt.report({params:{type:"enterGameGroup",data:{group:"5_进入游戏"}}});break;case 6:Lt.report({params:{type:"enterGameGroup",data:{group:"6_新手引导开始"}}});break;case 7:Lt.report({params:{type:"enterGameGroup",data:{group:"7_新手引导结束"}}})}Lt.index=e,i.save("SDKEnterGameType",e.toString())}}static reportSignIn(e){switch(e){case 1:Lt.report({params:{type:"signInGroup",data:{group:"签到弹出"}}});break;case 2:Lt.report({params:{type:"signInGroup",data:{group:"双倍签到"}}});break;case 3:Lt.report({params:{type:"signInGroup",data:{group:"普通签到"}}});break;case 4:Lt.report({params:{type:"signInGroup",data:{group:"签到弹窗关闭"}}});break;case 5:Lt.report({params:{type:"signInGroup",data:{group:"签到播放视频中途关闭"}}});break;case 6:Lt.report({params:{type:"signInGroup",data:{group:"签到视频看完"}}})}}static reportLevelRefresh(e){Lt.report({params:{type:"levelLoadRefresh",data:{level:e}}})}static reportTask(e,t){Lt.report({params:{type:"task",data:{taskId:e,state:1==t?"任务完成":"任务接取"}}})}static logStageLoad(e){switch(e){case 1:Lt.report({params:{type:"levelLoadGroup",data:{group:"进入关卡"}}});break;case 2:Lt.reportMissionTask("进入关卡"),Lt.report({params:{type:"levelLoadGroup",data:{group:"正式进入关卡"}}});break;case 3:Lt.reportMissionTask("任务弹窗"),Lt.report({params:{type:"levelLoadGroup",data:{group:"关卡任务弹出"}}});break;case 4:Lt.reportMissionTask("任务开始"),Lt.report({params:{type:"levelLoadGroup",data:{group:"点击开始任务"}}})}}static reportActionPanel(e){switch(e){case 1:return Lt.report({params:{type:"noActionOpenPanel",data:{group:"弹出"}}}),!1;case 2:return Lt.report({params:{type:"noActionOpenPanel",data:{group:"看视频"}}}),!1;case 3:return Lt.report({params:{type:"noActionOpenPanel",data:{group:"自主关闭弹窗"}}}),!1;case 4:return Lt.report({params:{type:"noActionOpenPanel",data:{group:"看视频中途关闭"}}}),!1;case 5:return Lt.report({params:{type:"noActionOpenPanel",data:{group:"看完视频"}}}),!1}return!0}static isShare(e){switch(e){case 1:var t=0;return Ve.level&&Ve.level.max_mission_id&&(t=Ve.level.max_mission_id%1e4),Lt.report({params:{type:"recordShareLevel",data:{level:t}}}),Lt.report({params:{type:"recordShareGroup",data:{group:"进入"}}}),!1;case 2:return Lt.report({params:{type:"recordShareGroup",data:{group:"分享成功"}}}),!1;case 3:return Lt.report({params:{type:"recordShareGroup",data:{group:"分享失败"}}}),!1}return!0}static report(e){}static reportMissionTask(e){}static reportMission(e){}static getRecordState(e){}static startRecord(){}static stopRecord(){}static share(e){}static vibrateShort(e=1){}}Lt.isMainShare=!1;class Mt extends Ct{constructor(e){super(e)}onFireMissionLevel(){}initUI(){}openWin(){Ve.level.getLevelByLevelId(Ve.game.mission_id)}finishTask(e){ea.scene.isGameEnd=!0,Lt.reportMissionTask("完成任务"),Lt.report({params:{type:"gameTaskFinish",data:{taskId:e.data.taskId}}}),cafe.event.dispatch(se.GAME_TASK_REF)}onTaskCountRef(e){}onMapMptLoaded(){Ve.task.getTaskList()}onCheckGameState(e=0){if(1==e)this._totalprogress>=100&&(cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0),Tn.inst.sound.play(Ie.id.任务完成),cafe.event.dispatch(se.GAME_TASK_END_REF),ea.scene.ui.gameEndFlash(),this.openWin());else{if(ea.scene.isGameEnd)return;cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0);var t=we.EndLostPanel;t=we.EndLostPanel,be.openpanel(t,{handler:initHandler(this,()=>{}),time:4e3})}}destroy(){super.destroy()}}class St extends Ct{initUI(){}onTaskRef(){}onTaskCountRef(e){}onMapMptLoaded(){this.owner.group_taskContent.height=33}finishTask(e){var t=e;ea.scene.isGameEnd=!0,Lt.reportMissionTask("完成任务"),Lt.report({params:{type:"gameTaskFinish",data:{taskId:e.data.taskId}}}),t.overFlash(initHandler(this,()=>{cafe.event.dispatch(se.GAME_TASK_REF)}))}openWin(){}onCheckGameState(e=0){var t=this;if(1==e)t._totalprogress>=100&&(cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0),Tn.inst.sound.play(Ie.id.任务完成),cafe.event.dispatch(se.GAME_TASK_END_REF),ea.scene.ui.gameEndFlash());else{if(ea.scene.isGameEnd)return;cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0);var i=we.EndTimeOutPanel;be.openpanel(i,{handler:initHandler(t,()=>{t.openWin()}),time:4e3})}}destroy(){super.destroy()}}class Pt extends Ct{initUI(){}onTaskRef(){}onMapMptLoaded(){mi.task.onMapMptLoaded(),ea.scene.ui.gameStartFlash(),Lt.reportEnter(5),ea.scene.ui.box_fight.visible=2==Ve.map.map.type}finishTask(e){var t=e;ea.scene.isGameEnd=!0,Lt.reportMissionTask("完成任务"),Lt.report({params:{type:"gameTaskFinish",data:{taskId:e.data.taskId}}}),t.overFlash(initHandler(this,()=>{cafe.event.dispatch(se.GAME_TASK_REF)}))}openWin(){}onCheckGameState(e=0){var t=this;if(1==e)t._totalprogress>=100&&(cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0),Tn.inst.sound.play(Ie.id.任务完成),cafe.event.dispatch(se.GAME_TASK_END_REF),ea.scene.ui.gameEndFlash(),t.openWin());else{if(ea.scene.isGameEnd)return;cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0);var i=we.EndTimeOutPanel;be.openpanel(i,{handler:initHandler(t,()=>{t.openWin()}),time:4e3})}}destroy(){super.destroy()}}class Rt{static init(){Rt.viewurls={}}static openview(e,t,i){var s=Rt;s.isWorking||(s.isWorking=!0,Laya.View.load(e,initHandler(s,a=>{s.isWorking=!1,a.name=e,a._param=t,_e.getLayer(2).addChild(a),s.viewurls[e]=a,i&&i(a)})))}static loadview(e,t,i,s){var a=Rt;if(!a.isWorking){if(a.isWorking=!0,a.viewurls[t]){e.removeChildren();var n=a.viewurls[t];return n._param=i,e.addChild(n),a.isWorking=!1,e.name=t,void(a.isWorking=!1)}Rt.showloadding(e,initHandler(a,n=>{cafe.event.dispatch("res_load",{urls:ve.getRes(t),handler:initHandler(a,o=>{if(!o)return cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"界面不见了！！！"]),void n.hide.run();Laya.View.load(t,initHandler(a,o=>{a.isWorking=!1,e.removeChildren(),o.name=t,o._param=i,n.hide.run(),e.addChild(o),a.viewurls[t]=o,s&&s(o)}),n.pross)})})}))}}static isView(e){return null!=Rt.viewurls[e]}static showloadding(e,t){}static closeview(e){var t=Rt;if(t.viewurls[e]){Laya.View.close(e,e);var i=t.viewurls[e];i.removeSelf(),i.destroy(),delete t.viewurls[e]}}}Rt.isWorking=!1;class Dt extends Ee.res.modules.guide.GuidePanelUI{constructor(){super(),this.maxguide=5,this.addCom(this,fe)}static showGuide(e){var t=Dt;if(Ve.guide.setGuide(e.setup),Dt.isWorking)Dt.panel&&Dt.panel.init(e);else{var i=we.GuidePanel;if(Dt.box=new Laya.Box,Dt.box.mouseThrough=!0,serror("打开最顶界面: "+i),Dt.isWorking=!0,_e.getLayer(6).addChild(Dt.box),Dt.panel){var s=Dt.panel;return s.init(e),Dt.box.addChild(s),s.show&&s.show(),void(s.name=i)}Laya.Dialog.load(i,initHandler(t,t=>{Dt.box&&(Dt.panel=t,t.init(e),Dt.box.addChild(t),t.name=i)}))}}static hideGuide(){var e=Dt;e.isWorking&&(e.panel&&e.panel.removeSelf(),e.box&&e.box.removeSelf(),e.panel=null,e.box=null,e.isWorking=!1),Ve.guide.currSetup=null}onEnable(){super.onEnable();this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onClickHandler,this.btn_next)}init(e){if(e.target&&(this.target=e.target,this.targetparent=e.target.parent,this.targetparams={x:this.target.x,y:this.target.y,scale:this.target.scaleX}),e.handler&&(this.handler=e.handler),e.setup){this.setGuide(e.setup);var t=a.guide.getTbByGuideId(e.setup);switch(t.type){case 3:var i,s=this["box_guide"+t.type];i=fe.SCREEN==fe.LONG_PIXE?fe.maxScale:fe.minScale,s.scale(i,i,!0),this.box_guide.scale(i,i,!0),this.btn_next.width=fe.width,this.btn_next.height=fe.height,this.btn_next.anchorX=.5,this.btn_next.anchorY=.5,this.btn_next.x=fe.width/2,this.btn_next.y=fe.height/2,this.box_guide.x=fe.width/2,this.box_guide.y=fe.height/2;var n=s.getChildByName("img"),o=s.getChildByName("img").getChildByName("txt");o.text=t.txt,n.width=o.width+60;break;default:this.setBtn(e.setup)}}}setBtn(e){var t,i=a.guide.getTbByGuideId(e),s=this["box_guide"+i.type],n=this.target.localToGlobal(new Laya.Point(0,0));t=fe.SCREEN==fe.LONG_PIXE?fe.maxScale:fe.minScale,s.scale(t,t,!0),this.box_guide.scale(t,t,!0),s.pos(n.x+this.target.width*t/2,n.y+this.target.height*t/2),this.target.filters=[new Laya.GlowFilter("#eeee44",8,0,0)],this.btn_next.width=this.target.width*t*1.2,this.btn_next.height=this.target.height*t*1.2,this.btn_next.anchorX=.5,this.btn_next.anchorY=.5,this.btn_next.x=n.x+this.btn_next.width/2,this.btn_next.y=n.y+this.btn_next.height/2,this.box_guide.x=n.x+this.btn_next.width/2,this.box_guide.y=n.y+this.btn_next.height/2;var o=s.getChildByName("img"),r=s.getChildByName("img").getChildByName("txt");r.text=i.txt,o.width=r.width+60}setGuide(e){for(var t=1;t<=this.maxguide;t++){var i=a.guide.getTbByGuideId(e);this["box_guide"+t].visible=t==i.type}}onClickHandler(e){if(this.target){var t=this.handler;this.target.filters=null}Ve.guide.finishSetup(!1),Dt.hideGuide(),Ve.guide.invalidate(),t&&t.run()}onDisable(){this._param=null,super.onDisable()}}class Nt extends he{constructor(){super(),this.isplotwork=!1,this.istalkwork=!1;this.list=[]}showPlot(e,t){var i=a.plot.getTbByPlotGroup(e);i.length<=0?t&&t.run():this.isplotwork?this.list[this.list.length]={handler:t,tb:i}:0!=e?(serror("显示剧情：",e),ea.scene.GamePause=!0,ea.scene.isOpenTask=!0,Dt.hideGuide(),this.isplotwork=!0,this.plotGrouplist=i,this.handler=t,this.nextPlot()):t&&t.run()}showTalk(){var e=this,t=e.talklist.shift();Rt.openview(we.TalkView,{info:t,handler:initHandler(e,()=>{e.talklist.length>0?e.showTalk():e.plotGrouplist.length>0?e.nextPlot():(e.isplotwork=!1,e.handler&&e.handler.run(),e.list.length>0&&(e.nextPlotGroup(),Ve.guide.refSetup()))})})}nextPlot(){this.talklist=this.plotGrouplist,this.showTalk()}nextPlotGroup(){var e=this.list.shift();this.handler=e.handler,this.plotGrouplist=e.tb,this.nextPlot()}destroy(){super.destroy()}}class jt{}jt.ACCEPT_TASK=1,jt.ARRIVE_DESTINATION=2,jt.SWITCH_MAP=3,jt.KILL_MONSTER=4,jt.GO_HOME=5,jt.UPGRADE_HOME=6,jt.TAKE_TRANSPORTATION=7,jt.HAVE_A_BATH=8,jt.ACCEPT_ENTRUST=9,jt.ARRIVE_DESTINATION2=10,jt.HAVE_MONEY=11,jt.NOPANEL_ACCEPT_TASK=12,jt.UNLOCK_NEW_ROLE=13,jt.USE_SKILL=14,jt.LOOK_VIDEO=15,jt.GET_CAR=16,jt.UP_FURNITURE=17,jt.ROLE_DIE=18,jt.NOPANEL_ARRIVE=19,jt.UNLOCK_NEW_EQUIP=20,jt.FINDSOMETHING=21,jt.GET_BALLNUM=22,jt.UNLOCK_NEW_NPC=23,jt.ACCEPTLEVEL_TASK=24,jt.KILL_MONSTER_NOPANEL=25,jt.KILL_MONSTER_SHOWBOSS=26,jt.KILL_BOSS=27,jt.Destroy_Device=28,jt.Destroy_Build=29,jt.Ride_Funning_Num=30;class Gt{constructor(){this.data=[]}add(e,t){let i=this;e.idx=i.data.length,i.data.push(e);var s=Math.floor(i.data.length/2-1),a=i.data.length-1;for(s<=0&&(s=0);e[t]<i.data[s][t];){var n=i.data[s];i.data[s]=e,e.idx=s,i.data[a]=n,n.idx=a,a=s,s=Math.floor(a/2)}}shift(e){let t=this;var i=t.data.length;if(0==i)return null;if(1==i)return t.data.pop();var s=t.data[0];t.data[0]=t.data.pop(),t.data[0].idx=0;var a,n=0,o=2*(n+1)-1,r=2*(n+1);for(a=t.data[o]&&t.data[r]?t.data[o][e]>t.data[r][e]?r:o:t.data[o]||t.data[r]?t.data[o]?o:r:-1;a>=0&&t.data[n][e]>t.data[a][e];){var l=t.data[n];t.data[n]=t.data[a],t.data[a].idx=n,t.data[a]=l,l.idx=a,o=2*((n=a)+1)-1,r=2*(n+1),a=t.data[o]&&t.data[r]?t.data[o][e]>t.data[r][e]?r:o:t.data[o]||t.data[r]?t.data[o]?o:r:-1}return s}resort(e,t){let i=this;var s=Math.floor((e.idx+1)/2-1),a=e.idx;for(s<=0&&(s=0);i.data[a][t]<i.data[s][t];){var n=i.data[s];i.data[s]=e,e.idx=s,i.data[a]=n,n.idx=a,a=s,s=Math.floor(a/2),1}}gcTree(){this.data.length=0}}class Bt{constructor(){this.offSet=[{x:0,y:-1,able:!0},{x:1,y:0,able:!0},{x:0,y:1,able:!0},{x:-1,y:0,able:!0},{x:-1,y:-1,able:!0},{x:1,y:-1,able:!0},{x:1,y:1,able:!0},{x:-1,y:1,able:!0}];this.openList=new Gt,this.ptList=[],this.objPool=[]}setGridData(e,t,i){this._mapData=e,this._width=t,this._height=i}get mapData(){return this._mapData}findpath(e,t,i,s,a=!1){let n=this;if(e==i&&t==s)return[];n._isIncludeStartPoint=a,e=Math.floor(e),t=Math.floor(t),i=Math.floor(i),s=Math.floor(s),e+=1,t+=1,i+=1,s+=1,n.ptList=[];var o,r,l,h,c=e,d=t,u=0,p=0,m=new Ht(-1,-1,e,t,0,0,0);n._width,n._height;for(null==n.ptList[c]&&(n.ptList[c]=[]),n.ptList[c][d]=m;;){for(c=m.curX,d=m.curY,m.idx=-1,1,h=0;h<8;h++){if(u=c+n.offSet[h].x,p=d+n.offSet[h].y,null==n._mapData[u]||null==n._mapData[u][p])return[];var g=n._mapData[u][p];if(g!=J.UNWALKABLE&&g!=J.TASK_AX_UNWALKABLE&&g!=J.TASK_RANGE_UNWALKABL&&g!=J.PY_UNWALKABLE)if(o=m.g+(h<4?10:14),null==n.ptList[u]&&(n.ptList[u]=[]),n.ptList[u][p])(l=n.ptList[u][p]).idx>=0&&o<l.g&&(l.g=o,l.f=o+l.h,l.preX=c,l.preY=d,n.openList.resort(l,"f"));else if(r=10*(Math.abs(i-u)+Math.abs(s-p)),l=new Ht(c,d,u,p,o,r,o+r),n.ptList[u][p]=l,n.openList.add(l,"f"),u==i&&p==s)return n.findAPath(l)}if(0==n.openList.data.length)return[];m=n.openList.shift("f")}return n.openList.gcTree(),[]}findAPath(e){let t=this;t.openList.gcTree();var i=[];do{i.unshift(new Laya.Point(e.curX-1,e.curY-1)),e=t.ptList[e.preX][e.preY]}while(-1!=e.preX);return t._isIncludeStartPoint&&i.unshift(new Laya.Point(e.curX-1,e.curY-1)),i}}class Ht{constructor(e,t,i,s,a,n,o){this.idx=-1,this.preX=e,this.preY=t,this.curX=i,this.curY=s,this.g=a,this.h=n,this.f=o}}class Ot{constructor(e){this.owner=e,this.owner.mptModel[J.THING]=this}push(e){this.thingFlags||(this.thingFlags=[]),this.thingFlags.push(e)}getThings(e){var t=[];if(!this.thingFlags)return null;for(var i=0;i<this.thingFlags.length;i++){var s=this.thingFlags[i].mode;s.dthing.type==e&&t.push(s)}return t}loadThing(e,t,i){var s=this,n=(e.res,e.thingDatas),o=function(e){var i=e.m;if(i){var o=n[i.res],r=Tn.inst.load3d.mapThingRes(ce.getPropUrl,1,o,i.data,ea.scene.mainscene.getChildByName("map"));r.setInitPoint(i.tr),e.mode&&(e.mode.removeSelf(),e.mode.destroy(),e.mode=null),e.mode=r;var l=a.thing.getTbByConfigId(Number(o.thingId));s.push({mode:r,tb:l}),t.push({mode:r,tb:l})}};for(var r in e.maps){var l=e.maps[r],h=n[l.res],c=a.thing.getTbByConfigId(Number(h.thingId)),d=(Qe.get3Distance(s.owner.initPoint,l.tr),le.type_thing);s.owner.renderFuncs.push({type:d,tbId:c.thingId,distance:c.renderDistance,func:o,m:l,isCache:!1,mode:null})}i&&i.runWith([s])}checkThing(e,t){if(this.thingFlags){for(var i=e.transform.position,s=0;s<this.thingFlags.length;s++){var a=this.thingFlags[s];if(a.mode!=e.parent&&a.mode.transform){var n=a.mode.transform.position,o=a.tb.thingTriggerDistance;if(o>0&&AREA({x:i.x,y:i.z},t,{x:n.x,y:n.z},o))return a.mode}}return null}}getThingsByType(e){return[]}clearThing(e){if(this.thingFlags){for(var t=0;t<this.thingFlags.length;t++){if(this.thingFlags[t].mode==e.parent)return this.thingFlags.splice(t,1),!0}return!1}}refthing(e){e.position.clone();if(this.thingFlags){for(var t=0;t<this.thingFlags.length;t++){var i=this.thingFlags[t];if(e&&i.mode.transform){var s,a=i.mode;(o=Qe.getDistance(e,a.transform))>a.tb.renderDistance+10?s=le.distancetype_noloading:o<=a.tb.renderDistance+10&&o>a.tb.renderDistance?s=le.distancetype_preloading:o<=a.tb.renderDistance&&o>a.tb.renderDistance-10?s=le.distancetype_replacemodel:o<=a.tb.renderDistance-10&&(s=le.distancetype_showmodel),a.onRefThing(s)}}for(t=0;mi.drop&&t<mi.drop.list.length;t++){var n=mi.drop.list[t];if(e&&n.transform){var o=Qe.getDistance(e,n.transform);n.active=!(o>20)}}}}}class zt{constructor(e){this.owner=e,this.owner.mptModel[J.DATA]=this}loadData(e){this.owner.gridX=e.rang[2],this.owner.gridY=e.rang[3],this.owner.gridWidthNum=e.rang[5],this.owner.gridHeightNum=e.rang[4],this.owner.mapWidth=10*this.owner.gridWidthNum,this.owner.mapHeight=10*this.owner.gridHeightNum,this.owner.taskgridFlags=[],this.owner.guideGridFlags=[],this.owner.taskTargetPoint=null;var t,i=[],s=[e.mapdata];this.owner.gridFlags=[];for(var a=0;a<this.owner.gridHeightNum+2;a++)i.push(J.UNWALKABLE);this.owner.gridFlags.push(i);for(var n=0;n<this.owner.gridWidthNum;n++){for((i=[]).push(J.UNWALKABLE),a=0;a<this.owner.gridHeightNum;a++)(t=s[0][n][a])==J.TASK_TARGET_POINT&&(this.owner.taskTargetPoint={x:n,y:a}),i.push(t);i.push(J.UNWALKABLE),this.owner.gridFlags.push(i)}for(i=[],a=0;a<this.owner.gridHeightNum+2;a++)i.push(J.UNWALKABLE);this.owner.gridFlags.push(i)}}class Vt{constructor(e){this.owner=e,this.owner.mptModel[J.GUIDE]=this}createGuide(){for(var e=this.owner.gridFlags,t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++){e[t][i]==J.GUIDE_WALKABLE&&(this.guideGridFlags[this.guideGridFlags.length]={x:t,y:i})}}isGuide(e){let t=this,i=Math.floor(e.position.x),s=Math.floor(e.position.z);if(!i)return!1;if(!s)return!1;var a=t.owner.gridFlags;if(null==a[i]||null==a[i][s])return!1;if(Number(a[i][s])==J.GUIDE_WALKABLE){if(t.guideGridFlags.length>0){for(var n=0;n<t.guideGridFlags.length;n++){var o=t.guideGridFlags[n];a[o.x][o.y]=J.WALKABLE}t.guideGridFlags=[]}return!0}return!1}}class Ft{}Ft.rocket=10001,Ft.magnet=10002,Ft.chest=10003,Ft.gold=10004,Ft.laughBoom=10005,Ft.starBoom=10006,Ft.stoneBoom=10007,Ft.boom=10008,Ft.stoneBigBoom=10009,Ft.addspeedeffect=10010,Ft.powereffect=10011,Ft.magneteffect=10012,Ft.rideeffect=10013,Ft.db_hall_effect=10014,Ft.db_car=10015,Ft.replace_car=10016,Ft.hit=10017,Ft.gotaskpoint=10018,Ft.gotaskpoint2=10019,Ft.bloodEffect=10020;class Ut{constructor(e){this.owner=e,this.taskTiggerList=[],this.owner.mptModel[J.TASK]=this}loadTask(e,t){this.taskDataMap={};for(var i=0;i<e.length;i++){var s=e[i],a=s.data.split("|"),n=Number(a[1]);this.taskDataMap[n]=s}this.initTiggerTask(Ve.task.getTaskList()),t&&t.runWith([this])}createTiggerTask(e){var t=this;if(2!=e.state){if(!t.taskDataMap||!t.taskDataMap[e.tb.taskId])return;var i=t.taskTiggerList.filter(t=>t.info.taskId==e.taskId)[0],s=t.taskTiggerList.indexOf(i);-1!=s&&t.taskTiggerList.splice(s,1);var a=t.taskDataMap[e.tb.taskId],n=new Laya.Vector3(a.tr[0],a.tr[1],a.tr[2]);if(e.tb.taskType==jt.ACCEPT_TASK||e.tb.taskType==jt.ACCEPTLEVEL_TASK||e.tb.taskType==jt.NOPANEL_ACCEPT_TASK||e.tb.taskType==jt.ARRIVE_DESTINATION||e.tb.taskType==jt.NOPANEL_ARRIVE){var o=e.tb.taskType==jt.ACCEPT_TASK||e.tb.taskType==jt.ACCEPTLEVEL_TASK||e.tb.taskType==jt.NOPANEL_ACCEPT_TASK?Ft.gotaskpoint2:Ft.gotaskpoint;Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_EFFECT,[n,o,{mat:null,handler:initHandler(t,i=>{i.info=e;var s=ea.scene.mainscene.getChildByName("map");s&&s.addChild(i),i.transform.localPosition=n.clone(),t.taskTiggerList[t.taskTiggerList.length]=i})}])}else t.taskTiggerList[t.taskTiggerList.length]={transform:{position:n},info:e}}}initTiggerTask(e){this.taskTiggerList=[];for(var t=0;t<e.length;t++)this.createTiggerTask(e[t])}checkTaskTigger(e){if(!e)return null;for(var t=0;t<this.taskTiggerList.length;t++){var i=this.taskTiggerList[t],s=i.info,a=i.transform;if(a){var n=a.localPosition?a.localPosition.clone():a.position.clone(),o=e.transform.position.clone(),r=Math.abs(n.x-o.x),l=(Math.abs(n.y-o.y),Math.abs(n.z-o.z)),h=new Laya.Vector3(1,1,1),c=s.tb.taskTiggerDistance.split("|");for(t=0;t<c.length;t++)0==t?h.x=Number(c[t]):1==t?h.y=Number(c[t]):h.z=Number(c[t]);if(r<h.x&&n.y-o.y<1.5&&l<h.z)return i}}return null}verifyTaskMarker(e){var t=mi.device.currentMountGear?mi.device.currentMountGear:ea.scene.player.owner,i=this.taskTiggerList.filter(t=>t.info==e)[0];if(!i)return!1;var s=i.transform;if(!s)return!1;for(var a=s.localPosition?s.localPosition.clone():s.position.clone(),n=t.transform.localPosition.clone(),o=Math.abs(a.x-n.x),r=(Math.abs(a.y-n.y),Math.abs(a.z-n.z)),l=new Laya.Vector3(1,1,1),h=e.tb.taskTiggerDistance.split("|"),c=0;c<h.length;c++)0==c?l.x=Number(h[c]):1==c?l.y=Number(h[c]):l.z=Number(h[c]);return o<l.x&&a.y-n.y<1.5&&r<l.z||void 0}check3TaskPoint(e){var t=ea.scene.player.owner,i=this.taskTiggerList.filter(t=>t.info==e)[0];if(!i)return!1;var s=i.transform;if(!s)return!1;for(var a=s.localPosition?s.localPosition.clone():s.position.clone(),n=t.transform.localPosition.clone(),o=new Laya.Vector3(1,1,1),r=e.tb.taskTiggerDistance.split("|"),l=0;l<r.length;l++)0==l?o.x=Number(r[l]):1==l?o.y=Number(r[l]):o.z=Number(r[l]);return Qe.isDistanceIn({position:a},{position:n},o.x)}fetchTaskTrigger(e){if(!e)return null;if(!this.taskDataMap[e.taskId])return null;for(var t=0;t<this.taskTiggerList.length;t++){var i=this.taskTiggerList[t];if(i.info.taskId==e.taskId)return i}return null}clearTaskTigger(e){var t=this.taskTiggerList.indexOf(e);-1!=t&&this.taskTiggerList.splice(t,1),e&&(e.info.tb.taskType!=jt.ACCEPT_TASK&&e.info.tb.taskType!=jt.ACCEPTLEVEL_TASK&&e.info.tb.taskType!=jt.NOPANEL_ACCEPT_TASK&&e.info.tb.taskType!=jt.ARRIVE_DESTINATION&&e.info.tb.taskType!=jt.NOPANEL_ARRIVE||e.removeSelf&&(e.removeSelf(),e.destroy()))}createTaskPoint(){for(var e,t,i,s,a=this.owner.gridFlags,n=0;n<a.length;n++)for(var o=0;o<a[n].length;o++){var r=a[n][o];r!=J.TASK_RANGE_WALKABLE&&r!=J.TASK_RANGE_UNWALKABL||(e||(e=n),e=Math.min(n,e),t||(t=o),t=Math.min(o,t),i||(i=n),i=Math.max(n,i),s||(s=o),s=Math.max(o,s))}if(this.taskArrowSp&&(this.taskArrowSp.removeSelf(),this.taskArrowSp.destroy()),this.taskSp){var l=i-e+1,h=s-t+1;return this.taskSp.transform.localPosition=new Laya.Vector3(e+l/2,0,t+h/2),void(this.taskSp.transform.localScale=new Laya.Vector3(l,1,h))}}createTaskPlane(){var e,t,i,s;this.planeMax=0;for(var a=this.owner.gridFlags,n=0;n<a.length;n++)for(var o=0;o<a[n].length;o++){a[n][o]==J.PLANE_WALKABLE&&(e||(e=n),e=Math.min(n,e),t||(t=o),t=Math.min(o,t),i||(i=n),i=Math.max(n,i),s||(s=o),s=Math.max(o,s),this.planeMax++)}if(this.planelist&&this.planelist.length>0)for(var r=0;r<this.planelist.length;r++){var l=this.planelist[r];l&&(l.removeSelf(),l.destroy())}this.planelist=[]}showTaskArrow(e){if(a.func.AX_ARROW){for(var t=this.owner.taskTargetPoint,i=oi.singleton.getPixelPath(e.position.x,e.position.z,t.x,t.y),s=0;s<i.length;s++){var n=i[s];n.x,n.y}serror("paths : ",i)}}hasMissionData(e){let t=Math.floor(e.position.x),i=Math.floor(e.position.z);if(!t)return!1;if(!i)return!1;var s=this.owner.gridFlags;if(null==s[t]||null==s[t][i])return!1;let a=Number(s[t][i]);return a==J.TASK_RANGE_WALKABLE||a==J.TASK_RANGE_UNWALKABL||a==J.TASK_TARGET_POINT?a:0}clearTask(){for(var e=this.owner.gridFlags,t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++){var s=e[t][i];s!=J.TASK_RANGE_WALKABLE&&s!=J.TASK_RANGE_UNWALKABL&&s!=J.TASK_TARGET_POINT||(e[t][i]=J.WALKABLE)}}refthing(e){for(var t=0;t<this.taskTiggerList.length;t++){var i=this.taskTiggerList[t];if(e&&null!=!i.active)if(i.destroyed)this.taskTiggerList.splice(t,1),t--;else{var s=i;if(11==this.taskTiggerList[t].info.tb.taskType){if(!ea.scene&&!ea.scene.ui)return;ea.scene.ui.lab_jindou.visible=!0,ea.scene.ui.img_jindou.visible=!0,ea.scene.ui.box_taskProgress.visible=!1,Ve.game.jindoumubiao=this.taskTiggerList[t].info.tb.taskCount,0==ea.scene.GamePause&&ea.scene&&ea.scene.ui.lab_jindou&&1==ea.scene.ui.lab_jindou.visible&&(null==Ve.game.hadgold&&(Ve.game.hadgold=0),ea.scene.ui.lab_jindou.text=(Ve.user.gold-Ve.game.hadgold).toString()+"/"+Ve.game.jindoumubiao.toString())}var a=Qe.getDistance(e,s.transform);s.active=!(a>30)}}}isTask(e){return e==J.TASK_RANGE_WALKABLE||e==J.TASK_RANGE_UNWALKABL||e==J.TASK_TARGET_POINT?e:0}}class qt{constructor(e){this.owner=e,this.owner.mptModel[J.EFFECT]=this,this.things=[]}loadEffect(e,t){for(var i,s=e.map,a=function(t,a){var n=(i=s[0][t-1][a-1]).split("_");Laya.loader.getRes(ce.getEffect(e.thingIds[n[0]]))},n=1;n<=this.owner.gridWidthNum;n++)for(var o=1;o<=this.owner.gridHeightNum;o++)i=s[0][n-1][o-1],0!=Number(i)&&a(n,o);t&&t.runWith([this])}}class Yt{constructor(e){this.owner=e,this.things=[],this.owner.mptModel[J.ROLE]=this}loadRole(e,t){var i=this,s=(e.res,e.thingDatas),n=function(e){var t=e.m;if(t){var a=s[t.res],n=Tn.inst.load3d.mapThingRes(ce.getRoletUrl,3,a,t.data,ea.scene.mainscene.getChildByName("map"));if(n){n.setInitPoint(t.tr),t.track&&t.track.length&&t.track.length>0&&n.setTracks(t.track),e.mode&&(e.mode.removeSelf(),e.mode.destroy(),e.mode=null),e.mode=n;var o=Math.floor(Number(a.thingId)%1e5/1e4);9==o||6==o?i.owner.devicePush(n):i.things.push(n)}}};for(var o in e.npcs){var r,l,h,c=e.npcs[o],d=(Qe.get3Distance(i.owner.initPoint,c.tr),s[c.res]),u=Math.floor(Number(d.thingId)%1e5/1e4);if(9==u||6==u){if(!(r=a.device.getTbByConfigId(Number(d.thingId)))){console.log(Number(d.thingId));continue}h=r.deviceId,l=le.type_device}else{var p=Math.floor(Number(d.thingId)%1e4/1e3);if(33==Math.floor(Number(d.thingId)%1e5/1e3))continue;if(6==d.type)l=le.type_role,h=Ve.game.roleid;else if(2==p){if(!(r=a.npc.getTbByConfigId(Number(d.thingId)))){console.log(Number(d.thingId));continue}l=le.type_npc,h=r.npcId}else if(3==p){if(!(r=a.monster.getTbByConfigId(Number(d.thingId)))){console.log(Number(d.thingId));continue}h=r.monsterId,l=le.type_monster}else 4==p?(r=a.thing.getTbByConfigId(Number(d.thingId)),l=le.type_carnpc,h=r.npcId):6==p&&(r=a.thing.getTbByConfigId(Number(d.thingId)),l=le.type_wznpc,h=r.npcId)}40==Number(c.data)?i.owner.renderFuncs.push({type:l,tbId:h,distance:200,func:n,m:c,isCache:!1,mode:null}):i.owner.renderFuncs.push({type:l,tbId:h,distance:r.renderDistance,func:n,m:c,isCache:!1,mode:null})}t&&t.runWith([i])}refthing(e){for(var t=0;t<this.things.length;t++){var i=this.things[t];if(e&&i.transform){var s,a=Qe.getDistance(e,i.transform),n=i.tb.renderDistance;40==Number(this.things[t].dataStr)&&(n=200),a>n+10?s=le.distancetype_noloading:a<=n+10&&a>n?s=le.distancetype_preloading:a<=n&&a>n-10?s=le.distancetype_replacemodel:a<=n-10&&(s=le.distancetype_showmodel),i.onRefThing(s)}}}pushRole(e){var t=this.things.indexOf(e);-1!=t&&this.things.splice(t,1),this.things.push(e)}delRoleSprite(e){var t=this.things.indexOf(e);-1!=t&&this.things.splice(t,1)}}class Wt{constructor(e){this.owner=e,this.owner.mptModel[J.GOLD]=this}createGold(){}}class Xt{constructor(e){this.owner=e,this.owner.mptModel[J.BUFF]=this}createBuff(){this.owner.gridFlags}}class Kt{constructor(e){this.owner=e,this.owner.mptModel[J.BUILD]=this}loadBuild(e,t,i){var s=this,n=(e.res,e.thingDatas);s.buildFlags||(s.buildFlags=[]);var o=function(e){var i=e.m;if(i){var o=n[i.res],r=Tn.inst.load3d.mapThingRes(ce.getBuildUrl,1,o,i.data,ea.scene.mainscene.getChildByName("map"));if(r){r.setInitPoint(i.tr);var l=a.thing.getTbByConfigId(Number(o.thingId));1==l.isdevice?s.owner.devicePush(r):(s.buildFlags.push({mode:r,tb:l}),t.push({mode:r,tb:l}))}}};for(var r in e.things){var l=e.things[r],h=n[l.res],c=(Qe.get3Distance(s.owner.initPoint,l.tr),le.type_thing),d=a.thing.getTbByConfigId(Number(h.thingId));d?s.owner.renderFuncs.push({type:c,tbId:d.thingId,distance:d.renderDistance,func:o,m:l,isCache:!1,mode:null}):console.log(h.thingId)}i&&i.runWith([s])}getBuildsByType(e){return[]}clearBuild(e){for(var t=0;t<this.buildFlags.length;t++){var i=this.buildFlags[t];if(i.mode==e.parent||i.mode==e)return this.buildFlags.splice(t,1),!0}return!1}refbuild(e){e.position.clone();for(var t=0;t<this.buildFlags.length;t++){var i=this.buildFlags[t];if(e&&i.mode.transform){var s,a=i.mode;(o=Qe.getDistance(e,i.mode.transform))>a.tb.renderDistance+10?s=le.distancetype_noloading:o<=a.tb.renderDistance+10&&o>a.tb.renderDistance?s=le.distancetype_preloading:o<=a.tb.renderDistance&&o>a.tb.renderDistance-10?s=le.distancetype_replacemodel:o<=a.tb.renderDistance-10&&(s=le.distancetype_showmodel),a.onRefThing(s)}}if(mi.drop&&mi.drop.list)for(t=0;t<mi.drop.list.length;t++){var n=mi.drop.list[t];if(e&&n.transform){var o=Qe.getDistance(e,n.transform);n.active=!(o>200)}}}}class Jt{}Jt.TRAMPOLINE=1,Jt.TRAMPOPOI=21,Jt.springPOI=22,Jt.springSCA=23,Jt.Color=24,Jt.PARKING=3,Jt.ORIGIN=6,Jt.TRANSFER=9,Jt.BATH=10,Jt.BUFF=12,Jt.GOLD=13,Jt.TASK=15,Jt.CAMERA=20,Jt.CLIMB=8,Jt.CANNON=36,Jt.STEIKEF=4081,Jt.PUSHOVER=4082,Jt.QUESTION=4083,Jt.MUSICBOX=4084,Jt.DIETHING=4085;class Zt{static getLW(e,t){var i,s=t.w%2;switch(e){case 0:i=t.l%2,s=t.w%2;break;case 90:case-90:i=t.w%2,s=t.l%2;break;default:i=t.l%2,s=t.w%2}return{l:i=i>0?i/2:i,w:s=s>0?s/2:s}}}class Qt{constructor(e){this.owner=e,this.owner.mptModel[J.MISSION]=this}loadData(e,t){var i=this,s=e.thingDatas,n=[],o=function(e){var t=e.m;if(t){var o=s[t.res];switch(o.type){case Jt.ORIGIN:if(ea.scene.player&&ea.scene.player.owner)ea.scene.player.owner.setInitPoint(t.tr),ea.scene.player.uMoveTrigger.ClearTrigger(),ea.scene.player.dMoveTrigger.ClearTrigger(),ea.scene.player.moveTrigger.ClearTrigger(),Ve.map.mptData.refThing(ea.scene.player.owner.transform),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH);else{var r=Tn.inst.load3d.mapThingRes(ce.getRoletUrl,3,o,t.data,ea.scene.mainscene.getChildByName("map"));if(!r)return;i.owner.mptModel[J.ROLE].things.push(r),r.setInitPoint(t.tr),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH)}i.owner.initPoint=t.tr;break;case Jt.TRANSFER:Zt.transfer_dthing||(Zt.transfer_dthing=o);var l=Tn.inst.load3d.mapThingRes(ce.getPropEffectUrl,1,o,t.data,ea.scene.mainscene.getChildByName("map"));if(!l)return;l.setInitPoint(t.tr);var h=a.thing.getTbByConfigId(Number(o.thingId));i.owner.mptModel[J.THING].push({mode:l,tb:h});break;case Jt.BUFF:"0"==t.data?mi&&mi.drop&&mi.drop.addRomDrop&&mi.drop.addRomDrop(t.tr):mi&&mi.drop&&mi.drop.addLockDrop&&mi.drop.addLockDrop(Number(t.data),t.tr);break;case Jt.GOLD:mi&&mi.drop&&mi.drop.addGold&&mi.drop.addGold(t.tr);break;case Jt.TASK:n.push(t);break;case Jt.BATH:i.owner.baths.push(t.tr);break;case Jt.CAMERA:var c=t.data.split("|");switch(Number(c[0])){case ye.CAMERA_GLOBAL:var d=new Laya.Sprite3D("globalCamera");ea.scene.mainscene.getChildByName("map").addChild(d),ta.toTrBy9G(d,t.tr),Ve.map.cameraThings[Number(c[0])]=d;break;case ye.CAMERA_TASK:if(c.length<=1)return void cafe.event.dispatch(ge.game.CMD,[ye.TIPS,"摄像机配置参数缺少"]);d=new Laya.Sprite3D("taskCamera"+c[1]);ea.scene.mainscene.getChildByName("map").addChild(d),ta.toTrBy9G(d,t.tr),Ve.map.cameraThings[Number(c[1])]=d}}}};for(var r in e.datas){var l,h,c=e.datas[r],d=s[c.res],u=a.thing.getTbByConfigId(Number(d.thingId)),p=60;switch(d.type){case Jt.ORIGIN:u=null,l=le.type_role,h=Ve.game.roleid;break;case Jt.TRANSFER:p=(u=a.thing.getTbByConfigId(Number(d.thingId))).renderDistance,h=u.thingId,l=le.type_transfer;break;case Jt.BUFF:u=a.drop.getTbByCondition(e=>e.resId==Number(d.thingId))[0],l=le.type_buff;break;case Jt.GOLD:h=null,l=le.type_gold;break;case Jt.TASK:h=Number(c.data.split("|")[1]),l=le.type_task;break;case Jt.BATH:u=null,l=le.type_bath;break;case Jt.CAMERA:u=null,l=le.type_camera}d.type==Jt.ORIGIN||d.type==Jt.TASK||d.type==Jt.BATH||d.type==Jt.CAMERA?o({distance:d.type>10?60:p,func:o,m:c,isCache:!1,mode:null}):i.owner.renderFuncs.push({type:l,tbId:h,distance:d.type>10?200:u.renderDistance,func:o,m:c,isCache:!1,mode:null})}i.owner.loadTask(n),t&&t.runWith([i])}}class $t{constructor(e){this.owner=e,this.devices=[],this.owner.mptModel[J.DEVICE]=this}pushDevice(e){this.devices.push(e)}refthing(e){e.position.clone();if(this.devices)for(var t=0;t<this.devices.length;t++){var i=this.devices[t];if(e&&i.transform){var s,a=i,n=Qe.getDistance(e,a.transform);n>a.tb.renderDistance+10?s=le.distancetype_noloading:n<=a.tb.renderDistance+10&&n>a.tb.renderDistance?s=le.distancetype_preloading:n<=a.tb.renderDistance&&n>a.tb.renderDistance-10?s=le.distancetype_replacemodel:n<=a.tb.renderDistance-10&&(s=le.distancetype_showmodel),a.onRefThing(s)}}}}class ei{constructor(){this.maxcount=30;this.mptModel={},this.renderFuncs=[],this.baths=[],this.thingMpt=new Ot(this),this.buildMpt=new Kt(this),this.dataMpt=new zt(this),this.guideMpt=new Vt(this),this.taskMpt=new Ut(this),this.effectMpt=new qt(this),this.roleMpt=new Yt(this),this.deviceMpt=new $t(this),this.goldMpt=new Wt(this),this.buffMpt=new Xt(this),this.missionMpt=new Qt(this)}get guideGridFlags(){return this.guideMpt.guideGridFlags}set guideGridFlags(e){this.guideMpt.guideGridFlags=e}get taskTargetPoint(){return this.taskMpt.taskTargetPoint}set taskTargetPoint(e){this.taskMpt.taskTargetPoint=e}get taskSp(){return this.taskMpt.taskSp}set taskSp(e){this.taskMpt.taskSp=e}get taskArrowSp(){return this.taskMpt.taskArrowSp}set taskArrowSp(e){this.taskMpt.taskArrowSp=e}get devices(){return this.deviceMpt.devices}devicePush(e){this.deviceMpt.pushDevice(e)}loadData(e,t){this.dataMpt.loadData(e),this.guideMpt.createGuide(),this.goldMpt.createGold(),this.buffMpt.createBuff(),t&&t.runWith([this])}refThing(e){var t={};e.length?t.position=new Laya.Vector3(e[0],e[1],e[2]):t.position=e.position.clone(),this.thingMpt.refthing(t),this.roleMpt.refthing(t),this.taskMpt.refthing(t),this.buildMpt.refbuild(t),this.deviceMpt.refthing(t)}checkBath(){if(!ea.scene.player||!ea.scene.player.owner)return!1;for(var e=ea.scene.player.owner,t=0;t<this.baths.length;t++)if(ta.isTrIn9G(e,this.baths[t]))return!0;return!1}getRenders(e,t){for(var i=this.renderFuncs.filter(t=>t.type==e),s=[],a=0;a<i.length;a++){var n=i[a];t&&n.tbId!=t||s.push(n)}return s}getRenderPosList(e,t){for(var i=this.renderFuncs.filter(t=>t.type==e),s=[],a=0;a<i.length;a++){var n=i[a];n.tbId==t&&s.push(ta.getPos(n.mode?n.mode:n.m.tr))}return s}loadMission(e,t){this.baths=[],this.missionMpt.loadData(e,t)}loadBuild(e,t,i){this.buildMpt.loadBuild(e,t,i)}loadThing(e,t,i){this.thingMpt.loadThing(e,t,i)}getThingsByType(e){return this.thingMpt.getThingsByType(e)}clearBuild(e){return this.buildMpt.clearBuild(e)}clearThing(e){return this.thingMpt.clearThing(e)}checkThing(e,t){return this.thingMpt.checkThing(e,t)}loadEffect(e,t){this.effectMpt.loadEffect(e,t)}checkTaskTigger(e){var t={transform:{position:e.transform.localPosition.clone()}};return this.taskMpt.checkTaskTigger(t)}verifyTaskMarker(e){return this.taskMpt.verifyTaskMarker(e)}check3TaskPoint(e){return this.taskMpt.check3TaskPoint(e)}clearTaskTigger(e){this.taskMpt.clearTaskTigger(e)}fetchTaskTrigger(e){return this.taskMpt.fetchTaskTrigger(e)}loadTask(e,t){this.taskMpt.loadTask(e,t)}createTiggerTask(e){this.taskMpt.createTiggerTask(e)}loadRole(e,t){this.roleMpt.loadRole(e,t)}renderLoadDistanceMods(){var e=this;e.removeRenderFunc=(()=>{Ye.remove(e,n),e.renderFuncs=[]});var t,i=e.initPoint;(t=e.renderFuncs.filter(e=>0==e.isCache&&(Qe.isDistanceIn(i,e.m.tr,e.distance,!0)||"21"==e.m.data.split("|")[0]||"22"==e.m.data.split("|")[0]))).sort((e,t)=>{var s=Qe.get3Distance(i,e.m.tr,!0),a=Qe.get3Distance(i,t.m.tr,!0),n=e.m.data.split("|"),o=t.m.data.split("|");if("21"==n[0]||"22"==n[0])return-1;if("21"==o[0]||"22"==o[0])return 1;if(s[0]>e.distance||s[1]>e.distance)return 1;if(s[0]<=e.distance&&s[1]<=e.distance){if(s[0]+s[1]<a[0]+a[1])return-1;if(s[0]+s[1]>a[0]+a[1])return 1}return 0});var s=t.length,a=0,n=()=>{for(var i=t.length>5?5:t.length,o=0;o<i;o++){var r=t.shift();r.func(r),r.isCache=!0,a++}var l=90*(Math.floor(a/s*100)/100);be.prosshandler.runWith([Math.floor(10+l)/100]),t.length<=0&&(Ye.remove(e,n),e.renderMods(),Ve.game.isFinish=!0,ea.scene.ui.btn_prase.visible=!0)};Ye.add(5,e,n)}renderMods(){var e=this,t=e.maxcount;e.removeRenderFunc=(()=>{Ye.remove(e,i),e.renderFuncs=[]}),be.prosshandler.runWith([10]);var i=()=>{if(ea.scene.player&&ea.scene.player.owner){var t,s;t=mi.device.currentMountGear?mi.device.currentMountGear.transform:ea.scene.player.owner.transform,(s=ea.scene.cameraCode.isGlobalCamera?e.renderFuncs.filter(e=>0==e.isCache):e.renderFuncs.filter(e=>0==e.isCache&&Qe.isDistanceIn(t,e.m.tr,e.distance,!0))).sort((e,i)=>{var s=Qe.get3Distance(t,e.m.tr,!0),a=Qe.get3Distance(t,i.m.tr,!0),n=e.m.data.split("|"),o=i.m.data.split("|");if("21"==n[0]||"22"==n[0])return-1;if("21"==o[0]||"22"==o[0])return 1;if(s[0]>e.distance||s[1]>e.distance)return 1;if(s[0]<=e.distance&&s[1]<=e.distance){if(s[0]+s[1]<a[0]+a[1])return-1;if(s[0]+s[1]>a[0]+a[1])return 1}return 0});for(var a=s.length>2?2:s.length,n=0;n<a;n++){var o=s.shift();o.func(o),o.isCache=!0}e.renderFuncs.filter(e=>0==e.isCache).length<=0&&Ye.remove(e,i)}};Ye.add(t,e,i)}showTaskArrow(e){this.taskMpt.showTaskArrow(e)}isRun(e){let t=Math.floor(e.localPosition.x),i=Math.floor(e.localPosition.z);if(!t)return!1;if(!i)return!1;if(null==this.gridFlags[t]||null==this.gridFlags[t][i])return!1;let s=Number(this.gridFlags[t][i]);return s!=J.UNWALKABLE&&s!=J.TASK_RANGE_UNWALKABL&&s!=J.PY_UNWALKABLE}isFootRun(e){let t=Math.floor(e.localPosition.x),i=Math.floor(e.localPosition.z);return!!t&&(!!i&&(null!=this.gridFlags[t]&&null!=this.gridFlags[t][i]&&Number(this.gridFlags[t][i])==J.FOOT_UNWALKABL))}getPointFlag(e){let t=Math.floor(e.localPosition.x),i=Math.floor(e.localPosition.z);if(!t)return J.UNWALKABLE;if(!i)return J.UNWALKABLE;if(null==this.gridFlags[t]||null==this.gridFlags[t][i])return J.UNWALKABLE;let s=Number(this.gridFlags[t][i]);return s!=J.UNWALKABLE&&s!=J.TASK_RANGE_UNWALKABL&&J.PY_UNWALKABLE,s}isWalkable(e){return e!=J.UNWALKABLE&&e!=J.TASK_RANGE_UNWALKABL&&e!=J.PY_UNWALKABLE}isTask(e){return this.taskMpt.isTask(e)}clearTask(){this.taskMpt.clearTask()}isFunc(e){return e==J.FUNC_WALKABLE}hasMissionData(e){return this.taskMpt.hasMissionData(e)}isGlobalRun(e){let t=Math.floor(e.position.x),i=Math.floor(e.position.z);if(!t)return!1;if(!i)return!1;if(null==this.gridFlags[t]||null==this.gridFlags[t][i])return!1;let s=Number(this.gridFlags[t][i]);return s!=J.UNWALKABLE&&s!=J.TASK_RANGE_UNWALKABL&&s!=J.PY_UNWALKABLE}isGuide(e){return this.guideMpt.isGuide(e)}refMptEnum(e,t,i){let s=Math.floor(e.position.x),a=Math.floor(e.position.z);if(!s)return!1;if(!a)return!1;if(null==this.gridFlags[s]||null==this.gridFlags[s][a])return!1;var n=s-t.x/2,o=a-t.y/2,r=s+t.x/2,l=a+t.y/2;n<0&&(n=0),o<0&&(o=0),r>this.gridWidthNum&&(r=this.gridWidthNum),l>this.gridHeightNum&&(l=this.gridHeightNum);for(var h=n;h<r;h++)for(var c=o;c<l;c++)this.gridFlags[h][c]=i}getRandomPos(){let e=Math.round(Math.random()*(oi.singleton.voidMapPos.length-1));return oi.singleton.voidMapPos[e]}getPos(e,t){return{x:Math.floor(e),y:Math.floor(t)}}}class ti{static isAllPointWalkable(e,t){if(null==e||null==t)return!1;var i=oi.singleton,s=e.x,a=e.y,n=t.x,o=t.y,r=Math.abs(o-a)>Math.abs(n-s);if(r&&(s=e.y,a=e.x,n=t.y,o=t.x),s>n){var l=s,h=a;s=n,n=l,a=o,o=h}for(var c=Math.abs((o-a)/(n-s)),d=o>a?1:-1,u=Math.floor(s);u<=Math.ceil(n);u++){var p=a+d*c*(u-s),m=!1;if(u==Math.floor(s)&&(m=int(p)!=int(a)),!m)if(r){if(!i.isGridPointWalkble(Math.floor(p),u))return!1}else if(!i.isGridPointWalkble(u,Math.floor(p)))return!1;if((d>0?Math.ceil(p)-p:p-Math.floor(p))<c){var g=Math.floor(p)+d;if(g<=Math.max(int(a),int(o))&&g>=Math.min(int(a),int(o)))if(r){if(!i.isGridPointWalkble(g,u))return!1}else if(!i.isGridPointWalkble(u,g))return!1}}return!0}}class ii{}ii.NORMAL=0;class si{}si.INIT_STATE=0,function(e){e.init=function(){e.loadding_log=0,e.game_log=1,e.unlock_log=0,e.turnTable_log=0,e.user_log=0,e.map_log=0,e.signin_log=0,e.rank_log=0,e.buff_log=0,e.advert_switch=1}}(Me||(Me={})),function(e){e.init=function(){}}(Se||(Se={}));class ai extends oe{onEnable(){this.ani=this.owner.getComponent(Laya.Animator)}onPlayerEnd(e){e==ie.loop&&(this.state=ie.wait,cafe.event.dispatch(se.GAME_RIDE_DOWN)),super.onPlayerEnd(e)}onDestroy(){super.onDestroy()}}class ni{static getName(e,t){for(var i=e,s=t.split("|"),a=0;a<s.length&&(i=i.getChildByName(s[a]));a++);return i}static getBox(e,t="group_panel"){var i;return(i=e[t].getChildByName("box_tt"))&&(i.visible=!0),i}static initPanelNodeNames(e,t,i){for(var s=0;s<i.length;s++){for(var a,n=i[s].split("|"),o=t,r=0;r<n.length;r++)o=o.getChildByName(n[r]),a=n[r];e[a]=o}}}class oi extends cafe.data.BaseData{constructor(){super(oi.NAME),this.loadtotal=3,this.loadcount=0,this.createtime=0,this.tarP=new Laya.Point(0,0),this.srcP=new Laya.Point(0,0),this.MAX_FIND_TIME=1e3;oi._singleton=this,this.isInitComplete=!1,this.pathFinder=new Bt,this.cameraThings={},this.init()}static get singleton(){return oi._singleton}static get state(){return this._state}static set state(e){this._state=e,cafe.event.dispatch(se.MAP_STATE_CHANGE,e)}model(e){return oi._singleton.mptData?oi._singleton.mptData.mptModel[e]:null}init(){var e=this.read();this.testMap=Number(this.getTestMap()),0!=this.testMap?this.mapId=this.testMap:this.mapId=e&&e.mapId?e.mapId:1001,this.landMap=[],window.setTestMap=this.setTestMap}setTestMap(e){this.testMap=e,Laya.LocalStorage.setItem(i.game_tag+"_"+i.game_id+"_map",String(e))}getTestMap(){return Number(Laya.LocalStorage.getItem(i.game_tag+"_"+i.game_id+"_map"))}get mapId(){return this._mapId}set mapId(e){this._mapId=e,this.map=a.map.getTbBymap(this._mapId)}setMap(e){this.owner=e}loadMpt(){this.propthing=[],this.buildthing=[],Ve.carlib.initmap(),this.mpt(this._mapId.toString(),ea.scene.mainscene,initHandler(this,this.onMptDataLoaded))}removeMap(e){for(var t=e.getChildByName("map"),i=0,s=0;s<t.numChildren;s++){var a=t.getChildAt(i);ea.scene.player&&a==ea.scene.player.owner?i++:(a.removeSelf(),a.destroy(),s--)}}mpt(e,t,i){var s,n=this,o=a.map.getTbBymap(Number(e));n.removeMap(t),1==Me.loadding_log&&slog("进入"+o.mapId+"场景"),s=Ve.game.mission.targetMap==o.mapId&&0!=Ve.game.mission.missionData?String(Ve.game.mission.missionData):String(o.defaultMissionData);var r=Laya.loader.getRes(ce.mapdata_data+s+".json"),l=Laya.loader.getRes(ce.map_data+o.mapConfig+".json"),h=l.rang[0]-l.rang[4]/2+.5,c=l.rang[1]-l.rang[5]/2+.5;n.owner.transform.localPositionX=-h,n.owner.transform.localPositionZ=-c;for(var d=l.thingDatas,u=(e,t)=>{var s=d[e.res],a=s.resThing[0],o=new Laya.Sprite3D("gamemap"+t);n.owner.addChild(o),n.landMap.push(o),Tn.inst.load3d.thingRes("res/res3D/3dmap/"+a.res,o,initHandler(n,n=>{ta.toTrBy9G(o,e.tr);var h=o.transform.position.clone();h.y=Math.round(1e3*h.y)/1e3,o.transform.position=h.clone(),n.transform.localPosition=new Laya.Vector3(a.thing.x+a.thing.offX-s.l/2,a.thing.offY,a.thing.z+a.thing.offZ-s.w/2),n.transform.localRotationEuler=new Laya.Vector3(a.thing.rX,a.thing.rY,a.thing.rZ),n.transform.localScale=new Laya.Vector3(a.thing.l,1,a.thing.w),(h=n.transform.position.clone()).y=Math.round(1e3*h.y)/1e3,n.transform.position=h.clone(),0==t&&i&&i.method&&i.runWith([l,r])}))},p=0;p<l.maps.length;p++){u(l.maps[p],p)}}hitRide(e){if(!e)return null;let t=new Laya.Point(e.transform.position.x,e.transform.position.z);for(var i=0;i<this.rideeffect.length;i++){var s=this.rideeffect[i].mode.getChildByName("group_rideeffect"),a=this.rideeffect[i].tb;if(s&&Qe.hitC(e,s,{pos:t,d1:1,d2:a.aniTiggerDistance}))return this.rideeffect[i]}return null}hitRideThing(e){let t=new Laya.Point(e.transform.position.x,e.transform.position.z);for(var i=0;i<this.buildthing.length;i++){var s=this.buildthing[i].mode,a=this.buildthing[i].tb;if(s&&a&&0!=a.isdevice&&Qe.hitC(e,s,{pos:t,d1:1,d2:a.rideTiggerDistance}))return this.buildthing[i]}return null}removeThing(e){for(var t=0;t<this.buildthing.length;t++){var i=this.buildthing[t].mode;if(e.parent==ea.scene.mainscene){if(e==i)return this.buildthing.splice(t,1),void this.mptData.clearThing(e)}else if(e.parent==i)return this.buildthing.splice(t,1),void this.mptData.clearThing(e)}}rideUp(e,t){var i=this;slog("开始乘坐1");var s=ni.getName(t.mode,t.tb.aniTiggerCameraPath);ea.scene.cameraCode.setPrePlotGroup(s),ea.scene.cameraCode.setPlotCamera();var n=e.getComponent(ht).role,o=a.role.getTbByRoleId(n.returnRole);if(slog("开始乘坐2"),"0"!=t.tb.aniTiggerBodyPath){var r=ni.getName(t.mode,t.tb.aniTiggerBodyPath);i.roleThing?r.addChild(i.roleThing):Tn.inst.load3d.thingRes(ce.role(o.roleMod),r,initHandler(i,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),i.roleThing=e}))}var l=t.mode.getComponent(ai);l.state=ie.loop,slog("开始乘坐播放",ie.loop),l.speed=t.tb.aniSpeed,t.effect.active=!1,e.active=!1}rideThingUp(e,t){var i=this,s=ni.getName(t.mode,t.tb.cameraPath);ea.scene.cameraCode.setPrePlotGroup(s),ea.scene.cameraCode.setPlotCamera();var n=e.getComponent(ht).role,o=a.role.getTbByRoleId(n.returnRole);if("0"!=t.tb.modPath){var r=ni.getName(t.mode,t.tb.modPath),l=("0"!=t.tb.aniModPath?ni.getName(t.mode,t.tb.aniModPath):t.mode).getComponent(re);i.roleThing?r.addChild(i.roleThing):Tn.inst.load3d.thingRes(ce.role(o.roleMod),r,initHandler(i,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),i.roleThing=e})),l.state=ie.loop,l.speed=t.tb.anispeed}e.active=!1}rideDown(e,t){e.active=!0,t.effect.active=!0,ea.scene.cameraCode.updateActiveCamera(),this.roleThing&&(this.roleThing.removeSelf(),this.roleThing=null)}rideThingDown(e,t){e.active=!0,ea.scene.cameraCode.updateActiveCamera(),this.roleThing&&(this.roleThing.removeSelf(),this.roleThing=null),ni.getName(t.mode,t.tb.path).getComponent(re).state=ie.wait}onLoadMptProgress(e){cafe.event.dispatch(se.ON_LOAD_MPT_PROGRESS,e)}mpt_res(){var e=this;e.loadtotal=4,e.loadcount=0,e.mptData?e.mptData.removeRenderFunc():e.mptData=new ei;var t,i=()=>{e.loadcount>=e.loadtotal&&(e.pathFinder.setGridData(e.mptData.gridFlags,e.mptData.gridWidthNum+2,e.mptData.gridHeightNum+2),e.isInitComplete=!0,cafe.event.dispatch(se.MAP_MPT_REF,e),cafe.event.dispatch(se.MAP_MPT_LOADED,e),cafe.event.dispatch(se.GAME_TASK_CAR_REF),e.invalidate())},s=e.map;t=Ve.game.mission.targetMap==s.mapId&&0!=Ve.game.mission.missionData?String(Ve.game.mission.missionData):String(s.defaultMissionData);var a=Laya.loader.getRes(ce.mapdata_data+t+".json"),n=Laya.loader.getRes(ce.map_data+s.mapConfig+".json");e.mapId=s.mapId,be.prosshandler.runWith([.05]),e.mptData.loadData(n,initHandler(e,t=>{e.mptData.loadMission(a,initHandler(e,t=>{serror("加载完成角色"),e.loadcount++,i()})),e.mptData.loadBuild(n,e.buildthing,initHandler(e,t=>{serror("加载完成建筑"),e.loadcount++,i()})),e.mptData.loadThing(a,e.propthing,initHandler(e,t=>{serror("加载完成物件数据"),e.loadcount++,i()})),e.mptData.loadRole(a,initHandler(e,t=>{serror("加载完成角色"),e.loadcount++,i()})),be.prosshandler.runWith([.1]),e.mptData.renderLoadDistanceMods()}))}onMptMissionLoaded(e){let t=this;t.loadcount=0,t.loadtotal=3,t.mptData?t.mptData.removeRenderFunc():t.mptData=new ei;var i=()=>{t.loadcount>=t.loadtotal&&(t.pathFinder.setGridData(t.mptData.gridFlags,t.mptData.gridWidthNum+2,t.mptData.gridHeightNum+2),t.isInitComplete=!0,cafe.event.dispatch(se.MAP_MPT_LOADED,t),t.invalidate())};t.mapId=t.map.mapId,t.mptData.loadMission(e,initHandler(t,e=>{serror("加载完成角色"),t.loadcount++,i()})),t.mptData.loadThing(e,t.propthing,initHandler(t,e=>{serror("加载完成物件数据"),t.loadcount++,i()})),t.mptData.loadRole(e,initHandler(t,e=>{serror("加载完成角色"),t.loadcount++,i()})),t.mptData.renderLoadDistanceMods()}onMptDataLoaded(e,t){let i=this;i.loadcount=0,i.loadtotal=4,i.mptData?i.mptData.removeRenderFunc():i.mptData=new ei;var s=()=>{i.loadcount>=i.loadtotal&&(i.pathFinder.setGridData(i.mptData.gridFlags,i.mptData.gridWidthNum+2,i.mptData.gridHeightNum+2),i.isInitComplete=!0,cafe.event.dispatch(se.MAP_MPT_LOADED,i),i.invalidate())};i.mapId=i.map.mapId,i.mptData.loadData(e,initHandler(i,a=>{i.mptData.loadMission(t,initHandler(i,e=>{serror("加载完成角色"),i.loadcount++,s()})),i.mptData.loadBuild(e,i.buildthing,initHandler(i,e=>{serror("加载完成建筑"),i.loadcount++,s()})),i.mptData.loadThing(t,i.propthing,initHandler(i,e=>{serror("加载完成物件数据"),i.loadcount++,s()})),i.mptData.loadRole(t,initHandler(i,e=>{serror("加载完成角色===end"),i.loadcount++,s()})),i.mptData.renderLoadDistanceMods()}))}get mapType(){return this.config.type}get isAttackMap(){return!!this.config&&this.config.type!=ii.NORMAL}isCurrentMap(e){return this._mapId==e}getGridPosFlag(e,t){return null==this.mptData.gridFlags[e+1]||null==this.mptData.gridFlags[e+1][t+1]?J.UNWALKABLE:this.mptData.gridFlags[e+1][t+1]}setGridPosFlag(e,t,i){e>=0&&e<this.mptData.gridWidthNum&&t>=0&&t<this.mptData.gridHeightNum&&(this.mptData.gridFlags[e+1][t+1]=i)}getPixelPosFlag(e,t){var i=oi.pixelX2GridX(e),s=oi.pixelY2GridY(t);return this.getGridPosFlag(i,s)}setPixelPosFlag(e,t,i){var s=oi.pixelX2GridX(e),a=oi.pixelY2GridY(t);this.setGridPosFlag(s,a,i)}isGridPointWalkble(e,t){return!(e<0||e>this.mptData.gridWidthNum||t<0||t>this.mptData.gridHeightNum)&&this.getGridPosFlag(e,t)!=J.UNWALKABLE}checkPixelWalkable(e,t){return!(e<0||e>this.mptData.mapWidth||t<0||t>this.mptData.mapHeight)&&this.getGridPosFlag(e,t)!=J.UNWALKABLE}isHidePoint(e,t){return this.getGridPosFlag(e,t)==J.HIDE}isHidePoint_pixel(e,t){var i=oi.pixelX2GridX(i),s=oi.pixelY2GridY(s);return this.isHidePoint(i,s)}static pixel2Grid(e){var t=e.x/oi.gridWidthPixels,i=e.y/oi.gridHeightPixels;return new Laya.Point(t,i)}static pixelX2GridX(e){return e/oi.gridWidthPixels}static pixelY2GridY(e){return e/oi.gridHeightPixels}static grid2Pixel(e){let t=oi;oi.singleton.mptData;var i=(e.x*t.gridWidthPixels+(t.gridWidthPixels>>1))/10,s=(e.y*t.gridHeightPixels+(t.gridHeightPixels>>1))/10;return new Laya.Point(i,s)}static gridX2PixelX(e){return e*oi.gridWidthPixels+(oi.gridWidthPixels>>1)}static gridY2PixelY(e){return e*oi.gridHeightPixels+(oi.gridHeightPixels>>1)}getPixelPath(e,t,i,s){let a=this;if(e=10*Math.floor(e),t=10*Math.floor(t),i=10*Math.floor(i),s=10*Math.floor(s),i==e&&s==t)return null;var n=a.getLinePath(e,t,i,s);if(null==n){if(a.srcP.x=e,a.srcP.y=t,a.tarP.x=i,a.tarP.y=s,0==(n=a.getGridPath(a.srcP,a.tarP)).length)return null;var o=[];for(l=0;l<n.length;l++){o.push(n[l]);for(var r=n.length-1;r>l;r--)if(ti.isAllPointWalkable(n[l],n[r])){l=r-1;break}}n=o;for(var l=0;l<n.length;l++)n[l]=oi.grid2Pixel(n[l])}return n}getLinePath(e,t,i,s){let a=this;var n=oi.pixel2Grid(new Laya.Point(e,t)),o=oi.pixel2Grid(new Laya.Point(i,s));if(!ti.isAllPointWalkable(n,o))return null;var r,l,h=i-e,c=s-t,d=Math.sqrt(h*h+c*c)/10,u=[];if(0==d)u.push(new Laya.Point(i,s));else for(var p=1;p<=d;p++){if(r=e+h*(p/d),l=t+c*(p/d),!a.checkPixelWalkable(r,l))return null;u.push(new Laya.Point(r,l))}return u}getGridPath(e,t,i=!1){let s=this;var a=oi.pixel2Grid(e),n=oi.pixel2Grid(t);return s.findDeep=0,s.findWalkablePath(a,n)?s.pathFinder.findpath(a.x,a.y,n.x,n.y,i):[]}findWalkablePath(e,t){let i=this;if(i.isGridPointWalkble(t.x,t.y))return!0;for(var s=0;!i.isGridPointWalkble(t.x,t.y)&&s<i.MAX_FIND_TIME;)oi.updatePos(t,e.x,e.y,1),s++;return s!=i.MAX_FIND_TIME}static updatePos(e,t,i,s=6){var a=t-e.x,n=i-e.y;0==a&&0==n||(this.rds=Math.atan2(n,a),this.Sin=Math.sin(this.rds),this.Cos=Math.cos(this.rds),e.x=Math.round(e.x+s*this.Cos),e.y=Math.round(e.y+s*this.Sin))}isCutFlagCopy(){return 1==this.config.type&&0==this.config.if_boss}save(){var e={mapId:this.mapId};i.saveJson(oi.NAME,e)}read(){return i.readJson(oi.NAME)}isFreshMap(){return 10001==this.mapId||10003==this.mapId}}oi.gridWidthPixels=10,oi.gridHeightPixels=10,oi.NAME="MAP_DATA",oi._state=si.INIT_STATE,function(e){class t{}t._prop_res_11861010_lh=0,t._prop_res_11861051_lh=1,t._prop_res_12000501_lh=2,t._prop_res_12000601_lh=3,t._prop_res_20270003_lh=4,t._prop_res_49810009_lh=5,t._prop_res_49810010_lh=6,t._prop_res_49810011_lh=7,t._prop_res_49810012_lh=8,t._prop_res_49810013_lh=9,t._prop_res_49810014_lh=10,e.res_enum=t,e.res_dic={0:"prop_res/11861010.lh",1:"prop_res/11861051.lh",2:"prop_res/12000501.lh",3:"prop_res/12000601.lh",4:"prop_res/20270003.lh",5:"prop_res/49810009.lh",6:"prop_res/49810010.lh",7:"prop_res/49810011.lh",8:"prop_res/49810012.lh",9:"prop_res/49810013.lh",10:"prop_res/49810014.lh"},e.res={"prop_res/11861010.lh":["Assets/juese/dujiaoshou02.jpg","Assets/FX/jiantou/mfd2.png","Assets/FX/Textures/creat2-y.jpg","Assets/FX/Textures/xingxing 1.png"],"prop_res/11861051.lh":["Assets/juese/xiaohuangren/baku.jpg","Assets/FX/jiantou/view.png","Assets/FX/Textures/creat72-m.jpg","Assets/FX/Textures/l00030_1.png"],"prop_res/12000501.lh":["Assets/FX/jiantou/s6.png"],"prop_res/12000601.lh":[],"prop_res/20270003.lh":[],"prop_res/49810009.lh":["Assets/juese/danzai/danzaiguajian/textures/666.jpg"],"prop_res/49810010.lh":["Assets/juese/danzai/danzaiguajian/textures/yanjing03.png"],"prop_res/49810011.lh":["Assets/juese/danzai/danzaiguajian/textures/666.jpg"],"prop_res/49810012.lh":["Assets/juese/danzai/danzaiguajian/textures/taiyangmao.jpg"],"prop_res/49810013.lh":["Assets/juese/danzai/danzaiguajian/textures/douli.png"],"prop_res/49810014.lh":["Assets/juese/danzai/danzaiguajian/textures/jingu.png"]},e.config={"prop_res/11861010.lh":["Assets/juese/dujiaoshou@idle2-idle2.lani","Assets/juese/dujiaoshou@idle1-idle1.lani","Assets/juese/dujiaoshou@attack-attack.lani","Assets/juese/dujiaoshou@run-run.lani","Assets/juese/Materials/dujiaoshou_d 1.lmat","Assets/juese/dujiaoshou-dujiaoshou.lm","Assets/FX/xingzhejineng/Hovl Studio/Sword slash VFX/Models/Materials/mfd2.lmat","Assets/FX/jiantou/pian-Plane001.lm","Assets/FX/Materials/xingxingjiludian.lmat","Assets/FX/Materials/xingxing01.lmat"],"prop_res/11861051.lh":["Assets/juese/xiaohuangren/baku@fly-fly.lani","Assets/juese/xiaohuangren/Materials/baku.lmat","Assets/juese/xiaohuangren/baku-gou01.lm","Assets/FX/jiantou/Materials/mfd.lmat","Assets/FX/jiantou/pian-Plane001.lm","Assets/FX/Materials/zisejiludian.lmat","Assets/FX/Materials/quan02.lmat"],"prop_res/12000501.lh":["Assets/FX/jiantou/Materials/1.lmat","Assets/FX/jiantou/pian-Plane001.lm"],"prop_res/12000601.lh":[],"prop_res/20270003.lh":[],"prop_res/49810009.lh":["Assets/juese/danzai/danzaiguajian/yanjing01-yanjing01.lm","Assets/juese/danzai/danzaiguajian/materials/666.lmat"],"prop_res/49810010.lh":["Assets/juese/danzai/danzaiguajian/yanjing02-yanjing02.lm","Assets/juese/danzai/danzaiguajian/materials/yanjing03.lmat"],"prop_res/49810011.lh":["Assets/juese/danzai/danzaiguajian/yanjing03-yanjing03.lm","Assets/juese/danzai/danzaiguajian/materials/666.lmat"],"prop_res/49810012.lh":["Assets/juese/danzai/danzaiguajian/taiyangmao-taiyangmao.lm","Assets/juese/danzai/danzaiguajian/materials/taiyangmao.lmat"],"prop_res/49810013.lh":["Assets/juese/danzai/danzaiguajian/douli-douli.lm","Assets/juese/danzai/danzaiguajian/materials/douli.lmat"],"prop_res/49810014.lh":["Assets/juese/danzai/danzaiguajian/jingu-jingu.lm","Assets/juese/danzai/danzaiguajian/materials/jingu.lmat"]}}(Pe||(Pe={}));class ri{constructor(e){this.thingHeight=2.4,this.headHeight=2.4,this.headEffectHeight=2.4;var t=this;e&&(t.info=e),t.txt=new Laya.Label("0米"),t.txt.font="黑体",t.txt.fontSize=50,t.txt.bold=!0,t.txt.size(100,24),t.txt.color="#ffffff",t.txt.strokeColor="#222222",t.txt.stroke=3,t.txt.anchorX=.5,t.txt.anchorY=.5,_e.getLayer(1).addChild(t.txt),t.txt.visible=!1,Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_12000501_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{t.arrow=e,t.arrow.active=!1})),Ye.add(1,t,t.onFrame),cafe.event.on(ge.game.MAP_START_REPLACE_FINISH,t.destroy,t),cafe.event.on(ge.game.MAP_REPLACE_FINISH,t.onLoadArrow,t)}static showModel(){var e=new ri;ri.map[0]=e}static show(e){var t=new ri(e);ri.map[e.taskId]=t}static hideAll(){for(var e in ri.map){var t=ri.map[e];t.destroy(),t=null}ri.map={}}static hide(e){var t=ri.map[e.taskId];t&&t.destroy(),delete ri.map[e.taskId]}onUnloadArrow(){this.arrow&&(this.arrow.removeSelf(),this.arrow.destroy(),this.arrow=null),this.tigger&&(this.tigger=null),this.txt&&(this.txt.removeSelf(),this.txt.destroy(),this.txt=null)}onLoadArrow(){!this.arrow||this.arrow.transform,!this.chooseFocus||this.chooseFocus.transform}onFrame(){if(0!=Ve.game.MaoMaoGameType){if(!ea.scene.GamePause&&this.arrow&&3!=Ve.game.MaoMaoGameType){if(0!=Ve.game.MaoMaoGameType){if(!Ve.game.GuideModel&&!Ve.game.TipsNpc)return void(this.arrow.active=!1);if(Ve.game.TipsNpc&&!Ve.game.TipsNpc.parent)return void(this.arrow.active=!1);if(Ve.game.GuideModel&&!Ve.game.GuideModel.parent)return void(this.arrow.active=!1)}if(this.txt)if(this.txt.visible=!1,ea.scene.camera&&ea.scene.mainscene&&oi.singleton.mptData&&ea.scene.player&&ea.scene.player.owner){this.arrow.active=!0;var e,t,i=mi.device.currentMountGear?mi.device.currentMountGear.transform.localPosition:ea.scene.player.owner.transform.localPosition;if(1==Ve.game.MaoMaoGameType&&(e=null==Ve.game.GuideModel?Ve.game.TipsNpc.transform.localPosition.clone():Ve.game.GuideModel.transform.localPosition.clone()),0==Ve.game.MaoMaoGameType){if(!this.info)return;if(this.tigger=Ve.map.mptData.fetchTaskTrigger(this.info),this.tigger&&this.tigger.transform&&this.info.tb.taskType!=jt.KILL_MONSTER&&this.info.tb.taskType!=jt.KILL_BOSS&&this.info.tb.taskType!=jt.KILL_MONSTER_NOPANEL&&this.info.tb.taskType!=jt.KILL_MONSTER_SHOWBOSS&&this.info.tb.taskType!=jt.Ride_Funning_Num&&this.info.tb.taskType!=jt.GET_BALLNUM&&this.info.tb.taskType!=jt.ARRIVE_DESTINATION&&this.info.tb.taskType!=jt.ACCEPT_ENTRUST&&this.info.tb.taskType!=jt.Destroy_Build&&this.info.tb.taskType!=jt.Destroy_Device){if(!this.tigger.transform)return void(this.arrow.active=!1);if(this.tigger.transform.localPosition)e=this.tigger.transform.localPosition.clone();else{if(!this.tigger.transform.position)return void(this.arrow.active=!1);e=this.tigger.transform.position.clone()}}else{if(!this.info)return;for(var s,n=this.info.tb.taskTargetId.split("|"),o=0;o<n.length;o++){var r;if("0"!=n[o])if(this.info.tb.taskType==jt.KILL_MONSTER||this.info.tb.taskType==jt.KILL_BOSS||this.info.tb.taskType==jt.KILL_MONSTER_NOPANEL||this.info.tb.taskType==jt.KILL_MONSTER_SHOWBOSS?r=Ve.map.mptData.getRenders(le.type_monster,Number(n[o])):this.info.tb.taskType==jt.ARRIVE_DESTINATION?r=Ve.map.mptData.getRenders(le.type_npc,Number(n[o])):this.info.tb.taskType==jt.ACCEPT_ENTRUST?r=Ve.map.mptData.getRenders(le.type_npc,Number(n[o])):this.info.tb.taskType==jt.Destroy_Build?r=Ve.map.mptData.getRenders(le.type_thing,Number(n[o])):this.info.tb.taskType==jt.Destroy_Device||this.info.tb.taskType==jt.Ride_Funning_Num?r=Ve.map.mptData.getRenders(le.type_device,Number(n[o])):this.info.tb.taskType==jt.GET_BALLNUM&&(r=ia.getThingListById(Number(33043),J.THING,le.type_thing)),r&&r.length>0)for(var l=0;l<r.length;l++){var h=r[l];if(h&&h.transform){if(this.info.tb.taskType==jt.GET_BALLNUM)var c=h.transform.localPosition.clone();else c=ta.getPos(h.mode?h.mode:h.m.tr);if(c){var d=getDistance({x:i.x,y:i.z},{x:c.x,y:c.z});s?d==(s=Math.min(s,d))&&(t=h):(s=d,t=h)}}}}if(t)e=this.info.tb.taskType==jt.GET_BALLNUM?t.transform.localPosition.clone():ta.getPos(t.mode?t.mode:t.m.tr);else if(this.tigger&&this.tigger.transform){if(!this.tigger.transform)return void(this.arrow.active=!1);if(this.tigger.transform.localPosition)e=this.tigger.transform.localPosition.clone();else{if(!this.tigger.transform.position)return void(this.arrow.active=!1);e=this.tigger.transform.position.clone()}}else{var u=Ve.map.mptData.getRenders(le.type_transfer,Number(n[o]));if(u&&1==u.length)e=ta.getPos(u[0].mode?u[0].mode:u[0].m.tr);else if(u&&u.length>1){var p=this.info.tb.taskmap.split("|");for(o=0;o<u.length;o++)if("21"==p[0]){if(this.info.tb.taskmap==u[o].m.data){if(!(e=ta.getPos(u[o].mode?u[o].mode:u[o].m.tr)))return void(this.arrow.active=!1);break}}else{var m=u[o].m.data.split("|");if("21"==m[0])continue;if(a.map.getTbByTargetMap(Number(m[1]),Number(p[1]))&&!(e=ta.getPos(u[o].mode?u[o].mode:u[o].m.tr)))return void(this.arrow.active=!1)}}}}}if(!e)return;this.p=getATBNextDistance({x:i.x,y:i.z},{x:e.x,y:e.z},.2);var g=getDistance({x:i.x,y:i.z},{x:e.x,y:e.z}),y=calcPosAngle({x:-i.x,y:i.z},{x:-e.x,y:e.z},!0);if(!this.arrow)return;if(!this.arrow.transform)return;this.arrow.transform.localRotationEulerY=y+90;var f=ea.scene.player.owner.transform.localPosition.clone();f.y;mi.device.currentMountGear?f=mi.device.currentMountGear.transform.localPosition.clone():this.arrow.transform.localScale=new Laya.Vector3(1,1,1),f.y+=.2,this.arrow.transform.localPosition=f.clone();new Laya.Vector4(0,0,0,0);var _;if(g<20&&this.txt.visible){if(t)a.monster.getTbByMonsterId(t.tbId);var v=ea.scene.mainscene.getChildByName("map").transform.position;(_=e.clone()).x+=v.x,_.y+=v.y,_.z+=v.z,this.chooseFocus&&(this.chooseFocus.active=!0,this.chooseFocus.transform.position=_.clone())}else{this.chooseFocus&&(this.chooseFocus.active=!1);var b=this.arrow.transform.position.clone();_=c=new Laya.Vector3(b.x,b.y-.5,b.z+.5)}}else this.arrow.active=!1}}else this&&this.arrow&&this.arrow.active&&(this.arrow.active=!1)}destroy(){cafe.event.off(ge.game.MAP_REPLACE_FINISH,this.onLoadArrow,this),cafe.event.off(ge.game.MAP_START_REPLACE_FINISH,this.onUnloadArrow,this),this.onUnloadArrow()}}ri.map={},ri.map2={},ri.arrowYActionCount=-.01;class li extends it{constructor(){super(...arguments),this.isDispose=!1}onEnable(){super.onEnable();this.btnTween=new Laya.Tween,this.btn2Tween=new Laya.Tween}setSouce(){return this.souce={},this.souce.width=this.owner.width,this.souce.height=this.owner.height,this.souce.scaleX=this.owner.scaleX,this.souce.scaleY=this.owner.scaleY,this.souce.x=this.owner.x,this.souce.y=this.owner.y,this.btnTween||(this.btnTween=new Laya.Tween),this.btn2Tween||(this.btn2Tween=new Laya.Tween),this}resSouce(){this.souce&&(this.owner.width=this.souce.width,this.owner.height=this.souce.height,this.owner.scaleX=this.souce.scaleX,this.owner.scaleY=this.souce.scaleY,this.owner.x=this.souce.x,this.owner.y=this.souce.y)}playhuxi(e=1e3){var t=this,i=t.owner.width*t.owner.scaleX,s=t.owner.height*t.owner.scaleY,a=t.owner.scaleX,n=1.1*t.owner.scaleX,o=.05*i,r=.05*s,l=t.owner.x,h=t.owner.y,c=t.owner.x-o,d=t.owner.y-r,u=()=>{!t.isDispose&&t.owner&&t.btnTween.to(t.owner,{x:c,y:d,scaleX:n,scaleY:n},e,null,initHandler(t,()=>{!t.isDispose&&t.owner&&t.btnTween.to(t.owner,{x:l,y:h,scaleX:a,scaleY:a},e,null,initHandler(t,u))}))};return u(),t}playTDSizeFlash(e,t=1.1,i=150,s=300,a=0){var n=this,o=n.owner.width*n.owner.scaleX,r=n.owner.height*n.owner.scaleY,l=n.owner.scaleX,h=n.owner.scaleX*t,c=o*((t-1)/2),d=r*((t-1)/2),u=n.owner.x,p=n.owner.y,m=n.owner.x-c,g=n.owner.y-d,y=()=>{!n.isDispose&&n.owner&&(n.owner.visible=!0,n.owner.scaleX=0,n.owner.scaleY=0,n.owner.x=u+o/2,n.owner.y=p+r/2,n.btnTween.to(n.owner,{x:m,y:g,scaleX:h,scaleY:h},i,Laya.Ease.quadOut,initHandler(n,()=>{!n.isDispose&&n.owner&&n.btnTween.to(n.owner,{x:u,y:p,scaleX:l,scaleY:l},s,Laya.Ease.quadIn,initHandler(n,()=>{n.destroy(),e&&e.run()}))})))};return a?Laya.Tween.to(n.owner,{},a,null,initHandler(n,y)):y(),n}playhuxialpha(){var e=this,t=()=>{!e.isDispose&&e.owner&&e.btn2Tween.to(e.owner,{alpha:1},1e3,null,initHandler(e,()=>{!e.isDispose&&e.owner&&e.btn2Tween.to(e.owner,{alpha:.5},1e3,null,initHandler(e,t))}))};return t(),e}zhendong(e=3e3){var t=this,i=0,s=()=>{!t.isDispose&&t.owner&&t.btnTween.to(t.owner,{rotation:-5},40,null,initHandler(t,()=>{!t.isDispose&&t.owner&&t.btnTween.to(t.owner,{rotation:5},40,null,initHandler(t,()=>{++i>=10?(i=0,t.btnTween.to(t.owner,{rotation:0},40,null,initHandler(t,()=>{a()}))):s()}))}))},a=()=>{t.btnTween.to(t.owner,{},e,null,initHandler(t,s))};return s(),t}onDestroy(){this.isDispose=!0,this.btnTween&&this.btnTween.clear(),this.btn2Tween&&this.btn2Tween.clear(),this.resSouce(),super.onDestroy()}}class hi{constructor(e,t){this.thisobj=e,this._type=t}get count(){return this._count}set count(e){this._count=e}setValue(e){this.thisobj[this._type]=e}static colorToTargetFish(e,t,i,s,a){var n=new hi(e,"color"),o=e.color,r=new Laya.Tween,l=Math.floor(i/s/2),h=t,c=e=>{r.clear(),e>=s?a&&a.run():r.to(n,{},l,null,initHandler(null,()=>{r.clear(),n.setValue(h),h==t?(h=o,e++):h=t,c(e)}))};c(1)}}class ci extends Ee.res.modules.game.MainUiTaskItemUI{constructor(){super(...arguments),this.num=0}onEnable(){super.onEnable(),this.addClick(this.btn_item),this.monitor(se.GAME_TASK_REF,this.dataUpdate)}onCdTimerStartHandler(){this.cb_finish.selected||(this.txt_taskcontent.color="#ffffff")}onCdTimerWarnHandler(){this.cb_finish.selected||(this.txt_taskcontent.color="#ff3333")}dataUpdate(){if(this.data){var e="";4!=this._data.tb.taskType&&2!=this._data.tb.taskType&&(e="("+this._data.count+"/"+this._data.tb.taskCount+")"),this.txt_taskcontent.text=this._data.tb.taskDesc,4==this._data.tb.taskCount?(this.countText.visible=!0,this.countText.text="数量："+e):this.countText.visible=!1}}onClickHandler(e){switch(e.target){case this.btn_item:}}get data(){return this._data}set data(e){this._data=e,this.dataUpdate()}overFlash(e){var t=this;hi.colorToTargetFish(t.txt_taskcontent,"#00ff00",800,3,initHandler(t,()=>{Laya.Tween.clearTween(t.txt_taskcontent),t.cb_finish.selected=!0,t.removeCom(t.box_content,li),t._btneffect=null}))}onDestroy(){super.onDestroy(),this.removeCom(this.box_content,li),this._btneffect=null}}class di extends he{constructor(e){super(),this.isOpenTask=!0;this.owner=e,this.list=[],this.monitor(se.GAME_TASK_COUNT_REF,this.onTaskCountRef),this.monitor(se.GAME_TASK_REF,this.onTaskRef),this.bin("TASK_DATA",this.onTaskDataChange)}onTaskRef(){}onTaskDataChange(){this.owner.box_task_content.removeChildren(),ri.hideAll(),this.list=[];var e=Ve.task.getTaskList(),t=5,i=[];this.owner.txt_taskdesc.visible=!0;for(var s=ia.getThingList(J.ROLE,le.type_monster),a=0;a<e.length;a++){if(1!=(h=e[a]).state||1!=h.type&&2!=h.type&&4!=h.type&&5!=h.type);else{var n=new ci;if(n.data=e[a],this.owner.box_task_content.addChild(n),this.list[this.list.length]=n,ri.hideAll(),ri.show(this.list[0].data),s)for(var o=0;o<s.length;o++){if((r=s[o])&&r.tbId==Number(e[a].tb.taskTargetId))-1==i.indexOf(r)&&i.push(r)}if(t+=0==a?60:65,this.owner.txt_taskdesc.visible=!1,2==this.list.length)break}}if(s)for(a=0;a<s.length;a++){var r;if(r=s[a])-1!=i.indexOf(r)?r.isSelect=!0:(r.isSelect=!1,ea.scene.cameraCode.removeMode(r.bpmode))}var l=this.list.length;for(a=0;a<e.length;a++){var h=e[a];if(l>=1)break;0==h.state&&l<2&&(ri.show(e[a]),l++)}this.owner.group_taskContent.height=t,cafe.event.dispatch(ge.task.TASK_REF)}onTaskCountRef(e){var t=this,i=Ve.task.getTaskList();if(i)for(var s=[],a=!1,n=e=>{if(a)s[s.length]=e;else{a=!0}},o=0;o<i.length;o++){let s=i[o];if(s.tb.taskType!=jt.ACCEPT_TASK&&s.tb.taskType!=jt.ACCEPTLEVEL_TASK&&s.tb.taskType!=jt.NOPANEL_ACCEPT_TASK)if(e.id&&e.taskType)for(var r=s.tb.taskTargetId.split("|"),l=0;l<r.length;l++){if(e.id==Number(r[l])&&e.taskType==s.tb.taskType)s.count+=e.count,(h=t.list.filter(e=>e.data.taskId==s.taskId)[0])&&h.dataUpdate(),s.count>=s.tb.taskCount&&n(s)}else if(e.id)for(r=s.tb.taskTargetId.split("|"),l=0;l<r.length;l++){if(e.id==Number(r[l]))s.count+=e.count,(h=t.list.filter(e=>e.data.taskId==s.taskId)[0])&&h.dataUpdate(),s.count>=s.tb.taskCount&&n(s)}else if(e.taskType){var h;if(e.taskType==s.tb.taskType)s.count+=e.count,(h=t.list.filter(e=>e.data.taskId==s.taskId)[0])&&h.dataUpdate(),s.count>=s.tb.taskCount&&n(s)}}}onMapMptLoaded(){}onRunTaskPlot(e,t){var i=e.tb.taskPlotId.split("|"),s=Number(i[0]),a=Number(i[1]),n=initHandler(this,()=>{0==a?t.endHandler.run():mi.plot.showPlot(a,t.endHandler)});t.runHandler.args=[n],0==s?t.runHandler.run():mi.plot.showPlot(s,t.runHandler)}onSwitchMapFinish(){}onTaskTigger(){var e=this;be.IsOpenPanel()||e.isOpenTask&&(e.isOpenTask=!1,Ve.task.getTaskCondition(initHandler(e,t=>{e.isOpenTask=t},[!0])))}destroy(){super.destroy()}}class ui extends he{constructor(){super(),this.onActiveRefTime=10;Ye.add(this.onActiveRefTime,this,this.onEnterFrame)}onEnterFrame(e){cafe.mount.execute()}destroy(){Ye.remove(this,this.onEnterFrame)}}class pi extends he{constructor(){super(),this.isplotwork=!1,this.istalkwork=!1;this.list=[]}init(){}onClick(e){if(e<5)this.initTxt(e);else{this.tb.needCharmNum.split("|");this.initTxt(e)}}initTxt(e){}onframe(){let e=new Laya.Vector4(0,0,0,0);var t=Ve.game.curNpc.transform.position.clone(),i=new Laya.Vector3(t.x,t.y+1.8,t.z).clone();ea.scene.camera.viewport.project(i.clone(),ea.scene.camera.projectionViewMatrix,e)}destroy(){super.destroy()}}class mi{static init(e){switch(mi.drop=new It,mi.plot=new Nt,mi.task=new di(e),mi.device=new ft(e),mi.cmd=new ut,mi.active=new ct,mi.core=new gt(e),mi.bath=new dt(e),mi.mount=new ui,mi.chat=new pi,Ve.game.mission.missionType){case 1:mi.mission=new St(e);break;case 2:mi.mission=new Pt(e);break;case 3:mi.mission=new Mt(e)}}static destroy(){mi.drop.destroy(),mi.plot.destroy(),mi.task.destroy(),mi.core.destroy(),mi.mission.destroy(),mi.device.destroy(),mi.cmd.destroy(),mi.active.destroy(),mi.bath.destroy(),mi.chat.destroy()}}class gi extends Te{onRunHandler(e,t){be.closepanel(we.DropEquipPanel),ea.scene.GamePause=!1;var i=Ve.shop.maps[e.shopId];i.have?(Ue.show("由于已有该商品，将会把商品转换为相等价值的金币"),ea.scene.GamePause=!1,Ve.user.addGold(5e3,ea.scene.moneypos,null,()=>{i.equip||mi.device.currentMountGear||(Ve.shop.useEquip(e.shopId,e.addValue),ea.weapon.equipWeapon(Ve.shop.equip_weapon)),t&&t.runWith([1])})):(Ve.shop.noMoneyBuyShop(e.shopId),Je.createImg(e,new Laya.Point(870,500)),mi.device.currentMountGear||(Ve.shop.useEquip(e.shopId,e.addValue),ea.weapon.equipWeapon(Ve.shop.equip_weapon)),t&&t.runWith([1]))}unbin(){super.unbin()}}class yi{constructor(){this.dropreward=new qe,this.dropbuff=new Ze,this.dropequip=new gi}}class fi extends Te{onVideoRunHandler(e,t){this.owner;Lt.logStageLoad(1),Ve.user.addGold(3*t.tb.taskGold,null,null,()=>{be.closepanel(we.EndUpPanel),e&&e.runWith([1]),ea.scene.GamePause=!1,Ve.game.nextMission(!0),We.closescene(we.GameScene),We.openscene(we.HallScene).start()})}onNormalRunHandler(e,t){this.owner;Lt.logStageLoad(1),Ve.user.addGold(t.tb.taskGold,null,null,()=>{be.closepanel(we.EndUpPanel),e&&e.runWith([1]),ea.scene.GamePause=!1,Ve.game.nextMission(!0),We.closescene(we.GameScene),We.openscene(we.HallScene).start()})}unbin(){super.unbin()}}class _i extends Te{init(e){this.owner=e}onRunHandler(e){var t=this,i=t.owner;Lt.logStageLoad(1),Ve.user.addGold(6e3,i.moneypos,null,()=>{be.closepanel(we.EndWinPanel),ea.scene.GamePause=!1;var i=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(i.music),e&&e.runWith([1]),cafe.event.dispatch(ge.game.MAP_TRANSFER_POINT,i.mapEnter),t.owner.Hallhandler&&t.owner.Hallhandler.run()})}unbin(){super.unbin()}}class vi{constructor(){this.endWin=new _i,this.endUp=new fi}}class bi extends it{onEnable(){super.onEnable()}onDestroy(){super.onDestroy()}}class wi extends it{constructor(){super(),this.upAlpha=.5,this.downAlpha=1,this.range=50,this.is_click=!1,this.isPosDown=!1}onEnable(){let e=this;super.onEnable(),e.initUi(),e.monitor(wi.YG_LOCK,e.yglock),e.monitor(Laya.Event.RESIZE,e.onStageResize),e.monitor(se.ClOSEPANELHANDLE,()=>{e.onPanelStageResize(),e.isPosDown=!1})}yglock(e){this.is_click=e}setParams(e,t){this.NAME=e,this.upAlpha=t.upAlpha?t.upAlpha:.5,this.downAlpha=t.downAlpha?t.downAlpha:1,this.range=t.range*fe.minScale?t.range*fe.minScale:50*fe.minScale}onStageResize(){let e=this;wi.isOne&&(wi.initcenter_pos={x:e.owner.x,y:e.owner.y}),e.center_pos=wi.initcenter_pos,e.global_pos=e.owner.localToGlobal(new Laya.Point(e.owner.box_group.x,e.owner.box_group.y)),e.owner.sp_jack_point.x=e.owner.sp_jack_icon.x,e.owner.sp_jack_point.y=e.owner.sp_jack_icon.y,wi.isOne=!1}onPanelStageResize(){this.center_pos=wi.initcenter_pos,this.global_pos=this.owner.localToGlobal(new Laya.Point(this.owner.box_group.x,this.owner.box_group.y)),this.owner.sp_jack_point.x=this.owner.sp_jack_icon.x,this.owner.sp_jack_point.y=this.owner.sp_jack_icon.y,this.owner.x=this.center_pos.x,this.owner.y=this.center_pos.y}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_MOVE,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,Laya.stage),Ye.add(1,this,this.onYGRef),this.onStageResize()}onYGRef(){Ve.game.MonsterStop||ea.scene.isGameStop||ea.scene.GamePause||be.IsOpenPanel()||this.owner.sp_jack_point.x==this.owner.sp_jack_icon.x&&this.owner.sp_jack_point.y==this.owner.sp_jack_icon.y?cafe.event.dispatch(this.NAME+wi.POS_REF):this.isPosDown&&cafe.event.dispatch(this.NAME+wi.POS_REF,{center_pos:this.center_pos,pos:this.cur_pos})}onDistanceMouseHandler(e){let t=this;if(!be.IsOpenPanel()){if(t.is_click)return t.owner.sp_jack_point.x=t.owner.sp_jack_icon.x,void(t.owner.sp_jack_point.y=t.owner.sp_jack_icon.y);switch(e.type){case Laya.Event.MOUSE_DOWN:var i={x:e.stageX,y:e.stageY},s=Laya.stage.width/2,a=Laya.stage.height;i.x>=0&&i.x<=s&&i.y>=0&&i.y<=a&&(t.isPosDown=!0,t.isPosIndex=e.touchId,t.center_pos=i,t.owner.sp_jack_point.x=t.owner.sp_jack_icon.x,t.owner.sp_jack_point.y=t.owner.sp_jack_icon.y,t.owner.x=t.center_pos.x*fe.minS,t.owner.y=t.center_pos.y*fe.minS,t.global_pos=t.owner.localToGlobal(new Laya.Point(t.owner.box_group.x,t.owner.box_group.y)),t.cur_pos=i,t.owner.alpha=t.downAlpha);break;case Laya.Event.MOUSE_MOVE:if(t.isPosDown&&e.touchId==t.isPosIndex){i={x:(n=e).stageX,y:n.stageY};var n,o=getATBNextDistance(t.center_pos,i,t.range);t.owner.sp_jack_point.x=(o.x-t.global_pos.x)*fe.minS,t.owner.sp_jack_point.y=(o.y-t.global_pos.y)*fe.minS,t.cur_pos=o}break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.isPosDown&&e.touchId==t.isPosIndex&&(t.isPosDown=!1,t.isPosIndex=null,t.owner.sp_jack_point.x=t.owner.sp_jack_icon.x,t.owner.sp_jack_point.y=t.owner.sp_jack_icon.y,t.owner.alpha=t.upAlpha,t.center_pos=wi.initcenter_pos,t.owner.x=t.center_pos.x,t.owner.y=t.center_pos.y,cafe.event.dispatch(t.NAME+wi.POS_REF))}}}onDestroy(){super.onDestroy(),Ye.remove(this,this.onYGRef)}}wi.isOne=!0,wi.YG_LOCK="YG_LOCK",wi.POS_REF="MAIN_YG_POS_REF",wi.DIR_REF="MAIN_YG_DIR_REF";class Ti extends it{constructor(){super(),this.ro_angle=0,this.upAlpha=.5,this.downAlpha=1,this.is_click=!1,this.isDown=!1,this.isKey=!1,this.dir=0}onEnable(){this.initUi(),this.monitor(Ti.YG_LOCK,this.yglock),this.monitor(Laya.Event.RESIZE,this.onStageResize)}yglock(e){this.is_click=e}setParams(e){this.upAlpha=e.upAlpha?e.upAlpha:.5,this.downAlpha=e.downAlpha?e.downAlpha:1,this.owner.alpha=this.upAlpha}onStageResize(){this.owner.sp_jack_icon.x=this.owner.width>>1,this.owner.sp_jack_icon.y=this.owner.height>>1,this.center_pos=new Laya.Point(this.owner.sp_jack_icon.x,this.owner.sp_jack_icon.y)}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner),this.layaMonitor(Laya.Event.MOUSE_MOVE,this.onDistanceMouseHandler,this.owner),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyA",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyA",this.onKeyUpHandler),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyD",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyD",this.onKeyUpHandler),this.onStageResize()}onKeyDownHandler(e){switch(this.isKey=!0,null==this.cur_angle&&(this.cur_angle=0),e.key){case"runKeyA":this.dir=1;break;case"runKeyD":this.dir=2}}onKeyUpHandler(e){this.isKey=!1}onUpdate(){if(ea.scene.isGameStop||ea.scene.GamePause)cafe.event.dispatch(Ti.YG_REF);else{if(this.isKey){if(0==this.dir)return;return 1==this.dir&&this.ro_angle>0?this.ro_angle=0:2==this.dir&&this.ro_angle<0&&(this.ro_angle=0),this.ro_angle-=1==this.dir?10:-10,this.ro_angle<-540?this.ro_angle=-540:this.ro_angle>540&&(this.ro_angle=540),void cafe.event.dispatch(Ti.YG_REF,{dir_angle:this.ro_angle})}if(this.isDown&&this.mousePos&&null!=this.cur_angle){var e=calcPosAngle(this.center_pos,{x:this.mousePos.x,y:this.mousePos.y},!0),t=this.cur_angle-e;t>90?t=this.cur_angle-(360+e):t<-90&&(t=this.cur_angle-(-360+e)),this.ro_angle-=t,this.ro_angle<-540?this.ro_angle=-540:this.ro_angle>540&&(this.ro_angle=540),this.owner.sp_jack_point.rotation=this.ro_angle,this.cur_angle=e,cafe.event.dispatch(Ti.YG_REF,{dir_angle:this.ro_angle})}else 0!=this.owner.sp_jack_point.rotation&&(this.ro_angle+=(0-this.ro_angle)/28,this.owner.sp_jack_point.rotation=Math.round(this.ro_angle),cafe.event.dispatch(Ti.YG_REF,{dir_angle:Math.round(this.ro_angle)}))}}onDistanceMouseHandler(e){let t=this;if(t.is_click)t.owner.sp_jack_point.rotation=t.ro_angle;else switch(e.type){case Laya.Event.MOUSE_DOWN:t.isDown=!0,t.mousePos={x:e.target.mouseX,y:e.target.mouseY};var i=calcPosAngle(t.center_pos,{x:t.mousePos.x,y:t.mousePos.y},!0);t.cur_angle=i,t.owner.alpha=t.downAlpha;break;case Laya.Event.MOUSE_MOVE:if(!t.isDown)return;t.mousePos={x:e.target.mouseX,y:e.target.mouseY};break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.isDown=!1,t.mousePos=null,t.cur_angle=null,t.owner.alpha=t.upAlpha}}onDestroy(){super.onDestroy()}}Ti.YG_LOCK="YG_DIR_LOCK",Ti.YG_REF="YG_DIR_REF";class Ai extends it{constructor(){super(),this.isDirDown=!1}onEnable(){this.initUi(),this.monitor(Laya.Event.RESIZE,this.onStageResize)}setParams(e,t){this.NAME=e}onStageResize(){this.dircenter_pos=new Laya.Point(fe.width/2,fe.height/2)}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_MOVE,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,Laya.stage),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,Laya.stage),this.onStageResize()}onUpdate(){if(ea.scene.isGameStop||ea.scene.GamePause||be.IsOpenPanel())cafe.event.dispatch(this.NAME+Ai.DIR_REF);else if(this.isDirDown&&this.dircur_pos&&this.dircur_pos!=this.dirCurrCenter_pos){if(ea.scene.isOpenTask)return;getDistance(this.dircur_pos,this.dirCurrCenter_pos)>=4&&(cafe.event.dispatch(this.NAME+Ai.DIR_REF,{center_pos:this.dirCurrCenter_pos,pos:this.dircur_pos}),this.dirCurrCenter_pos=this.dircur_pos,this.dircur_pos=null)}}onDistanceMouseHandler(e){let t=this;if(e.target instanceof Laya.Button&&e.type==Laya.Event.MOUSE_UP&&e.type==Laya.Event.MOUSE_OUT&&be.IsOpenPanel())t.isDirDown&&e.touchId==t.isDirIndex&&(t.isDirDown=!1,t.isDirIndex=null,cafe.event.dispatch(t.NAME+Ai.DIR_REF));else if(!ea.scene.isGuide)switch(e.type){case Laya.Event.MOUSE_DOWN:var i={x:e.stageX,y:e.stageY},s=Laya.stage.width/2,a=Laya.stage.width,n=Laya.stage.height;i.x>=s&&i.x<=a&&i.y>=0&&i.y<=n&&(t.isDirDown=!0,t.isDirIndex=e.touchId,t.dirCurrCenter_pos=i,t.dircur_pos=i);break;case Laya.Event.MOUSE_MOVE:if(t.isDirDown&&e.touchId==t.isDirIndex){var o=e;i={x:o.stageX,y:o.stageY};t.dircur_pos=i}break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.isDirDown&&e.touchId==t.isDirIndex&&(t.isDirDown=!1,t.isDirIndex=null,cafe.event.dispatch(t.NAME+Ai.DIR_REF))}}onDestroy(){super.onDestroy()}}Ai.DIR_REF="CAMERA_DIR_REF";class xi{}xi.GLOW="CUSTOM_SHADER_GLOW",xi.MULTIPLEPASSOUTLINE="CUSTOM_SHADER_MULTIPLEPASSOUTLINE",xi.BLUREFFECT="CUSTOM_SHADER_BLUREFFECT";class ki extends Laya.Material{constructor(e,t){super(),this.setShaderName(xi.BLUREFFECT),this.texelSize=new Laya.Vector4,this.doSamplevalue=0,this._shaderValues.setNumber(ki.SHADERVALUE_DOWNSAMPLEVALUE,t),this._shaderValues.setVector(ki.SHADERVALUE_TEXELSIZE,e)}sourceTexture(e,t){this._shaderValues.setTexture(ki.SHADERVALUE_SOURCETEXTURE0,e),this._shaderValues.setTexture(ki.ShADERVALUE_SOURCETEXTURE1,t)}}ki.SHADERVALUE_MAINTEX=Laya.Shader3D.propertyNameToID("u_MainTex"),ki.SHADERVALUE_TEXELSIZE=Laya.Shader3D.propertyNameToID("u_MainTex_TexelSize"),ki.SHADERVALUE_DOWNSAMPLEVALUE=Laya.Shader3D.propertyNameToID("u_DownSampleValue"),ki.SHADERVALUE_SOURCETEXTURE0=Laya.Shader3D.propertyNameToID("u_sourceTexture0"),ki.ShADERVALUE_SOURCETEXTURE1=Laya.Shader3D.propertyNameToID("u_sourceTexture1");class Ei{}Ei.MoveAction="MoveAction",Ei.CarMoveAction="CarMoveAction",Ei.GravityAction="GravityAction";class Ii extends it{constructor(){super(),this.cameraDistance=10,this.maxMuline=100,this.muline=0,this.cameraEventFlag=Laya.CameraEventFlags.BeforeImageEffect,this.cameraType=1,this.isInit=!1,this.isPlayering=!1,this.isPlot=!1,this.isGlobalCamera=!1,this.cameraTweenSpeed=8,this.carCameraTweenSpeed=16,this.cameraYTweenSpeed=1,this.cameraRunTweenSpeed=4,this.iszhendong=!1}onEnable(){this.cameraTranslate=new Laya.Vector3,this.playYGroup=new Laya.Sprite3D("cameraYGroup"),this.playXGroup=new Laya.Sprite3D("cameraXGroup"),this.playZGroup=new Laya.Sprite3D("cameraZGroup"),this.distanceCameraSprite=new Laya.Sprite3D("distanceCameraSp"),this.runCameraSprite=new Laya.Sprite3D("runCameraSp"),this.unlitMaterial=new Laya.UnlitMaterial,this.unlitMaterial.albedoColor=new Laya.Vector4(255,0,0,255),this.renders=[],this.lookPos=new Laya.Vector3(0,4,0),this.monitor(Ii.GAME_START_FOG_START,this.showFog),this.monitor(Ii.GAME_CAMERA_SWITCH,this.switchCamera)}triggerEnter(e){var t=e.owner;return!!t&&(-1!=t.name.indexOf("Cube")||(-1!=t.name.indexOf("Sand_01")||-1!=t.name.indexOf("Water")))}clearCamera(){var e=Ve.map.cameraThings;for(var t in e){var i=e[t];i&&i.transform&&null!=i.numChildren&&(i.numChildren>0&&this.updateActiveCamera(),i.parent&&(i.removeSelf(),i.destroy(),i=null),delete e[t])}}cameraFlash(){}zhengDong(){var e=this,t=e.playZGroup.transform;if(t&&!e.iszhendong){var i=e.playZGroup.transform.localPosition.clone().x,s=e.playZGroup.transform.localPosition.clone().y,a=e.playZGroup.transform.localPosition.clone().z;e.iszhendong=!0,Laya.Tween.to(t,{localPositionX:i+.3,localPositionY:s+.3,lolocalPositionZ:a+.3},20,null,initHandler(e,()=>{Laya.Tween.to(t,{localPositionX:i,localPositionY:s,lolocalPositionZ:a},20,null,initHandler(e,()=>{Laya.Tween.to(t,{localPositionX:i-.3,localPositionY:s-.3,lolocalPositionZ:a-.3},20,null,initHandler(e,()=>{Laya.Tween.to(t,{localPositionX:i,localPositionY:s,lolocalPositionZ:a},20,null,initHandler(e,()=>{Laya.Tween.clearAll(t),e.iszhendong=!1}))}))}))}))}}setCamera(e){let t=this;if(console.log("初始化摄像机2"),ea.scene.camera=e,t.isGlobalCamera=!1,Laya.Material.load("res/res3D/Assets/Mesh/BG/"+Ve.map.map.skymat,initHandler(this,function(t){e.clearFlag=Laya.CameraClearFlags.Sky;var i=e.skyRenderer;i.mesh=Laya.SkyBox.instance,i.material=t})),ea.scene.camera.useOcclusionCulling=!0,ea.scene.mainscene&&(ea.scene.mainscene.addChild(t.playXGroup),t.playXGroup.addChild(t.playYGroup),t.playYGroup.addChild(t.playZGroup),t.playZGroup.addChild(t.distanceCameraSprite),t.playZGroup.addChild(t.runCameraSprite),ea.scene.isControlDebug)){var i=t.playXGroup.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,1)));(s=new Laya.BlinnPhongMaterial).albedoColor=new Laya.Vector4(1,0,0,1),Laya.Texture2D.load("res/layabox.png",initHandler(null,function(e){s.albedoTexture=e})),i.meshRenderer.material=s;i=t.playYGroup.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,1,.1)));(s=new Laya.BlinnPhongMaterial).albedoColor=new Laya.Vector4(0,1,0,1),Laya.Texture2D.load("res/layabox.png",initHandler(null,function(e){s.albedoTexture=e})),i.meshRenderer.material=s;var s;i=t.playZGroup.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(1,.1,.1)));(s=new Laya.BlinnPhongMaterial).albedoColor=new Laya.Vector4(0,0,1,1),Laya.Texture2D.load("res/layabox.png",initHandler(null,function(e){s.albedoTexture=e})),i.meshRenderer.material=s}e.farPlane=2e3,3==Ve.game.MaoMaoGameType&&(e.fieldOfView=35),8==Ve.map.map.gamePkType&&(e.fieldOfView=95),t.tween=new Laya.Tween,slog("localPositionX"+ea.scene.camera.transform.localPositionX),slog("localPositionY"+ea.scene.camera.transform.localPositionY),slog("localPositionZ"+ea.scene.camera.transform.localPositionZ),slog("localRotationEulerX"+ea.scene.camera.transform.localRotationEulerX),slog("localRotationEulerY"+ea.scene.camera.transform.localRotationEulerY),slog("localRotationEulerZ"+ea.scene.camera.transform.localRotationEulerZ),ea.scene.cameraCode=t,console.log("摄像机初始化完成"),t.owner.frameLoop(1,t,t.onFollowPlayer)}addMode(e){this.maxMuline<=this.muline||e&&this.addModeRender(e.skinnedMeshRenderer,this.unlitMaterial)}addModeRender(e,t){-1==this.renders.indexOf(e)&&(this.commandBuffer&&(ea.scene.camera.removeCommandBuffer(this.cameraEventFlag,this.commandBuffer),Laya.RenderTexture.recoverToPool(this.renderTexture),Laya.RenderTexture.recoverToPool(this.subRendertexture),Laya.RenderTexture.recoverToPool(this.downRenderTexture),Laya.RenderTexture.recoverToPool(this.blurTexture)),this.renders.push(e),this.commandBuffer=this.createDrawMeshCommandBuffer(ea.scene.camera,this.renders),this.muline++,ea.scene.camera.addCommandBuffer(this.cameraEventFlag,this.commandBuffer))}removeMode(e){e&&this.disableRenderModer(e.skinnedMeshRenderer)}disableRenderModer(e){var t=this.renders.indexOf(e);-1!=t&&(ea.scene.camera.removeCommandBuffer(this.cameraEventFlag,this.commandBuffer),Laya.RenderTexture.recoverToPool(this.renderTexture),Laya.RenderTexture.recoverToPool(this.subRendertexture),Laya.RenderTexture.recoverToPool(this.downRenderTexture),Laya.RenderTexture.recoverToPool(this.blurTexture),this.renders.splice(t,1),this.renders.length>0&&(this.commandBuffer=this.createDrawMeshCommandBuffer(ea.scene.camera,this.renders),ea.scene.camera.addCommandBuffer(this.cameraEventFlag,this.commandBuffer)),this.muline--)}showFog(){Laya.Tween.to(ea.scene.mainscene,{fogStart:10},5e3,Laya.Ease.strongOut,initHandler(this,()=>{Laya.Tween.clearTween(ea.scene.mainscene)}))}switchCamera(){switch(this.cameraType++,this.cameraType>Ii.THREEPLAY45D&&(this.cameraType=Ii.ZEROPLAY),this.cameraType){case Ii.ONEPLAY:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initOnePlay());break;case Ii.ONEPLAY2:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initOnePlay2());break;case Ii.THREEPLAY:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initThreePlay())}}updateActiveCamera(e){switch(null!=e&&(this.cameraType=e),this.isGlobalCamera=!1,this.isPlot=!1,this.cameraType>Ii.THREEPLAY45D&&(this.cameraType=Ii.ZEROPLAY),this.cameraType){case Ii.ONEPLAY:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initOnePlay());break;case Ii.ONEPLAY2:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initOnePlay2());break;case Ii.THREEPLAY:ea.scene.camera.parent!=ea.scene.mainscene&&(ea.scene.mainscene.addChild(ea.scene.camera),this.initThreePlay())}}setGlobalCamera(e=new Laya.Vector3(0,0,0)){this.isGlobalCamera=!0;var t=Ve.map.cameraThings[ye.CAMERA_GLOBAL];t!=ea.scene.camera.parent&&(t.addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=e,ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,0,0))}setLockCameraTarget(e){if(this.isGlobalCamera){var t=Ve.map.cameraThings[ye.CAMERA_GLOBAL];t.transform.localPosition=e.transform.localPosition.clone();var i=a.furniture.getTbByModId(e.tb.configId);t.transform.localRotationEulerY=i.range,ea.scene.camera.transform.localPositionZ=i.distance}}setPrePlotGroup(e){this.plotGroup=e}setPlotCamera(){this.isPlot=!0,this.plotGroup!=ea.scene.camera.parent&&(this.plotGroup.addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=new Laya.Vector3(0,0,0),ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,180,0))}onFollowPlayer(){let e=this;if(!e.isGlobalCamera&&!e.isPlot&&e.lockTarget&&ea.scene.camera&&ea.scene.camera.transform&&!e.isPlayering)switch(e.cameraType){case Ii.ZEROPLAY:e.zeroPlay();break;case Ii.ONEPLAY:e.onePlay();break;case Ii.ONEPLAY2:0==Ve.game.carmove_camera?mi.device.currentMountGear&&70062==mi.device.currentMountGear.tbId||70013==mi.device.currentMountGear.tbId?e.oneCar2():e.oneCar1():e.onePlay3();break;case Ii.THREEPLAY:e.threePlay();break;case Ii.THREEPLAY45D:e.threePlay45d()}}oneCar1(){if(mi.device.currentMountGear&&6==mi.device.currentMountGear.tb.deviceType)return;var e=ea.scene.player.action.getAct(Ei.MoveAction);let t=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;var i=this.lockTarget.transform;if(i){var s=this.lockTarget.transform,a=(t.cameraDistance,t.cameraHieght),n=this.playXGroup.transform,o=t.cameratween,r=(Ve.map.map&&Ve.map.map.scale,Qe.getPosToBackwardPos(i,0,!1)),l=Qe.getPosToBackwardPos2(s,0,!1),h=n.position.x,c=n.position.y,d=n.position.z;h+=(r.x-n.position.x)/o,c+=(l.y+a-n.position.y)/o,d+=(r.y-n.position.z)/o,this.endRoY=e.ownerRoY,this.currRoY+=(this.endRoY-this.currRoY)/this.carCameraTweenSpeed,n.localRotationEuler=new Laya.Vector3(0,this.currRoY,0),this.lookPos.setValue(h,c,d),n.position=this.lookPos}}oneCar2(){if(mi.device.currentMountGear&&6==mi.device.currentMountGear.tb.deviceType)return;var e=ea.scene.player.action.getAct(Ei.MoveAction);let t=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;var i=Xe.getBody(this.lockTarget,"pao").transform;if(i){var s=this.lockTarget.transform,a=(t.cameraDistance,t.cameraHieght),n=this.playXGroup.transform,o=t.cameratween,r=(Ve.map.map&&Ve.map.map.scale,Qe.getPosToBackwardPos(i,0,!1)),l=Qe.getPosToBackwardPos2(s,0,!1),h=n.position.x,c=n.position.y,d=n.position.z;h+=(r.x-n.position.x)/o,c+=(l.y+a-n.position.y)/o,d+=(r.y-n.position.z)/o,this.endRoY=e.ownerRoY,this.currRoY+=(this.endRoY-this.currRoY)/this.carCameraTweenSpeed,n.localPositionY=this.currRoY,this.lookPos.setValue(h,c,d),n.position=this.lookPos}}zeroPlay(){}threePlay45d(){}initCameraPlay(){if(this.lockTarget&&ea.scene.camera&&ea.scene.camera.transform){switch(this.cameraType){case Ii.ONEPLAY:this.initOnePlay();break;case Ii.ONEPLAY2:this.initOnePlay2();break;case Ii.ONEPLAY3:this.initOnePlay3();break;case Ii.THREEPLAY:this.initThreePlay()}Lt.logStageLoad(2),cafe.event.dispatch(se.GAME_CAMERA_INIT_REF),slog("初始化摄像机完成")}}rotateCamera(e,t){ea.scene.camera.parent,this.playZGroup}initOnePlay(){var e=["0","0","0"];let t=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;var i=t.cameraDistance,s=t.cameraHieght,a=t.cameraRoX,n=Ve.map.map?Ve.map.map.scale:1;ea.scene.camera.parent!=this.playZGroup&&(this.playZGroup.addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=new Laya.Vector3(0,0,(Number(e[0])+i)*n),ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,0,0));var o=this.lockTarget.transform,r=this.playXGroup.transform,l=Qe.getPosToBackwardPos(o,0,!1);this.lookPos.setValue(l.x,(Number(e[1])+s)*n,l.y),this.posY=this.playXGroup.transform.position.y;var h=o.rotationEuler.y-180;r.localRotationEuler=new Laya.Vector3(0,h,0),this.playXGroup.transform.localRotationEuler=new Laya.Vector3(Number(e[2])+a,0,0),r.position=this.lookPos}initOnePlay2(e){if(this.lockTarget){var t=["0","0","0"];e||(e=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb),this.cameraTweenSpeed=e.cameratween;var i=e.cameraDistance,s=e.cameraRoX,a=e.cameraRoX;if(5==Ve.map.map.gamePkType&&(i=1.8*e.cameraDistance,s=1.5*e.cameraHieght),6==Ve.map.map.gamePkType&&(i=1.5*e.cameraDistance,s=1.2*e.cameraHieght),Ve.game.issmall&&(i=.6*e.cameraDistance,s=.3*e.cameraHieght),Ve.game.isbig&&(i=1.8*e.cameraDistance,s=1.5*e.cameraHieght),3==Ve.game.MaoMaoGameType){i=1.8*e.cameraDistance,s=1.5*e.cameraHieght;a=0}1==Ve.map.map.gamePkType&&(i*=1.8,s=.8*e.cameraHieght),Ve.map.map.gamePkType;var n=Ve.map.map?Ve.map.map.scale:1;ea.scene.camera.parent!=this.playXGroup&&this.playZGroup.addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=new Laya.Vector3(0,0,-(Number(t[0])+i)*n),this.runCameraSprite.transform.localPosition=new Laya.Vector3(0,0,-(Number(t[0])+i)*n),this.distanceCameraSprite.transform.localPosition=new Laya.Vector3(0,0,-(Number(t[0])+i)*n),ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,-180,0);var o=this.lockTarget.transform,r=Qe.getPosToBackwardPos(o,0,!1),l=this.playXGroup.transform;this.lookPos.setValue(r.x,(Number(t[1])+s)*n,r.y),this.posY=this.playXGroup.transform.position.y,this.playYGroup.transform.localRotationEuler=new Laya.Vector3(Number(t[2])+a,0,0),l.position=this.lookPos}}initOnePlay3(){var e=["0","0","0"];let t=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;var i=t.cameraDistance,s=(t.cameraHieght,t.cameraRoX),a=Ve.map.map?Ve.map.map.scale:1;ea.scene.camera.parent!=this.playXGroup&&this.playXGroup.addChild(ea.scene.camera),ea.scene.camera.transform.localPosition=new Laya.Vector3(0,0,(Number(e[0])+i+2.8)*a),ea.scene.camera.transform.localRotationEuler=new Laya.Vector3(0,0,0);var n=this.lockTarget.transform,o=Qe.getPosToBackwardPos(n,0,!1),r=this.playXGroup.transform;this.lookPos.setValue(o.x,(Number(e[1])+3)*a,o.y),this.posY=this.playXGroup.transform.position.y;var l=n.rotationEuler.y-180;r.localRotationEuler=new Laya.Vector3(0,l,0),this.playYGroup.transform.localRotationEuler=new Laya.Vector3(Number(e[2])+s,0,0),r.position=this.lookPos}initThreePlay(){var e=this.lockTarget.transform,t=ea.scene.camera.transform,i=Ve.map.map?Ve.map.map.scale:1,s=Qe.getPosToBackwardPos(e,1*i,!1);this.lookPos.setValue(s.x,(Number("0")+10)*i,s.y),this.posY=this.playXGroup.transform.position.y;var a=e.rotationEuler.y-180;t.localRotationEuler=new Laya.Vector3(-90,a,0),t.position=this.lookPos}onePlay(){var e=this.lockTarget.transform,t=this.playXGroup.transform,i=Ve.map.map?Ve.map.map.scale:1;let s=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;s.cameraDistance;var a=s.cameraHieght,n=(s.cameraRoX,Qe.getPosToBackwardPos(e,0,!1)),o=t.position.x,r=t.position.z;o+=(n.x-t.position.x)/this.cameraTweenSpeed,r+=(n.y-t.position.z)/this.cameraTweenSpeed,this.lookPos.setValue(o,(Number("0")+a)*i,r);var l=e.rotationEuler.y-180,h=t.localRotationEuler.y;l<=-270&&h>=-90?h=-360+h:h<=-270&&l>=-90&&(h=360+h),h+=(l-h)/this.cameraTweenSpeed,t.localRotationEuler=new Laya.Vector3(0,h,0),t.position=this.lookPos}onePlay2(){var e=this.lockTarget.transform;let t=mi.device.currentMountGear?mi.device.currentMountGear.tb:ea.scene.player.info.tb;t.cameraDistance;var i=t.cameraHieght,s=(t.cameraRoX,this.playXGroup.transform),a=Ve.map.map?Ve.map.map.scale:1,n=Qe.getPosToBackwardPos(e,0,!1),o=s.position.x,r=s.position.z;o+=(n.x-s.position.x)/this.cameraTweenSpeed,r+=(n.y-s.position.z)/this.cameraTweenSpeed,this.lookPos.setValue(o,(Number("0")+i)*a,r);var l=e.rotationEuler.y-180,h=s.localRotationEuler.y;l<=-270&&h>=-90?h=-360+h:h<=-270&&l>=-90&&(h=360+h),h+=(l-h)/this.cameraTweenSpeed,s.localRotationEuler=new Laya.Vector3(0,h,0),s.position=this.lookPos}onePlay3(){let e=this;if(mi.device.currentMountGear&&6==mi.device.currentMountGear.tb.deviceType)return;if(0==Ve.game.carmove_camera)return;if(!ea.scene.player)return;let t;if(mi.device.currentMountGear?t=mi.device.currentMountGear.tb:ea.scene.player&&ea.scene.player.info&&(t=ea.scene.player.info.tb),t){var i=e.lockTarget.transform;if(i){var s=e.lockTarget.transform,a=(t.cameraDistance,t.cameraHieght);Ve.game.issmall&&0==Ve.game.MaoMaoGameType&&(.6*t.cameraDistance,a=.3*t.cameraHieght),Ve.game.isbig&&0==Ve.game.MaoMaoGameType&&(1.8*t.cameraDistance,a=1.5*t.cameraHieght);var n=e.playXGroup.transform,o=(Ve.map.map&&Ve.map.map.scale,Qe.getPosToBackwardPos(i,0,!1)),r=Qe.getPosToBackwardPos2(s,0,!1),l=n.position.x,h=n.position.y,c=n.position.z;l+=(o.x-n.position.x)/e.cameraTweenSpeed,h+=(r.y+a-n.position.y)/e.cameraYTweenSpeed,c+=(o.y-n.position.z)/e.cameraTweenSpeed,e.lookPos.setValue(l,h,c),n.position=e.lookPos;var d=e.lookPos.clone(),u=e.distanceCameraSprite.transform.position.clone(),p=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(d,u,p)){for(var m,g=10,y=0;y<p.length;y++){var f=p[y];if("saveCube"!=f.collider.owner.name){var _=f.collider.owner,v=f.collider.owner.name;if(_.main&&(_=_.main),_!=e.lockTarget&&!(_&&_.thingId&&37388==_.thingId||_&&_.thingId&&37389==_.thingId||"Cube"==v&&f.collider.owner.main&&37212==f.collider.owner.main.thingId||"undevice"==v||"umove_hit"==v||"group_uninstall"==v||"body"==v||"group_move"==v||"group_checkhit"==v||"move_hit"==v||"group_hit"==v||"dmove_hit"==v||"attack_hit"==v)){var b=Qe.getDistanceByPos(d,f.point);g>b&&(g=b,m=f.point.clone())}}}e.runCameraSprite.transform.position=m?m.clone():u.clone()}else e.runCameraSprite.transform.position=u.clone();var w=e.runCameraSprite.transform.localPosition,T=ea.scene.camera.transform,A=T.localPosition.z;A+=(w.z+1-A)/e.cameraRunTweenSpeed,8!=Ve.map.map.gamePkType&&1!=Ve.map.map.gamePkType&&(T.localPositionZ=Math.round(1e3*A)/1e3),1==Ve.map.map.gamePkType?(e.playXGroup.transform.localRotationEuler=new Laya.Vector3(0,180,0),e.playYGroup.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.playZGroup.transform.localRotationEuler=new Laya.Vector3(0,0,0)):8==Ve.map.map.gamePkType&&(e.playXGroup.transform.localRotationEuler=new Laya.Vector3(90,180,0),e.playYGroup.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.playZGroup.transform.localRotationEuler=new Laya.Vector3(0,0,0))}}}threePlay(){var e=this.lockTarget.transform,t=ea.scene.camera.transform,i=Ve.map.map?Ve.map.map.scale:1,s=Qe.getPosToBackwardPos(e,1*i,!1),a=t.position.x,n=t.position.z;a+=(s.x-t.position.x)/this.cameraTweenSpeed,n+=(s.y-t.position.z)/this.cameraTweenSpeed,this.lookPos.setValue(a,(Number("0")+10)*i,n);var o=e.rotationEuler.y-180,r=t.localRotationEuler.y;o<=-270&&r>=-90?r=-360+r:r<=-270&&o>=-90&&(r=360+r),r+=(o-r)/this.cameraTweenSpeed,t.localRotationEuler=new Laya.Vector3(-90,r,0),t.position=this.lookPos}createDrawMeshCommandBuffer(e,t){var i=new Laya.CommandBuffer;e.enableBuiltInRenderTexture=!0;var s=e.viewport;this.renderTexture=Laya.RenderTexture.createFromPool(s.width,s.height,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_NONE),i.setRenderTarget(this.renderTexture),i.clearRenderTarget(!0,!1,new Laya.Vector4(0,0,0,0));for(var a=0,n=t.length;a<n;a++)i.drawRender(t[a],this.unlitMaterial,0);this.subRendertexture=Laya.RenderTexture.createFromPool(s.width,s.height,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_NONE),i.blitScreenQuad(this.renderTexture,this.subRendertexture);var o=s.width/2,r=s.height/2,l=new Laya.Vector4(1/s.width,1/s.height,s.width,r),h=new ki(l,1);return this.downRenderTexture=Laya.RenderTexture.createFromPool(o,r,Laya.RenderTextureFormat.R8G8B8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_NONE),i.blitScreenQuadByMaterial(this.renderTexture,this.downRenderTexture,null,h,0),this.blurTexture=Laya.RenderTexture.createFromPool(o,r,Laya.RenderTextureFormat.R8G8B8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_NONE),this.blurTexture.filterMode=Laya.FilterMode.Bilinear,i.blitScreenQuadByMaterial(this.downRenderTexture,this.blurTexture,null,h,1),i.blitScreenQuadByMaterial(this.blurTexture,this.downRenderTexture,null,h,2),i.blitScreenQuadByMaterial(this.downRenderTexture,this.blurTexture,null,h,1),i.blitScreenQuadByMaterial(this.blurTexture,this.downRenderTexture,null,h,2),i.setShaderDataTexture(h._shaderValues,ki.SHADERVALUE_SOURCETEXTURE0,this.downRenderTexture),i.setShaderDataTexture(h._shaderValues,ki.ShADERVALUE_SOURCETEXTURE1,this.subRendertexture),i.blitScreenQuadByMaterial(this.blurTexture,this.renderTexture,null,h,3),i.setShaderDataTexture(h._shaderValues,ki.SHADERVALUE_SOURCETEXTURE0,this.renderTexture),i.blitScreenQuadByMaterial(null,this.subRendertexture,null,h,4),i.blitScreenQuadByMaterial(this.subRendertexture,null),i}onDestroy(){super.onDestroy(),this.tween&&this.tween.clear(),Laya.Tween.clearTween(ea.scene.mainscene),ea.scene.camera&&ea.scene.camera.parent&&ea.scene.camera.removeSelf()}}Ii.GAME_START_FOG_START="GAME_START_FOG_START",Ii.GAME_CAMERA_SWITCH="GAME_CAMERA_SWITCH",Ii.ZEROPLAY=0,Ii.ONEPLAY=1,Ii.ONEPLAY2=2,Ii.ONEPLAY3=5,Ii.THREEPLAY=3,Ii.THREEPLAY45D=4;class Ci extends Laya.Script3D{constructor(){super(),this.isHit=!1,this.isTrigger=!1;this.kinematics=[],cafe.event.on(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}onGameBodyDieHandler(e){var t=this.kinematics.indexOf(e);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1))}onTriggerEnter(e){this.isHit=!0,-1==this.kinematics.indexOf(e.owner)&&this.isEnter&&this.isEnter(e)&&(this.kinematics.push(e.owner),this.isTrigger=!0);var t=e.owner;this.PlayerTriggerAction(t),this.handler&&this.handler.runWith([e])}PlayerTriggerAction(e){this.owner&&this.owner.main&&"player"==this.owner.main.name&&e.main&&e.main.tb.destroyType&&2==e.main.tb.destroyType&&1==Ve.map.map.gamePkType&&(i.read("firstSkill")||i.save("firstSkill","1"),"1"!=i.read("firstSkill")||ea.scene.ui.firstSkill.visible||(ea.scene.ui.firstSkill.visible=!0))}onTriggerStay(e){this.prohandler&&this.prohandler.runWith([e])}delTrigger(e){if(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];i.main!=e&&i!=e||(this.kinematics.splice(t,1),t--)}this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1)}}onTriggerExit(e){var t=this.kinematics.indexOf(e.owner);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1)),this.isHit=!1,this.exithandler&&this.exithandler.runWith([e]);var s=e.owner;s.main&&s.main.tb.destroyType&&2==s.main.tb.destroyType&&"1"==i.read("firstSkill")&&ea.scene.ui.firstSkill.visible&&(ea.scene.ui.firstSkill.visible=!1)}onDestroy(){super.onDestroy();cafe.event.off(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}}class Li{static showManTipText(e,t){if(null==t)return;var i=Li;let s=e.clone(),a=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(s,ea.scene.camera.projectionViewMatrix,a);var n=new Laya.FontClip("res/font/fontRed.png","0123456789");n.value=t.toString(),n.scaleX=.3,n.scaleY=.3;var o=new Laya.Box;if(_e.getLayer(1).addChild(o),o.addChild(n),n.centerY=0,n.centerX=0,o.anchorX=.5,o.anchorY=.5,a.w>=0){o.visible=!0,o.pos(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),o.alpha=1,o.y=a.y-200;Laya.Tween.clearTween(o),Laya.Tween.to(o,{alpha:1,y:a.y-200},0,null,initHandler(i,()=>{Laya.Tween.clearTween(o),Laya.Tween.clearTween(o),Laya.Tween.to(o,{y:a.y-500,alpha:0},1200,null,initHandler(i,()=>{Laya.Tween.clearTween(o),o.removeSelf(),o.removeSelf()}),300)}))}else o.visible=!1}static BoomJinqiuShow(e,t){var i=Li;let s=e.clone();s.y+=1;let a=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(s,ea.scene.camera.projectionViewMatrix,a);var n=new Laya.Image("res/icon/boom/1010.png"),o=new Laya.Box;if(_e.getLayer(1).addChild(o),o.addChild(n),n.anchorX=.5,n.anchorY=.5,a.w>=0){o.visible=!0,o.pos(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),n.alpha=.1,n.scaleX=.1*t,n.scaleY=.1*t;Laya.Tween.clearTween(n),Laya.Tween.to(n,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.to(n,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.to(n,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.to(n,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.to(n,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.to(n,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(n),Laya.Tween.clearTween(n),Laya.Tween.to(n,{scaleX:2*t,scaleY:2*t,alpha:0},80,null,initHandler(i,()=>{Laya.Tween.clearTween(n),n.removeSelf(),o.removeSelf()}),300)}))}))}))}))}))}))}else o.visible=!1}static showTipText(e,t){if(null==t)return;var i=Li;let s=e.clone(),a=new Laya.Vector4(0,0,0,0);var n;ea.scene.camera.viewport.project(s,ea.scene.camera.projectionViewMatrix,a),(n=t>=200?new Laya.FontClip("res/font/fontOr.png","0123456789"):new Laya.FontClip("res/font/fontBlue.png","0123456789")).value=t.toString(),n.scaleX=.7,n.scaleY=.7;var o=new Laya.Box;_e.getLayer(1).addChild(o),o.addChild(n),n.centerY=0,n.centerX=0,o.anchorX=.5,o.anchorY=.5;var r=Math.floor(180*Math.random())-90;if(a.w>=0){o.visible=!0,o.pos(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),o.alpha=1,o.y=a.y-200,o.rotation=r;var l=r/90*300;Laya.Tween.clearTween(o),Laya.Tween.to(o,{alpha:1,y:a.y-200},200,null,initHandler(i,()=>{Laya.Tween.clearTween(o),Laya.Tween.clearTween(o),Laya.Tween.to(o,{y:a.y-500,alpha:0,x:a.x+l},1200,null,initHandler(i,()=>{Laya.Tween.clearTween(o),o.removeSelf(),o.removeSelf()}),300)}))}else o.visible=!1}static BoomShow(e,t){var i=Li;let s=e.clone();s.y+=1;let a=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(s,ea.scene.camera.projectionViewMatrix,a);var n=[1001,1002,1003,1004,1005,1006,1007,1008],o=Math.round(Math.random()*(n.length-1)),r=new Laya.Image("res/icon/boom/"+n[o]+".png"),l=new Laya.Box;if(_e.getLayer(1).addChild(l),l.addChild(r),r.anchorX=.5,r.anchorY=.5,a.w>=0){l.visible=!0,l.pos(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),r.alpha=.1,r.scaleX=.1*t,r.scaleY=.1*t;Laya.Tween.clearTween(r),Laya.Tween.to(r,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.to(r,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.to(r,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.to(r,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.to(r,{alpha:1,scaleX:1.2*t,scaleY:1.2*t},80,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.to(r,{scaleX:t,scaleY:t},180,null,initHandler(i,()=>{Laya.Tween.clearTween(r),Laya.Tween.clearTween(r),Laya.Tween.to(r,{scaleX:2*t,scaleY:2*t,alpha:0},80,null,initHandler(i,()=>{Laya.Tween.clearTween(r),r.removeSelf(),l.removeSelf()}),300)}))}))}))}))}))}))}else l.visible=!1}}class Mi extends nt{constructor(){super(),this.count=180,this.speed=.1,this.removespeed=.01,this.isgh=!1,this.isEnterBall=!1}onEnable(){let e=this;super.onEnable(),e.tr=e.owner.transform;var t=e.owner.getChildByName("body");e.rball=t.getChildByName("tmode"),e.hitTarget=e.rball.getChildByName("Cube"),e.hitTarget&&(e.hitTrigger=e.addCom(e.hitTarget,Ci),e.hitTrigger.isEnter=(t=>e.triggerEnter(t)))}setValue(e,t,i,s){this.removespeed=.01,this.angle=e,this.speed=i,this.angleE=t,this.count=s}triggerEnter(e){var t=e.owner;if("qiuCube"==t.name){var i={x:this.owner.transform.position.x,y:this.owner.transform.position.z},s={x:ea.scene.player.owner.transform.position.x,y:ea.scene.player.owner.transform.position.z},a=calcPosAngle({x:i.x,y:i.y},{x:s.x,y:s.y}),n=calcPosAngle({x:i.x,y:-i.y},{x:s.x,y:-s.y},!0),o=1;return Math.random()<.5&&(o=-1),this.setValue(a+45*o,-(n+90),.5,100),!1}if("qiudoor"==t.name){var r=this.owner.transform.position;return Li.BoomJinqiuShow(r,.8),Xe.getBody(this.owner,"Cube").destroy(),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:t.main.tb.configId,taskType:jt.GET_BALLNUM,count:1}),!0}t.main&&(t=t.main);var l=t.tb;return!!l&&30017==l.thingId}onUpdate(){let e=this;if(!ea.scene.GamePause&&Ve.game.isStartGame)if(e.speed>0){var t={x:e.tr.position.x,y:e.tr.position.z};e.prePos=t;var i=calcAngleDist(t,e.speed,e.angle);if(e.tr.position=new Laya.Vector3(i.x,.3,i.y),2==Ve.map.map.gamePkType&&(e.tr.position=new Laya.Vector3(i.x,.64,i.y)),e.rball.transform.rotate(new Laya.Vector3(e.speed,0,0),!0,!0),e.tr.localRotationEulerY=e.angleE,e.speed>.1?e.removespeed*=1.02:e.removespeed*=.6,e.removespeed<.001&&(e.removespeed=.001),e.speed-=e.removespeed,oi.singleton.mptData.isFootRun(e.tr)){var s=calcPosAngle({x:i.x,y:i.y},{x:t.x,y:t.y}),a=calcPosAngle({x:i.x,y:-i.y},{x:t.x,y:-t.y},!0)+90;e.angleE=a,e.angle=s,e.speed<.1&&(e.speed=.1)}e.hitTrigger.isTrigger&&(e.speed=0),e.count--}else!e.isEnterBall&&e.hitTrigger.isTrigger&&(e.isEnterBall=!0)}onDestroy(){super.onDestroy()}}class Si extends ht{constructor(){super(),this.joint_speed=.005,this.max_ro_angle=.01,this._ro_angle=.005,this.add_ro_angle=.005,this.ro_state=0,this.isQingXing=!1,this.cd=!1,this.Tipscd=0}onEnable(){this.thingbody||(this.thingbody=this.owner),this.move_speed=.01,this.move_anispeed=1,super.onEnable()}initThing(){}hitHurt(e){return!1}ClearTrigger(){this.moveTrigger.ClearTrigger()}onMoveTrigger(e){var t=this;if(ea.scene.GamePause||!t.triggerActive)return!1;var i=e.owner;if("equip"==i.name)return!1;if("skill_hit"==i.name)return!1;if("bullet_hit"==i.name)return!1;if("qiuCube"==i.name)return!1;if(-1!=i.name.indexOf("attack_hit")||-1!=i.name.indexOf("group_uninstall"))return!1;if(i.main==t.owner)return!1;if("undevice"==i.name)return!1;if(!t.hitHurt||t.hitHurt(i))return t.moveTrigger.isHit=!1,!0;if("wuyueyinghuanew300"==i.name||"119022"==i.name||"119001"==i.name||"119008"==i.name)return!0;if(i.main&&11230018==i.main.dthing.thingId&&t.owner==ea.scene.player.owner)return be.openpanel(we.EndWinPanel),!1;if(-1!=t.owner.name.indexOf("monster")&&i&&i.main&&37858==i.main.thingId)return!1;if(i.main&&37858==i.main.thingId&&t.owner==ea.scene.player.owner)return ea.scene.ui.getFUJinDu(6,i.main),!1;if(i.main&&40810090==i.main.dthing.thingId&&t.owner==ea.scene.player.owner)return this.OpenDoor(i),!1;if(i.main&&i.main.tb.funcType==Jt.CLIMB&&t.owner==ea.scene.player.owner)return cafe.event.dispatch(ge.game.ONCLIMB),!1;if("taskProgressCube"==i.name&&(1==t.type||6==t.type)){if(6==t.type&&mi.device.currentMountGear!=t.owner)return;return!Ve.game.isTaskProgress&&(Ve.game.isTaskProgress=!0,i.removeSelf(),i=null,ea.scene.player.ClearTrigger(),ea.scene.ui.addTaskProgress(),Laya.timer.once(800,t,()=>{Ve.game.isTaskProgress=!1}),!1)}if(i.main&&11230473==i.main.dthing.thingId&&(1==t.type||6==t.type))return(6!=t.type||mi.device.currentMountGear==t.owner)&&(!!i.parent.active&&(i.parent.active=!1,i.parent.removeSelf(),ea.scene.player.ClearTrigger(),Ve.game.haveKey++,Ve.game.getKey++,ea.scene.ui.showKeyAni(),!1));if("tpCube"==i.name){if(mi.device.currentMountGear)return!1;ea.scene.GamePause=!0,ea.scene.player.StartTp(),ea.scene.player&&ea.scene.player.FlyBagHidden(),Laya.timer.once(800,t,()=>{var e=i.main.dataStr.split("|"),s=new Laya.Vector3(Number(e[0]),Number(e[1]),Number(e[2])),a=i.transform.position.clone();if(ea.scene.player.owner.transform.position=new Laya.Vector3(a.x+s.x,a.y+s.y,a.z+s.z),!e[3])return Laya.timer.once(100,t,()=>{ea.scene.player.EndTp(),ea.scene.GamePause=!1,cafe.event.dispatch(ge.game.ROLE_MOD_REPLACE_FINISH,0)}),!1;e[3].indexOf("-")?(ea.scene.player.owner.transform.localRotationEulerY-=Math.abs(Number(e[3])),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH)):(ea.scene.player.owner.transform.localRotationEulerY+=Math.abs(Number(e[3])),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH)),Laya.timer.once(100,t,()=>{ea.scene.player.EndTp(),ea.scene.GamePause=!1,cafe.event.dispatch(ge.game.ROLE_MOD_REPLACE_FINISH,0)})})}if("saveCube"==i.name&&t.owner==ea.scene.player.owner){if(!i.parent.active)return;return Ve.game.savetppoi=i.transform.position.clone(),i.parent.active=!1,i.parent.removeSelf(),ea.scene.player.ClearTrigger(),!1}if(("dropCube"==i.name||i.main&&i.main.tb.funcType==Jt.DIETHING)&&t.owner==ea.scene.player.owner){if(ea.scene.ui.SubtractBlood(),!Ve.game.savetppoi)return cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),cafe.event.dispatch(se.CANCELSKILL),ta.toTrBy9G(ea.scene.player.owner,Ve.map.mptData.initPoint),!1;var s=Ve.game.savetppoi.clone();return ea.scene.player.owner.transform.position=new Laya.Vector3(s.x,s.y+.1,s.z),ea.scene.player.EndTp(),cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),!1}if(i.main&&37241==i.main.thingId){console.log("记录复活点");var n=i.main.transform.position.clone(),o=i.main.transform.rotationEuler.clone();return o&&n&&Ve.game.RiseModel!=i.main&&(Ve.game.RisePoi=new Laya.Vector3(n.x,n.y,n.z),Ve.game.RiseRot=o,Ve.game.RiseModel=i.main,-1!=ea.scene.player.ani.state.indexOf("jump")&&(Ve.game.isshibietiao=!0)),!1}if(-1!=i.name.indexOf("Cube")&&i.main&&(37204==i.main.tb.thingId||37205==i.main.tb.thingId))return!0;if(-1!=i.name.indexOf("Cube")&&i.triggerType&&310!=i.triggerType)return!0;if("guan1"==i.name||"guan2"==i.name)return!0;if("l_move_hit"==i.name||"b_move_hit"==i.name)return!0;if("weapon"==i.name){var r=i.parent;switch(r.name){case"20001":var l=a.shop.getTbByShopId(80029);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20002":l=a.shop.getTbByShopId(80027);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20003":l=a.shop.getTbByShopId(80028);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20004":l=a.shop.getTbByShopId(80021);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20005":l=a.shop.getTbByShopId(80020);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20006":l=a.shop.getTbByShopId(80023);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20007":l=a.shop.getTbByShopId(80022);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20008":l=a.shop.getTbByShopId(80024);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20009":l=a.shop.getTbByShopId(80025);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l});break;case"20010":l=a.shop.getTbByShopId(80026);Et.openpanel(vt.DropRewardPanel,vt.PANEL_TOP_TIPS,{info:l})}return r.removeChildren(0,2),r.removeSelf(),r.destroy(),r=null,!1}if(i&&"Cube"==i.name&&i.main&&(37212==i.main.tb.thingId||37213==i.main.tb.thingId))return!0;if(i&&"tmode"==i.name&&i.main&&(37208==i.main.tb.thingId||37211==i.main.tb.thingId||37446==i.main.tb.thingId))return!0;if(i&&"tmode"==i.name&&i.main&&(37212==i.main.tb.thingId||37213==i.main.tb.thingId)&&0==t.cd)return setTimeout(()=>{i.active=!1},100),setTimeout(()=>{t.cd=!1},500),Ve.game.selectDoor=i.main,!1;if(i.main&&37016==i.main.tb.thingId&&i.main.dataStr&&0==t.cd)return t.cd=!0,cafe.event.dispatch(se.GETBUFF,i.main.dataStr),setTimeout(()=>{i.main.removeSelf(),i.main.destroy()},100),setTimeout(()=>{t.cd=!1},500),!1;if((-1!=i.name.indexOf("Cube")||"0"==i.name[3])&&i.main&&310!=i.main.triggerType){if(i.main&&i.main.triggerType>=320){var h=i.main;if(0==Ve.map.map.exitMapId)return void(t.Tipscd=0);switch(h.triggerType){case 320:case 321:break;case 322:be.openpanel(we.EndWinPanel,{type:0,handler:initHandler(t,()=>{})});break;case 323:be.openpanel(we.EndWinPanel,{type:1,handler:initHandler(t,()=>{})})}return!0}if(i.main&&i.main.dataStr)if("2001"==i.main.dataStr.split("|")[0]&&cafe.event.dispatch(ge.game.DOOR,Number(i.main.dataStr.split("|")[1])),i.main.dataStr,20035009!=i.main.dataStr||mi.device.currentMountGear||(Ve.game.ponponchan=i.parent,ea.scene.ui.btn_pon.visible=!0),cafe.event.dispatch(ge.game.TOOLCMD,i.main.dataStr),!i.main.getComponent(ht))return!1;return!0}if(i.main||(i=i.parent),"119022"==i.name||"119008"==i.name)return!0;if("bhit"==i.name||"hit"==i.name||-1!=i.name.indexOf("Sand_01")||-1!=i.name.indexOf("Water"))return!0;if(i.main&&(i=i.main),!t.action||!t.action.isInstall(Ei.MoveAction))return!1;if(!i||i.py||i.car||i==t.owner)return!1;if(t.owner==i.parent)return!1;if(null==i.triggerType){var c=e.owner.getComponent(Laya.Rigidbody3D);if(c&&c.isKinematic)return i.modelType!=le.type_role&&(e.owner.parent!=ea.scene.thingCode.playbody&&e.owner.parent.parent!=ea.scene.thingCode.playbody&&"body"==e.owner.name);var d=new Laya.Vector2,u=e.owner.transform;d.x=u.position.x+e.colliderShape.localOffset.x,d.y=u.position.z+e.colliderShape.localOffset.y;var p=e.colliderShape.sizeX,m=e.colliderShape.sizeY,g=d.x-p,y=d.x+p,f=d.y-m,_=d.y+m,v=getDistance(d,{x:g,y:f}),b=calcPosAngle(d,{x:g,y:f}),w=calcAngleDist(d,v,u.rotation.y+b),T=calcPosAngle(d,{x:y,y:f}),A=calcAngleDist(d,v,u.rotation.y+T),x=calcPosAngle(d,{x:y,y:_}),k=(calcAngleDist(d,v,u.rotation.y+x),calcPosAngle(d,{x:g,y:_}));calcAngleDist(d,v,u.rotation.y+k);return!0}switch(i.triggerType){case 0:case 9:case 11:case 13:case 14:case 20:return!0;case 5:return cafe.event.dispatch(se.GAME_TIGGER_REMOVE,i),i.transform&&Li.BoomShow(i.transform.position.clone(),i.tb.boomscale),setTimeout(()=>{i.removeSelf(),i.destroy(),i=null},10),!1;case 310:if((I=i.getComponent(Mi))||(I=i.addComponent(Mi)),1==I.isgh)return I.isgh=!1,!1;t.owner.transform.position.y,w={x:t.owner.transform.position.x,y:t.owner.transform.position.z},A={x:i.transform.position.x,y:i.transform.position.z},b=calcPosAngle({x:w.x,y:w.y},{x:A.x,y:A.y});var E=calcPosAngle({x:w.x,y:-w.y},{x:A.x,y:-A.y},!0);return I.setValue(b,E+90,.5,100),!1;default:var I;if((I=e.owner.ai)&&I.isRide||e.owner.parent==ea.scene.thingCode.playbody)return!1;d=new Laya.Vector2,u=e.owner.transform;d.x=u.position.x+e.colliderShape.localOffset.x,d.y=u.position.z+e.colliderShape.localOffset.z;p=e.colliderShape.sizeX,m=e.colliderShape.sizeZ,g=d.x-p,y=d.x+p,f=d.y-m,_=d.y+m,v=getDistance(d,{x:g,y:f}),b=calcPosAngle(d,{x:g,y:f}),w=calcAngleDist(d,v,u.rotation.y+b),T=calcPosAngle(d,{x:y,y:f}),A=calcAngleDist(d,v,u.rotation.y+T),x=calcPosAngle(d,{x:y,y:_}),calcAngleDist(d,v,u.rotation.y+x),k=calcPosAngle(d,{x:g,y:_}),calcAngleDist(d,v,u.rotation.y+k);return!0}}OpenDoor(e){var t=e.main.getChildByName("body").getComponent(Laya.Animator),i=e.main.dataStr;if(!Ve.game.isOpenDoor&&0!=Number(i)){t.play("press"),Ve.game.isOpenDoor=!0;for(var s=0;s<Ve.game.doors.length;s++){var a=Ve.game.doors[s].dataStr;if(Number(i)==Number(a)){console.log("openDoor");var n=Ve.game.doors[s].getChildByName("body").getChildByName("rightDoor").getComponent(Laya.Animator),o=Ve.game.doors[s].getChildByName("body").getChildByName("leftDoor").getComponent(Laya.Animator);n.speed=2,o.speed=2,n.play("open"),o.play("open"),Ve.game.doors.splice(s,1);break}}Laya.timer.once(800,self,()=>{t.play("idle"),Ve.game.isOpenDoor=!1})}}get ro_angle(){return this._ro_angle<this.max_ro_angle&&(this._ro_angle+=.002),this._ro_angle>=this.max_ro_angle&&(this._ro_angle=this.max_ro_angle),this._ro_angle}isroMax(){return this._ro_angle>=this.max_ro_angle}onFuncFrie(e){this.type=0==this.type?1:0}onDestroy(){super.onDestroy(),Laya.Tween.clearTween(this)}}class Pi{}Pi.role=100,Pi.device=101,Pi.car=102,Pi.npc=103,Pi.monster=104,Pi.home_build=300,Pi.home_thing=301,Pi.map_build=302,Pi.map_public_build=303,Pi.map_plant=304,Pi.map_special_build=305;class Ri extends Laya.Script3D{constructor(){super(),this.isHit=!1,this.isTrigger=!1;this.kinematics=[],cafe.event.on(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}onGameBodyDieHandler(e){var t=this.kinematics.indexOf(e);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1))}onUpdate(){this.kinematicSprite&&this.kinematicSprite.destroyed&&(this.isHit=!1,this.kinematicSprite=null)}isHitType(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];if(i.main&&(i=i.main),i.triggerType==e)return!0}return!1}onTriggerEnter(e){if(this.kinematicSprite=e.owner,this.isHit=!0,-1==this.kinematics.indexOf(e.owner)&&this.isEnter&&this.isEnter(e)){this.kinematics.push(e.owner),this.isTrigger=!0;var t=e.owner;t.main&&(t=t.main),Ve.guide.isGuideBoolean(3)?Ve.guide.refSetup():Ve.guide.isGuideBoolean(4)&&t.triggerType==Pi.monster&&Ve.guide.refSetup(),this.PlayerTriggerEnter(e)}this.handler&&this.handler.runWith([e])}onTriggerStay(e){}onTriggerExit(e){this.kinematicSprite=null,this.isHit=!1;var t=this.kinematics.indexOf(e.owner);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1));var i=e.owner;-1==i.name.indexOf("Cube")&&"0"!=i.name[3]||i.main&&i.main.dataStr&&(ea.scene.ui.btn_pon.visible=!1,cafe.event.dispatch(ge.game.TOOLCMD,"0|"+i.main.dataStr));var s=e.owner;s.main&&(s=s.main),Ve.guide.isGuideBoolean(3)?Ve.guide.refSetup():Ve.guide.isGuideBoolean(4)&&s.triggerType==Pi.monster&&Ve.guide.refSetup(),this.PlayerTriggerExit(e)}PlayerTriggerEnter(e){if(this.owner.main==ea.scene.player.owner){var t=e.owner;t.main&&t.main.tb&&t.main.tb.funcType==Jt.MUSICBOX&&ea.scene.ui&&!ea.scene.ui.btn_music.visible&&(ea.scene.ui.btn_music.visible=!0,Ve.game.musicData=Number(t.main.dataStr))}}PlayerTriggerExit(e){if(this.owner.main==ea.scene.player.owner){var t=e.owner;t.main&&t.main.tb&&t.main.tb.funcType==Jt.MUSICBOX&&ea.scene.ui&&ea.scene.ui.btn_music.visible&&(ea.scene.ui.btn_music.visible=!1)}}delTrigger(e){if(e){for(var t=0;t<this.kinematics.length;t++){this.kinematics[t].main==e&&(this.kinematics.splice(t,1),t--)}this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1)}}ClearTrigger(){this.kinematics=[],this.isTrigger=!1,this.isHit=!1}onDestroy(){super.onDestroy();cafe.event.off(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}}class Di extends st{constructor(){super(),this.thingHeight=.02}onEnable(){super.onEnable()}init(e,t){this.thing_id=e,this.thing_hp=t,this.max_hp=t}onDestroy(){this.headview&&(this.headview.visible=!1),ea.scene.isGameing||super.onDestroy()}}class Ni extends Si{constructor(){super(),this.penpenScore=0,this.range=.01,this.unlocking=!1,this.isDie=!1,this.hitcount=0,this.isWeapon=!1,this.weaponAtt=0,this.isCar=!1,this.isHeroRideCar=!1}initThing(){this.ani||(this.ani=this.addCom(this.owner,oe),this.ani.init(this.thingbody,new Laya.Handler(this,this.onPlayerEnd))),this.info||(this.info=new $e,this.info.attribute=this.addCom(this.owner,Di),this.info.attribute.init(2)),this.initEffect(),Ve.map.mptData.mptModel[J.ROLE].pushRole(this.owner)}initEffect(){this.flyEffect=Xe.getBodys(this.owner,"fly_effect"),this.skillEffect=Xe.getBodys(this.owner,"skill_effect"),this.stopFlyEffect(),this.stopSkillEffect()}playFlyEffect(){for(var e=0;e<this.flyEffect.length;e++);}stopFlyEffect(){for(var e=0;e<this.flyEffect.length;e++)this.flyEffect[e].active=!1}playSkillEffect(){for(var e=0;e<this.skillEffect.length;e++);}stopSkillEffect(){for(var e=0;e<this.skillEffect.length;e++)this.skillEffect[e].active=!1}triggerEnter(e){if(!this.triggerActive)return!1;var t=e.owner;return!!t&&("body"==t.name&&t!=this.owner)}bodyTriggerEnter(e){if(!this.triggerActive)return!1;var t=e.owner;return!!t&&("body"==t.name&&t!=this.owner)}onSkillTrigger(e){if(!this.triggerActive)return!1;var t=e.owner;return!!t&&!(-1==t.name.indexOf("Cube")||!t.main||2!=t.main.tb.destroyType)}onAttackTrigger(e){if(!this.triggerActive)return!1;var t=e.owner;return!!t&&("Cube"==t.name&&t.main&&1101==t.main.tb.funcType&&1==Ve.game.MaoMaoGameType&&"1"!=i.read("firstAtt")&&(i.save("firstAtt","1"),ea.scene.ui.firstAtt.visible=!0),t.main&&t.main.tb.funcType==Jt.STEIKEF&&7==Ve.map.map.gamePkType&&"1"!=i.read("strikething")&&(i.save("strikething","1"),ea.scene.ui.strikething.visible=!0),!(-1==t.name.indexOf("Cube")||!t.main||1!=t.main.tb.destroyType)||-1!=t.name.indexOf("Cube"))}onfindTrigger(e){var t=e.owner;return!!t&&("body"==t.name&&t!=this.owner)}triggerHit(e,t){if(!this.triggerActive)return!1;t.owner}delTrigger(e){this.findTrigger&&this.findTrigger.delTrigger(e),this.attackTrigger&&this.attackTrigger.delTrigger(e),this.skillTrigger&&this.skillTrigger.delTrigger(e),this.moveTrigger&&this.moveTrigger.delTrigger(e),this.dMoveTrigger&&this.dMoveTrigger.delTrigger(e),this.uMoveTrigger&&this.uMoveTrigger.delTrigger(e),this.hitTrigger&&this.hitTrigger.delTrigger(e),this.bodyTrigger&&this.bodyTrigger.delTrigger(e),this.monsterSkillTrigger&&this.monsterSkillTrigger.delTrigger(e),this.monsterBuildTrigger&&this.monsterBuildTrigger.delTrigger(e)}onTbHandler(){var e=this;e.move_speed=e.info.tb.speed,e.move_anispeed=e.info.tb.moveanispeed,e.hitTrigger&&e.hitTrigger.destroy(),e.hitTarget=e.thingbody.getChildByName("group_hit"),e.hitTarget&&(e.hitTrigger=e.addCom(e.hitTarget,Ci),e.hitTrigger.isEnter=(t=>e.triggerEnter(t))),e.bodyTrigger&&e.bodyTrigger.destroy(),e.bodyTarget=e.thingbody,e.bodyTarget&&(e.bodyTrigger=e.addCom(e.bodyTarget,Ci),e.bodyTrigger.isEnter=(t=>e.bodyTriggerEnter(t))),e.moveTrigger&&e.moveTrigger.destroy(),e.moveTarget=e.thingbody.getChildByName("move_hit"),e.moveTarget&&(e.moveTrigger=e.addCom(e.moveTarget,Ri),e.moveTrigger.ClearTrigger(),e.moveTrigger.isEnter=(t=>(!t.owner||!t.owner.main||-1==t.owner.main.name.indexOf("monster"))&&e.onMoveTrigger(t))),e.attackTrigger&&e.attackTrigger.destroy(),e.attackTarget=e.thingbody.getChildByName("attack_hit"),e.attackTarget&&(e.attackTrigger=e.addCom(e.attackTarget,Ci),e.attackTrigger.isEnter=(t=>e.onAttackTrigger(t))),e.skillTrigger&&e.skillTrigger.destroy(),e.skillTarget=e.thingbody.getChildByName("skill_hit"),e.skillTarget&&(e.skillTrigger=e.addCom(e.skillTarget,Ci),e.skillTrigger.isEnter=(t=>e.onSkillTrigger(t)));var t=Ve.map.map.scale;e.info.speed=e.info.tb.speed*t/1e5}playAni(e,t){this.ani&&(this.ani.state!=ie.fly&&e==ie.fly?this.playFlyEffect():this.ani.state==ie.fly&&e!=ie.fly&&this.stopFlyEffect(),this.skillEffect&&(this.ani.state!=ie.skill&&e==ie.skill?this.playSkillEffect():this.ani.state==ie.skill&&e!=ie.skill&&this.stopSkillEffect()),super.playAni(e,t),this.hitcount=0)}onPlayerEnd(e){if(-1!=e.indexOf(ie.liangqiang)||-1!=e.indexOf(ie.show)||-1!=e.indexOf(ie.attack)||-1!=e.indexOf(ie.skill)||-1!=e.indexOf(ie.hit)||-1!=e.indexOf(ie.chuizi)||-1!=e.indexOf(ie.lutou)||-1!=e.indexOf(ie.npcqiang)||-1!=e.indexOf(ie.che)){if("dancheidle"==this.ani.curAniState||"dancherun"==this.ani.curAniState)return;if(this.isCar){var t=a.shop.getTbByShopId(this.carId);this.playAni(t.shopRideAni)}else this.ani.speed=1,this.playAni(ie.idle)}}onEnable(){var e=this.owner.getChildByName("body");this.thingbody||(this.thingbody=e),this.roleEffect={},this.type=2,super.onEnable()}play_skill_effect_end(e,t,i,s){this.isdispose||(this.ani.state=e,this.runOneTimeParticle(t,i,{isLocal:s&&s.isLocal,time:s&&s.time,size:s&&s.size}))}runOneTimeParticle(e,t,i){let s=this;s.isdispose||Tn.inst.load3d.particleRes(e,initHandler(s,e=>{if(i&&i.size&&(e.transform.localScale=new Laya.Vector3(i.size,i.size,i.size)),i&&i.isLocal)e.particleSystem.addParticle(new Laya.Vector3(0,.001,0),new Laya.Vector3(0,0,0),i&&i.time||300),s.owner.addChild(e);else{let t=s.owner.transform;e.particleSystem.addParticle(new Laya.Vector3(t.position.x,.001,t.position.z),new Laya.Vector3(0,0,0),i&&i.time||300),ea.scene.mainscene.addChild(e)}e.timerOnce(i&&i.time||300,s,()=>{e.removeSelf()}),t&&t.run()}))}runEnumParticleEffect(e,t){var i=this,s=ce.d3res+Ce.res_dic[e];Tn.inst.load3d.particleRes(s,initHandler(i,s=>{i.roleEffect[e]=t.addChild(s),s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,0,0)}))}clearRoleEnumParticleRes(e){this.roleEffect[e]&&(this.roleEffect[e].removeSelf(),delete this.roleEffect[e])}stopParticleRes(){let e=this;if(super.stopParticleRes(),e.roleEffect)for(let t in e.roleEffect)e.roleEffect[t].removeSelf(),delete e.roleEffect[t]}die(){if(this.isdispose)return;if(this.isDie)return;if(this.isDie=!0,Ve.game.isUp=!1,!ea.scene.mainscene)return;if(delete ea.scene.things[this.owner.name],!ea.scene.mainscene)return;this.owner.parent;this.owner.state;this.owner.removeSelf(),this.owner.destroy()}processHitTarget(e,t,i=null){if(t==this.owner)return!1;switch(e){case 3:return!1;case 2:return!0}return!1}onDestroy(){Ve.map.mptData.mptModel[J.ROLE].delRoleSprite(this.owner),super.onDestroy(),this.isdispose||(this.isdispose=!0,this.stopParticleRes())}}class ji extends Ni{constructor(){super()}onEnable(){var e=this.owner.getChildByName("body");this.thingbody||(this.thingbody=e),super.onEnable(),this.type=4}initThingTb(e){var t=this,i=t.owner.getChildByName("body"),s=i.getChildByName("mode");t.ani=s?s.getComponent(Laya.Animator):i.getComponent(Laya.Animator),t.state||(t.state=t.addCom(t.owner,lt)),t.ai=t.addCom(t.owner,Qi),t.tbthing=e,ea.scene.things[t.owner.name]=t.owner,t.hitTarget=i,t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.owner.tb=t.tbthing}initThing(e){var t=this;t.ani=t.addCom(t.owner,oe),t.ani.init(t.thingbody,new Laya.Handler(t,t.onPlayerEnd)),t.ai=t.addCom(t.owner,Qi),t.route=e,t.pathinfo=Ve.path.getPath(e.routePathId),t.tbthing=a.thing.getTbByThingId(e.routePathNpcId),ea.scene.things[t.owner.name]=t.owner,t.hitTarget=t.thingbody.getChildAt(0),t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.owner.tb=t.tbthing}triggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(Ni);return!("body"!=e.owner.name||!i)}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ai.speed=this.tbthing.speed/1e5,this.ani.speed=this.tbthing.anispeed}onDestroy(){this.isdispose||(this.isdispose=!0,super.onDestroy())}}class Gi extends Laya.Script{constructor(){super()}onEnable(){this.script=this.owner.getComponent(Fi);for(let e in ea.scene.things)0;this.owner.state,this.script.stopParticleRes(),this.runLoopingParticle("res/res3D/role_effect/20006.lh")}runLoopingParticle(e){let t=this;Tn.inst.load3d.particleRes(e,initHandler(t,e=>{e.transform.localScale=new Laya.Vector3(2,2,2),e.transform.localPosition=new Laya.Vector3(0,-1,0),e.particleSystem.play(),t.effect=t.owner.addChild(e)}))}onUpdate(){let e=this;e.owner.transform.localPositionY-=.1,e.owner.transform.localPositionY<-10&&(e.script.die(),e.destroy())}onDisable(){let e=this;e.effect&&(e.effect.destroy(),e.effect.removeSelf(),e.effect=null),super.onDisable()}}class Bi{constructor(){this.isload=!1,this.isLoop=!1;cafe.event.on(se.SYSTEM_FOCUS_CHANGE,this.onFocusChangeHandler,this)}init(){}load(e,t=1,i=null){}onFocusChangeHandler(e){}play(...e){return null}stop(){}pause(){}dispose(){cafe.event.off(se.SYSTEM_FOCUS_CHANGE,this.onFocusChangeHandler,this)}}class Hi extends Bi{constructor(){super(),this.isload=!1}onFocusChangeHandler(e){e?this.source&&this.play():this.loop>0?this.stop():this.pause()}set volume(e){this._volume=e,this.source&&(this.source.volume=e)}get volume(){return this._volume}init(e=null,t=1,i=null,s=null){this.tb=e,this.loop=t,this.comhandler=i,this.handler=s}load(){var e=this,t=Laya.SoundManager.playSound(ce.fullPath("res/sound/"+e.tb.soundPath+Oi.exit),e.loop*e.tb.soundCount,new Laya.Handler(this,()=>{e.isload=!0,e.comhandler&&e.comhandler.run(),e.comhandler=null,t&&(t.soundId=e.tb,e.volume?t.volume=e.volume:t.volume=e.tb.soundVolume/100,0==e.loop&&(t.completeHandler=new Laya.Handler(e,e.onPlayEnd)),e.source=t)}));t&&(t.soundId=e.tb,e.volume?t.volume=e.volume:t.volume=e.tb.soundVolume/100,0==e.loop&&(t.completeHandler=new Laya.Handler(e,e.onPlayEnd)),e.source=t)}onPlayEnd(){this.handler&&this.handler.run(),1==this.loop&&this.dispose()}play(){return this.source?this.source.play():this.load(),this}stop(){this.source&&(this.source.stop(),this.pos=0,this.isload=!1,this.source.completeHandler=null,this.source=null)}pause(){this.source&&(this.pos=this.source.position,this.source.pause())}dispose(){this.stop(),Laya.Pool.recoverByClass(this)}}class Oi{constructor(){this.playNum=5,this.yyTime=800,this.yypreTime=0;this.__useRes={},this.__workRes={},cafe.event.on(se.SYSTEM_FOCUS_CHANGE,this.onFocusChangeHandler,this)}onFocusChangeHandler(e){slog("SoundLoader.onFocusChangeHandler : ",e),e?this.soundchannel_bg&&(this.soundchannel_bg.startTime=this.soundchannel_bg_pos,this.soundchannel_bg.play()):this.soundchannel_bg&&(this.soundchannel_bg_pos=this.soundchannel_bg.position,this.soundchannel_bg.pause())}set soundMuted(e){Laya.SoundManager.soundMuted=e}get soundMuted(){return Laya.SoundManager.soundMuted}pre(e,t=null,i=null){var s,n=this;try{var o=a.sound.getTbBysoundId(e);(s=Laya.SoundManager.playSound(ce.fullPath("res/sound/"+o.soundPath+Oi.exit),1,new Laya.Handler(this,()=>{n.__workRes[e]=1})))&&(s.volume=0),t&&t.runWith([e]),t=null}catch(s){t&&t.runWith([e]),t=null,i&&i.runWith([e]),i=null}}getUrl(e){}playBG(e){if(null!=e&&(this.soundBG=e),this.soundchannel_bg){if(this.soundchannel_bg.soundId==e)return null;this.soundchannel_bg.volume=0,this.soundchannel_bg.stop(),this.soundchannel_bg=null}if(1==Ve.setting.isSound){var t=a.sound.getTbBysoundId(this.soundBG);return t?(this.soundchannel_bg=Laya.SoundManager.playMusic(ce.fullPath("res/sound/"+t.soundPath+Oi.exit),0),this.soundchannel_bg&&(this.soundchannel_bg.soundId=e,this.soundchannel_bg.volume=t.soundVolume/100),this.soundchannel_bg):null}return null}switchBg(e){e?this.playBG():this.soundchannel_bg&&(this.soundchannel_bg.stop(),this.soundchannel_bg=null)}play(e,t=1,i=null,s=!1){var n=this;if(slog("声音播放",e,Ve.setting.isSound),1==Ve.setting.isSound){if(Laya.Browser.onMiniGame){if(0==n.__workRes[e])return null;null==n.__workRes[e]&&(n.__workRes[e]=0);r=Laya.Pool.getItemByClass("sound",Hi),o=a.sound.getTbBysoundId(e);if(0==e||1!=o.soundType&&2!=o.soundType)n.playBG(e);else{if(2==o.soundType){if((l=(new Date).getTime())-n.yypreTime<n.yyTime)return null;n.yypreTime=l}r.init(o,t,new Laya.Handler(this,()=>{n.__workRes[e]=1,i&&i.run(),i=null})),r&&(0==n.__workRes[e]?r.volume=0:r.volume=o.soundVolume/100,r.soundId=e),r.play()}}else{var o=a.sound.getTbBysoundId(e),r=Laya.Pool.getItemByClass("sound",Hi);if(0==e||!o||1!=o.soundType&&2!=o.soundType)n.playBG(e);else{if(!s&&2==o.soundType){var l;if((l=(new Date).getTime())-n.yypreTime<n.yyTime)return null;n.yypreTime=l}r.init(o,t,i),r&&(r.soundId=e,r.volume=o.soundVolume/100),r.play()}}return r}return null}stop(e){e.stop()}desposeRes(e){}dispose(){cafe.event.off(se.SYSTEM_FOCUS_CHANGE,this.onFocusChangeHandler,this)}}class zi extends it{constructor(){super(),this.isdispose=!1}onEnable(){let e=this;e.script=e.owner.getComponent(Fi),e.tween=new Laya.Tween,e.tweenFly=new Laya.Tween,e.owner.timerOnce(200,e,()=>{e.isdispose||e.destroy()})}setTarget(e,t,i,s){let a=this;a.saveAngle=i,a.saveDistance=t,a.lNum=s,t>2&&a.playHit(),a.trans=e.transform;let n=calcAngleDist({x:a.trans.localPositionX,y:a.trans.localPositionZ},t,i),o=e.getComponent(Fi),r=.8*o.scale,l=1.1*o.scale;a.tween.clear(),a.tween.to(a.trans,{localScaleX:r,localScaleY:r,localScaleZ:r},50,null,initHandler(a,()=>{a.owner?a.tween.to(a.trans,{localScaleX:l,localScaleY:l,localScaleZ:l},50,null,initHandler(a,()=>{a.owner?a.tween.to(a.trans,{localScaleX:o.scale,localScaleY:o.scale,localScaleZ:o.scale},30,null,initHandler(a,()=>{a.owner?a.tween.clear():a.destroy()})):a.destroy()})):a.destroy()})),a.tweenFly.to(a.trans,{localPositionX:n.x,localPositionZ:n.y},180,null,initHandler(a,()=>{if(!a.owner)return void a.destroy();if(a.tweenFly.clear(),oi.singleton.mptData.isRun(a.owner.transform))a.target=null;else{if(a.target){let e=a.target.getComponent(at);a.owner.getComponent(at);if(e){let e=0;for(let t in ea.scene.things)e++;10==e&&Laya.SoundManager.playSound("res/sound/sound_kill1"+Oi.exit,1),delete ea.scene.things[a.owner.name],cafe.event.dispatch(se.PLAYER_GAMESCENE_PLAYER_COUNT)}}let e=a.addCom(a.owner,Gi);a.target&&(e.target=a.target)}a.destroy()}))}playHit(){let e=this;Tn.inst.load3d.particleRes("res/res3D/role_effect/20004.lh",initHandler(e,t=>{e.owner?(e.hiteffect=t,t.transform.localScale=new Laya.Vector3(1,1,1),t.transform.localPosition=new Laya.Vector3(0,.5,0),t.particleSystem.play(),e.owner.addChild(t)):t.destroy()}))}onDisable(){let e=this;e.isdispose||(e.isdispose=!0,e.hiteffect&&(e.hiteffect.removeSelf(),e.hiteffect.destroy()),e.tween&&(e.tween.clear(),e.tween=null),e.tweenFly&&(e.tweenFly.clear(),e.tweenFly=null),super.onDisable())}}class Vi extends Laya.Script{constructor(){super(),this.maxNum=5}onEnable(){let e=this;e.runNum=e.maxNum,e.script=e.owner.getComponent(Fi),Tn.inst.load3d.thingRes("res/res3D/role_effect/20005.lh",ea.scene.mainscene,initHandler(e,t=>{e.owner?(e.effect=t,e.t=e.owner.transform,e.effect.transform.localPosition=new Laya.Vector3(e.t.localPositionX,2,e.t.localPositionZ),e.effect.transform.localScale=new Laya.Vector3(2.5,2.5,2.5)):t.removeSelf()}))}onUpdate(){let e=this;e.effect&&(e.effect.transform.localRotationEulerY+=3,e.effect.transform.localPosition=new Laya.Vector3(e.t.localPositionX,2,e.t.localPositionZ),e.runNum=e.maxNum)}onDisable(){let e=this;e.effect&&(e.effect.removeSelf(),e.effect=null),super.onDisable()}}class Fi extends ht{constructor(){super(),this.range=.01,this.unlocking=!1}onUpdate(){let e=this;if(super.onUpdate(),!ea.scene.things)return;let t=new Laya.Point(e.owner.transform.localPositionX,e.owner.transform.localPositionZ);for(let i in ea.scene.things){let s=ea.scene.things[i];if(null===s||null==s.transform){delete ea.scene.things[i];continue}if(s===e.owner)continue;let a=new Laya.Point(s.transform.localPositionX,s.transform.localPositionZ),n=s.getComponent(Fi);AREA(t,e.r,a,n.r)>0&&e.owner.transform.localPositionY<=1&&e.processHitTarget(s.type,s,"Bip001RFinger1")}}onEnable(){this.effects={},this.roleEffect={},this.owner.type=2,this.ani=this.owner.getComponent(Laya.Animator),super.onEnable(),cafe.event.on(se.SLIME_LEVEL_REF+"_"+this.owner.name,this.onLevelHandler,this),cafe.event.on(se.ONE_PLAYER_CHANGE,this.onOnePlayerChange,this)}onOnePlayerChange(e){let t=this;if(e==t.owner.name){let e=t.owner.getComponent(Vi);e||(e=t.addCom(t.owner,Vi))}else{let e=t.owner.getComponent(Vi);e&&e.destroy()}}onLevelHandler(e){let t=this;t.isdispose||(t.scale=1+.2*e,t.r=t.scale/2,t.owner.transform.localScaleX!=t.scale&&(t.owner&&Laya.Tween.clearTween(t.owner.transform),Laya.Tween.to(t.owner.transform,{localScaleX:t.scale,localScaleY:t.scale,localScaleZ:t.scale},2e3,Laya.Ease.backOut,initHandler(t,()=>{t.owner&&Laya.Tween.clearTween(t.owner.transform)}))))}play_skill_effect_end(e,t,i,s){this.isdispose||(this.ani.state=e,this.runOneTimeParticle(t,i,{isLocal:s&&s.isLocal,time:s&&s.time,size:s&&s.size}))}runOneTimeParticle(e,t,i){let s=this;s.isdispose||Tn.inst.load3d.particleRes(e,initHandler(s,e=>{if(i&&i.size&&(e.particleSystem.startSizeConstant=i.size),i&&i.isLocal)e.particleSystem.addParticle(new Laya.Vector3(0,.001,0),new Laya.Vector3(0,0,0),i&&i.time||300),s.owner.addChild(e);else{let t=s.owner.transform;e.particleSystem.addParticle(new Laya.Vector3(t.position.x,.001,t.position.z),new Laya.Vector3(0,0,0),i&&i.time||300),ea.scene.mainscene.addChild(e)}e.timerOnce(i&&i.time||300,s,()=>{e.removeSelf()}),t&&t.run()}))}runLoopingParticle(e,t){let i=this;Tn.inst.load3d.particleRes(e,initHandler(i,s=>{s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,0,0),i.effects[e]=t.addChild(s)}))}runEnumParticleEffect(e,t){var i=this,s=ce.d3res+Ce.res_dic[e];Tn.inst.load3d.particleRes(s,initHandler(i,s=>{i.roleEffect[e]=t.addChild(s),s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,0,0)}))}clearRoleEnumParticleRes(e){this.roleEffect[e]&&(this.roleEffect[e].removeSelf(),delete this.roleEffect[e])}TrailSprite3DRes(e,t){let i=this;Tn.inst.load3d.particleRes(e,initHandler(i,s=>{s.transform.localScale=new Laya.Vector3(1,1,1),s.transform.localPosition=new Laya.Vector3(0,.3,0),s._geometryFilter.widthMultiplier=.8,s._geometryFilter.time=1,i.effects[e]=t.addChild(s)}))}playAction(e){this.ani.state=e}stopParticleRes(){let e=this;if(e.effects)for(let t in e.effects)e.effects[t].removeSelf(),delete e.effects[t];if(e.roleEffect)for(let t in e.roleEffect)e.roleEffect[t].removeSelf(),delete e.roleEffect[t]}die(){if(this.isdispose)return;if(Ve.game.isUp=!1,!ea.scene.mainscene)return;if(delete ea.scene.things[this.owner.name],!ea.scene.mainscene)return;this.owner.parent;this.owner.state;this.owner.removeSelf(),this.owner.destroy()}hit(){}processHitTarget(e,t,i=null){let s=this;if(t==s.owner)return!1;s.owner.getComponent(Fi);let a=s.owner.getComponent(at);switch(e){case 3:return!1;case 2:let i=t.getComponent(Gi),n=s.owner.getComponent(Gi);if(i||n)return;let o=s.owner.getComponent(zi),r=t.getComponent(zi);if(o&&o.target==t&&r&&r.target==s.owner)return!1;let l=t.getComponent(at),h=t.getComponent(Fi),c=0,d=0,u=0,p=0;return 1==Me.game_log&&serror(s.owner.name+" vs "+t.name+" start-----------------------------"),o&&o.target!=t&&(c=o.saveDistance,d=o.lNum,o.destroy()),r&&r.target!=s.owner&&(u=r.saveDistance,p=r.lNum,r.destroy()),(!Ve.game.isPauseGame||1!=t.state&&1!=s.owner.state)&&(s.AhitB(t,l,a,o,r,c,u,d+1),h.AhitB(s.owner,a,l,r,o,u,c,p+1),1==t.state||s.owner.state,s.playHit(t)),1==Me.game_log&&serror(s.owner.name+" vs "+t.name+" end-----------------------------"),!0}return!1}AhitB(e,t,i,s,a,n,o,r){1==Me.game_log&&(serror("myL1: "+n),serror("targetL1: "+o),serror("lNum: "+r)),a=this.addCom(e,zi);let l=e.transform,h=this.owner.transform,c=calcPosAngle({x:h.localPositionX,y:h.localPositionZ},{x:l.localPositionX,y:l.localPositionZ});a.target=this.owner;let d=2,u=2;1==this.owner.state&&Ve.game.isUp&&(d=2.2,u=2.2);let p,m=0,g=1.21,y=i.getValue(0),f=t.getValue(0),_=calcPosAngle({x:l.localPositionX,y:-l.localPositionZ},{x:h.localPositionX,y:-h.localPositionZ}),v=Math.round(180*_/Math.PI)+180;if(1==Me.game_log&&serror(e.name,v),y==f)m=u,1==Me.game_log&&serror("a:",p,m);else if(f>y){let e=f-y;m=u/Math.pow(g,e),1==Me.game_log&&serror(f,y,u+"/("+g+"^("+f+"-"+y+")):",p,m)}else{let e=y-f;m=u*Math.pow(g,e),1==Me.game_log&&serror(f,y,u+"*("+g+"^("+y+"-"+f+")):",p,m)}m<0&&(m=1.2),a.setTarget(e,m,c,r)}playHit(e){let t=e.transform,i=this.owner.transform,s=calcPosAngle({x:i.localPositionX,y:i.localPositionZ},{x:t.localPositionX,y:t.localPositionZ}),a=calcAngleDist({x:i.localPositionX,y:i.localPositionZ},this.r,s);Tn.inst.load3d.particleRes("res/res3D/role_effect/20003.lh",initHandler(this,e=>{e.transform.localScale=new Laya.Vector3(1,1,1),e.transform.localPosition=new Laya.Vector3(a.x,.5,a.y),e.particleSystem.play(),ea.scene.mainscene.addChild(e)}))}unLinkSprite3DToAvatarNode(e,t){let i=this;try{i.ani._isLinkSpriteToAnimationNodeData(e,t,!1),i.ani._isLinkSpriteToAnimationNode(e,t,!1)}catch(e){1==Me.game_log&&serror("解除绑定失败")}}onDisable(){super.onDisable();if(this.isdispose)return;this.isdispose=!0;let e=this.owner.getComponent(Vi);e&&e.destroy(),this.stopParticleRes(),cafe.event.off(se.SLIME_LEVEL_REF+"_"+this.owner.name,this.onLevelHandler,this),cafe.event.off(se.ONE_PLAYER_CHANGE,this.onOnePlayerChange,this)}}class Ui extends nt{constructor(){super(),this.MaxRunNum=5}onEnable(){let e=this;if(!e.script){e.owner.name="npc"+e.owner._id,e.owner.state;e.addCom(e.owner,Fi);ea.scene.things[e.owner.name]=e.owner,e.totalTime=30,e.time=e.totalTime,e.script.info.movestate=Q.wait,e.checkAction=e.addCom(e.owner,Yi),cafe.event.dispatch(se.PLAYER_GAMESCENE_PLAYER_COUNT)}}onUpdate(){let e=this;if(!ea.scene.GamePause&&Ve.game.isStartGame){if(0==e.time){if(e.owner.getComponent(zi))return;var t=e.checkAction.checkAll(2,2);if(t.mode){if((i=e.owner.getComponent(qi))||(i=e.addCom(e.owner,void 0)),!e.aiAction||e.aiAction.action_type==i.action_type&&i.target==t.mode){if(e.aiAction&&e.aiAction.action_type==i.action_type)return e.aiAction.res_action(),void(e.time=e.totalTime)}else e.aiAction.destroy(),e.aiAction=null;i.action(t.mode),e.aiAction=i}else{var i;if((i=e.owner.getComponent(qi))||(i=e.addCom(e.owner,void 0)),e.aiAction&&!e.aiAction.owner&&(e.aiAction=null),e.aiAction&&e.aiAction.action_type!=i.action_type)e.aiAction.destroy(),e.aiAction=null;else if(e.aiAction&&e.aiAction.owner&&e.aiAction.action_type==i.action_type)return e.aiAction.res_action(),void(e.time=e.totalTime);i.action(),e.aiAction=i}e.time=e.totalTime}e.time--}}onDestroy(){super.onDestroy()}}class qi extends Laya.Script{constructor(){super()}onEnable(){super.onEnable();var e=this.owner.getComponent(Fi);this.script=e,this.ai=this.owner.getComponent(Ui)}action(e){return null}checkAll3DModes(e,t,i){return null}checkAll3D(e,t,i){return null}checkAll(e,t,i){return null}checkStartEndAll(e,t,i){return null}checkliveNpc(e,t,i){return null}checkliveNpc2(e,t,i){return null}res_action(){}get_action_type(){return this.action_type}onDisable(){super.onDisable()}}class Yi extends qi{constructor(){super()}onEnable(){super.onEnable()}checkAll3DModes(e,t,i){let s=this,a=ea.scene.things,n=s.owner.transform.position,o=[],r=[];for(let h in a){let c=a[h],d=c.transform;if(!d)continue;let u=d.position,p=Laya.Vector3.distance(n,u);if(!(e<p)&&c!=s.owner){var l=c.getComponent(ht);0!=t&&t?t==l.type&&(i&&c.tb.type!=i||-1==o.indexOf(p)&&(o.push(p),r.push(c))):i&&c.tb.type!=i||-1==o.indexOf(p)&&(o.push(p),r.push(c))}}return{mode:r,d:o}}checkAll3D(e,t,i){let s,a=this,n=ea.scene.things,o=a.owner.transform.position,r=null;for(let h in n){let c=n[h],d=c.transform;if(!d)continue;let u=d.position,p=Laya.Vector3.distance(o,u);if(!(e<p)&&c!=a.owner){var l=c.getComponent(ht);0!=t&&t?t==l.type&&(i&&c.tb.type!=i||(s?s>p&&(s=p,r=c):(s=p,r=c))):i&&c.tb.type!=i||(s?s>p&&(s=p,r=c):(s=p,r=c))}}return{mode:r,d:s}}checkAll(e,t,i){let s,a=this,n=ea.scene.things,o=a.owner.transform,r={x:o.position.x,y:o.position.z},l=null;for(let o in n){let c=n[o],d=c.transform;if(!d)continue;let u={x:d.position.x,y:d.position.z},p=getDistance(r,u);if(!(e<p)&&c!=a.owner){var h=c.getComponent(ht);0!=t&&t?h&&t==h.type&&(i&&c.tb.type!=i||(s?s>p&&(s=p,l=c):(s=p,l=c))):i&&c.tb.type!=i||(s?s>p&&(s=p,l=c):(s=p,l=c))}}return{mode:l,d:s}}checkliveNpc(e,t,i){let s,a=this,n=Ve.map.mptData.mptModel[J.ROLE].things,o=a.owner.transform,r={x:o.position.x,y:o.position.z},l=null;for(let o in n){let c=n[o],d=c.transform;if(!d)continue;let u={x:d.position.x,y:d.position.z},p=getDistance(r,u);if(!(e<p)&&c!=a.owner){var h=c.getComponent(ht);h&&t==h.type&&0==h.isDie&&(i&&c.tb.type!=i||(s?s>p&&(s=p,l=c):(s=p,l=c)))}}return{mode:l,d:s}}checkliveNpc2(e,t,i){let s,a=this,n=Ve.map.mptData.mptModel[J.ROLE].things,o=a.owner.transform,r={x:o.position.x,y:o.position.z},l=null;for(let o in n){let c=n[o],d=c.transform;if(!d)continue;let u={x:d.position.x,y:d.position.z},p=getDistance(r,u);if(!(e<p)&&c!=a.owner){var h=c.getComponent(ht);h&&t==h.type&&(i&&c.tb.type!=i||(s?s>p&&(s=p,l=c):(s=p,l=c)))}}return{mode:l,d:s}}checkStartEndAll(e,t,i){let s,a=this,n=ea.scene.things,o=a.owner.transform,r={x:o.position.x,y:o.position.z},l=null;for(let o in n){let h=n[o],c=h.transform;if(!c)continue;let d={x:c.position.x,y:c.position.z},u=getDistance(r,d);if(!(e>u||t<u))if(h!=a.owner)if(0!=i&&i)i==h.getComponent(ht).type&&(s?s>u&&(s=u,l=h):(s=u,l=h));else s?s>u&&(s=u,l=h):(s=u,l=h)}return{mode:l,d:s}}onDisable(){super.onDisable()}}class Wi extends it{constructor(){super()}onEnable(){super.onEnable();this.script=this.owner.getComponent(ht)}onDestroy(){super.onDestroy()}}class Xi extends he{constructor(e,t,i){super(),this.active=!1;this.name=t,this.owner=e,this.script=this.owner.getComponent(ht),this.taskIds=[],this.initState(i)}push(e){-1==this.taskIds.indexOf(e)&&this.taskIds.push(e)}onEnable(){}initState(e){this.params=e,this.onEnable()}install(e){this.active=!0,Ye.remove(this,this.onFrameEnterHandler),Ye.add(1,this,this.onFrameEnterHandler),this.monitor(ge.task.TASK_FINISH,this.onTaskFinishHandler)}onTaskFinishHandler(e){var t=this.taskIds.indexOf(e);-1!=t&&this.taskIds.splice(t,1),this.taskIds.length<=0&&this.chooseFocus&&(this.chooseFocus.removeSelf(),this.chooseFocus.destroy(),this.chooseFocus=null)}onUpdate(e){}onFrameRun(e){}onFrameEnterHandler(e){this.active&&this.onFrameRun(e)}uninstall(){this.active=!1,Ye.remove(this,this.onFrameEnterHandler),this.clearMonitor()}destroy(){super.destroy(),this.uninstall()}}class Ki extends Xi{constructor(){super(...arguments),this.active=!1}onEnable(){var e=this;Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_10025_lh],e.owner,1,{},initHandler(e,t=>{e.chooseFocus=t,e.chooseFocus.transform.localPosition=new Laya.Vector3(0,0,0),e.chooseFocus.transform.localScale=new Laya.Vector3(10,5,10)}))}onTaskFinishHandler(e){}onFrameRun(e){}uninstall(){super.uninstall()}destroy(){super.destroy(),this.chooseFocus&&(this.chooseFocus.removeSelf(),this.chooseFocus.destroy(),this.chooseFocus=null)}}class Ji extends Xi{constructor(){super(...arguments),this.active=!1}onEnable(){var e=this;super.onEnable(),Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_10027_lh],e.owner,1,{},initHandler(e,t=>{if(e.isdispose)return t.removeSelf(),t.destroy(),void(t=null);e.chooseFocus=t,e.chooseFocus.transform.localPosition=new Laya.Vector3(0,e.owner.tb.headEffectH,0),e.chooseFocus.transform.localScale=new Laya.Vector3(1,1,1)}))}onFrameRun(e){}uninstall(){super.uninstall()}destroy(){super.destroy(),this.chooseFocus&&(this.chooseFocus.removeSelf(),this.chooseFocus.destroy(),this.chooseFocus=null)}}class Zi extends Wi{constructor(){super()}onEnable(){super.onEnable();this.layaMonitor(ge.game.MONSTER_INSTALL_STATE,this.onStateInstallHandler,this.owner),this.monitor(ge.task.TASK_REF,this.onTaskRefHandler),this.onTaskRefHandler()}onTaskRefHandler(){for(var e=Ve.task.getTaskListByStateAndTargetId(jt.ACCEPT_ENTRUST,this.owner.tbId),t=0;t<e.length;t++){var i=e[t];i.tb.taskType==jt.ACCEPT_ENTRUST?(this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"ARRIVE_DESTINATION",params:{taskId:i.taskId}}),this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"TALK",params:{taskId:i.taskId}})):this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"ARRIVE_DESTINATION",params:{taskId:i.taskId}})}}onStateInstallHandler(e){switch(e.state){case"ARRIVE_DESTINATION":this.script.state.install("ARRIVE_DESTINATION",Ki,e.params);break;case"TALK":this.script.state.install("TALK",Ji,e.params)}}onDestroy(){super.onDestroy()}}class Qi extends nt{constructor(){super(),this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isRide=!1}onEnable(){let e=this;if(!e.script){e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,ji);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi)}e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi))}npcLineAi(){var e,t=this.owner.transform.position.clone(),i=this.speed;e=this.moveIndex>=this.script.pathinfo.lines.length-1?this.script.pathinfo.lines[0]:this.script.pathinfo.lines[this.moveIndex+1];var s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[1]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a);s.d<=n&&(this.moveIndex++,this.moveIndex>=this.script.pathinfo.lines.length&&(this.moveIndex=0),e=this.moveIndex>=this.script.pathinfo.lines.length-1?this.script.pathinfo.lines[0]:this.script.pathinfo.lines[this.moveIndex+1],s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[1]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a));var o=calcPosAngle({x:t.x,y:-t.z},{x:e[0],y:-e[1]},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z),this.saveMovePos=this.owner.transform.position.clone()}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&!e.isRide)if(e.script&&e.script.route){if(1==e.script.route.npcAi){if(e.script&&e.script.hitTrigger&&e.script.hitTrigger.isTrigger)return;e.npcLineAi()}else if(2==e.script.route.npcAi){(t=e.checkAction.checkAll(10,1))&&t.mode?(e.npcEscapeAi(t.mode),e.workaiCount=180,e.isDeviate=!0):e.workaiCount>0?(e.npcEscapeWorkAi(),e.workaiCount--):e.isDeviate?e.npcDeviateLineAi():e.npcLineAi()}else if(3==e.script.route.npcAi){var t=e.checkAction.checkAll(10,1),i=ie.attack;if(40003==e.script.tbthing.thingId&&(i=ie.attack1),t&&t.mode&&e.script.hitTrigger.isTrigger){if(e.script.ani.state!=i)e.script.playAni(i),(s=t.mode.getComponent(at))&&e.owner.timerOnce(300,e,()=>{e.script.hitTrigger.isTrigger&&s.hitHurt(e.script.tbthing.attack)})}else{if(e.script.ani.state==i)return;(t=e.checkAction.checkAll(10,1))&&t.mode?(!e.isDeviate&&e.script.tbthing.pursuitSound&&Tn.inst.sound.play(e.script.tbthing.pursuitSound),e.npcTrackAi(t.mode),e.script.playAni(ie.run),e.workaiCount=100,e.isDeviate=!0):e.workaiCount>0?(e.npcTrackWorkAi(),e.workaiCount--):e.isDeviate?e.npcDeviateLineAi():e.npcLineAi()}}}else if(e.script&&e.script.tbthing){i=ie.attack;if(40003==e.script.tbthing.thingId&&(i=ie.attack1),(t=e.checkAction.checkAll(10,1))&&t.mode&&e.script.hitTrigger.isTrigger){var s;if(e.script.ani.state!=i)e.script.playAni(i),(s=t.mode.getComponent(at))&&e.owner.timerOnce(300,e,()=>{e.script.hitTrigger.isTrigger&&s.hitHurt(e.script.tbthing.attack)})}else{if(e.script.ani.state==i)return;(t=e.checkAction.checkAll(10,1))&&t.mode?(e.npcTrackAi(t.mode),e.script.playAni(ie.run),e.workaiCount=100,e.isDeviate=!0):e.workaiCount>0?(e.npcTrackWorkAi(),e.workaiCount--):e.script.playAni(ie.idle)}}}onDestroy(){super.onDestroy()}}class $i extends it{constructor(){super(),this.list=["lh_2001","lh_2002","lh_2003","lh_2004","lh_2005"],this.Carlist=["che001","che002","che004","che005","che006","che007","che008"]}onAwake(){this.index=0}replacePlayer(e){var t=this,i=a.role.getTbByRoleId(e),s=i.roleMod+".lh";let n=t.playbody.getComponent(ht);n.showReplace();var o=()=>{Tn.inst.load3d.thingRes(ce.getRoletUrl(s),null,initHandler(t,e=>{if(e){var a=t.playbody.getChildByName("mode");a.removeSelf(),a.destroy(),e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.transform.localScale=new Laya.Vector3(.1,.1,.1),t.playbody.addChild(e),e.name="mode",t.playbody.getComponent(ht).thing=e,e.createtime=(new Date).getTime(),e.roleId=i.roleId,e.tb=i,t.playerRoldId=i.roleId,n.role=i,ea.scene.cameraCode.cameraType=Ve.map.map.startCamera,ea.scene.cameraCode.initCameraPlay(),n.hideReplace(),cafe.event.dispatch(se.GAME_ATT_STATE,1)}else serror("mapThingRes加载资源失败：",s)}))};n.isride?t.unRidePlayer(initHandler(t,()=>{o(),n.isride=!1})):o()}ridePlayer(e){var t,i=this;e.mode&&!e.mode.tb&&(t=e.mode,e.mode=e.mode.getChildAt(0));var s=a.role.getTbByRoleId(i.playerRoldId),n=a.role.getTbByRoleId(s.returnRole).roleMod+".lh";Tn.inst.load3d.thingRes(ce.getRoletUrl(n),null,initHandler(i,a=>{if(!a)return void serror("mapThingRes加载资源失败：",n);var o=i.playbody.getComponent(ht);o.moveTrigger.ClearTrigger(),i.rideData={};var r=e.mode.getComponent(Qi);r&&(r.isRide=!0);var l=i.playbody.getChildByName("mode");l.removeSelf(),l.destroy(),i.playbody.addChild(e.mode),e.mode.transform.localPosition=new Laya.Vector3(0,0,0),e.mode.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.mode.transform.localScale=new Laya.Vector3(1,1,1);e.mode;t&&(t.removeSelf(),t.destroy()),i.rideData.name=e.mode.name,e.mode.name="mode",o.thing=e.mode,ni.getName(e.mode,e.tb.modPath).addChild(a),a.transform.localPosition=new Laya.Vector3(0,0,0),a.transform.localRotationEuler=new Laya.Vector3(0,0,0),a.transform.localScale=new Laya.Vector3(1,1,1),e.mode.roleId=s.roleId,i.rideData.tb=e.mode.tb,e.mode.tb=s,i.playerRoldId=s.roleId;let h=i.playbody.getComponent(ht);h.role=s,h.moveTrigger.isHit=!1,h.isride=!0,cafe.event.dispatch(se.GAME_ATT_STATE,0)}))}unRidePlayer(e){var t=this;if(!t.rideData)return;var i=a.role.getTbByRoleId(t.playerRoldId),s=i.roleMod+".lh";if(!t.playbody)return;let n=t.playbody.getComponent(ht);Tn.inst.load3d.thingRes(ce.getRoletUrl(s),null,initHandler(t,a=>{if(a){var o=t.playbody.getChildByName("mode");if(o){o.name=t.rideData.name;var r,l=o.getComponent(Qi);l?(l.isRide=!1,o.tb=t.rideData.tb):o.tb=t.rideData.tb,(r=ni.getName(o,o.tb.modPath))&&r.removeChildren();var h=o.transform.position.clone();ea.scene.mainscene.getChildByName("map").addChild(o),o.transform.position=new Laya.Vector3(h.x,h.y,h.z)}var c=getDistanceAngleEToPos({x:t.playbody.transform.position.x,y:t.playbody.transform.position.z},3,o.transform.rotationEuler.y+90);t.playbody.transform.position=new Laya.Vector3(c.x,0,c.y),a&&(a.transform.localPosition=new Laya.Vector3(0,0,0),a.transform.localRotationEuler=new Laya.Vector3(0,0,0),a.transform.localScale=new Laya.Vector3(1,1,1),t.playbody.addChild(a),a.name="mode",n.thing=a,a.createtime=(new Date).getTime(),a.roleId=i.roleId,a.tb=i),t.playerRoldId=i.roleId,n.role=i,e&&e.run(),n.isride=!1,cafe.event.dispatch(se.GAME_ATT_STATE,1)}else serror("mapThingRes加载资源失败：",s)}))}createPlayer(){let e=this;if(console.log("开始创建玩家"),e.playbody){var t=e.playbody.getComponent(ht);t&&t.role&&t.role.roleId!=Ve.game.roleid&&(t.destroy(),t=null,e.playbody=null)}if(e.playerRoldId==Ve.game.roleid)return ea.scene.cameraCode.cameraType=Ve.map.map.startCamera,void ea.scene.cameraCode.initCameraPlay();e.playbody||(e.playbody=Ve.map.mptData.playerBody);var i=e.playbody;if(!i.parent)return;var s=ea.scene.mainscene.getChildByName("map"),a=new Laya.Vector3(i.transform.position.x,i.transform.position.y,i.transform.position.z),n=new Laya.Vector3(i.transform.rotationEuler.x,i.transform.rotationEuler.y,i.transform.rotationEuler.z),o=Ve.role.getCurrRole().tb;e.playerRoldId=o.roleId;var r=o.roleScale*Ve.map.map.scale;i.transform.localScale=new Laya.Vector3(r,r,r),i.name="player",s.addChild(e.playbody);let l=e.playbody.transform;l.position=a,l.rotationEuler=n,oi.singleton.mptData.showTaskArrow(l),console.log("玩家创建完成"),ea.scene.cameraCode.cameraType=Ve.map.map.startCamera,ea.scene.cameraCode.initCameraPlay(),ea.scene.gamestartPos=e.playbody.transform.position.clone(),ea.scene.player.landY=ea.scene.player.owner.transform.localPositionY,oi.singleton.mptData.refThing(e.playbody.transform),cafe.event.dispatch(se.GAME_ATT_STATE,1),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH)}createNpc(){if(0==Ve.game.MaoMaoGameType){var e=Ve.npc.getCurrNpc().tb.configId,t=(ea.scene.mainscene.getChildByName("map"),Ve.map.map);Ve.game.mission.targetMap==t.mapId&&0!=Ve.game.mission.missionData?String(Ve.game.mission.missionData):String(t.defaultMissionData);var i=Laya.loader.getRes("res/res3D/role/"+e+".lh");Ve.map.mptData.loadRole(i,initHandler(this,e=>{serror("加载完成角色"),Ve.map.loadcount++}))}}onDestroy(){super.onDestroy()}}class es{}es.position=1,es.rotationEuler=2,es.scale=3,es.localPosition=4,es.localRotationEuler=5,es.localScale=6;class ts{get count(){return this._count}set count(e){this._count=e,this.handler&&this.handler.runWith([e])}static getTweenid(e){var t=ts;return e._tweenid?e._tweenid:(e._tweenid=t._tweenid,t._tweenid++,e._tweenid)}static conTween(e,t){var i=ts,s=100*ts.getTweenid(e)+t;return null!=i.dic[s]}static clearFish(e,t){var i=ts,s=100*ts.getTweenid(e)+t;null!=i.dic[s]&&(i.dic[s].tween.clear(),delete i.dic[s])}static Localposition(e,t,i,s,a,n){var o=ts,r=100*ts.getTweenid(e)+es.localPosition;null!=o.dic[r]&&(o.dic[r].tween.clear(),delete o.dic[r]);var l=e.localPosition.x,h=i.x-e.localPosition.x,c=e.localPosition.y,d=i.y-e.localPosition.y,u=e.localPosition.z,p=i.z-e.localPosition.z,m=new ts;m.handler=new Laya.Handler(m,t=>{var i=t/1e4,s=l+h*i,a=c+d*i,o=u+p*i;e.localPosition=new Laya.Vector3(s,a,o),n&&n.runWith([t])}),m._count=0;var g=new Laya.Tween;g.to(m,{count:1e4},t,s,initHandler(o,()=>{g.clear();var t=l+h,i=c+d,s=u+p;e.localPosition=new Laya.Vector3(t,i,s),delete o.dic[r],n&&(n.runWith([1e4]),n.clear(),n=null),a&&a.run()})),ts.dic[r]={target:e,util:m,tween:g}}static position(e,t,i,s,a,n){var o=ts,r=100*ts.getTweenid(e)+es.position;null!=o.dic[r]&&(o.dic[r].tween.clear(),delete o.dic[r]);var l=e.position.x,h=i.x-e.position.x,c=e.position.y,d=i.y-e.position.y,u=e.position.z,p=i.z-e.position.z,m=new ts;m.handler=new Laya.Handler(m,t=>{var i=t/1e4,s=l+h*i,a=c+d*i,o=u+p*i;e.position=new Laya.Vector3(s,a,o),n&&n.runWith([t])}),m._count=0;var g=new Laya.Tween;g.to(m,{count:1e4},t,s,initHandler(o,()=>{g.clear();var t=l+h,i=c+d,s=u+p;e.position=new Laya.Vector3(t,i,s),delete o.dic[r],n&&(n.runWith([1e4]),n.clear(),n=null),a&&a.run()})),ts.dic[r]={target:e,util:m,tween:g}}static localscale(e,t,i,s,a,n){var o=ts,r=100*ts.getTweenid(e)+es.localScale;null!=o.dic[r]&&(o.dic[r].tween.clear(),delete o.dic[r]);var l=e.localScale.x,h=i.x-e.localScale.x,c=e.localScale.y,d=i.y-e.localScale.y,u=e.localScale.z,p=i.z-e.localScale.z,m=new ts;m.handler=new Laya.Handler(m,t=>{var i=t/1e4,s=l+h*i,a=c+d*i,o=u+p*i;e.localScale=new Laya.Vector3(s,a,o),n&&n.runWith([t])}),m._count=0;var g=new Laya.Tween;g.to(m,{count:1e4},t,s,initHandler(o,()=>{g.clear();var t=l+h,i=c+d,s=u+p;e.localScale=new Laya.Vector3(t,i,s),delete o.dic[r],n&&(n.runWith([1e4]),n.clear(),n=null),a&&a.run()})),ts.dic[r]={target:e,util:m,tween:g}}static to(e,t,i,s,a){var n=ts,o=100*ts.getTweenid(e)+es.localScale;null!=n.dic[o]&&(n.dic[o].tween.clear(),delete n.dic[o]);var r=new ts;r.handler=new Laya.Handler(r,e=>{a&&a.runWith([e,l])}),r._count=0;var l=new Laya.Tween;l.to(r,{count:1e4},t,i,initHandler(n,()=>{l.clear(),delete n.dic[o],a&&(a.runWith([1e4]),a.clear(),a=null),s&&s.run()})),ts.dic[o]={target:e,util:r,tween:l}}static Spring3DAni(e,t,i,s,a,n,o){var r;r=i.clone(),i=new Laya.Vector3(i.x*s,i.y*s,i.z*s),ts.localscale(e,t,i,a,n,initHandler(this,()=>{ts.localscale(e,t,r,a,n,o)}))}}ts.dic={},ts._tweenid=0,function(e){class t{}t._role_11810077_lh=0,t._role_11812124_lh=1,t._role_11812125_lh=2,t._role_11812126_lh=3,t._role_11812127_lh=4,t._role_11812129_lh=5,t._role_11812130_lh=6,t._role_11812131_lh=7,t._role_11861050_lh=8,t._role_40810288_lh=9,t._role_40810289_lh=10,t._role_40810290_lh=11,t._role_40810291_lh=12,t._role_40810303_lh=13,t._role_40810304_lh=14,t._role_40810305_lh=15,t._role_40810306_lh=16,t._role_40810307_lh=17,t._role_40812157_lh=18,t._role_40812158_lh=19,t._role_40812159_lh=20,t._role_40812160_lh=21,t._role_40812163_lh=22,t._role_40812164_lh=23,t._role_40812165_lh=24,t._role_40812166_lh=25,t._role_40812167_lh=26,t._role_40812168_lh=27,t._role_40813032_lh=28,e.res_enum=t,e.res_dic={0:"role/11810077.lh",1:"role/11812124.lh",2:"role/11812125.lh",3:"role/11812126.lh",4:"role/11812127.lh",5:"role/11812129.lh",6:"role/11812130.lh",7:"role/11812131.lh",8:"role/11861050.lh",9:"role/40810288.lh",10:"role/40810289.lh",11:"role/40810290.lh",12:"role/40810291.lh",13:"role/40810303.lh",14:"role/40810304.lh",15:"role/40810305.lh",16:"role/40810306.lh",17:"role/40810307.lh",18:"role/40812157.lh",19:"role/40812158.lh",20:"role/40812159.lh",21:"role/40812160.lh",22:"role/40812163.lh",23:"role/40812164.lh",24:"role/40812165.lh",25:"role/40812166.lh",26:"role/40812167.lh",27:"role/40812168.lh",28:"role/40813032.lh"},e.res={"role/11810077.lh":["Assets/juese/yinghuajuese/yinghua_npc/textures/xinnianpaoku .jpg"],"role/11812124.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu01.jpg"],"role/11812125.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu02.jpg"],"role/11812126.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu03.jpg"],"role/11812127.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu04.jpg"],"role/11812129.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu06.jpg"],"role/11812130.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu07.jpg"],"role/11812131.lh":["Assets/juese/yinghuajuese/paokuchongwu/textures/chongwu08.jpg"],"role/11861050.lh":["Assets/moxing/ufo/ufo.jpg","Assets/FX/jiantou/view.png","Assets/FX/Textures/creat72-m.jpg","Assets/FX/Textures/l00030_1.png"],"role/40810288.lh":["Assets/juese/tunshijinghuajuese/textures/shayuHJ.png"],"role/40810289.lh":["Assets/juese/tunshijinghuajuese/textures/xiangjiaohou.jpg"],"role/40810290.lh":["Assets/juese/tunshijinghuajuese/textures/xigua.jpg","Assets/juese/tunshijinghuajuese/textures/eyu.jpg"],"role/40810291.lh":["Assets/juese/tunshijinghuajuese/textures/qingwaren.jpg","Assets/juese/tunshijinghuajuese/textures/shenti.jpg"],"role/40810303.lh":["Assets/juese/tunshijinghuajuese/textures/xinmugunrenHJ.jpg"],"role/40810304.lh":["Assets/juese/tunshijinghuajuese/textures/daxiangHJ.jpg","Assets/juese/tunshijinghuajuese/textures/daxiangtouHJ.png"],"role/40810305.lh":["Assets/juese/tunshijinghuajuese/textures/shurenHJ.jpg"],"role/40810306.lh":["Assets/juese/tunshijinghuajuese/textures/kafeirenzhe.jpg"],"role/40810307.lh":["Assets/juese/danzai/danzaiguajian/textures/666.jpg","Assets/juese/jujiwaixingren/textures/rongheguai.jpg"],"role/40812157.lh":["Assets/juese/tunshijinghuajuese/textures/xiezi.jpg","Assets/juese/tunshijinghuajuese/textures/shayuHJ.png"],"role/40812158.lh":["Assets/juese/tunshijinghuajuese/textures/xiangjiaohou.jpg"],"role/40812159.lh":["Assets/juese/tunshijinghuajuese/textures/xigua.jpg","Assets/juese/tunshijinghuajuese/textures/eyu.jpg"],"role/40812160.lh":["Assets/juese/tunshijinghuajuese/textures/qingwaren.jpg","Assets/juese/tunshijinghuajuese/textures/shenti.jpg"],"role/40812163.lh":["Assets/juese/tunshijinghuajuese/textures/xinmugunrenHJ.jpg"],"role/40812164.lh":["Assets/juese/tunshijinghuajuese/textures/daxiangHJ.jpg","Assets/juese/tunshijinghuajuese/textures/daxiangtouHJ.png"],"role/40812165.lh":["Assets/juese/tunshijinghuajuese/textures/shurenHJ.jpg"],"role/40812166.lh":["Assets/juese/tunshijinghuajuese/textures/shayuHJ.png"],"role/40812167.lh":["Assets/juese/tunshijinghuajuese/textures/kafeirenzhe.jpg"],"role/40812168.lh":["Assets/juese/jujiwaixingren/textures/rongheguai.jpg"],"role/40813032.lh":["Assets/juese/jujiwaixingren/textures/tungtungren.jpg"]},e.config={"role/11810077.lh":["Assets/juese/yinghuazhujue/dongzuo/idle002-Take 001.lani","Assets/juese/yinghuazhujue/juesedongzuo@walk-walk.lani","Assets/juese/yinghuazhujue/juesedongzuo@run-run.lani","Assets/flyshort-flyshort.lani","Assets/juese/yinghuazhujue/juesedongzuo@jinzhan05-jinzhan05.lani","Assets/juese/nvzhujue@qima-qima.lani","Assets/juese/GTAgtx/ride-ride.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@jump01-jump01.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@jump02_3-jump02_3.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@jump03_1-jump03_1.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@jump04-jump04.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@liangqiang-liangqiang.lani","Assets/zhizhuxia/juesedongzuo@motuo-motuo.lani","Assets/juese/yinghuazhujue/juesedongzuo@zhongdiantiao-zhongdiantiao.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@huabang-huabang.lani","Assets/juese/yinghuazhujue/juesedongzuo@pa-pa.lani","Assets/juese/yinghuazhujue/juesedongzuo@paidle-paidle.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@idle02-idle02.lani","Assets/juese/yinghuazhujue/juesedongzuo@baoren_idle-baoren_idle.lani","Assets/juese/yinghuazhujue/juesedongzuo@baoren_run-baoren_run.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@chi-chi.lani","Assets/juese/yinghuazhujue/juesedongzuo@sit-sit.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@qizixingche-qizixingche.lani","Assets/juese/yinghuazhujue/dongzuo/juesedongzuo@qizixingcheidle-qizixingcheidle.lani","Assets/juese/yinghuazhujue/juesedongzuo@hit-hit.lani","Assets/juese/yinghuazhujue/juesedongzuo@shuijiao-shuijiao.lani","Assets/juese/yinghuazhujue/juesedongzuo@beishang-beishang.lani","Assets/juese/yinghuajuese/yinghua_npc/materials/xinnianpaoku .lmat"],"role/11812124.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu01@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu01@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu01.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu01-chongwu01.lm"],"role/11812125.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu02@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu02@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu02.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu02-chongwu02.lm"],"role/11812126.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu03@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu03@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu03.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu03-chongwu03.lm"],"role/11812127.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu04@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu04@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu04.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu04-chongwu04.lm"],"role/11812129.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu06@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu06@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu06.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu06-chongwu06.lm"],"role/11812130.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu07@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu07@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu07.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu07-chongwu07.lm"],"role/11812131.lh":["Assets/juese/yinghuajuese/paokuchongwu/chongwu08@idle-idle.lani","Assets/juese/yinghuajuese/paokuchongwu/chongwu08@walk-walk.lani","Assets/juese/yinghuajuese/paokuchongwu/materials/chongwu08.lmat","Assets/juese/yinghuajuese/paokuchongwu/chongwu08-chongwu08.lm"],"role/11861050.lh":["Assets/moxing/ufo/ufo@idle-idle.lani","Assets/moxing/ufo/ufo@walk-walk.lani","Assets/moxing/ufo/Materials/ufo.lmat","Assets/moxing/ufo/ufo-ufo.lm","Assets/FX/jiantou/Materials/mfd.lmat","Assets/FX/jiantou/pian-Plane001.lm","Assets/FX/Materials/zisejiludian.lmat","Assets/FX/Materials/quan02.lmat"],"role/40810288.lh":["Assets/juese/tunshijinghuajuese/sanjiaoshayu@idle-idle.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@hit-hit.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@attack-attack.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@skill-skill.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@walk-walk.lani","Assets/juese/tunshijinghuajuese/materials/shayu.lmat","Assets/juese/tunshijinghuajuese/sanjiaoshayu-sanjiaoshayu.lm"],"role/40810289.lh":["Assets/juese/tunshijinghuajuese/xiangjiaohou@idle-idle.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@attack-attack.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@hit-hit.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@walk-walk.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/materials/xiangjiaohou.lmat","Assets/juese/tunshijinghuajuese/xiangjiaohou-xiangjiaohou.lm"],"role/40810290.lh":["Assets/juese/tunshijinghuajuese/xiguaeyu@idle-idle.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@attack-attack.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@hit-hit.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@walk-walk.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/xiguaeyu-xigua.lm","Assets/juese/tunshijinghuajuese/materials/xigua.lmat","Assets/juese/tunshijinghuajuese/materials/eyu.lmat","Assets/juese/tunshijinghuajuese/xiguaeyu-xiguaeyu.lm"],"role/40810291.lh":["Assets/juese/nanzhujue@idle02-idle02.lani","Assets/juese/zhizhuxia/Run-run.lani","Assets/juese/zhizhuxia/Walk-walk.lani","Assets/juese/zhizhuxia/hit-hit.lani","Assets/juese/kklt/kklt@attack2-attack2.lani","Assets/juese/zhizhuxia/idle-idle.lani","Assets/juese/zhizhuxia/zhizhuxia@paqiang-paqiang.lani","Assets/juese/zhizhuxia/zhizhuxia@paqiang_idle-paqiang_idle.lani","Assets/juese/zhizhuxia/zhizhuxia@jump101-jump101.lani","Assets/juese/zhizhuxia/zhizhuxia@jump102-jump102.lani","Assets/juese/zhizhuxia/zhizhuxia@jump103-jump103.lani","Assets/juese/zhizhuxia/zhizhuxia@jump104-jump104.lani","Assets/juese/zhizhuxia/zhizhuxia@qima-qima.lani","Assets/juese/zhizhuxia/zhizhuxia@motuo-motuo.lani","Assets/juese/zhizhuxia/aodebiao@qiche-qiche.lani","Assets/juese/zhizhuxia/aodebiao@qicheidle-qicheidle.lani","Assets/juese/tunshijinghuajuese/luntairen-luntai.lm","Assets/juese/tunshijinghuajuese/materials/qingwaren.lmat","Assets/juese/tunshijinghuajuese/luntairen-qingwa.lm","Assets/juese/tunshijinghuajuese/materials/shenti.lmat","Assets/juese/tunshijinghuajuese/luntairen-zhuzhixia.lm"],"role/40810303.lh":["Assets/juese/tunshijinghuajuese/xinmugunren@idle-idle.lani","Assets/juese/tunshijinghuajuese/xinmugunren@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/xinmugunren@hit-hit.lani","Assets/juese/tunshijinghuajuese/xinmugunren@attack-attack.lani","Assets/juese/tunshijinghuajuese/xinmugunren@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/xinmugunren@run-run.lani","Assets/juese/tunshijinghuajuese/xinmugunren@walk-walk.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/xinmugunren@pa-pa.lani","Assets/juese/tunshijinghuajuese/xinmugunren@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/xinmugunren-mugun.lm","Assets/juese/tunshijinghuajuese/materials/xinmugunren.lmat","Assets/juese/tunshijinghuajuese/xinmugunren-mugunren.lm"],"role/40810304.lh":["Assets/juese/tunshijinghuajuese/daxiang@idle-idle.lani","Assets/juese/tunshijinghuajuese/daxiang@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/daxiang@hit-hit.lani","Assets/juese/tunshijinghuajuese/daxiang@attack-attack.lani","Assets/juese/tunshijinghuajuese/daxiang@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/daxiang@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/daxiang@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/daxiang@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/daxiang@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/daxiang@run-run.lani","Assets/juese/tunshijinghuajuese/daxiang@walk-walk.lani","Assets/juese/tunshijinghuajuese/materials/daxiang.lmat","Assets/juese/tunshijinghuajuese/daxiang-daxiang.lm","Assets/juese/tunshijinghuajuese/materials/daxiangtou.lmat","Assets/juese/tunshijinghuajuese/daxiang-daxiangtou.lm"],"role/40810305.lh":["Assets/juese/tunshijinghuajuese/shuren@idle-idle.lani","Assets/juese/tunshijinghuajuese/shuren@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/shuren@hit-hit.lani","Assets/juese/tunshijinghuajuese/shuren@attack-attack.lani","Assets/juese/tunshijinghuajuese/shuren@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/shuren@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/shuren@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/shuren@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/shuren@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/shuren@run-run.lani","Assets/juese/tunshijinghuajuese/shuren@walk-walk.lani","Assets/juese/tunshijinghuajuese/shuren@pa-pa.lani","Assets/juese/tunshijinghuajuese/shuren@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/materials/shuren.lmat","Assets/juese/tunshijinghuajuese/shuren-shuren.lm"],"role/40810306.lh":["Assets/juese/tunshijinghuajuese/kafeirenzhe@idle-idle.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@hit-hit.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@attack-attack.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@run-run.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@walk-walk.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@pa-pa.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/materials/kafeirenzhe.lmat","Assets/juese/tunshijinghuajuese/kafeirenzhe-kafeirenzhe.lm"],"role/40810307.lh":["Assets/juese/tunshijinghuajuese/rongheguai@idle-idle.lani","Assets/juese/tunshijinghuajuese/rongheguai@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/rongheguai@die-die.lani","Assets/juese/tunshijinghuajuese/rongheguai@hit-hit.lani","Assets/juese/tunshijinghuajuese/rongheguai@attack01-attack01.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/rongheguai@kaiche-kaiche.lani","Assets/juese/tunshijinghuajuese/rongheguai@motuo-motuo.lani","Assets/juese/tunshijinghuajuese/rongheguai@run-run.lani","Assets/juese/tunshijinghuajuese/rongheguai@walk-walk.lani","Assets/juese/tunshijinghuajuese/rongheguai@pa-pa.lani","Assets/juese/tunshijinghuajuese/rongheguai@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/rongheguai@qingzhu-qingzhu.lani","Assets/juese/danzai/danzaiguajian/yanjing01-yanjing01.lm","Assets/juese/danzai/danzaiguajian/materials/666.lmat","Assets/juese/tunshijinghuajuese/materials/rongheguai.lmat","Assets/juese/tunshijinghuajuese/rongheguai-rongheguai.lm"],"role/40812157.lh":["Assets/juese/tunshijinghuajuese/shayu@idle-idle.lani","Assets/juese/tunshijinghuajuese/shayu@attack-attack.lani","Assets/juese/tunshijinghuajuese/shayu@hit-hit.lani","Assets/juese/tunshijinghuajuese/shayu@walk-walk.lani","Assets/juese/tunshijinghuajuese/shayu@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/shayu@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/shayu@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/shayu@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/materials/xiezi.lmat","Assets/juese/tunshijinghuajuese/materials/shayu.lmat","Assets/juese/tunshijinghuajuese/shayu-shayu.lm"],"role/40812158.lh":["Assets/juese/tunshijinghuajuese/xiangjiaohou@idle-idle.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@attack-attack.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@hit-hit.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@walk-walk.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xiangjiaohou@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/materials/xiangjiaohou.lmat","Assets/juese/tunshijinghuajuese/xiangjiaohou-xiangjiaohou.lm"],"role/40812159.lh":["Assets/juese/tunshijinghuajuese/xiguaeyu@idle-idle.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@attack-attack.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@hit-hit.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@walk-walk.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xiguaeyu@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/xiguaeyu-xigua.lm","Assets/juese/tunshijinghuajuese/materials/xigua.lmat","Assets/juese/tunshijinghuajuese/materials/eyu.lmat","Assets/juese/tunshijinghuajuese/xiguaeyu-xiguaeyu.lm"],"role/40812160.lh":["Assets/juese/nanzhujue@idle02-idle02.lani","Assets/juese/zhizhuxia/Run-run.lani","Assets/juese/zhizhuxia/Walk-walk.lani","Assets/juese/zhizhuxia/hit-hit.lani","Assets/juese/kklt/kklt@attack2-attack2.lani","Assets/juese/zhizhuxia/idle-idle.lani","Assets/juese/zhizhuxia/zhizhuxia@paqiang-paqiang.lani","Assets/juese/zhizhuxia/zhizhuxia@paqiang_idle-paqiang_idle.lani","Assets/juese/zhizhuxia/zhizhuxia@jump101-jump101.lani","Assets/juese/zhizhuxia/zhizhuxia@jump102-jump102.lani","Assets/juese/zhizhuxia/zhizhuxia@jump103-jump103.lani","Assets/juese/zhizhuxia/zhizhuxia@jump104-jump104.lani","Assets/juese/zhizhuxia/zhizhuxia@qima-qima.lani","Assets/juese/zhizhuxia/zhizhuxia@motuo-motuo.lani","Assets/juese/zhizhuxia/aodebiao@qiche-qiche.lani","Assets/juese/zhizhuxia/aodebiao@qicheidle-qicheidle.lani","Assets/juese/tunshijinghuajuese/luntairen-luntai.lm","Assets/juese/tunshijinghuajuese/materials/qingwaren.lmat","Assets/juese/tunshijinghuajuese/luntairen-qingwa.lm","Assets/juese/tunshijinghuajuese/materials/shenti.lmat","Assets/juese/tunshijinghuajuese/luntairen-zhuzhixia.lm"],"role/40812163.lh":["Assets/juese/tunshijinghuajuese/xinmugunren@idle-idle.lani","Assets/juese/tunshijinghuajuese/xinmugunren@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/xinmugunren@hit-hit.lani","Assets/juese/tunshijinghuajuese/xinmugunren@attack-attack.lani","Assets/juese/tunshijinghuajuese/xinmugunren@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/xinmugunren@run-run.lani","Assets/juese/tunshijinghuajuese/xinmugunren@walk-walk.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/xinmugunren@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/xinmugunren@pa-pa.lani","Assets/juese/tunshijinghuajuese/xinmugunren@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/materials/xinmugunren.lmat","Assets/juese/tunshijinghuajuese/xinmugunren-mugunren.lm"],"role/40812164.lh":["Assets/juese/tunshijinghuajuese/daxiang@idle-idle.lani","Assets/juese/tunshijinghuajuese/daxiang@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/daxiang@hit-hit.lani","Assets/juese/tunshijinghuajuese/daxiang@attack-attack.lani","Assets/juese/tunshijinghuajuese/daxiang@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/daxiang@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/daxiang@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/daxiang@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/daxiang@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/daxiang@run-run.lani","Assets/juese/tunshijinghuajuese/daxiang@walk-walk.lani","Assets/juese/tunshijinghuajuese/materials/daxiang.lmat","Assets/juese/tunshijinghuajuese/daxiang-daxiang.lm","Assets/juese/tunshijinghuajuese/materials/daxiangtou.lmat","Assets/juese/tunshijinghuajuese/daxiang-daxiangtou.lm"],"role/40812165.lh":["Assets/juese/tunshijinghuajuese/shuren@idle-idle.lani","Assets/juese/tunshijinghuajuese/shuren@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/shuren@hit-hit.lani","Assets/juese/tunshijinghuajuese/shuren@attack-attack.lani","Assets/juese/tunshijinghuajuese/shuren@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/shuren@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/shuren@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/shuren@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/shuren@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/shuren@run-run.lani","Assets/juese/tunshijinghuajuese/shuren@walk-walk.lani","Assets/juese/tunshijinghuajuese/shuren@pa-pa.lani","Assets/juese/tunshijinghuajuese/shuren@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/materials/shuren.lmat","Assets/juese/tunshijinghuajuese/shuren-shuren.lm"],"role/40812166.lh":["Assets/juese/tunshijinghuajuese/sanjiaoshayu@idle-idle.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@hit-hit.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@attack-attack.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@skill-skill.lani","Assets/juese/tunshijinghuajuese/sanjiaoshayu@walk-walk.lani","Assets/juese/tunshijinghuajuese/materials/shayu.lmat","Assets/juese/tunshijinghuajuese/sanjiaoshayu-sanjiaoshayu.lm"],"role/40812167.lh":["Assets/juese/tunshijinghuajuese/kafeirenzhe@idle-idle.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@hit-hit.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@attack-attack.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@run-run.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@walk-walk.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@pa-pa.lani","Assets/juese/tunshijinghuajuese/kafeirenzhe@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/materials/kafeirenzhe.lmat","Assets/juese/tunshijinghuajuese/kafeirenzhe-kafeirenzhe.lm"],"role/40812168.lh":["Assets/juese/tunshijinghuajuese/rongheguai@idle-idle.lani","Assets/juese/tunshijinghuajuese/rongheguai@beibaofeixing-beibaofeixing.lani","Assets/juese/tunshijinghuajuese/rongheguai@die-die.lani","Assets/juese/tunshijinghuajuese/rongheguai@hit-hit.lani","Assets/juese/tunshijinghuajuese/rongheguai@attack01-attack01.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump101-jump101.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump102-jump102.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump103-jump103.lani","Assets/juese/tunshijinghuajuese/rongheguai@jump104-jump104.lani","Assets/juese/tunshijinghuajuese/rongheguai@kaiche-kaiche.lani","Assets/juese/tunshijinghuajuese/rongheguai@motuo-motuo.lani","Assets/juese/tunshijinghuajuese/rongheguai@run-run.lani","Assets/juese/tunshijinghuajuese/rongheguai@walk-walk.lani","Assets/juese/tunshijinghuajuese/rongheguai@pa-pa.lani","Assets/juese/tunshijinghuajuese/rongheguai@paidle-paidle.lani","Assets/juese/tunshijinghuajuese/rongheguai@qingzhu-qingzhu.lani","Assets/juese/tunshijinghuajuese/materials/rongheguai.lmat","Assets/juese/tunshijinghuajuese/rongheguai-rongheguai.lm"],"role/40813032.lh":["Assets/juese/xiangchangpaidui/xiangchangren@idle-idle.lani","Assets/juese/xiangchangpaidui/xiangchangren@beibaofeixing-beibaofeixing.lani","Assets/juese/xiangchangpaidui/xiangchangren@hit-hit.lani","Assets/juese/xiangchangpaidui/xiangchangren@attack-attack.lani","Assets/juese/xiangchangpaidui/xiangchangren@jump01-jump01.lani","Assets/juese/xiangchangpaidui/xiangchangren@jump02-jump02.lani","Assets/juese/xiangchangpaidui/xiangchangren@jump03-jump03.lani","Assets/juese/xiangchangpaidui/xiangchangren@jump04-jump04.lani","Assets/juese/xiangchangpaidui/xiangchangren@kuqi-kuqi.lani","Assets/juese/xiangchangpaidui/xiangchangren@motuo-motuo.lani","Assets/juese/xiangchangpaidui/xiangchangren@qima-qima.lani","Assets/juese/xiangchangpaidui/xiangchangren@qingzhu-qingzhu.lani","Assets/juese/xiangchangpaidui/xiangchangren@run-run.lani","Assets/juese/xiangchangpaidui/xiangchangren@walk-walk.lani","Assets/juese/xiangchangpaidui/xiangchangren@pa-pa.lani","Assets/juese/xiangchangpaidui/xiangchangren@paidle-paidle.lani","Assets/juese/niaopianbaobao/bangqiugun-bangqiugun.lm","Assets/juese/jujiwaixingren/materials/tungtungren.lmat","Assets/juese/jujiwaixingren/tungtungren-tungtungren.lm"]}}(Re||(Re={}));class is extends st{constructor(){super(),this.uiWidth=200,this.thingHeight=.12}onEnable(){super.onEnable()}init(e,t,i){let s=this;s.thing_id=e,s.thing_hp||(s.thing_hp=t),Ve.npc.equip_npc?(s.max_hp=this.Max_hp(Ve.npc.equip_npc),s.max_Attack=s.max_attack(Ve.npc.equip_npc),s.max_Speed=s.max_speed(Ve.npc.equip_npc)):(s.max_hp=t,s.max_Attack=i.attack,s.max_Speed=i.move_speed),s.monitor(se.INITNPCEQUIP,s.InitEquip)}InitEquip(e){this.max_hp=this.Max_hp(e),this.max_Attack=this.max_attack(e),this.max_Speed=this.max_speed(e),this.thing_hp+=Ve.equip.GetnpcEquipHp(),this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp),this.headview&&(this.headview.txt_hp.text=this.thing_hp+"/"+this.max_hp);var t=200*(Math.round(this.thing_hp/this.max_hp*100)/100);t<10&&(t=10),this.headview&&(this.headview.img_hp.width=t)}Max_hp(e){return Ve.equip.GetnpcEquipHp()>0?a.npc.getTbByNpcId(e).hp+Ve.equip.GetnpcEquipHp():a.npc.getTbByNpcId(e).hp}max_speed(e){return a.npc.getTbByNpcId(e).move_speed+Ve.equip.GetnpcEquipSpeed()}max_attack(e){return a.npc.getTbByNpcId(e).attack+Ve.equip.GetnpcEquipAttack()}addBsHp(e){this.thing_hp+=Math.floor(this.max_hp*(e/100)),this.thing_hp>this.max_hp&&(this.thing_hp=this.max_hp);e=Math.round(this.thing_hp/this.max_hp*100)/100;var t=this.uiWidth*e;t<10&&(t=10),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=t,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString()),this.thing_hp}revive(){this.thing_hp=this.max_hp;var e=Math.round(this.thing_hp/this.max_hp*100)/100,t=this.uiWidth*e;t<10&&(t=10),ea.scene.ui.img_rolehp&&(ea.scene.ui.img_rolehp.width=t,ea.scene.ui.rolehpNum.text=this.thing_hp.toString()+"/"+this.max_hp.toString())}onDestroy(){this.headview&&(this.headview.visible=!1),ea.scene.isGameing||super.onDestroy()}}class ss extends it{constructor(){super()}static getD3id(e){var t=ss;return e._d3id?e._d3id:(e._d3id=t._d3id,t._d3id++,e._d3id)}static getPathLineWait(e,t){var i=this,s=0;return()=>{var a,n=e.transform.localPosition.clone();a=s>=e.tracks.length-1?e.tracks[0]:e.tracks[s+1];var o=posToAngleDist({x:n.x,y:n.z},{x:a[0],y:a[2]}),r=calcAngleDist({x:n.x,y:n.z},t,o.a),l=getDistance({x:n.x,y:n.z},r);if(o.d<=l){if(i.time++,i.time<50){var h=e.getComponent(oe);return h.speed=1,void h.play(ie.idle)}i.time=0,++s>=e.tracks.length&&(s=0),a=s>=e.tracks.length-1?e.tracks[0]:e.tracks[s+1],o=posToAngleDist({x:n.x,y:n.z},{x:a[0],y:a[2]}),r=calcAngleDist({x:n.x,y:n.z},t,o.a),l=getDistance({x:n.x,y:n.z},r)}var c=calcPosAngle({x:n.x,y:-n.z},{x:a[0],y:-a[2]},!0),d=new Laya.Vector3(n.x,n.y+.5,n.z),u=new Laya.Vector3(n.x,-20,n.z),p=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(d,u,p)?e.transform.localPosition=new Laya.Vector3(r.x,p.point.y,r.y):e.transform.localPosition=new Laya.Vector3(r.x,n.y,r.y);var m=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(m.x,c,m.z),e.transform.localPosition.clone()}}static getPathLine(e,t){if(e.tracks){if(0==Ve.game.MaoMaoGameType&&2!=e.tb.bigmode){var i,s,a=0,n=!1,o=!1,r=!1,l=!1,h=e.transform.position.y,c=0,d=0,u=e.getComponent(fs),p=!1;return()=>{if(u.ani.state!=ie.liangqiang){var m,g=e.transform.localPosition.clone(),y=e.transform.position.clone();if(e.tracks.length&&a>=e.tracks.length-1){if(e.modelType==le.type_npc&&6!=Ve.map.map.gamePkType&&2!=Ve.map.map.gamePkType&&3!=Ve.map.map.gamePkType)return u.ani.play(ie.qingzhu),void(u.ani.speed=1);m=e.tracks[0]}else m=e.tracks[a+1];var f=posToAngleDist({x:g.x,y:g.z},{x:m[0],y:m[2]}),_=calcAngleDist({x:g.x,y:g.z},t,f.a),v=getDistance({x:g.x,y:g.z},_);f.d<=v&&(a++,e.tracks.length&&a>=e.tracks.length&&(a=0),m=e.tracks.length&&a>=e.tracks.length-1?e.tracks[0]:e.tracks[a+1],f=posToAngleDist({x:g.x,y:g.z},{x:m[0],y:m[2]}),_=calcAngleDist({x:g.x,y:g.z},t,f.a),v=getDistance({x:g.x,y:g.z},_));var b=calcPosAngle({x:g.x,y:-g.z},{x:m[0],y:-m[2]},!0);if(-1!=u.ani.state.indexOf("jump")&&1==p){if(u.ani.ani.getControllerLayer().getCurrentPlayState().normalizedTime>=1&&u.ani.ani.getControllerLayer().getCurrentPlayState()._finish&&(u.ani.ani.getControllerLayer().getCurrentPlayState().animatorState.name==ie.jump1?(u.playAni(ie.jump2),u.ani.speed=3,n=!1,o=!0):u.ani.ani.getControllerLayer().getCurrentPlayState().animatorState.name==ie.jump3&&(l=!1,u.ani.play(ie.walk),u.ani.speed=1,p=!1)),n||!o||l)return;var w=e.transform;d+=r?.002:.006;2.5,i=2*Math.sin(Math.PI/180*45)*2.5*d-d*d*40+c;let t=e.transform.localPositionY;var T=i-c;if(c=i,t+=T,T<=0&&(r=!0))w.position.y;t<=h+.1&&s>t&&(w.localPositionY=h,u.playAni(ie.jump3),u.ani.speed=2,o=!1,l=!0),s=t}var A=new Laya.Vector3(y.x,y.y+1.5,y.z),x=new Laya.Vector3(y.x,-20,y.z),k=[],E=new Laya.HitResult;if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(A,x,k)){E=k[0];for(var I=0;I<k.length;I++)E==k[0]&&("group_hit2"==k[0].collider.owner.name||k[0].collider.owner.name),"group_hit2"!=k[I].collider.owner.name&&"group_hit"!=k[I].collider.owner.name&&k[I].point.y>E.point.y&&(E=k[I]);if(Math.abs(E.point.y-h)>=.4&&!p)return u.ani.play(ie.jump1),p=!0,n=!0,c=0,d=0,s=0,void(h=E.point.y);-1==u.ani.state.indexOf("jump")?(u.ani.play(ie.run),e.transform.localPosition=new Laya.Vector3(_.x,E.point.y,_.y)):u.moveTrigger.isTrigger?e.transform.localPosition=new Laya.Vector3(g.x,s,g.z):e.transform.localPosition=new Laya.Vector3(_.x,s,_.y),h=E.point.y}else e.transform.localPosition=new Laya.Vector3(_.x,g.y,_.y);var C=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(C.x,b,C.z),e.transform.localPosition.clone()}else p=!1}}return this.getPathLine2(e,t)}}static getPathLine2(e,t){var i=0;return()=>{var s,a=e.transform.localPosition.clone();s=i>=e.tracks.length-1?e.tracks[0]:e.tracks[i+1];var n=posToAngleDist({x:a.x,y:a.z},{x:s[0],y:s[2]}),o=calcAngleDist({x:a.x,y:a.z},t,n.a),r=getDistance({x:a.x,y:a.z},o);n.d<=r&&(++i>=e.tracks.length&&(i=0),s=i>=e.tracks.length-1?e.tracks[0]:e.tracks[i+1],n=posToAngleDist({x:a.x,y:a.z},{x:s[0],y:s[2]}),o=calcAngleDist({x:a.x,y:a.z},t,n.a),r=getDistance({x:a.x,y:a.z},o));var l=calcPosAngle({x:a.x,y:-a.z},{x:s[0],y:-s[2]},!0),h=new Laya.Vector3(a.x,a.y+1,a.z),c=new Laya.Vector3(a.x,-2,a.z),d=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(h,c,d)&&"dropCube"!=d.collider.owner.name?e.transform.localPosition=new Laya.Vector3(o.x,d.point.y,o.y):e.transform.localPosition=new Laya.Vector3(o.x,a.y,o.y);var u=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(u.x,l,u.z),e.transform.localPosition.clone()}}static getSkyPathLine(e,t){var i=0;return()=>{var s,a=e.transform.localPosition.clone();s=i>=e.tracks.length-1?e.tracks[0]:e.tracks[i+1];var n,o=posToAngleDist({x:a.x,y:a.z},{x:s[0],y:s[2]}),r=calcAngleDist({x:a.x,y:a.z},t,o.a),l=getDistance({x:a.x,y:a.z},r);n=s[1],o.d<=l&&(++i>=e.tracks.length&&(i=0),s=i>=e.tracks.length-1?e.tracks[0]:e.tracks[i+1],o=posToAngleDist({x:a.x,y:a.z},{x:s[0],y:s[2]}),r=calcAngleDist({x:a.x,y:a.z},t,o.a),l=getDistance({x:a.x,y:a.z},r));var h=calcPosAngle({x:a.x,y:-a.z},{x:s[0],y:-s[2]},!0);e.transform.localPosition=new Laya.Vector3(r.x,n,r.y);var c=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(c.x,h,c.z),e.transform.localPosition.clone()}}static getSaveData(e){var t=e.transform;return{x:t.localPosition.x,y:t.localPosition.y,z:t.localPosition.z,l:t.localScale.x,h:t.localScale.y,w:t.localScale.z}}static returnSaveData(e){var t=e.transform,i=ss.save3dData[ss.getD3id(e)];t&&i&&(t.localPositionX=i.x,t.localPositionY=i.y,t.localPositionZ=i.z,t.localScaleX=i.l,t.localScaleY=i.h,t.localScaleZ=i.w),delete ss.save3dData[ss.getD3id(e)]}static vibrate(e,t=.04){var i=ss,s=e.transform;if(s){Laya.Tween.clearTween(s),ss.save3dData[ss.getD3id(e)]||(ss.save3dData[ss.getD3id(e)]=i.getSaveData(e));var a=ss.save3dData[ss.getD3id(e)];Laya.Tween.to(s,{localPositionX:a.x+t,localPositionY:a.y+t,localPositionZ:a.z+t},20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),Laya.Tween.to(s,{localPositionX:a.x+t,localPositionY:a.y-t,localPositionZ:a.z-t},20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),Laya.Tween.to(s,{localPositionX:a.x-t,localPositionY:a.y+t,localPositionZ:a.z-t},20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),Laya.Tween.to(s,{localPositionX:a.x-t,localPositionY:a.y-t,localPositionZ:a.z+t},20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),i.returnSaveData(e)}))}))}))}))}}static flaser(e,t="Y"){var i=ss,s=e.transform;if(s){Laya.Tween.clearTween(s),ss.save3dData[ss.getD3id(e)]||(ss.save3dData[ss.getD3id(e)]=i.getSaveData(e));var a,n,o,r,l=ss.save3dData[ss.getD3id(e)],h={};"Y"==t?(a="localScaleX",n="localScaleZ",o=l.l,r=l.w):"Z"==t?(a="localScaleY",n="localScaleX",o=l.h,r=l.l):"X"==t&&(a="localScaleY",n="localScaleZ",o=l.h,r=l.w),h["localScale"+t]=.1,h[a]=o+.2,h[n]=r+.2,Laya.Tween.to(s,h,20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),Laya.Tween.to(s,{},500,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),h["localScale"+t]=l.h+.2,h[a]=o-.2,h[n]=r-.2,Laya.Tween.to(s,h,20,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),h["localScale"+t]=l.h,h[a]=o,h[n]=r,Laya.Tween.to(s,h,80,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),i.returnSaveData(e)}))}))}))}))}}static hitfly(e,t="Y"){var i=ss,s=e.transform;if(s){Laya.Tween.clearTween(s),ss.save3dData[ss.getD3id(e)]||(ss.save3dData[ss.getD3id(e)]=i.getSaveData(e));var a=ss.save3dData[ss.getD3id(e)],n={};n["localPosition"+t]="Y"==t?a.y+2:a.z+2,Laya.Tween.to(s,n,40,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),Laya.Tween.to(s,{},500,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),n["localPosition"+t]="Y"==t?a.y:a.z,Laya.Tween.to(s,n,80,null,initHandler(i.thisobj,()=>{Laya.Tween.clearTween(s),i.returnSaveData(e)}))}))}))}}posYFlash(e,t,i){var s=this;s.tween=new Laya.Tween;var a=t,n=o=>{s.tween.clear(),s.tween.to(s.owner.transform,{localPositionY:a},i,null,initHandler(s,()=>{s.tween.clear(),a==t?(a=e,o++):a=t,n(o)}))};n(t)}roFlash(e,t,i,s){var a=this;a.tween=new Laya.Tween;var n=i,o=r=>{a.tween.clear();var l={};l["localRotationEuler"+e]=n,a.tween.to(a.owner.transform,l,s,null,initHandler(a,()=>{a.tween.clear(),n==i?(n=t,r++):n=i,o(r)}))};o(i)}static EffectMaterialTModeYAction(e,t){var i=ni.getName(e,"tmode").meshRenderer.material;e.frameLoop(1,e,()=>{i.tilingOffsetW+=t})}onDestroy(){super.onDestroy();this.tween&&(this.tween.clear(),this.tween=null)}}ss.time=0,ss._d3id=0,ss.save3dData={},ss.thisobj={};class as extends nt{constructor(){super(),this.attackNum=0,this.isCanSkill=!1,this.isAttack=!1,this.isFly=!1,this.isGun=!1,this.isDie=!1,this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isFollow=!1,this.preAttTime=0,this.FuHuoTime=0,this.FuHuoNum=0,this.talkcd=500,this.lastTalk=0,this.npctalkLock=!1,this.actionType=0,this.actionTime=0,this._actime=0,this.ismovehit=!1,this.hitdir=0,this.curChangetime=0,this.startX=0}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,fs);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi),e.monitor(Z.EQUIP_NPC,e.refNpc)}e.randomAction(),e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLineWait(e.owner,e.script.owner.tb.move_speed/1e5)),e.dikuang&&(e.dikuang.removeSelf(),e.dikuang.destroy(),e.dikuang=null),e.dikuang=new Laya.Image("res/modules/game/dengjd.png"),e.dikuang.size(300,55),e.dikuang.anchorX=.5,e.dikuang.anchorY=.5,e.dikuang.alpha=.8,e.txt=new Laya.Label,e.txt.font="黑体",e.txt.anchorX=.5,e.txt.anchorY=.5,e.txt.fontSize=26,e.txt.bold=!0,e.txt.size(360,60),e.txt.color="#ffffff",e.txt.bold=!0,e.txt.centerX=0,e.txt.centerY=0,e.txt.align="center",e.txt.valign="middle",e.dikuang.addChild(e.txt),_e.getLayer(1).addChild(e.dikuang),e.txt.visible=!0,e.dikuang.visible=!1,e.monitor(se.NOFOLLOW,()=>{e.script.ani.state=ie.idle,e.isFollow=!1}),e.monitor(se.ISFOLLOW,e.followhandler),e.monitor(se.CLOSEQP,e.delqp)}followhandler(e){this.owner.npcId==e&&(this.isFollow=!0)}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow?Ve.game.equipNpc=this.owner:(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}Die(e){this.script.isDie=!0,this.FuHuoTime=20}end(){this.script.isDie=!0}Receive(e){this.isDie=!1,this.isFollow=!0;var t=a.npc.getTbByNpcId(e);this.owner.getComponent(is).hitHurt(-t.hp)}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e,t){var i,s=this,a=s.owner.transform.position.clone();e?i=e.transform.position.clone():t&&(i=t.clone());var n=s.script.tbthing.move_speed/1e5,o=ea.scene.player.info.is_add_speed?1.2*n:n,r=posToAngleDist({x:a.x,y:a.z},{x:i.x,y:i.z});if(r.d<.05)return s.owner.active=!1,void Tn.inst.load3d.thingRes(ce.getBuildUrl(s.script.maomaoModel.dataStr+".lh"),s.owner.parent,initHandler(s,e=>{e||console.log("没有模型"),e.transform.position=s.script.maomaoModel.transform.position.clone(),e.transform.rotationEuler=s.script.maomaoModel.transform.rotationEuler.clone(),e.transform.localScale=s.script.maomaoModel.transform.localScale.clone(),Ve.game.DuoMaoMaoNpc[e.name]=s.script}));var l=calcAngleDist({x:a.x,y:a.z},o,r.a),h=calcPosAngle({x:a.x,y:-a.z},{x:i.x,y:-i.z},!0);s.anglevalue={a:r.a,ae:h};var c=new Laya.Vector3(a.x,a.y+s.script.tbthing.landH,a.z),d=new Laya.Vector3(a.x,-1,a.z),u=s.owner.transform.rotationEuler.clone();s.owner.transform.rotationEuler=new Laya.Vector3(u.x,h,u.z);var p=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(c,d,p)?s.script.moveTrigger.isTrigger||(!s.isFly||s.isAttack,s.owner.transform.position=new Laya.Vector3(l.x,a.y,l.y)):s.script.moveTrigger.isTrigger||(s.isFly?s.owner.transform.position=new Laya.Vector3(l.x,a.y,l.y):s.owner.transform.position=new Laya.Vector3(l.x,.12,l.y))}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}showqp(e){var t=this,i=e.split("|");Number(i[0])==t.script.tbthing.npcId&&(t.dikuang.visible=!0,t.txt.text=i[1],setTimeout(()=>{t.dikuang&&(t.dikuang.visible=!1)},2e3))}showDieqp(){this.dikuang.visible=!0,this.txt.text="救救我"}delqp(e){e==this.script.tbthing.npcId&&(this.dikuang.visible=!1)}inittext(){var e=this;if(!e.npctalkLock){e.npctalkLock=!e.npctalkLock,e.dikuang.visible=!0;for(let i=0;i<100;i++){var t=e.RandomNumber(0,Ve.game.npcTalk.length-1);if(t!=e.lastTalk){e.lastTalk=t;break}}e.txt.text=Ve.game.npcTalk[t],setTimeout(()=>{e.dikuang.visible=!1,e.npctalkLock=!1},3e3)}}randomAction(){switch(this.actionType=this.RandomNumber(1,6),this._actime=(new Date).getTime(),console.log(),this.actionType){case 1:case 2:this.actionTime=this.RandomNumber(1,3);break;case 3:this.actionTime=0;break;default:this.actionTime=this.RandomNumber(4,7)}}randDirection(){return 1==this.RandomNumber(1,2)?1:-1}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&e.script.active&&!Ve.game.isfirest&&ea.scene.player&&ea.scene.player.owner&&ea.scene.camera){if(e.dikuang&&e.dikuang.visible){let s=new Laya.Vector4(0,0,0,0);var t,i=e.owner.transform.position.clone();t=1==Ve.game.MaoMaoGameType?new Laya.Vector3(i.x,i.y,i.z):new Laya.Vector3(i.x,i.y+1,i.z),ea.scene.camera.viewport.project(t.clone(),ea.scene.camera.projectionViewMatrix,s),s.w>=0?e.dikuang.pos(s.x/Laya.stage.clientScaleX,s.y/Laya.stage.clientScaleY):e.dikuang.visible=!1}if(e.script.isDie)return e.dikuang.visible||e.showDieqp(),void e.script.playAni(ie.daodiidle);if(e.actionTime>0)(c=(new Date).getTime())-e._actime>=1e3*e.actionTime&&(e.actionTime=0,e.actionType=0,e.randomAction());if(e.script&&e.script.tbthing&&ea.scene.player&&ea.scene.player.owner){var s=-e.script.tbthing.move_speed/1e5,a=e.checkAction.checkAll(30,7);if(a&&a.mode){var n=a.mode.transform.position.clone(),o=e.owner.transform.position.clone();getDistance({x:n.x,y:n.z},{x:o.x,y:o.z})<=5&&3!=e.actionType&&(e.actionType=0)}else s*=.3;if(1==e.actionType)return void e.script.ani.play(ie.idle);var r=new Laya.Vector3(1,1,1);if(2==e.actionType&&(s*=.7),e.owner.transform.getForward(r),r.x=r.x*s,r.y=r.y*s,r.z=r.z*s,3==e.actionType&&!e.script.moveTrigger.isTrigger){var l=6*Math.random()-3;return e.owner.transform.rotationEuler.y=l,e.actionType=0,void e.randomAction()}var h=e.owner.transform.rotationEuler.clone(),c=(new Date).getTime();if(e.script.moveTrigger&&e.script.moveTrigger.isTrigger)return!e.ismovehit&&c-e.curChangetime>=5e3&&(e.hitdir=e.randDirection(),e.ismovehit=!0,e.curChangetime=c),void(e.owner.transform.rotationEuler=new Laya.Vector3(h.x,h.y+=4*e.hitdir,h.z));e.ismovehit=!1,2==e.actionType?e.script.ani.play(ie.qianxing):e.script.ani.play(ie.run),e.owner.transform.translate(r,!1)}}}onDestroy(){let e=this;e.dikuang.visible=!1,e.dikuang.active=!1,e.dikuang&&e.dikuang.parent&&(e.dikuang.removeSelf(),e.dikuang.destroy()),e.headview&&e.headview.parent&&(e.headview.removeSelf(),e.headview.destroy()),e.headview=null,e.dikuang=null,Laya.timer.clearAll(e),super.onDestroy(),e.lineFunc&&(e.lineFunc=null)}}class ns extends nt{constructor(){super(),this.workaiCount=0,this.isDeviate=!1,this.modelId="",this.speed=.01,this.isFollow=!1,this.preAttTime=0,this.FuHuoTime=0,this.FuHuoNum=0,this.curDir=0,this.DirChangeTime=0,this.DirChangeCloseTime=0,this.talkcd=500,this.lastTalk=0,this.npctalkLock=!1,this.actionType=0,this.actionTime=0,this._actime=0,this.ismovehit=!1,this.hitdir=0,this.curChangetime=0,this.startX=0}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,fs);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi),e.monitor(Z.EQUIP_NPC,e.refNpc)}e.randomAction(),e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLineWait(e.owner,e.script.owner.tb.move_speed/1e5)),e.dikuang&&(e.dikuang.removeSelf(),e.dikuang.destroy(),e.dikuang=null),e.dikuang=new Laya.Image("res/modules/game/dengjd.png"),e.dikuang.size(300,55),e.dikuang.anchorX=.5,e.dikuang.anchorY=.5,e.dikuang.alpha=.8,e.txt=new Laya.Label,e.txt.font="黑体",e.txt.anchorX=.5,e.txt.anchorY=.5,e.txt.fontSize=26,e.txt.bold=!0,e.txt.size(360,60),e.txt.color="#ffffff",e.txt.bold=!0,e.txt.centerX=0,e.txt.centerY=0,e.txt.align="center",e.txt.valign="middle",e.dikuang.addChild(e.txt),_e.getLayer(1).addChild(e.dikuang),e.txt.visible=!0,e.dikuang.visible=!1,e.monitor(se.NOFOLLOW,()=>{e.script.ani.state=ie.idle,e.isFollow=!1}),e.monitor(se.ISFOLLOW,e.followhandler),e.monitor(se.CLOSEQP,e.delqp)}followhandler(e){this.owner.npcId==e&&(this.isFollow=!0)}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow?Ve.game.equipNpc=this.owner:(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}Die(e){this.script.isDie=!0,this.owner.mode.enabled=!0,this.owner.mode.active=!0,this.owner.getChildByName(this.script.maomaoModel.dataStr).active=!1,this.FuHuoTime=(new Date).getTime()}end(){this.script.isDie=!0}Receive(e){this.script.isDie=!1,this.isFollow=!0;var t=a.npc.getTbByNpcId(e);this.owner.getComponent(is).hitHurt(-t.hp)}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e,t){if(!e||null!=e.transform){var i,s=this.owner.transform.position.clone();e?i=e.transform.position.clone():t&&(i=t.clone());var a=this.script.tbthing.move_speed/1e5,n=ea.scene.player.info.is_add_speed?1.2*a:a,o=posToAngleDist({x:s.x,y:s.z},{x:i.x,y:i.z}),r=(new Date).getTime();if(o.d<.05&&!this.script.isDie)8==Ve.map.map.gamePkType&&this.script.playAni(ie.idle);else{if(this.FuHuoTime>0&&r-this.FuHuoTime>=4e3&&this.script.isDie){var l=Xe.getBody(this.owner,"33006");return l?(l.active=!1,l.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],this.owner,1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,.5,0)})),this.script.isDie=!1,this.owner.mode.enabled=!1,this.owner.mode.active=!1,this.owner.getChildByName(this.modelId).active=!0,this.script.maomaoModel=null,void(this.FuHuoTime=0)}var h=new Laya.Vector3(1,1,1),c=-n;this.owner.transform.getForward(h),h.x=h.x*c,h.y=h.y*c,h.z=h.z*c;var d=calcAngleDist({x:s.x,y:s.z},n,o.a),u=calcPosAngle({x:s.x,y:-s.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:o.a,ae:u};var p=new Laya.Vector3(s.x,s.y+this.script.tbthing.landH,s.z),m=new Laya.Vector3(s.x,-1,s.z),g=this.owner.transform.rotationEuler.clone();this.script.isDie||(this.owner.transform.rotationEuler=new Laya.Vector3(g.x,u,g.z));var y=new Laya.HitResult;if(ea.scene.mainscene.physicsSimulation.raycastFromTo(p,m,y)){if(this.script.moveTrigger&&this.script.moveTrigger.isTrigger&&8!=Ve.map.map.gamePkType)return void(this.owner.transform.rotationEuler=new Laya.Vector3(g.x,g.y+=5,g.z));this.owner.transform.translate(h,!1)}else this.script.moveTrigger.isTrigger||(this.owner.transform.position=new Laya.Vector3(d.x,s.y,d.y))}}}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}showqp(e){var t=this,i=e.split("|");Number(i[0])==t.script.tbthing.npcId&&(t.dikuang.visible=!0,t.txt.text=i[1],setTimeout(()=>{t.dikuang&&(t.dikuang.visible=!1)},2e3))}showDieqp(){this.dikuang.visible=!0,this.txt.text="救救我"}delqp(e){e==this.script.tbthing.npcId&&(this.dikuang.visible=!1)}inittext(){var e=this;if(!e.npctalkLock){e.npctalkLock=!e.npctalkLock,e.dikuang.visible=!0;for(let i=0;i<100;i++){var t=e.RandomNumber(0,Ve.game.npcTalk.length-1);if(t!=e.lastTalk){e.lastTalk=t;break}}e.txt.text=Ve.game.npcTalk[t],setTimeout(()=>{e.dikuang.visible=!1,e.npctalkLock=!1},3e3)}}randomAction(){switch(this.actionType=this.RandomNumber(1,2),this._actime=(new Date).getTime(),console.log(),this.actionType){case 1:case 2:this.actionTime=this.RandomNumber(1,3);break;case 3:this.actionTime=0;break;default:this.actionTime=this.RandomNumber(4,7)}}randDirection(){return 1==this.RandomNumber(1,2)?1:-1}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&e.script.active&&ea.scene.player&&ea.scene.player.owner&&ea.scene.camera)if(e.script.maomaoModel){if(e.script.playAni(ie.run),0==e.script.isbianshen){e.script.isbianshen=!0;var t=Xe.getBody(ea.scene.player.owner,"33006");t?(t.active=!1,t.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],ea.scene.player.owner,1,null,initHandler(e,e=>{e.transform.localPosition=new Laya.Vector3(0,.5,0)})),Tn.inst.load3d.thingRes(ce.getBuildUrl(e.script.maomaoModel.dataStr+".lh"),e.owner,initHandler(e,t=>{if(t){var i=t.getComponent(Laya.Animator);i&&i.destroy(),e.modelId=e.script.maomaoModel.dataStr,t.ismaoModel=!0,e.owner.mode.enabled=!1,e.owner.mode.active=!1,t.transform.localPosition=new Laya.Vector3(0,0,0),t.transform.localRotationEuler=new Laya.Vector3(0,0,0),Ve.game.DuoMaoMaoNpc[t.name]=e.script,e.script.bianshenmodel=t,8==Ve.map.map.gamePkType&&(e.script.bianshenmodel.active=!1,e.owner.mode.active=!0)}else console.log("没有模型"+e.script.maomaoModel.dataStr)}))}if(Ve.game.isfirest)return;e.script.maomaoModel&&e.npcTrackAi(e.script.maomaoModel)}else;}onDestroy(){let e=this;e.dikuang.visible=!1,e.dikuang.active=!1,e.dikuang&&e.dikuang.parent&&(e.dikuang.removeSelf(),e.dikuang.destroy()),e.headview&&e.headview.parent&&(e.headview.removeSelf(),e.headview.destroy()),e.headview=null,e.dikuang=null,Laya.timer.clearAll(e),super.onDestroy(),e.lineFunc&&(e.lineFunc=null)}}class os extends nt{constructor(){super(),this.isDie=!1,this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isFollow=!1,this.preAttTime=0,this.FuHuoTime=0,this.FuHuoNum=0,this.talkcd=500,this.lastTalk=0,this.npctalkLock=!1,this.actionType=0,this.actionTime=0,this._actime=0,this.ismovehit=!1,this.hitdir=0,this.curChangetime=0,this.startX=0}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,fs);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi),e.monitor(Z.EQUIP_NPC,e.refNpc)}e.randomAction(),e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLineWait(e.owner,e.script.owner.tb.move_speed/1e5)),e.dikuang&&(e.dikuang.removeSelf(),e.dikuang.destroy(),e.dikuang=null),e.dikuang=new Laya.Image("res/modules/game/dengjd.png"),e.dikuang.size(300,55),e.dikuang.anchorX=.5,e.dikuang.anchorY=.5,e.dikuang.alpha=.8,e.txt=new Laya.Label,e.txt.font="黑体",e.txt.anchorX=.5,e.txt.anchorY=.5,e.txt.fontSize=26,e.txt.bold=!0,e.txt.size(360,60),e.txt.color="#ffffff",e.txt.bold=!0,e.txt.centerX=0,e.txt.centerY=0,e.txt.align="center",e.txt.valign="middle",e.dikuang.addChild(e.txt),_e.getLayer(1).addChild(e.dikuang),e.txt.visible=!0,e.dikuang.visible=!1,e.monitor(se.NOFOLLOW,()=>{e.script.ani.state=ie.idle,e.isFollow=!1}),e.monitor(se.ISFOLLOW,e.followhandler),e.monitor(se.CLOSEQP,e.delqp)}followhandler(e){this.owner.npcId==e&&(this.isFollow=!0)}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow?Ve.game.equipNpc=this.owner:(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}Die(e){this.script.isDie=!0,this.FuHuoTime=20}end(){this.script.isDie=!0}Receive(e){this.isDie=!1,this.isFollow=!0;var t=a.npc.getTbByNpcId(e);this.owner.getComponent(is).hitHurt(-t.hp)}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e,t){var i,s=this,a=s.owner.transform.position.clone();e?i=e.transform.position.clone():t&&(i=t.clone());var n=s.script.tbthing.move_speed/1e5,o=ea.scene.player.info.is_add_speed?1.2*n:n,r=posToAngleDist({x:a.x,y:a.z},{x:i.x,y:i.z});if(r.d<.05)return s.owner.active=!1,void Tn.inst.load3d.thingRes(ce.getBuildUrl(s.script.maomaoModel.dataStr+".lh"),s.owner.parent,initHandler(s,e=>{e||console.log("没有模型"),e.transform.position=s.script.maomaoModel.transform.position.clone(),e.transform.rotationEuler=s.script.maomaoModel.transform.rotationEuler.clone(),e.transform.localScale=s.script.maomaoModel.transform.localScale.clone(),Ve.game.DuoMaoMaoNpc[e.name]=s.script}));var l=calcAngleDist({x:a.x,y:a.z},o,r.a),h=calcPosAngle({x:a.x,y:-a.z},{x:i.x,y:-i.z},!0);s.anglevalue={a:r.a,ae:h};var c=new Laya.Vector3(a.x,a.y+s.script.tbthing.landH,a.z),d=new Laya.Vector3(a.x,-1,a.z),u=s.owner.transform.rotationEuler.clone();s.owner.transform.rotationEuler=new Laya.Vector3(u.x,h,u.z);var p=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(c,d,p),s.script.moveTrigger.isTrigger||(s.owner.transform.position=new Laya.Vector3(l.x,a.y,l.y))}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}showqp(e){var t=this,i=e.split("|");Number(i[0])==t.script.tbthing.npcId&&(t.dikuang.visible=!0,t.txt.text=i[1],setTimeout(()=>{t.dikuang&&(t.dikuang.visible=!1)},2e3))}showDieqp(){this.dikuang.visible=!0,this.txt.text="救救我"}delqp(e){e==this.script.tbthing.npcId&&(this.dikuang.visible=!1)}inittext(){var e=this;if(!e.npctalkLock){e.npctalkLock=!e.npctalkLock,e.dikuang.visible=!0;for(let i=0;i<100;i++){var t=e.RandomNumber(0,Ve.game.npcTalk.length-1);if(t!=e.lastTalk){e.lastTalk=t;break}}e.txt.text=Ve.game.npcTalk[t],setTimeout(()=>{e.dikuang.visible=!1,e.npctalkLock=!1},3e3)}}randomAction(){switch(this.actionType=this.RandomNumber(1,2),this._actime=(new Date).getTime(),console.log(),this.actionType){case 1:case 2:this.actionTime=this.RandomNumber(1,3);break;default:this.actionTime=this.RandomNumber(4,7)}}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&e.script.active&&!Ve.game.isfirest&&ea.scene.player&&ea.scene.player.owner&&ea.scene.camera){if(e.actionTime>0)(new Date).getTime()-e._actime>=1e3*e.actionTime&&(e.actionTime=0,e.actionType=0,e.randomAction());1==e.actionType?e.script.ani.play(ie.idle):e.script.ani.play("jump")}}onDestroy(){let e=this;e.dikuang.visible=!1,e.dikuang.active=!1,e.dikuang&&e.dikuang.parent&&(e.dikuang.removeSelf(),e.dikuang.destroy()),e.headview&&e.headview.parent&&(e.headview.removeSelf(),e.headview.destroy()),e.headview=null,e.dikuang=null,Laya.timer.clearAll(e),super.onDestroy(),e.lineFunc&&(e.lineFunc=null)}}class rs extends it{constructor(){super(...arguments),this.state=0}onEnable(){}getAni(){switch(this.state){case 0:return this.state=1,"donghua";case 1:return this.state=0,"idle"}}onUpdate(){}}class ls{static getTime(e){for(var t=String(Math.floor(e/60)),i=String(e%60);t.toString().length<=1;)t="0"+t;for(;i.toString().length<=1;)i="0"+i;return t.toString()+":"+i.toString()}static getTime3(e){for(var t=String(Math.floor(e/60)),i=String(e%60),s=String(Math.floor(e%60/10)),a=String(e%60%10);t.toString().length<=1;)t="0     "+t;return i=i.toString().length<=1?"0     "+i:s+"     "+a,t.toString()+"   :   "+i.toString()}static getTime4(e){for(var t=String(Math.floor(e/60)),i=String(e%60),s=String(Math.floor(e%60/10)),a=String(e%60%10);t.toString().length<=1;)t="0"+t;return i=i.toString().length<=1?"0"+i:s+a,t.toString()+":"+i.toString()}static getTime2(e){for(var t=String(Math.floor(e/60)),i=String(e%60);t.toString().length<=1;)t="0"+t;for(;i.toString().length<=1;)i="0"+i;return t.toString()+"分"+i.toString()+"秒"}static getMaxTime(e){var t=ls.getSecond(e),i=ls.getMinute(e),s=ls.getHour(e),a=ls.getDay(e),n=!1,o="";return t>0&&(o=t-60*i+"秒"+o,t-60*i==0&&(n=!0,o="")),i>0&&(o=i-60*s+"分"+o,n&&(i-60*s==0?(o="",n=!0):n=!1)),s>0&&(o=s-24*a+"小时"+o,n&&(s-24*a==0?(o="",n=!0):n=!1)),a>0&&(o=a+"天"+o),o}static getCdTime(e){var t=ls.getSecond(e),i=ls.getMinute(e),s=ls.getHour(e),a=ls.getDay(e);if(a>0)return a+"天";if(s>0)return s+"小时";if(i>0){var n;(n=t-60*i)<10&&(n="0"+n);var o=i;return o<10&&(o="0"+o),o+":"+n}return t>0?((n=t)<10&&(n="0"+n),"00:"+n):"00:00"}static getSecond(e){return Math.floor(e)}static getMinute(e){return Math.floor(e/60)}static getHour(e){return Math.floor(e/Math.pow(60,2))}static getDay(e){return Math.floor(e/Math.pow(60,2)/24)}static isCurrDayTime(e,t){var i=new Date(1e3*e),s=t?new Date(1e3*t):new Date,a=i.getFullYear(),n=s.getFullYear(),o=i.getMonth(),r=s.getMonth(),l=i.getDate(),h=s.getDate();return a==n&&o==r&&l==h}static getClickCd(e){var t=0;return()=>{var i=(new Date).getTime();return!(i-t<e)&&(t=i,!0)}}}class hs extends it{constructor(){super(...arguments),this.isgo=!1,this.total=0,this.startX=0,this.curTimeToTal=0,this.font=new Laya.FontClip("res/font/yinghua123.png","0123456789:")}onEnable(){super.onEnable()}run(){this.life=2500,this.Startlife=this.life,this.active=!0}start(e){this.isgo=!0,2!=e&&ea.scene.ui&&(ea.scene.ui.lab_gameTime.visible=!0),this.curTimeToTal=e,this.total=e,15!=e&&20!=e&&10!=e&&420!=e&&300!=e&&120!=e&&180!=e&&3!=Ve.game.MaoMaoGameType||(ea.scene.ui.img_timebg.addChild(this.font),this.font.centerX=0,this.font.centerY=-16)}statOnlyTime(e){this.isgo=!0,this.curTimeToTal=e,this.total=e}initend(){this.isgo=!1,this.startX=0,ea.scene.ui&&(ea.scene.ui.lab_gameTime.visible=!1)}end(){if(3!=Ve.map.map.gamePkType)switch(this.isgo=!1,this.startX=0,ea.scene.ui.lab_gameTime.visible=!1,this.total){case 1:ea.scene.ui.showDaojishi();break;case 2:if(1==Ve.game.MaoMaoGameType){this.start(1),ea.scene.ui.intNpcZhuangTai();var e=new Laya.Vector3(0,-2,0),t=new Laya.Vector3(2,-3,0),i=90;if(608001==Ve.map.map.mapConfig||597001==Ve.map.map.mapConfig||615001==Ve.map.map.mapConfig||666018==Ve.map.map.mapConfig)e=new Laya.Vector3(0,-2,0),t=new Laya.Vector3(-2,-3,0),i=270;else if(666005==Ve.map.map.mapConfig||400037==Ve.map.map.mapConfig)e=new Laya.Vector3(0,-.5,.5),t=new Laya.Vector3(0,-3,-2),i=180;else if(200210==Ve.map.map.mapConfig||620001==Ve.map.map.mapConfig)e=new Laya.Vector3(0,-.5,-.5),t=new Laya.Vector3(0,-3,2),i=0;Es.startLoadCam2(i,e,t,2)}else 3==Ve.game.MaoMaoGameType&&(ea.scene.ui.intNpcZhuangTai(),Ve.game.isfirest=!1,Ve.game.DuoMaoMaoInt(),8!=Ve.map.map.gamePkType?(ea.scene.ui.showSeleModelBox(),this.start(20)):this.start(10),be.openpanel(we.RoleTrialPanel));break;case 3:ea.scene.ui.intNpcZhuangTai(),ea.scene.ui.showDaojishi();break;case 5:ea.scene.ui.showDaojishi();break;case 10:if(3==Ve.game.MaoMaoGameType){cafe.event.dispatch(se.MONSTERSTARTSHOW);break}ea.scene.ui.showDaojishi();break;case 15:ea.scene.GamePause=!0,ea.scene.ui.lab_daojishi.visible=!1,ea.scene.ui.btn_openMap.disabled=!0,be.openpanel(Ve.shop.ShopPanel);break;case 20:if(3==Ve.game.MaoMaoGameType){cafe.event.dispatch(se.MONSTERSTARTSHOW);break}mi.device.unDevice(),ea.scene.GamePause=!0,ea.scene.ui.lab_daojishi.visible=!1;break;case 30:ea.scene.ui.showDaojishi();break;default:var s;s=1==Ve.game.MaoMaoGameType?we.EndLostPanel:we.EndWinPanel,be.openpanel(s)}}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}onUpdate(){if(this.isgo&&!ea.scene.GamePause){this.startX++,this.startX>=60&&(this.startX=0,this.curTimeToTal--),this.curTimeToTal<=0&&this.end(),3==Ve.game.MaoMaoGameType&&this.curTimeToTal==Ve.map.map.hideTime&&0==Ve.game.showFYbuff&&(Ve.game.showFYbuff=!0,Ve.game.showFYnum=this.RandomNumber(1,2),8!=Ve.map.map.gamePkType&&ea.scene.ui.showSceneUItween(ea.scene.ui.tips_fengyin)),3==Ve.game.MaoMaoGameType&&this.curTimeToTal==Ve.map.map.hideTime-5&&ea.scene.ui.tips_fengyin.visible&&ea.scene.ui.hideSceneUI(ea.scene.ui.tips_fengyin),0!=Ve.game.MaoMaoGameType&&ea.scene.ui.ShowNpcqpAction(this.curTimeToTal,30);var e="";if(e=1==Ve.game.MaoMaoGameType?"抓捕倒计时:":"逃脱倒计时:",3==this.total&&(e="游戏开始倒计时"),1!=Ve.game.MaoMaoGameType&&3!=Ve.game.MaoMaoGameType||(ea.scene.ui.lab_daojishi.text=e),20==this.total&&this.curTimeToTal%10==0&&3==Ve.game.MaoMaoGameType&&0==this.startX&&Tn.inst.sound.play(15054),10!=this.total&&23!=this.total||3!=this.curTimeToTal||this.end(),ea.scene.ui.lab_gameTime.text=ls.getTime3(this.curTimeToTal),this.font.value=ls.getTime4(this.curTimeToTal),1!=Ve.game.MaoMaoGameType&&3!=Ve.game.MaoMaoGameType||(ea.scene.ui.img_timebg.skin=""),3==Ve.map.map.gamePkType){if(!ls.getTime(this.curTimeToTal))return;this.curTimeToTal>0&&(ea.scene.ui.lab_yanjiang.text="距离下一波:"+this.curTimeToTal+"秒")}}}onDestroy(){super.onDestroy()}}class cs{static RandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}static RandomIntNumbers(e,t,i=1){for(var s=[];s.length<i;){e=Math.ceil(e),t=Math.floor(t);var a=Math.floor(Math.random()*(t-e+1))+e;s.push(a)}return s}static GetUniqueRandomNumbers(e,t,i=3){var s=new Set,a=t-e+1;if(a<i)throw new Error("数值范围不足以生成指定数量的唯一值");for(;s.size<i;){var n=Math.floor(Math.random()*a)+e;s.add(n)}return Array.from(s)}static GetUniqueRandomNumbersBeyValue(e,t,i=3,s){var a=new Set,n=t-e+1;if(n<i)throw new Error("数值范围不足以生成指定数量的唯一值");for(;a.size<i;){var o=Math.floor(Math.random()*n)+e;o!=s&&a.add(o)}return Array.from(a)}static Ranege(e,t,i){return Math.min(Math.max(i,e),t)}}class ds extends it{constructor(){super(),this.speed=.2,this.heigtList=[5,5,5,5,10,10,15,15,5,5],this.speedList=[.035,.035,.035,.035,.035,.035,.035,.035,.035,.035],this.waitTime=5,this.ismove=!0,this.startPoi=null,this.isLevel=!1,this.levelnum=0,this.heigtNum=0,this.nodeList=[],this.hailangModel=null,this.hailangconfigId="11180474.lh",this.up=!0,this.lablv=1,this.daojishilock=!1}onEnable(){this.MagmaInit(),this.SuoquanInit()}MagmaInit(){var e=this;if(3==Ve.map.map.gamePkType){if(200267==Ve.map.map.mapConfig?e.hailangconfigId="11230385.lh":e.hailangconfigId="11180474.lh",super.onEnable(),400014==Ve.map.map.mapConfig)e.heigtList=[85,85,85,85,10,10,15,15,5,5],e.speedList=[.022,.022,.022,.022,.035,.035,.035,.035,.035,.035];else{var t=cs.RandomIntNumbers(5,15,8);t.splice(0,0,5,5),e.heigtList=t,e.speedList=[.035,.035,.035,.035,.035,.035,.035,.035,.035,.035]}Tn.inst.load3d.thingRes(ce.getBuildUrl(e.hailangconfigId),ea.scene.mainscene.getChildByName("map"),initHandler(e,t=>{t&&(400014==Ve.map.map.mapConfig?t.transform.localPosition=new Laya.Vector3(0,-20,0):t.transform.localPosition=new Laya.Vector3(0,-50,0),e.heigtNum=e.heigtList[e.levelnum],e.owner=t,e.nodeList[e.levelnum]=t,e.speed=e.speedList[e.levelnum],e.weixianui())})),e.startPoi=e.owner.transform.localPosition.clone(),e.monitor(se.RESTARTHAILANG,e.restart),e.monitor(se.HAILANGSTOP,e.stopMove),Laya.timer.once(9e3,e,()=>{ea.scene.ui.img_weixian.visible=!0})}}SuoquanInit(){6==Ve.map.map.gamePkType&&(this.up=!1,this.heigtNum=this.owner.transform.position.y,this.speed=.035,this.startPoi=this.owner.transform.localPosition.clone())}SetUpValue(e){this.up=!0,this.heigtNum=e}RestartPos(){this.up=!1,this.heigtNum=-2,Laya.timer.clearAll(this),Ve.game.diedelay=!0,Laya.timer.once(3e3,this,()=>{Ve.game.diedelay=!1})}stopMove(){this.ismove=!1}restart(){if(Ve.game.RisePoi)if(Ve.game.RisePoi&&Ve.game.RisePoi.y<this.heigtNum-7*this.heigtList[this.levelnum]){this.owner=null;for(let e=this.levelnum;e>0;e--){if(!(Ve.game.RisePoi.y<this.heigtNum-7*this.heigtList[this.levelnum])){this.owner=this.nodeList[this.levelnum];this.heigtList[this.levelnum];this.owner.transform.localPosition=new Laya.Vector3(0,-100,0),this.startPoi=new Laya.Vector3(0,-100,0),this.ismove=!0;break}this.nodeList[this.levelnum].removeSelf(),this.nodeList[this.levelnum].destroy(),this.nodeList[this.levelnum]=null,this.nodeList.splice(this.levelnum,1),this.heigtNum-=7*this.heigtList[this.levelnum],this.levelnum--}}else this.ismove=!0,this.owner.transform.localPosition=new Laya.Vector3(-58,this.owner.transform.localPositionY,470);else this.up=!1,this.ismove=!0,this.levelnum>0&&this.levelnum--;Ve.game.diedelay=!0,Laya.timer.once(3e3,this,()=>{Ve.game.diedelay=!1})}upLevel(){var e=this;e.levelnum!=e.heigtList.length-1&&(Tn.inst.load3d.thingRes(ce.getBuildUrl(e.hailangconfigId),ea.scene.mainscene.getChildByName("map"),initHandler(e,t=>{if(t){e.levelnum++,e.nodeList[e.levelnum]=t;e.heigtList[e.levelnum];e.speedList[e.levelnum]>0?e.speed=e.speedList[e.levelnum]:e.speed=e.speedList[8],t.transform.localPosition=new Laya.Vector3(0,-20,0),e.startPoi=new Laya.Vector3(0,-20,0),e.heigtList[e.levelnum]>0?e.heigtNum=e.heigtList[e.levelnum]:e.heigtNum=e.heigtList[8],e.owner=t}})),e.up=!0,Laya.timer.once(1e3,e,()=>{ea.scene.ui.img_weixian.visible=!0,e.daojishilock=!1}),Laya.timer.once(6600,e,()=>{ea.scene.ui.img_weixian.visible=!1}))}weixianui(){var e=this;Laya.timer.loop(3e3,e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:0},500,null,initHandler(e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:.8},500,null,initHandler(e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:0},500,null,initHandler(e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:.8},500,null,initHandler(e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:0},500,null,initHandler(e,()=>{Laya.Tween.to(ea.scene.ui.img_weixian,{alpha:.8},500,null,initHandler(e,()=>{Laya.Tween.clearAll(ea.scene.ui.img_weixian)}))}))}))}))}))}))},null,!0,!0)}daojishi(){var e;1!=this.daojishilock&&(this.daojishilock=!0,e=Math.floor((this.heigtList[this.levelnum]+40)/this.speedList[this.levelnum]/60),Laya.timer.once(1e3*(e-10),this,()=>{}),ea.scene.ui.getComponent(hs).start(e))}onUpdate(){this.owner&&(ea.scene.GamePause||(this.MagmaAction(),this.SuoquanAction()))}MagmaAction(){if(3==Ve.map.map.gamePkType){var e=this;e.CheckTargetPosEnd(),e.ismove&&(Rt.isView(we.TalkView)||(1==e.up&&e.owner.transform.localPositionY<e.heigtNum&&(e.owner.transform.localPositionY+=e.speed),1==e.up&&e.owner.transform.localPositionY>=e.heigtNum&&Laya.timer.once(3e3,e,()=>{e.up=!1}),e.up,0==e.up&&(ea.scene.ui.img_weixian.visible=!1,Ve.game.yanjiangwin=!0),0==e.up&&(e.owner.transform.localPositionY>=-40?e.owner.transform.localPositionY-=e.speed:e.upLevel()),e.lablv&&(e.lablv<5?e.lablv=e.levelnum+1:e.lablv=5),1==e.up?ea.scene.ui.lab_yanjiang.text="岩浆正在上升  强度:LV"+e.lablv:e.daojishi()))}}SuoquanAction(){if(6==Ve.map.map.gamePkType){this.CheckTargetPosEnd(),1==this.up&&this.owner.transform.localPositionY<this.heigtNum?this.owner.transform.localPositionY+=this.speed:1==this.up&&this.owner.transform.localPositionY>=this.heigtNum?this.up=!1:0==this.up&&this.owner.transform.localPositionY>this.heigtNum&&(this.owner.transform.localPositionY-=this.speed)}}CheckTargetPosEnd(){if(ea.scene.player.owner){var e=!1;for(let t=0;t<this.nodeList.length;t++){if(!(this.nodeList[t].transform.position.y<ea.scene.player.owner.transform.position.y)){e=!0;break}}this.owner.transform.position.y>=ea.scene.player.owner.transform.position.y&&(e=!0),!Ve.game.diedelay&&e&&(ea.scene.player.ClearTrigger(),cafe.event.dispatch(se.GAME_PLAYER_DIE),cafe.event.dispatch(se.HAILANGSTOP),ea.scene.player.ClearTrigger())}}onDestroy(){super.onDestroy()}}class us extends it{onEnable(){super.onEnable(),this.checkAction=this.addCom(this.owner,Yi)}onUpdate(){if(ea.scene.player.owner){var e=this.owner.transform.position.clone(),t=ea.scene.player.owner.transform.position.clone(),i=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z});if(!(i.d>10)&&i.d<6){var s=this.checkAction.checkAll(6,1);s&&s.mode}}}onDestroy(){super.onDestroy()}}class ps extends it{constructor(){super(),this.speed=.0087}onEnable(){super.onEnable()}onUpdate(){this.owner&&(ea.scene.GamePause||(this.owner.getChildByName("body").meshRenderer.material._MainTex_STW+=this.speed))}onDestroy(){super.onDestroy()}}class ms extends it{constructor(){super(),this._suoQuanId=1,this._buildThings=[],this._npcThings=[],this._monsterThings=[],this._yanjiangThings=[],this._isExecute=!1,this._isDie=!1,this._isMusicStop=!1}onEnable(){this.Init(),this.monitor(se.RESTARTHAILANG,this.ReStart),this.monitor(se.SUOQUAN_MUSIC_QUESTION,this.CheckMusicQuestion)}ReStart(){this.XiuFuAction()}onUpdate(){ea.scene.GamePause||this._curTb&&this.owner&&ea.scene.player.owner&&(this._isExecute||this.PhasesAction(),this.DeathAction(ea.scene.player.owner))}Init(){this._suoQuanId=666013==Ve.map.map.mapConfig?28:1,this._curTb=a.remon.getTbBySuoQuanId(this._suoQuanId),this._buildThings=[],this._npcThings=[],this._monsterThings=[],this._yanjiangThings=[],this._isExecute=!1,this._isDie=!1}PhasesAction(){if(this._curTb&&this.owner)switch(Ve.game.suoQuanId=this._suoQuanId,this.ClearThings(),this._isExecute=!0,this.TipsAction(),this._curTb.thingType){case 0:this.QuanAction();break;case 1:this.ThingAction();break;case 2:this.NpcAction();break;case 3:this.MonsterAction();break;case 4:this.YanJiangAction();break;case 5:this.MusicQuestionAction()}}QuanAction(){if(!this.owner)return;var e=this.owner.transform.localScale.clone();e.x=this._curTb.thingActionValue,e.z=this._curTb.thingActionValue,ts.localscale(this.owner.transform,1e3*this._curTb.suoQuanTime,e);let t=this._suoQuanId+1;this.TimeEndAction(t)}ThingAction(){if(!this.owner)return;for(var e=this._curTb.thingID.split("|"),t=0;t<e.length;t++)this.ScaleAction(e[t],!0,this._curTb.thingType),this._buildThings.push(e[t]);let i=this._suoQuanId+1;this.TimeEndAction(i)}NpcAction(){if(!this.owner)return;for(var e=this._curTb.thingID.split("|"),t=0;t<e.length;t++)this.ScaleAction(e[t],!0,this._curTb.thingType),this._npcThings.push(e[t]);let i=this._suoQuanId+1;this.TimeEndAction(i)}MonsterAction(){if(!this.owner)return;for(var e=this._curTb.thingID.split("|"),t=0;t<e.length;t++)this.ScaleAction(e[t],!0,this._curTb.thingType),this._monsterThings.push(e[t]);let i=this._suoQuanId+1;this.TimeEndAction(i)}YanJiangAction(){if(this.owner)for(var e=this._curTb.thingID.split("|"),t=0;t<e.length;t++){this.ScaleAction(e[t],!0,this._curTb.thingType),this._yanjiangThings.push(e[t]);let i=this._suoQuanId+1;this.TimeEndAction(i)}}MusicQuestionAction(){this.owner&&ea.scene.ui&&(ea.scene.ui.SuoQuanMusicPlay(Number(this._curTb.thingID)),Laya.timer.once(1e3*this._curTb.suoQuanTime,this,()=>{this._suoQuanId=this._curTb.thingActionValue,this._curTb=a.remon.getTbBySuoQuanId(this._suoQuanId),this._isExecute=!1,this._isMusicStop=!0}))}CheckMusicQuestion(e){console.log("音乐选择："+e),e?this._curTb=a.remon.getTbBySuoQuanId(++this._suoQuanId):(this._suoQuanId=this._curTb.thingActionValue,this._curTb=a.remon.getTbBySuoQuanId(this._suoQuanId)),Laya.timer.clearAll(this),this._isExecute=!1,this._isMusicStop=!0}TipsAction(){if(this.owner){var e=this._curTb.actionText.split("|"),t=this._curTb.actionTextTime.split("|");this.TextPlay(e,t,0)}}TextPlay(e,t,i){i>=e.length||(ea.scene.ui.lab_suoQuan.text=e[i],Laya.timer.once(1e3*Number(t[i]),this,()=>{i++,this.TextPlay(e,t,i)}))}ScaleAction(e,t,i){var s;switch(i){case 1:Ve.game.allSuoQuanBuildThing&&(s=Ve.game.allSuoQuanBuildThing.get(e));break;case 2:Ve.game.allSuoQuanNpcThing&&(s=Ve.game.allSuoQuanNpcThing.get(e));break;case 3:Ve.game.allSuoQuanMonsterThing&&(s=Ve.game.allSuoQuanMonsterThing.get(e));break;case 4:Ve.game.allSuoQuanBuildThing&&(s=Ve.game.allSuoQuanBuildThing.get(e))}if(s)if(t){for(var a=0;a<s.length;a++)if(s[a].SuoQuanThingShow(),4==i){this.yanjiang=s[a].owner;var n=s[a].owner.getComponent(ds);n||(n=s[a].owner.addComponent(ds)),n.SetUpValue(this._curTb.thingActionValue)}}else for(a=0;a<s.length;a++)s[a].SuoQuanThingConceal()}TimeEndAction(e){Laya.timer.once(1e3*this._curTb.suoQuanTime,this,()=>{this._suoQuanId=e,this._suoQuanId>27&&666013!=Ve.map.map.mapConfig&&(this._suoQuanId=0),this._curTb=a.remon.getTbBySuoQuanId(this._suoQuanId),this._isExecute=!1})}DeathAction(e){if(this.owner&&!this._isDie){var t,i=this.owner.transform.position.clone();e&&(t=e.transform.position.clone()),getDistance({x:i.x,y:i.z},{x:t.x,y:t.z})>.5*this.owner.transform.localScaleX&&(this._isDie=!0,be.openpanel(we.EndLostPanel))}}XiuFuAction(){if(6==Ve.map.map.gamePkType){var e=Ve.game.savetppoi.clone();if(ea.scene.player.owner.transform.position=new Laya.Vector3(e.x,e.y+.1,e.z),ea.scene.player.EndTp(),cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),this.yanjiang){var t=this.yanjiang.getComponent(ds);t||(t=this.yanjiang.addComponent(ds)),t.RestartPos()}Laya.timer.once(1e3,this,()=>{this._isDie=!1})}}ClearThings(){let e=0;if(e=1==this._curTb.suoQuanId?0:a.remon.getTbBySuoQuanId(this._suoQuanId-1).foreverGenerated,this._buildThings){if(1!=e)for(var t=0;t<this._buildThings.length;t++)this.ScaleAction(this._buildThings[t],!1,1);this._buildThings=[]}if(this._npcThings){if(1!=e)for(t=0;t<this._npcThings.length;t++)this.ScaleAction(this._npcThings[t],!1,2);this._npcThings=[]}if(this._monsterThings){if(1!=e)for(t=0;t<this._monsterThings.length;t++)this.ScaleAction(this._monsterThings[t],!1,3);this._monsterThings=[]}if(this._yanjiangThings){if(1!=e)for(t=0;t<this._yanjiangThings.length;t++)this.ScaleAction(this._yanjiangThings[t],!1,1);this._yanjiangThings=[]}this._isMusicStop&&(ea.scene.ui.SuoQuanMusicStop(),this._isMusicStop=!1)}onDestroy(){Ve.game.allSuoQuanBuildThing&&Ve.game.allSuoQuanBuildThing.clear(),Ve.game.allSuoQuanNpcThing&&Ve.game.allSuoQuanNpcThing.clear(),Ve.game.allSuoQuanMonsterThing&&Ve.game.allSuoQuanMonsterThing.clear()}}class gs extends Ni{constructor(){super(),this.isDie=!1,this.firstloadlock=!1,this.isFalling=!1}onEnable(){let e=this;(e.thingbody||(e.thingbody=e.owner),super.onEnable(),11180212==e.thingbody.dthing.thingId||11180213==e.thingbody.dthing.thingId)&&(Xe.getBody(e.thingbody,"Cube").active=!1);11180208!=e.thingbody.dthing.thingId&&11180211!=e.thingbody.dthing.thingId&&11180246!=e.thingbody.dthing.thingId||e.owner.addComponent(rs),e.type=3}initThingTb(e){(this.info=new $e,this.info.attribute=this.addCom(this.owner,Di),this.info.attribute.init(2,e.hp),this.tbthing=e,ea.scene.things[this.owner.name]=this.owner,this.owner.tb=this.tbthing,this.owner.thingId=this.tbthing.thingId,11180160==this.tbthing.configId||11180161==this.tbthing.configId)&&(this.owner.getComponent(us)||this.addCom(this.owner,us));if(11230267==e.configId&&(gs.fuhuoThing&&(gs.fuhuoThing=null),gs.fuhuoThing=this),40810045==e.configId&&(ea.scene.ui.taskProgressNumber++,ea.scene.ui.InitTaskProgress()),33635007==e.configId&&Ve.game.GuangquanOwner.push(this.owner),11180562!=e.configId&&40810110!=e.configId&&59834008!=e.configId&&60034015!=e.configId&&59934004!=e.configId&&60134005!=e.configId&&59834010!=e.configId&&11230472!=e.configId||this.owner.addComponent(ps),11230470==e.configId||11230471==e.configId){var t=Math.floor(4*Math.random());this.owner.getChildByName("body").getChildAt(0).active=!1,this.owner.getChildByName("body").getChildAt(1).active=!1,this.owner.getChildByName("body").getChildAt(2).active=!1,this.owner.getChildByName("body").getChildAt(3).active=!1,this.owner.getChildByName("body").getChildAt(t).active=!0}if(11180474==e.configId)this.owner.addComponent(ds);if(40810091==e.configId&&Ve.game.doors.push(this.owner),11230479==e.configId&&(Ve.game.LiuchengCube=Xe.getBody(this.owner,"LiuchengCube")),0==Ve.game.initTime&&11230284==e.configId){for(var i=Ve.shop.getShopListByType(3),s=0;s<i.length;s++)if(Number(this.owner.dataStr)==i[s].shopId){1==i[s].have&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null);break}this.owner=this.owner}if(this.ThingAni(e),this.SuoQuanAction(e),0==Ve.game.initTime&&this.CheckLand(e)&&this.GameAction(e),4!=Ve.game.MaoMaoGameType&&0!=Ve.game.MaoMaoGameType||(Ve.game.isfirest=!1),11180546==e.configId){var a=[],n=this.owner.transform.position.clone(),o=this.owner.transform.localRotationEulerY;a.push(n.x),a.push(n.y),a.push(n.z),a.push(o),Ve.game.FuhuoPoiList[Number(this.owner.dataStr)]=a}if(11210125!=e.configId&&11210128!=e.configId||1!=Ve.game.MaoMaoGameType&&3!=Ve.game.MaoMaoGameType||(Ve.game.DuoMaoMaoModel[this.owner.name]=this.owner.getComponent(gs),Ve.game.DuoMaoMaoId.push(this.owner.name),this.owner.using=!1),1==Ve.game.MaoMaoGameType||3==Ve.game.MaoMaoGameType){var r=this.owner.getComponent(Laya.Animator);if(!r)var l=Xe.getBody(this.owner,"body");l&&(r=l.getComponent(Laya.Animator)),r&&(this.owner.tb.destroyType=0)}}CheckLand(e){return 11230402==e.configId&&600008==Ve.map.map.mapConfig||11180210==e.configId&&200039==Ve.map.map.mapConfig||11230392==e.configId&&200048==Ve.map.map.mapConfig||11180344==e.configId&&200075==Ve.map.map.mapConfig||11230012==e.configId&&200081==Ve.map.map.mapConfig||31533018==e.configId&&200086==Ve.map.map.mapConfig||11180547==e.configId&&200203==Ve.map.map.mapConfig||11230201==e.configId&&200210==Ve.map.map.mapConfig||11180540==e.configId&&200222==Ve.map.map.mapConfig||11180066==e.configId&&200236==Ve.map.map.mapConfig||32135005==e.configId&&200237==Ve.map.map.mapConfig||11230344==e.configId&&200239==Ve.map.map.mapConfig||52134019==e.configId&&200248==Ve.map.map.mapConfig||11230392==e.configId&&200286==Ve.map.map.mapConfig||11230479==e.configId&&200338==Ve.map.map.mapConfig||11230267==e.configId&&200348==Ve.map.map.mapConfig||33835001==e.configId&&338001==Ve.map.map.mapConfig||11180474==e.configId&&400005==Ve.map.map.mapConfig||11180474==e.configId&&400006==Ve.map.map.mapConfig||11180358==e.configId&&400007==Ve.map.map.mapConfig||40810044==e.configId&&400033==Ve.map.map.mapConfig||11180545==e.configId&&400037==Ve.map.map.mapConfig||40810002==e.configId&&400036==Ve.map.map.mapConfig||11180230==e.configId&&400045==Ve.map.map.mapConfig||30435022==e.configId&&400046==Ve.map.map.mapConfig||53134001==e.configId&&400052==Ve.map.map.mapConfig||11230201==e.configId&&400057==Ve.map.map.mapConfig||54733001==e.configId&&400058==Ve.map.map.mapConfig||55133003==e.configId&&400064==Ve.map.map.mapConfig||54734003==e.configId&&400066==Ve.map.map.mapConfig||55534008==e.configId&&400068==Ve.map.map.mapConfig||11180540==e.configId&&400072==Ve.map.map.mapConfig||32134055==e.configId&&400078==Ve.map.map.mapConfig||60333001==e.configId&&400079==Ve.map.map.mapConfig||55800004==e.configId&&558001==Ve.map.map.mapConfig||59734001==e.configId&&597001==Ve.map.map.mapConfig||60333001==e.configId&&603001==Ve.map.map.mapConfig||60734001==e.configId&&607001==Ve.map.map.mapConfig||60800001==e.configId&&608001==Ve.map.map.mapConfig||61534002==e.configId&&615001==Ve.map.map.mapConfig||61634001==e.configId&&616001==Ve.map.map.mapConfig||62034007==e.configId&&620001==Ve.map.map.mapConfig||60134001==e.configId&&666001==Ve.map.map.mapConfig||59934001==e.configId&&666002==Ve.map.map.mapConfig||59834020==e.configId&&666003==Ve.map.map.mapConfig||60734001==e.configId&&666004==Ve.map.map.mapConfig||55234002==e.configId&&666005==Ve.map.map.mapConfig||60334001==e.configId&&666006==Ve.map.map.mapConfig||61234007==e.configId&&666007==Ve.map.map.mapConfig||58834004==e.configId&&666008==Ve.map.map.mapConfig||11230479==e.configId&&666009==Ve.map.map.mapConfig||53134001==e.configId&&666010==Ve.map.map.mapConfig||59034001==e.configId&&666011==Ve.map.map.mapConfig||11230392==e.configId&&666012==Ve.map.map.mapConfig||40810145==e.configId&&666013==Ve.map.map.mapConfig||11230392==e.configId&&666014==Ve.map.map.mapConfig||33835001==e.configId&&666015==Ve.map.map.mapConfig||57334003==e.configId&&666016==Ve.map.map.mapConfig||30435022==e.configId&&666017==Ve.map.map.mapConfig||30435022==e.configId&&666018==Ve.map.map.mapConfig||60834010==e.configId&&666019==Ve.map.map.mapConfig||11230272==e.configId&&666020==Ve.map.map.mapConfig||40810144==e.configId&&666021==Ve.map.map.mapConfig||11230391==e.configId&&666022==Ve.map.map.mapConfig||32135006==e.configId&&666023==Ve.map.map.mapConfig||11230479==e.configId&&666024==Ve.map.map.mapConfig||11230376==e.configId&&200251==Ve.map.map.mapConfig}ThingAni(e){40810003!=e.configId&&40810004!=e.configId&&40810005!=e.configId&&40810006!=e.configId&&40810007!=e.configId||(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=.2);51534012!=e.configId&&61234003!=e.configId&&11230478!=e.configId&&11230483!=e.configId&&37208!=e.thingId||(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=.5);60734007==e.configId&&(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=2);54934009==this.tbthing.configId&&(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=.1);59934007!=this.tbthing.configId&&59934006!=this.tbthing.configId&&60134012!=this.tbthing.configId||(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=.4);11210058==this.tbthing.configId&&(this.owner.getChildByName("body").getChildByName("tmode").getComponent(Laya.Animator).speed=.2);59034005==this.tbthing.configId&&(this.owner.getChildByName("body").getComponent(Laya.Animator).speed=.2)}GameAction(e){Ve.game.initTime++,be.hideloadding(),null==Ve.game.savetppoi&&(Ve.game.savetppoi=ea.scene.player.owner.transform.position.clone()),Ve.game.fraction=0,200236!=Ve.map.map.mapConfig&&ea.scene&&ea.scene.ui&&(ea.scene.ui.img_fraction.visible=!1),2==Ve.game.MaoMaoGameType?(ea.scene.ui.getComponent(hs).start(3),Ue.show("追击者很快就要来了...")):1!=Ve.game.MaoMaoGameType&&3!=Ve.game.MaoMaoGameType||(ea.scene.GamePause=!1,ea.scene.ui.getComponent(hs).start(2)),2==Ve.map.map.gamePkType&&(ea.scene.GamePause=!1,ea.scene.ui.getComponent(hs).start(15)),3==Ve.map.map.gamePkType?ea.scene.ui.box_yanjiang.visible=!0:ea.scene.ui.box_yanjiang.visible=!1}SuoQuanThingConceal(){this.owner&&6==Ve.map.map.gamePkType&&(this.owner.active=!1,this.endScale=this.owner.transform.localScale.clone())}SuoQuanThingShow(){this.owner&&6==Ve.map.map.gamePkType&&(this.endScale||(this.endScale=new Laya.Vector3(1,1,1)),this.owner.active=!0)}SuoQuanAction(e){if(this.owner&&e&&6==Ve.map.map.gamePkType)if(40810145!=e.configId){var t=!1;t=Ve.game.allSuoQuanBuildThing.get(e.configId.toString()).length>0;for(var i=a.remon.getTbByThingType(1),s=a.remon.getTbByThingType(4),n=0;n<i.length&&!t;n++)for(var o=i[n].thingID.split("|"),r=0;r<o.length;r++)if(e.configId.toString()==o[r]){t=!0;break}for(n=0;n<s.length&&!t;n++){var l=s[n].thingID.split("|");for(r=0;r<l.length;r++)if(e.configId.toString()==l[r]){t=!0;break}}t&&(Ve.game.allSuoQuanBuildThing&&Ve.game.allSuoQuanBuildThing.add(e.configId.toString(),this),this.SuoQuanThingConceal())}else{this.owner.addComponent(ms).owner=this.owner}}FallDown(e){if(!this.isFalling&&this.owner){this.isFalling=!0;var t=new Laya.Tween;t.to(this.owner.transform,{localRotationEulerZ:e},1e3,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{Tn.inst.sound.play(15048),t.clear()}))}}get tbthing(){return this._thing}set tbthing(e){this._thing=e}drop(){var e=this,t=e.tbthing.drop.split(":");if("0"==t[0])mi.drop.addDrop(e.owner);else if("1"==t[0])mi.drop.addGold(ta.get9GByTr(e.owner));else if("2"==t[0])mi.drop.addBuff(ta.get9GByTr(e.owner));else if("3"==t[0])if(null!=t[1]){var i=a.drop.getTbByDropId(Number(t[1])),s=a.shop.getTbByShopId(Number(i.value)),n=Ve.role.getInfoByRoleId(s.targetId);if(!n.isHave){var o=()=>{ea.scene.player.ani.state==ie.idle&&(Ye.remove(e,o),Ve.role.haveRole(n.tb.returnRole))};Ye.add(1,e,o)}}else mi.drop.addRomDrop(ta.get9GByTr(e.owner))}onDestroy(){Ve.map.mptData.mptModel[J.BUILD].clearBuild(this.owner),this.isdispose||(this.isdispose=!0,super.onDestroy())}}class ys extends nt{constructor(){super(),this.isDie=!1,this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isFollow=!1,this.preAttTime=0,this.FuHuoTime=0,this.FuHuoNum=0,this.talkcd=500,this.lastTalk=0,this.npctalkLock=!1,this.actionType=0,this.actionTime=0,this._actime=0,this.ismovehit=!1,this.hitdir=0,this.isfuhuo=!1,this.curChangetime=0,this.startX=0}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,fs);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi),e.monitor(se.NPCUNDEVICE,e.undevice),e.monitor(Z.EQUIP_NPC,e.refNpc)}e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),e.dikuang&&(e.dikuang.removeSelf(),e.dikuang.destroy(),e.dikuang=null),e.dikuang=new Laya.Image("res/modules/game/dengjd.png"),e.dikuang.size(300,55),e.dikuang.anchorX=.5,e.dikuang.anchorY=.5,e.dikuang.alpha=.8,e.txt=new Laya.Label,e.txt.font="黑体",e.txt.anchorX=.5,e.txt.anchorY=.5,e.txt.fontSize=26,e.txt.bold=!0,e.txt.size(360,60),e.txt.color="#ffffff",e.txt.bold=!0,e.txt.centerX=0,e.txt.centerY=0,e.txt.align="center",e.txt.valign="middle",e.dikuang.addChild(e.txt),_e.getLayer(1).addChild(e.dikuang),e.txt.visible=!0,e.dikuang.visible=!1,e.monitor(se.NOFOLLOW,()=>{e.script.ani.state=ie.idle,e.isFollow=!1}),e.monitor(se.ISFOLLOW,e.followhandler),e.monitor(se.CLOSEQP,e.delqp),e.monitor(se.NPCPOS,e.npcPosHandler),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLine(e.owner,e.script.owner.tb.move_speed/2e5)),this.CameraSplit(42812008)}CameraSplit(e){5==Ve.map.map.gamePkType&&(this.owner.npcId!=e&&this.owner.dthing.thingId!=e.toString()||Es.SplitCamView(this.owner))}followhandler(e){this.owner.npcId!=e&&this.owner.dthing.thingId!=e.toString()||(this.isFollow=!0)}npcPosHandler(e){if(this.owner.npcId!=e&&this.owner.dthing.thingId!=e.toString());else{var t=this.owner.transform.position.clone();Ve.game.npcPos=t}}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow?Ve.game.equipNpc=this.owner:(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}Die(e){this.script.isDie=!0,this.FuHuoTime=20}end(){this.script.isDie=!0}undevice(){mi.device.currentMountGear&&this.isFollow&&(this.owner.removeSelf(),ea.scene.mainscene.getChildByName("map").addChild(this.owner))}Receive(e){this.isDie=!1,this.isFollow=!0;var t=a.npc.getTbByNpcId(e);this.owner.getComponent(is).hitHurt(-t.hp)}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e,t){var i,s=this.owner.transform.position.clone();e?i=e.transform.position.clone():t&&(i=t.clone());var a=this.script.tbthing.move_speed/15e4,n=ea.scene.player.info.is_add_speed?1.2*a:a,o=posToAngleDist({x:s.x,y:s.z},{x:i.x,y:i.z}),r=calcPosAngle({x:s.x,y:-s.z},{x:i.x,y:-i.z},!0);if(0==Ve.game.MaoMaoGameType&&14175==this.script.tbthing.npcId)o=posToAngleDist({x:s.x,y:s.z},{x:i.x+1,y:i.z+1}),r=calcPosAngle({x:s.x,y:-s.z},{x:i.x+1,y:-i.z-1},!0);else if(0==Ve.game.MaoMaoGameType&&14176==this.script.tbthing.npcId)o=posToAngleDist({x:s.x,y:s.z},{x:i.x-1,y:i.z-1}),r=calcPosAngle({x:s.x,y:-s.z},{x:i.x-1,y:1-i.z},!0);else if(0==Ve.game.MaoMaoGameType&&14140==this.script.tbthing.npcId)o=posToAngleDist({x:s.x,y:s.z},{x:i.x,y:i.z}),r=calcPosAngle({x:s.x,y:-s.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:o.a,ae:r};var l=calcAngleDist({x:s.x,y:s.z},n,o.a),h=new Laya.Vector3(s.x,s.y+this.script.tbthing.landH,s.z),c=new Laya.Vector3(s.x,-1,s.z),d=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(d.x,r,d.z);var u=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(h,c,u),this.owner.transform.position=new Laya.Vector3(l.x,i.y,l.y)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}showqp(e){var t=this,i=e.split("|");Number(i[0])==t.script.tbthing.npcId&&(t.dikuang.visible=!0,t.txt.text=i[1],setTimeout(()=>{t.dikuang&&(t.dikuang.visible=!1)},2e3))}showDieqp(){this.dikuang.visible=!0,this.txt.text="救救我"}delqp(e){e==this.script.tbthing.npcId&&(this.dikuang.visible=!1)}inittext(){var e=this;if(!e.npctalkLock){e.npctalkLock=!e.npctalkLock,e.dikuang.visible=!0;for(let i=0;i<100;i++){var t=e.RandomNumber(0,Ve.game.npcTalk.length-1);if(t!=e.lastTalk){e.lastTalk=t;break}}e.txt.text=Ve.game.npcTalk[t],setTimeout(()=>{e.dikuang.visible=!1,e.npctalkLock=!1},3e3)}}fuhuo(){var e=this;e.isFollow||(e.script.ani.play(ie.idle),e.script.ani.speed=e.script.tbthing.ani_speed,e.lineFunc=null,e.owner.transform.position=e.script.intpos.clone(),e.lineFunc=ss.getPathLine(e.owner,e.script.owner.tb.move_speed/2e5),Laya.timer.once(300,e,()=>{e.isfuhuo=!1}))}onUpdate(){let e=this;if((!Ve.game.juzheowner||Ve.game.juzheowner.tb.configId!=e.script.tbthing.configId)&&Ve.game.isStartGame&&!ea.scene.isGameEnd&&!Ve.game.isfirest&&ea.scene.player&&ea.scene.player.owner&&!Rt.isView(we.TalkView)&&ea.scene.camera&&!e.isfuhuo){if(200256==Ve.map.map.mapConfig&&e.owner.transform.position.y<5&&!e.isfuhuo&&!e.isFollow&&2!=e.script.owner.tb.bigmode)return e.isfuhuo=!0,void e.fuhuo();var t=0;if(gs.fuhuoThing&&gs.fuhuoThing.owner&&(t=gs.fuhuoThing.owner.transform.position.y),e.owner.transform.position.y<t+1.5&&!e.isfuhuo&&!e.isFollow&&2!=e.script.owner.tb.bigmode)return e.isfuhuo=!0,void e.fuhuo();if(e.lineFunc&&!ea.scene.GamePause&&e.script.ani.state!=ie.qingzhu&&(ea.scene.npcGamePause&&2!=Ve.map.map.gamePkType||(e.lineFunc&&e.lineFunc(),2==e.script.owner.tb.bigmode&&e.script.ani.play("walk"))),2==e.script.owner.tb.bigmode&&e.script&&e.script.moveTrigger&&e.script.moveTrigger.isTrigger&&e.script.moveTrigger.kinematics.length>0)for(let t=0;t<e.script.moveTrigger.kinematics.length;t++){var i=e.script.moveTrigger.kinematics[t],s=i.main;if(s&&-1!=s.name.indexOf("npc"))return;if(s&&"dropCube"!=i.name){var a=s.transform.localPosition.clone();Tn.inst.sound.play(15047),Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_10008_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(e,e=>{e.transform.localPosition=new Laya.Vector3(a.x,a.y+1,a.z),ea.scene.cameraCode.zhengDong(),setTimeout(()=>{e.removeSelf(),e.destroy()},500)})),s.removeSelf(),s.destroy(),e.script.moveTrigger.kinematics=[],e.script.moveTrigger.isTrigger=!1,e.script.moveTrigger.isHit=!1}else;}else if(e.isFollow){if(mi.device.currentMountGear&&1==mi.device.currentMountGear.tb.isShowNpc&&e.isFollow){var n=Xe.getBody(mi.device.currentMountGear,mi.device.currentMountGear.tb.npcinstallBoneName);return n.numChildren<1&&(n.addChild(e.owner),11861010==mi.device.currentMountGear.tb.configId&&14051!=e.script.owner.tbId?e.owner.transform.localPosition=new Laya.Vector3(0,.33,-.12):e.owner.transform.localPosition=new Laya.Vector3(0,0,0),e.owner.transform.rotation=n.transform.rotation),e.script.isHeroRideCar=!0,void e.script.playAni(mi.device.currentMountGear.tb.npcani)}var o=ea.scene.player.owner,r=o.transform.position,l=e.owner.transform.position,h=getDistance({x:r.x,y:r.z},{x:l.x,y:l.z});if(h>20){var c=calcPosAngle({x:r.x,y:r.z},{x:l.x,y:l.z}),d=calcAngleDist({x:r.x,y:r.z},5,c);e.owner.transform.position=new Laya.Vector3(d.x,.12,d.y)}h<4?e.script.playAni(ie.idle):e.workaiCount<=0?(e.npcTrackAi(o),e.script.playAni(ie.run),e.workaiCount=100,e.isDeviate=!0):(e.npcTrackAi(o),e.script.playAni(ie.run),e.workaiCount--)}}}onDestroy(){let e=this;Es.ClearCam(),e.dikuang.visible=!1,e.dikuang.active=!1,e.dikuang&&e.dikuang.parent&&(e.dikuang.removeSelf(),e.dikuang.destroy()),e.headview&&e.headview.parent&&(e.headview.removeSelf(),e.headview.destroy()),e.headview=null,e.dikuang=null,Laya.timer.clearAll(e),super.onDestroy(),e.lineFunc&&(e.lineFunc=null)}}class fs extends Ni{constructor(){super(),this.HaoGanDu=0,this.maomaoModel=null,this.isbianshen=!1,this.bianshenmodel=null,this.FuHuoTime=0,this.FuHuoNum=0}onEnable(){let e=this;e.thingbody||(e.thingbody=e.owner),super.onEnable(),e.thingbody.dthing.thingId>=11812001&&e.thingbody.dthing.thingId<=11812005||e.thingbody.dthing.thingId>=11812011&&e.thingbody.dthing.thingId<=11812019?e.type=10:e.type=5,2!=Ve.game.MaoMaoGameType&&3!=Ve.game.MaoMaoGameType||(e.type=1),e.isHeroRideCar=!1}initThingTb(e){var t=this,s=t.owner.getChildByName("body");t.ani=t.addCom(t.owner,oe);var a=s;a?t.ani.init(a,new Laya.Handler(t,t.onPlayerEnd)):t.ani.init(s,new Laya.Handler(t,t.onPlayerEnd)),t.state||(t.state=t.addCom(t.owner,lt)),0==Ve.game.MaoMaoGameType?t.ai=t.addCom(t.owner,ys):1==Ve.game.MaoMaoGameType?t.ai=t.addCom(t.owner,vs):2==Ve.game.MaoMaoGameType?t.ai=t.addCom(t.owner,as):3==Ve.game.MaoMaoGameType?t.ai=t.addCom(t.owner,ns):4==Ve.game.MaoMaoGameType&&(t.ai=t.addCom(t.owner,os)),t.info=new $e,t.info.attribute=t.addCom(t.owner,is),t.intpos=t.owner.transform.position.clone(),t.info.attribute.init(1,e.hp,e);i.read(t.owner.name);t.tbthing=e,ea.scene.things[t.owner.name]=t.owner,t.hitTarget=s,t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.moveTarget=s.getChildByName("move_hit"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ci),t.moveTrigger.isEnter=(e=>t.moveEnter(e))),t.attackTarget=s.getChildByName("attack_hit"),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>t.AttEnter(e))),t.skillTarget=s.getChildByName("skill_hit"),t.skillTarget&&(t.skillTrigger=t.addCom(t.skillTarget,Ci),t.skillTrigger.isEnter=(e=>t.AttEnter(e))),t.playAni(ie.idle),t.owner.tb=t.tbthing,t.owner.npcId=t.tbthing.npcId,3==Ve.game.MaoMaoGameType&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33002_lh],t.owner,1,null,initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,.1,0)})),1==Ve.game.MaoMaoGameType&&(t.dikuang=new Laya.Image("res/modules/game/dengjd.png"),t.dikuang.size(300,55),t.dikuang.anchorX=.5,t.dikuang.anchorY=.5,t.dikuang.alpha=.8,t.txt=new Laya.Label,t.txt.font="黑体",t.txt.anchorX=.5,t.txt.anchorY=.5,t.txt.fontSize=26,t.txt.bold=!0,t.txt.size(360,60),t.txt.color="#ffffff",t.txt.bold=!0,t.txt.centerX=0,t.txt.centerY=0,t.txt.align="center",t.txt.valign="middle",t.dikuang.addChild(t.txt),_e.getLayer(1).addChild(t.dikuang),t.dikuang.name=t.owner.name+"talk",t.txt.visible=!0,t.dikuang.visible=!1),this.SuoQuanAction(e)}AttEnter(e){var t=e.owner;return t.main!=this.owner&&("body"==t.name&&t!=this.owner&&"player"!=t.main.name)}moveEnter(e){var t=e.owner;return t.main!=this.owner&&-1!=t.name.indexOf("Cube")}triggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(ht);return!("body"!=e.owner.name||!i)}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ai.speed=this.tbthing.move_speed/1e5,this.ani.speed=this.tbthing.ani_speed}addHaoGan(e){}SuoQuanThingConceal(){this.owner&&6==Ve.map.map.gamePkType&&(this.owner.active=!1,this.endScale=this.owner.transform.localScale.clone())}SuoQuanThingShow(){this.owner&&6==Ve.map.map.gamePkType&&(this.endScale||(this.endScale=new Laya.Vector3(1,1,1)),this.owner.active=!0)}SuoQuanAction(e){if(this.owner&&e&&6==Ve.map.map.gamePkType){var t=!1;t=Ve.game.allSuoQuanNpcThing.get(e.configId.toString()).length>0;for(var i=a.remon.getTbByThingType(2),s=0;s<i.length&&!t;s++)for(var n=i[s].thingID.split("|"),o=0;o<n.length;o++)if(e.configId.toString()==n[o]){t=!0;break}t&&(Ve.game.allSuoQuanNpcThing&&Ve.game.allSuoQuanNpcThing.add(e.configId.toString(),this),this.SuoQuanThingConceal())}}onDestroy(){let e=this;e.isdispose||(e.bianshenmodel&&(e.bianshenmodel=null),e.isdispose=!0,super.onDestroy())}}class _s extends it{constructor(){super(...arguments),this.speed=0,this.addspeed=0,this.maxspeed=0,this.total=50,this.ishit=!1,this.hitNum=0}onEnable(){super.onEnable(),this.list=[]}run(e){var t=this;this.tb=e,t.life=400;var i=t.tb.battSpeed.split("|");t.speed=0,t.addspeed=Number(i[1])/1e5,t.maxspeed=Number(i[0])/1e5,t.attackTrigger&&t.attackTrigger.destroy(),t.attackTarget=t.owner.getChildByName("tmode").getChildByName("bullet_hit"),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>t.onAttackTrigger(e))),t.active=!0}delTrigger(e){this.attackTrigger.delTrigger(e)}onAttackTrigger(e){var t=e.owner;return!!t&&("body"==t.name&&t!=this.owner||!!(t.main&&t.main.tb&&t.main.tb.monsterId))}onUpdate(){if(!this.owner)return;if(!this.active)return;if(!Ve.map.mptData)return;let e=this.speed;this.owner.transform.translate(new Laya.Vector3(0,0,e),!0),this.life--,this.life<=0&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null),this.speed<this.maxspeed&&(this.speed+=this.addspeed,this.speed>=this.maxspeed&&(this.speed=this.maxspeed)),this.hurt()}hurt(){var e=this.tb.battAck;if(this.attackTrigger.isTrigger)for(var t=0;t<this.attackTrigger.kinematics.length;t++){var i=this.attackTrigger.kinematics[t].main,s=i.getComponent(ht);if(s){var a=this.list.filter(e=>e.mode==i)[0],n=this.list.indexOf(a);if(!(a&&a.count>0)){if(!s.info.attribute)return;s.info.attribute.headview||s.info.attribute.initView(),s.info.attribute.hitHurt(e),s.info.attribute.thing_hp<=0?(mi.drop.addRomDrop(ta.get9GByTr(i)),this.list.splice(n,1),s.dieMonsterClear?s.dieMonsterClear():(cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),i.removeSelf(),i.destroy()),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:i.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:i.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:i.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:i.tbId,taskType:27,count:1}),t--):(ss.vibrate(i),this.hitNum++,3==this.hitNum&&(this.ishit=!1,this.hitNum=0),a?a.count>0?a.count--:a.count=this.total:this.list.push({mode:i,count:this.total})),this.owner&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null)}}}}onDestroy(){super.onDestroy()}}class vs extends nt{constructor(){super(),this.attackNum=0,this.isCanSkill=!1,this.isAttack=!1,this.isFly=!1,this.isGun=!1,this.isDie=!1,this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isFollow=!1,this.preAttTime=0,this.talkcd=500,this.lastTalk=0,this.npctalkLock=!1}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,fs);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.run),e.checkAction=e.addCom(e.owner,Yi),e.monitor(Z.EQUIP_NPC,e.refNpc)}e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLineWait(e.owner,e.script.owner.tb.move_speed/1e5)),e.monitor(se.NOFOLLOW,()=>{e.script.ani.state=ie.idle,e.isFollow=!1}),e.monitor(se.ISFOLLOW,e.followhandler),e.monitor(se.CLOSEQP,e.delqp)}followhandler(e){this.owner.npcId==e&&(this.isFollow=!0)}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow?Ve.game.equipNpc=this.owner:(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}Die(e){}Receive(e){this.isDie=!1,this.isFollow=!0;var t=a.npc.getTbByNpcId(e);this.owner.getComponent(is).hitHurt(-t.hp)}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e,t){var i,s=this,a=s.owner.transform.position.clone();e?i=e.transform.position.clone():t&&(i=t.clone());var n=s.script.tbthing.move_speed/1e5,o=(ea.scene.player.info.is_add_speed,1.2*n),r=(new Date).getTime(),l=posToAngleDist({x:a.x,y:a.z},{x:i.x,y:i.z});if(1!=s.isbianshen||s.script.isDie){if(s.script.FuHuoTime>0&&r-s.script.FuHuoTime>=3e3&&s.script.isDie){var h=Xe.getBody(s.owner,"33006");h?(h.active=!1,h.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],s.owner,1,null,initHandler(s,e=>{e.transform.localPosition=new Laya.Vector3(0,.5,0)})),s.script.isDie=!1,s.owner.active=!1,s.script.bianshenmodel.active=!0;var c=s.owner.transform.position.clone();return"11180480"==s.script.bianshenmodel.name?s.script.bianshenmodel.transform.position=new Laya.Vector3(c.x,1.6,c.z):s.script.bianshenmodel.transform.position=c,s.script.maomaoModel=null,void(s.script.FuHuoTime=0)}if(l.d<.05&&!s.script.isDie)return s.owner.active=!1,s.isbianshen=!0,void Tn.inst.load3d.thingRes(ce.getBuildUrl(s.script.maomaoModel.dataStr+".lh"),s.owner.parent,initHandler(s,e=>{e||console.log("没有模型"),e.transform.position=s.script.maomaoModel.transform.position.clone(),e.transform.rotationEuler=s.script.maomaoModel.transform.rotationEuler.clone(),e.transform.localScale=s.script.maomaoModel.transform.localScale.clone(),Ve.game.DuoMaoMaoNpc[e.name]=s.script,s.owner.transform.position=s.script.maomaoModel.transform.position.clone(),s.script.bianshenmodel=e}));var d=new Laya.Vector3(1,1,1),u=-o;s.owner.transform.getForward(d),d.x=d.x*u,d.y=d.y*u,d.z=d.z*u;var p=calcAngleDist({x:a.x,y:a.z},o,l.a),m=calcPosAngle({x:a.x,y:-a.z},{x:i.x,y:-i.z},!0);s.anglevalue={a:l.a,ae:m};var g=new Laya.Vector3(a.x,a.y+s.script.tbthing.landH,a.z),y=new Laya.Vector3(a.x,-1,a.z),f=s.owner.transform.rotationEuler.clone();s.script.isDie||(s.owner.transform.rotationEuler=new Laya.Vector3(f.x,m,f.z));var _=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(g,y,_)){var v=-5;for(let e=0;e<_.length;e++){var b=_[e];if(b.collider.owner.main==s.owner||(v=Math.max(v,b.point.y)),e==_.length-1)return s.script.moveTrigger&&s.script.moveTrigger.isTrigger&&s.script.isDie?void(s.owner.transform.rotationEuler=new Laya.Vector3(f.x,f.y+=5,f.z)):void s.owner.transform.translate(new Laya.Vector3(d.x,v-a.y,d.z),!1)}}else s.script.moveTrigger.isTrigger||(s.owner.transform.position=new Laya.Vector3(p.x,a.y,p.y))}}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}rangeEffectSkill(e){var t=Xe.getBody(this.owner,"fong_effect");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{var i=t.transform;i.position&&(e.transform.position=i.position.clone())}))}Fire(e,t){for(var i=this,s=Xe.getBodys(i.owner,"npc_group_firestart"),a=Xe.getBodys(i.owner,"npc_group_firedir"),n=0;s&&n<s.length;n++){var o=s[n].transform,r=a[n].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+t+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(i,t=>{var s=o,a=r;if(e&&e.mode){if(!(a=e.mode.transform)||!a.position)return t.removeSelf(),void t.destroy();a.position.y+=1}if(s.position&&(t.transform.position=s.position.clone()),e&&e.mode){t.transform.lookAt(a.position,new Laya.Vector3(0,0,0));Qe.getTAndSpeedToXYObj(t.transform.position,a.localRotationEulerY,a.localRotationEulerX,1);t.transform.localRotationEulerX=t.transform.localRotationEulerX-180,t.transform.localRotationEulerZ=180}else{var n=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);t.transform.localRotationEulerY=n}t.addComponent(_s).run(i.script.tbthing)}))}}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}showqp(e){var t=this,i=e.split("|");Number(i[0])==t.script.tbthing.npcId&&(t.script.dikuang.visible=!0,t.script.txt.text=i[1],setTimeout(()=>{t.script.dikuang&&(t.script.dikuang.visible=!1)},2e3))}delqp(e){e==this.script.tbthing.npcId&&(this.script.dikuang.visible=!1)}inittext(){var e=this;if(!e.npctalkLock){e.npctalkLock=!e.npctalkLock,e.script.dikuang.visible=!0;for(let i=0;i<100;i++){var t=e.RandomNumber(0,Ve.game.npcTalk.length-1);if(t!=e.lastTalk){e.lastTalk=t;break}}e.script.txt.text=Ve.game.npcTalk[t],setTimeout(()=>{e.script.dikuang.visible=!1,e.npctalkLock=!1},3e3)}}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&e.script.active&&ea.scene.player&&ea.scene.player.owner&&ea.scene.camera){if(e.script.dikuang&&e.script.dikuang.visible){let s=new Laya.Vector4(0,0,0,0);var t=e.owner.transform.position.clone(),i=new Laya.Vector3(t.x,t.y,t.z);ea.scene.camera.viewport.project(i.clone(),ea.scene.camera.projectionViewMatrix,s),s.w>=0?e.script.dikuang.pos(s.x/Laya.stage.clientScaleX,s.y/Laya.stage.clientScaleY):e.script.dikuang.visible=!1}return e.script.maomaoModel?(e.script.playAni(ie.run),void e.npcTrackAi(e.script.maomaoModel)):void 0}}onDestroy(){let e=this;e.script.dikuang&&e.script.dikuang.parent&&(e.script.dikuang.removeSelf(),e.script.dikuang.destroy()),e.script.dikuang=null,Laya.timer.clearAll(e),super.onDestroy(),e.lineFunc&&(e.lineFunc=null)}}class bs extends Xi{constructor(){super(...arguments),this.active=!1}onEnable(){var e=this;Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_10026_lh],e.owner,1,{},initHandler(e,t=>{e.chooseFocus=t,e.chooseFocus.transform.localPosition=new Laya.Vector3(0,e.owner.tb.headEffectH,0),e.chooseFocus.transform.localScale=new Laya.Vector3(1,1,1)}))}onFrameRun(e){}uninstall(){super.uninstall()}destroy(){super.destroy(),this.chooseFocus&&(this.chooseFocus.removeSelf(),this.chooseFocus.destroy(),this.chooseFocus=null)}}class ws extends Wi{constructor(){super()}onEnable(){super.onEnable();this.layaMonitor(ge.game.MONSTER_INSTALL_STATE,this.onStateInstallHandler,this.owner),this.monitor(ge.task.TASK_REF,this.onTaskRefHandler),this.onTaskRefHandler()}onTaskRefHandler(){for(var e=Ve.task.getTaskListByStateAndTargetId(jt.KILL_MONSTER,this.owner.tbId),t=0;t<e.length;t++){var i=e[t];this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"KILL_MONSTER",params:{taskId:i.taskId}})}var s=Ve.task.getTaskListByStateAndTargetId(jt.KILL_BOSS,this.owner.tbId);for(t=0;t<s.length;t++){i=s[t];this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"KILL_BOSS",params:{taskId:i.taskId}})}var a=Ve.task.getTaskListByStateAndTargetId(jt.KILL_MONSTER_NOPANEL,this.owner.tbId);for(t=0;t<a.length;t++){i=a[t];this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"KILL_MONSTER_NOPANEL",params:{taskId:i.taskId}})}var n=Ve.task.getTaskListByStateAndTargetId(jt.KILL_MONSTER_SHOWBOSS,this.owner.tbId);for(t=0;t<n.length;t++){i=n[t];this.owner.event(ge.game.MONSTER_INSTALL_STATE,{state:"KILL_MONSTER_SHOWBOSS",params:{taskId:i.taskId}})}}onStateInstallHandler(e){switch(e.state){case"KILL_MONSTER":this.script.state.install("KILL_MONSTER",bs,e.params);break;case"KILL_BOSS":this.script.state.install("KILL_BOSS",bs,e.params);break;case"KILL_MONSTER_NOPANEL":this.script.state.install("KILL_MONSTER_NOPANEL",bs,e.params);break;case"KILL_MONSTER_SHOWBOSS":this.script.state.install("KILL_MONSTER_SHOWBOSS",bs,e.params)}}onDestroy(){super.onDestroy()}}class Ts extends nt{constructor(){super(),this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.iscemian=null,this.cemianTime=0,this.farDir=0,this.movehittime=0,this.curDir=0,this.DirChangeTime=0,this.DirChangeCloseTime=0,this.isshengjiang=!1,this.driveTarget=null,this.undrive=null,this.tmodeAni=null,this.driveType=0,this.AniCd=0,this.npcDieTime=0}onEnable(){let e=this;if(e.preAttTime=0,e.preSkillTime=0,!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="monster"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,ks);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.checkAction=e.addCom(e.owner,Yi)}super.onEnable(),e.getCom(e.owner,ws)||(e.control=e.addCom(e.owner,ws)),e.leftPoi=Xe.getBody(e.owner,"left"),e.rightPoi=Xe.getBody(e.owner,"right"),e.monitor(se.MONSTERFUYUAN,e.FuYuan),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLineWait(e.owner,e.script.owner.tb.move_speed/1e5))}FuYuan(){ta.toTrBy9G(this.script.owner,this.script.owner.initPoint)}npcLineAi(){var e,t=this.owner.transform.position.clone(),i=this.speed;e=this.moveIndex>=this.script.owner.tracks.length-1?this.script.owner.tracks[0]:this.script.owner.tracks[this.moveIndex+1];var s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[2]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a);s.d<=n&&(this.moveIndex++,this.moveIndex>=this.script.owner.tracks.length&&(this.moveIndex=0),e=this.moveIndex>=this.script.owner.tracks.length-1?this.script.owner.tracks[0]:this.script.owner.tracks[this.moveIndex+1],s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[2]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a));var o=calcPosAngle({x:t.x,y:-t.z},{x:e[0],y:-e[2]},!0),r=new Laya.Vector3(t.x,t.y+this.script.tbthing.landH,t.z),l=new Laya.Vector3(t.x,-1,t.z),h=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(r,l,h)?this.owner.transform.position=new Laya.Vector3(a.x,h.point.y,a.y):this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var c=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(c.x,o,c.z),this.saveMovePos=this.owner.transform.position.clone()}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0),o=new Laya.Vector3(e.x,e.y+this.script.tbthing.landH,e.z),r=new Laya.Vector3(e.x,-1,e.z),l=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(o,r,l)?this.owner.transform.position=new Laya.Vector3(a.x,l.point.y,a.y):this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var h=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(h.x,n,h.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}getDirection(e){return e>=-1.5&&e<=1.5?1:0}npcTrackAi(e){this.script.ani.speed=this.script.tbthing.ani_speed;var t,i,s=this.owner.transform.position.clone(),a=e.clone(),n=-this.script.tbthing.move_speed/1e5,o=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!1);t=this.getDirection(o);var r=new Laya.Vector3(1,1,1),l=n;this.owner.transform.getForward(r),r.x=r.x*l,r.y=r.y*l,r.z=r.z*l;var h=new Laya.Vector3(s.x+r.x,s.y,s.z+r.z),c=calcPosAngle({x:s.x,y:-s.z},{x:h.x,y:-h.z},!1);i=this.getDirection(c);var d=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!0),u=getDistance({x:s.x,y:s.z},{x:a.x,y:a.z}),p=0,m=this.owner.transform.rotationEuler.clone();if(this.script.leftTarget&&this.script.rightTarget)if(this.script.leftTrigger.isTrigger||this.script.rightTrigger.isTrigger)this.iscemian=!0;else{if(1==this.iscemian)(g=(new Date).getTime())-this.cemianTime>200&&(this.iscemian=!1,this.cemianTime=g);this.iscemian||!this.script.moveTrigger||this.script.moveTrigger.isTrigger?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z):m.y!=d&&-90!=d?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,d,m.z):this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z)}if(this.script.moveTrigger&&this.script.moveTrigger.isTrigger){var g=(new Date).getTime();return p=t+i==2&&g-this.DirChangeCloseTime>=1500?1:-1,this.DirChangeTime>=3?(g-this.DirChangeCloseTime>=2500&&(this.DirChangeTime=0),p=this.curDir,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z))):(this.curDir!=p?(this.DirChangeTime++,this.curDir=p,this.DirChangeCloseTime=g):this.DirChangeTime=0,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z)))}u<1&&!this.script.leftTrigger.isTrigger&&!this.script.rightTrigger.isTrigger||this.owner.transform.translate(r,!1)}hit(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:o};var r=new Laya.Vector3(t.x,t.y+this.script.tbthing.landH,t.z),l=new Laya.Vector3(t.x,-1,t.z),h=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(r,l,h)?this.owner.transform.position=new Laya.Vector3(n.x,h.point.y,n.y):this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var c=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(c.x,o,c.z)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a),s=new Laya.Vector3(e.x,e.y+this.script.tbthing.landH,e.z),a=new Laya.Vector3(e.x,-1,e.z),n=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(s,a,n)?this.owner.transform.position=new Laya.Vector3(i.x,n.point.y,i.y):this.owner.transform.position=new Laya.Vector3(i.x,.2,i.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,this.anglevalue.ae,o.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o};var r=new Laya.Vector3(t.x,t.y+this.script.tbthing.landH,t.z),l=new Laya.Vector3(t.x,-1,t.z),h=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(r,l,h)?this.owner.transform.position=new Laya.Vector3(n.x,h.point.y,n.y):this.owner.transform.position=new Laya.Vector3(n.x,.2,n.y);var c=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(c.x,o,c.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a),s=new Laya.Vector3(e.x,e.y+this.script.tbthing.landH,e.z),a=new Laya.Vector3(e.x,-1,e.z),n=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(s,a,n)?this.owner.transform.position=new Laya.Vector3(i.x,n.point.y,i.y):this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,this.anglevalue.ae,o.z)}onFrameRun(e){let t=this;if(!Ve.game.monsterStop&&(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&ea.scene.player&&ea.scene.player.owner&&!t.script.isDie&&t.script.active&&!Ve.game.isfirest))if(Ve.game.fuhuoTime>0)(new Date).getTime()-Ve.game.fuhuoTime>=5e3&&(Ve.game.fuhuoTime=0);else if(t.npcDieTime>0)(new Date).getTime()-t.npcDieTime>=1500&&(t.npcDieTime=0);else if(!be.IsOpenPanel()&&t.script&&t.script.tbthing&&t.script&&t.script.tbthing){var i=t.checkAction.checkliveNpc(10*t.script.tbthing.attackDistance,1),s=t.attackList[t.attackIndex].split(":"),a=ie[s[0]],n=t.script.owner.getChildByName("body");if(n||(n=t.script.owner),i&&i.mode){t.npcTrackAi(i.mode.transform.position);s=t.attackList[t.attackIndex].split(":"),a=ie[s[0]],s[1]&&Number(s[1]);var o=()=>{t.script.playAni(a,new Laya.Handler(t,()=>{if(t.script.warmEffect&&(t.script.warmEffect.active=!1),t.script.hitTrigger&&t.script.hitTrigger.isTrigger)for(var e=0;e<t.script.hitTrigger.kinematics.length;e++){var i=t.script.hitTrigger.kinematics[e].main.getComponent(at);if(i){if(Tn.inst.sound.play(t.script.tbthing.attsound),t.script.hitTrigger.isTrigger&&t.script.ani.state==t.attackList[0]&&t.script.ani.state==t.attackList[0]){var s=t.script.hitTrigger.kinematics[e];t.script.hitTrigger.delTrigger(s),ea.scene.ui.CancelDevide(),ea.scene.player.playAni(ie.daodiidle),t.script.ani.play("paoxiao"),Tn.inst.sound.play(15052),Es.startLoadCam4(t.owner,initHandler(t,()=>{t.script.ani.speed=1.5,i.hitHurt(t.script.tbthing.attack*(Ve.level.isHard?1.2:1))}))}}else if(i||(i=t.script.hitTrigger.kinematics[e].main.getComponent(is)),i){s=t.script.hitTrigger.kinematics[e];t.npcDieTime=(new Date).getTime();var a=t.script.hitTrigger.kinematics[e].main.getComponent(as);if(!a)return;if(Es.specialCam)return;if(a.script.isDie){t.script.hitTrigger.delTrigger(s);break}a&&a.FuHuoNum++,2==a.FuHuoNum?(a.script.ani.speed=.4,t.script.ani.speed=.8,a.script.playAni(ie.daodiidle),t.script.ani.play("paoxiao"),Tn.inst.sound.play(15052),Es.startLoadCam4(t.owner,initHandler(t,()=>{cafe.event.dispatch(se.NPCTAOTAI,a.script.owner.tbId);var e=Xe.getBody(a.script.owner,"body").getComponent(Laya.Animator);e&&(e.enable=!1),t.script.ani.speed=1.5,a.script.owner.removeSelf(),a.script.owner.destroy(),ea.scene.ui.upDateList(),t.script.hitTrigger.delTrigger(s),t.npcDieTime=(new Date).getTime()}))):(a.script.ani.speed=.4,a.script.playAni(ie.daodiidle),t.script.ani.speed=.8,t.script.ani.play("paoxiao"),Tn.inst.sound.play(15052),Es.startLoadCam4(t.owner,initHandler(t,()=>{cafe.event.dispatch(se.NPCXURUO,{id:a.script.owner.tbId,state:!0}),a.script.ani.speed=1,t.script.ani.speed=1.5,a.Die(),t.script.hitTrigger.delTrigger(s),t.npcDieTime=(new Date).getTime()})))}}}))};t.script.tbthing.warmTime>0?(t.script.warmEffect&&(t.script.warmEffect.active=!0),o()):o()}}}onDestroy(){super.onDestroy()}}class As extends nt{constructor(){super(),this._isAttack=!1,this.iscemian=null,this.cemianTime=0,this.farDir=0,this.movehittime=0,this.curDir=0,this.DirChangeTime=0,this.DirChangeCloseTime=0}onEnable(){let e=this;if(!e.script){e.owner.name="monster"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,ks);e.script=t,e.owner.ai=e,e.script.playAni(ie.idle),e.checkAction=e.addCom(e.owner,Yi)}super.onEnable(),e.getCom(e.owner,ws)||(e.control=e.addCom(e.owner,ws)),e.monitor(se.MONSTERFUYUAN,e.FuYuan),e.monitor(se.CHANGECAMERA,e.changeCam),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLine(e.owner,e.script.owner.tb.move_speed/1e5))}changeCam(){ea.scene.cameraCode.lockTarget=this.owner,ea.scene.cameraCode.initOnePlay2()}FuYuan(){ta.toTrBy9G(this.script.owner,this.script.owner.initPoint)}getDirection(e){return e>=-1.5&&e<=1.5?1:0}npcTrackAi(e){this.script.ani.speed=this.script.tbthing.ani_speed;var t,i,s=this.owner.transform.position.clone(),a=e.clone(),n=-this.script.tbthing.move_speed/1e5,o=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!1);t=this.getDirection(o),this.script.ani.play("run");var r=new Laya.Vector3(1,1,1),l=n;this.owner.transform.getForward(r),r.x=r.x*l,r.y=r.y*l,r.z=r.z*l;var h=new Laya.Vector3(s.x+r.x,s.y,s.z+r.z),c=calcPosAngle({x:s.x,y:-s.z},{x:h.x,y:-h.z},!1);i=this.getDirection(c);var d=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!0),u=getDistance({x:s.x,y:s.z},{x:a.x,y:a.z}),p=0,m=this.owner.transform.rotationEuler.clone();if(this.script.leftTarget&&this.script.rightTarget)if(this.script.leftTrigger.isTrigger||this.script.rightTrigger.isTrigger)this.iscemian=!0;else{if(1==this.iscemian)(g=(new Date).getTime())-this.cemianTime>200&&(this.iscemian=!1,this.cemianTime=g);this.iscemian||!this.script.moveTrigger||this.script.moveTrigger.isTrigger?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z):m.y!=d&&-90!=d?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,d,m.z):this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z)}if(this.script.moveTrigger&&this.script.moveTrigger.isTrigger){if(null==this.script.moveTrigger.kinematics[0].parent)return void this.script.moveTrigger.delTrigger(this.script.moveTrigger.kinematics[0]);var g=(new Date).getTime();return p=t+i==2&&g-this.DirChangeCloseTime>=1500?1:-1,this.DirChangeTime>=3?(g-this.DirChangeCloseTime>=2500&&(this.DirChangeTime=0),p=this.curDir,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z))):(this.curDir!=p?(this.DirChangeTime++,this.curDir=p,this.DirChangeCloseTime=g):this.DirChangeTime=0,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z)))}u<.2&&!this.script.leftTrigger.isTrigger&&!this.script.rightTrigger.isTrigger||this.owner.transform.translate(r,!1)}onFrameRun(e){let t=this;if(Ve.game.monsterStop)return;if(!Ve.game.isStartGame)return;if(ea.scene.isGameEnd)return;if(ea.scene.GamePause)return;if(!ea.scene.player||!ea.scene.player.owner)return;if(t.script.isDie)return;if(!t.script.active)return;if(Ve.game.isfirest)return;if(Ve.game.fuhuoTime>0)return void((new Date).getTime()-Ve.game.fuhuoTime>=5e3&&(Ve.game.fuhuoTime=0));if(be.IsOpenPanel())return;if(!t.script||!t.script.tbthing)return;if(this._isAttack)return;var i=ea.scene.player.owner.transform.position.clone(),s=t.owner.transform.position.clone(),a=getDistance({x:i.x,y:i.z},{x:s.x,y:s.z});let n=t.checkAction.checkliveNpc2(t.script.tbthing.followDistance,1);if(n&&n.mode){this.MainUITip(a,n),getDistance({x:n.mode.transform.position.x,y:n.mode.transform.position.z},{x:s.x,y:s.z})<=t.script.tbthing.attackDistance?this.AttAction():t.npcTrackAi(n.mode.transform.position)}else this.AttAction(),"attack"!=this.script.ani.state&&(this.MainUITip(a,null),t.script.ani.play("run"),t.lineFunc&&t.lineFunc())}SkillTimeOut(){this._isAttack=!0,setTimeout(()=>{this._isAttack=!1},this.script.tbthing.skillcd)}MainUITip(e,t){var i=ea.scene.ui;e>7&&e<15&&(i.tips_kaojing.visible&&i.hideSceneUI(i.tips_kaojing),i.tips_fujin.visible||i.showSceneUItween(i.tips_fujin)),e<7?(i.tips_fujin.visible&&i.hideSceneUI(i.tips_fujin),i.tips_kaojing.visible||i.showSceneUItween(i.tips_kaojing)):e>15&&(i.tips_kaojing.visible&&i.hideSceneUI(i.tips_kaojing),i.tips_fujin.visible&&i.hideSceneUI(i.tips_fujin));var s=ea.scene.player.owner;t&&t.mode==s?(i.tips_kaojing.visible&&i.hideSceneUI(i.tips_kaojing),i.tips_fujin.visible&&i.hideSceneUI(i.tips_fujin),i.img_wx.visible=!0):i.img_wx.visible=!1}AttAction(){if(this.script.hitTrigger&&this.script.hitTrigger.isTrigger){var e=this.attackList[this.attackIndex].split(":"),t=ie[e[0]],i=()=>{this.script.playAni(t,new Laya.Handler(this,e=>{"attack"==e&&(this.script.warmEffect&&(this.script.warmEffect.active=!1),this.Attact())}))};this.script.tbthing.warmTime>0?(this.script.warmEffect&&(this.script.warmEffect.active=!0),i()):i()}}Attact(){if(this.script.hitTrigger&&this.script.hitTrigger.isTrigger)for(var e=0;e<this.script.hitTrigger.kinematics.length;e++){var t,i=this.script.hitTrigger.kinematics[e].main;if(i||(-1!=this.script.hitTrigger.kinematics[e].parent.name.indexOf("npc")?i=this.script.hitTrigger.kinematics[e].parent:-1!=this.script.hitTrigger.kinematics[e].parent.parent.name.indexOf("npc")?i=this.script.hitTrigger.kinematics[e].parent.parent:-1!=this.script.hitTrigger.kinematics[e].parent.parent.parent.name.indexOf("npc")&&(i=this.script.hitTrigger.kinematics[e].parent.parent.parent)),i){if(i&&(t=i.getComponent(at)),!t){if(t||(t=i.getComponent(is)),t){Tn.inst.sound.play(this.script.tbthing.attsound),this.SkillTimeOut();var s=i.getComponent(fs);if(s&&1==s.isDie)continue;this.script.hitTrigger.kinematics[e];var a=i.getComponent(ns);if(!a)continue;if(Es.specialCam)return;this.ShowAttEffect(i),a&&a.FuHuoNum++;let t=2;if(8==Ve.map.map.gamePkType&&(t=1),a.FuHuoNum==t){this.DelTrigger(i);var n=a.owner.tb.npcName;ea.scene.ui.showNpctaotaiUI(n),ea.scene.ui.lab_monsterName.text=this.script.owner.tb.monsterName,this.script.ani.play(ie.idle),a.script.ani.speed=1,a.owner.mode.active=!0,a.script.playAni(ie.kuqi),a.script.bianshenmodel&&(a.script.bianshenmodel.active=!1),setTimeout(()=>{cafe.event.dispatch(se.NPCTAOTAI,a.script.owner.tbId);var e=Xe.getBody(a.script.owner,"body").getComponent(Laya.Animator);e&&(e.enabled=!1),a.script.owner.removeSelf(),a.script.owner.destroy(),ea.scene.ui.upDateList()},1800)}else a.script.ani.speed=1,a.script.playAni(ie.kuqi),cafe.event.dispatch(se.NPCXURUO,{id:a.script.owner.tbId,state:!0}),this.script.ani.play(ie.idle),a.Die();break}if(!i||!i.transform||1!=i.tb.destroyType){this.DelTrigger(i),this.script.ani.play(ie.idle);continue}Tn.inst.sound.play(this.script.tbthing.attsound),this.SkillTimeOut(),this.ShowAttEffect(i);var o=i.getComponent(Laya.Animator);if(!o)var r=Xe.getBody(i,"body");r&&(o=r.getComponent(Laya.Animator)),o&&(o.enabled=!1,o.destroy()),i.removeSelf(),i.destroy(),this.DelTrigger(i),this.script.ani.play(ie.idle);break}if(Tn.inst.sound.play(this.script.tbthing.attsound),this.script.hitTrigger.isTrigger&&this.script.ani.state==this.attackList[0]&&this.script.ani.state==this.attackList[0]){ea.scene.ui.CancelDevide(),ea.scene.ui.showHurtUIByTween(),this.script.ani.play(ie.idle),t.hitHurt(this.script.tbthing.attack*(Ve.level.isHard?1.2:1)),this.SkillTimeOut(),this.ShowAttEffect(i);break}}}}ShowAttEffect(e){var t=e.transform.localPosition.clone();t||(t=e.parent.transform.localPosition.clone());var i=ea.scene.mainscene.getChildByName("map").getChildByName("30027");i?(i.transform.localPosition=t,i.active=!1,i.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(this,e=>{e&&t&&(e.transform.localPosition=t)}))}DelTrigger(e){this.script.hitTrigger.delTrigger(e),this.script.moveTrigger.delTrigger(e),this.script.leftTrigger.delTrigger(e),this.script.rightTrigger.delTrigger(e)}onDestroy(){super.onDestroy()}}class xs extends nt{constructor(){super(),this.npcAimTime=2e3,this.iscemian=null,this.cemianTime=0,this.movehittime=0,this.curDir=0,this.DirChangeTime=0,this.DirChangeCloseTime=0,this.npcDieTime=0}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="monster"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,ks);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.checkAction=e.addCom(e.owner,Yi)}super.onEnable(),e.getCom(e.owner,ws)||(e.control=e.addCom(e.owner,ws)),e.leftPoi=Xe.getBody(e.owner,"left"),e.rightPoi=Xe.getBody(e.owner,"right"),e.monitor(se.MONSTERFUYUAN,e.FuYuan),e.monitor(se.CHANGECAMERA,e.changeCam),e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLine2(e.owner,e.script.owner.tb.move_speed/1e5))}changeCam(){ea.scene.cameraCode.lockTarget=this.owner,ea.scene.cameraCode.initOnePlay2()}FuYuan(){ta.toTrBy9G(this.script.owner,this.script.owner.initPoint)}getDirection(e){return e>=-1.5&&e<=1.5?1:0}npcTrackAi(e){this.script.ani.speed=this.script.tbthing.ani_speed;var t,i,s=this.owner.transform.position.clone(),a=e.clone(),n=-this.script.tbthing.move_speed/1e5,o=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!1);t=this.getDirection(o),this.script.ani.play("run");var r=new Laya.Vector3(1,1,1),l=n;this.owner.transform.getForward(r),r.x=r.x*l,r.y=r.y*l,r.z=r.z*l;var h=new Laya.Vector3(s.x+r.x,s.y,s.z+r.z),c=calcPosAngle({x:s.x,y:-s.z},{x:h.x,y:-h.z},!1);i=this.getDirection(c);var d=calcPosAngle({x:s.x,y:-s.z},{x:a.x,y:-a.z},!0),u=getDistance({x:s.x,y:s.z},{x:a.x,y:a.z}),p=0,m=this.owner.transform.rotationEuler.clone();if(this.script.leftTarget&&this.script.rightTarget)if(this.script.leftTrigger.isTrigger||this.script.rightTrigger.isTrigger)this.iscemian=!0;else{if(1==this.iscemian)(g=(new Date).getTime())-this.cemianTime>200&&(this.iscemian=!1,this.cemianTime=g);this.iscemian||!this.script.moveTrigger||this.script.moveTrigger.isTrigger?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z):m.y!=d&&-90!=d?this.owner.transform.rotationEuler=new Laya.Vector3(m.x,d,m.z):this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y,m.z)}if(this.script.moveTrigger&&this.script.moveTrigger.isTrigger){if(null==this.script.moveTrigger.kinematics[0].parent)return void this.script.moveTrigger.delTrigger(this.script.moveTrigger.kinematics[0]);var g=(new Date).getTime();return p=t+i==2&&g-this.DirChangeCloseTime>=1500?1:-1,this.DirChangeTime>=3?(g-this.DirChangeCloseTime>=2500&&(this.DirChangeTime=0),p=this.curDir,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z))):(this.curDir!=p?(this.DirChangeTime++,this.curDir=p,this.DirChangeCloseTime=g):this.DirChangeTime=0,void(this.owner.transform.rotationEuler=new Laya.Vector3(m.x,m.y+=8*p,m.z)))}u<.2&&!this.script.leftTrigger.isTrigger&&!this.script.rightTrigger.isTrigger||this.owner.transform.translate(r,!1)}onFrameRun(e){let t=this;if(Ve.game.isStartGame&&(!ea.scene.isGameEnd&&!ea.scene.GamePause&&ea.scene.player&&ea.scene.player.owner&&!t.script.isDie&&t.owner.active&&!Ve.game.isfirest))if(t.npcDieTime>0)(new Date).getTime()-t.npcDieTime>=t.npcAimTime+100&&(t.npcDieTime=0);else if(!be.IsOpenPanel()&&t.script&&t.script.tbthing&&t.script&&t.script.tbthing){var i=t.checkAction.checkliveNpc(t.script.tbthing.attackDistance,1),s=t.checkAction.checkliveNpc(t.script.tbthing.attackDistance,5),a=i&&i.mode?i:s,n=t.attackList[t.attackIndex].split(":"),o=ie[n[0]],r=t.script.owner.getChildByName("body");if(r||(r=t.script.owner),a&&a.mode)if(this.CheckRole()){n=t.attackList[t.attackIndex].split(":"),o=ie[n[0]];(()=>{t.script.playAni(o,new Laya.Handler(t,e=>{if("finish"==e&&t.script.ani.play(ie.idle),"attack"==e&&t.script.hitTrigger&&t.script.hitTrigger.isTrigger)for(var i=0;i<this.roleThings.length;i++){var s=this.roleThings[i].main;if(s){Tn.inst.sound.play(t.script.tbthing.attsound),t.script.ani.state==t.attackList[0]&&(t.npcDieTime=(new Date).getTime());var a=s.transform.localPosition.clone();a||(a=s.parent.transform.localPosition.clone());var n=ea.scene.mainscene.getChildByName("map").getChildByName("30027");n?(n.transform.localPosition=a,n.active=!1,n.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(t,e=>{e.transform.localPosition=a})),Tn.inst.sound.play(15050),this.StrikeToFly(s);break}}}))})()}else t.npcTrackAi(a.mode.transform.position);else t.script.ani.play("run"),t.lineFunc&&t.lineFunc()}}StrikeToFly(e){if(e){var t=10;6==Ve.map.map.gamePkType&&(t=a.remon.getTbBySuoQuanId(Ve.game.suoQuanId).thingActionValue);var i=this.script.owner.transform.localPosition.clone(),s=e.transform.localPosition.clone(),n=calcPosAngle({x:i.x,y:i.z},{x:s.x,y:s.z}),o=calcAngleDist({x:s.x,y:s.z},t,n),r=new Laya.Vector3(o.x,e.transform.localPositionY+2,o.y);ts.Localposition(e.transform,300,r,Laya.Ease.bounceOut)}}CheckRole(){if(this.roleThings=[],!this.script.hitTrigger||!this.script.hitTrigger.isTrigger)return!1;for(var e=0;e<this.script.hitTrigger.kinematics.length;e++){var t=this.script.hitTrigger.kinematics[e].main;t&&(t.modelType!=le.type_role&&t.modelType!=le.type_npc||this.roleThings.push(this.script.hitTrigger.kinematics[e]))}return this.roleThings.length>=1}onDestroy(){super.onDestroy()}}class ks extends Ni{constructor(){super(),this.isDie=!1,this.startshowEff=null}onEnable(){this.thingbody||(this.thingbody=this.owner),super.onEnable(),this.type=7}initThingTb(e){var t=this,i=t.owner.getChildByName("body"),s=i.getComponent(Laya.Animator);s||(s=(i=t.owner.getChildByName("body").getChildByName("tmode")).getComponent(Laya.Animator)),t.ani=t.addCom(t.owner,oe);var a=i;switch(a?t.ani.init(a,new Laya.Handler(t,t.onPlayerEnd)):t.ani.init(i,new Laya.Handler(t,t.onPlayerEnd)),t.state||(t.state=t.addCom(t.owner,lt)),Ve.game.MaoMaoGameType){case 0:t.ai=t.addCom(t.owner,xs);break;case 2:t.ai=t.addCom(t.owner,Ts);break;case 3:t.ai=t.addCom(t.owner,As)}t.info=new $e,t.info.attribute=t.addCom(t.owner,Di),t.info.attribute.init(2,e.hp),t.tbthing=e,ea.scene.things[t.owner.name]=t.owner,t.hitTarget=Xe.getBody(i,"attack_hit"),t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.monsterSkillTarget=Xe.getBody(i,"skill_hit"),t.monsterSkillTarget&&(t.monsterSkillTrigger=t.addCom(t.monsterSkillTarget,Ci),t.monsterSkillTrigger.isEnter=(e=>t.triggerEnter(e))),t.uMoveTarget=t.thingbody.getChildByName("umove_hit"),t.uMoveTarget&&(t.uMoveTrigger=t.addCom(t.uMoveTarget,Ri),t.uMoveTrigger.ClearTrigger(),t.uMoveTrigger.isEnter=(e=>t.onMoveTrigger(e))),t.dMoveTrigger&&t.dMoveTrigger.destroy(),t.dMoveTarget=Xe.getBody(t.thingbody,"dmove_hit"),t.dMoveTarget&&(t.dMoveTrigger=t.addCom(t.dMoveTarget,Ri),t.dMoveTrigger.ClearTrigger(),t.dMoveTrigger.isEnter=(e=>t.onMoveTrigger(e))),t.moveTrigger&&t.moveTrigger.destroy(),t.moveTarget=Xe.getBody(t.thingbody,"move_hit"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ri),t.moveTrigger.ClearTrigger(),t.moveTrigger.isEnter=(e=>t.onMoveTrigger(e))),t.rightTarget=Xe.getBody(t.thingbody,"right_hit"),t.rightTarget&&(t.rightTrigger=t.addCom(t.rightTarget,Ri),t.rightTrigger.ClearTrigger(),t.rightTrigger.isEnter=(e=>t.onMoveTrigger(e))),t.leftTarget=Xe.getBody(t.thingbody,"left_hit"),t.leftTarget&&(t.leftTrigger=t.addCom(t.leftTarget,Ri),t.leftTrigger.ClearTrigger(),t.leftTrigger.isEnter=(e=>t.onMoveTrigger(e))),t.playAni(ie.idle),t.owner.tb=t.tbthing,t.owner.monsterId=t.tbthing.monsterId,t.ai.attackList=t.tbthing.actionname.split("|"),t.ai.attackIndex=0,t.warmEffect=Xe.getBody(t.owner,"group_warm"),t.warmEffect&&(t.warmEffect.active=!1),t.monitor(se.MONSTERSTARTSHOW,t.gameStartShow),t.monitor(se.MONSTERSTARTSHOW2,t.gameStartShow2),t.monitor(se.MONSTERFENGYING,t.FengYingAction),3==Ve.game.MaoMaoGameType&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33001_lh],t.owner,1,null,initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,.1,0)})),this.SuoQuanAction(e)}gameStartShow2(){var e=this.owner.transform.position.clone(),t=this.owner.transform.localRotationEulerY;this.owner.transform.position.y=8,Ye.add(1,this,this.shangsheng3),Es.startLoadCam5(this.owner,t-180,e,initHandler(this,()=>{}))}gameStartShow(){var e=this,t=e.owner.transform.position.clone(),i=e.owner.transform.localRotationEulerY;ea.scene.ui.showSceneUItween(ea.scene.ui.tips_startshow),Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33005_lh],ea.scene.mainscene,1,null,initHandler(e,s=>{switch(s.transform.position=new Laya.Vector3(t.x,.2,t.z),e.startshowEff=s,e.tbthing.startType){case 1:Ye.add(1,e,e.shangsheng),Es.startLoadCam6(e.owner,i,t,null);break;case 2:t=new Laya.Vector3(e.owner.transform.position.clone().x+3,e.owner.transform.position.clone().y,e.owner.transform.position.clone().z),Es.startLoadCam6(e.owner,i,t,null),e.startpoi=e.owner.transform.localPosition.clone(),Ye.add(1,e,e.shangsheng2)}e.playAni(ie.idle),Laya.timer.once(2e3,e,()=>{ea.scene.ui.hideSceneUI(ea.scene.ui.tips_startshow),e.playAni(ie.idle)})}))}shangsheng(){var e=this;e.owner?e.owner.transform.localPositionY<.1?e.owner.transform.localPositionY+=.02:(Ye.remove(e,e.xiachen),Laya.timer.frameOnce(60,e,()=>{Es.removeCam(),Ye.remove(e,e.shangsheng),ea.scene.ui.lab_daojishi.visible=!1,ea.scene.ui.getComponent(hs).start(Ve.map.map.hideTime),Ve.game.monsterStop=!1,Ue.show("游戏正式开始"),8!=Ve.map.map.gamePkType&&(ea.scene.ui.igm_timegame.visible=!0,ea.scene.ui.ui_skill6.visible=!0,ea.scene.ui.box_jingyan.visible=!0),ea.scene.ui.btn_changeCam.visible=!0,e.startshowEff&&(e.startshowEff.removeSelf(),e.startshowEff.destroy(),e.startshowEff=null)})):Ye.remove(e,e.shangsheng)}shangsheng2(){var e=this;e.owner?e.owner.transform.localPositionX<e.startpoi.x+3?e.owner.transform.localPositionX+=.02:(Ye.remove(e,e.xiachen),Laya.timer.frameOnce(60,e,()=>{Es.removeCam(),Ye.remove(e,e.shangsheng2),ea.scene.ui.getComponent(hs).start(200),Ve.game.monsterStop=!1,Ue.show("游戏正式开始"),ea.scene.ui.igm_timegame.visible=!0,ea.scene.ui.ui_skill6.visible=!0,ea.scene.ui.box_jingyan.visible=!0,ea.scene.ui.btn_changeCam.visible=!0,e.startshowEff&&(e.startshowEff.removeSelf(),e.startshowEff.destroy(),e.startshowEff=null)})):Ye.remove(e,e.shangsheng2)}shangsheng3(){var e=this;e.owner?e.owner.transform.localPositionY>.1?e.owner.transform.localPositionY-=.02:(Ye.remove(e,e.xiachen),e.playAni(ie.idle),Laya.timer.once(90,e,()=>{Ye.remove(e,e.shangsheng3),Ve.game.monsterStop=!1,ea.scene.ui.igm_timegame.visible=!0,ea.scene.ui.lab_daojishi.visible=!1,cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),ea.scene.ui.getComponent(hs).start(180),Ve.game.monsterStop=!1,Ue.show("游戏正式开始"),e.startshowEff&&(e.startshowEff.removeSelf(),e.startshowEff.destroy(),e.startshowEff=null)})):Ye.remove(e,e.shangsheng3)}FengYingAction(){var e=this;Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33004_lh],e.owner,1,null,initHandler(e,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)}));var t=e.owner.transform.position.clone(),i=e.owner.transform.localRotationEulerY;Es.startLoadCam6(e.owner,i,t,null),Laya.timer.frameOnce(60,e,()=>{Ye.add(1,e,e.xiachen)})}xiachen(){this.owner?this.owner.transform.localPositionY>-2?this.owner.transform.localPositionY-=.01:(Ye.remove(this,this.xiachen),Es.removeCam(),ea.scene.ui.getComponent(hs).end()):Ye.remove(this,this.xiachen)}triggerEnter(e){var t,i=e.owner;if(!i.main&&i==this.owner)return!1;if(i.main&&i.main==this.owner)return!1;if("body"==i.name&&i!=this.owner)return!0;if(t=i.main?i.main.getComponent(ht):i.getComponent(ht),"group_hit"==e.owner.name&&t)return!i.main.getComponent(vs);if(i&&i.main&&37858==i.main.thingId)return!1;var s=i.main?i.main.getComponent(gs):i.getComponent(gs);return!(!s||1!=s.tbthing.destroyType)||(!i.main||37858!=i.main.thingId)&&(!(-1==i.name.indexOf("Cube")||!i.parent.ismaoModel&&!i.parent.parent.ismaoModel)||!(!i.main||!i.name||"undevice"==i.name||37211!=i.main.thingId&&37208!=i.main.thingId))}triggerBuildEnter(e){var t=e.owner;return!(!t.main&&t==this.owner)&&((!t.main||t.main!=this.owner)&&!(-1==t.name.indexOf("Cube")||!t.main||1!=t.main.tb.destroyType))}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ai.speed=this.tbthing.move_speed/1e5,this.ani.speed=this.tbthing.ani_speed}drop(){var e=this;e.tbthing.type;var t=e.tbthing.drop.split(":");if("0"==t[0])mi.drop.addDrop(e.owner);else if("1"==t[0])mi.drop.addGold(ta.get9GByTr(e.owner));else if("2"==t[0])mi.drop.addBuff(ta.get9GByTr(e.owner));else if("3"==t[0])if(null!=t[1]){var i=a.drop.getTbByDropId(Number(t[1])),s=a.shop.getTbByShopId(Number(i.value)),n=Ve.role.getInfoByRoleId(s.targetId);if(!n.isHave){var o=()=>{ea.scene.player.ani.state==ie.idle&&(Ye.remove(e,o),Ve.role.haveRole(n.tb.returnRole))};Ye.add(1,e,o)}}else mi.drop.addRomDrop(ta.get9GByTr(e.owner));else if("4"==t[0]&&null!=t[1]){var r=Number(t[1]);mi.drop.addLockDrop(r,ta.get9GByTr(e.owner))}}dieMonsterClear(){this.owner.removeSelf(),this.owner.destroy(),this.owner=null}onPlayerEnd(e){-1!=e.indexOf("attack")&&this.playAni(ie.idle)}hit(e){this.tbthing.type>2||(this.warmEffect&&(this.warmEffect.active=!1),e?this.playAni(e):this.playAni(ie.hit))}SuoQuanThingConceal(){this.owner&&6==Ve.map.map.gamePkType&&(this.owner.active=!1,this.endScale=this.owner.transform.localScale.clone())}SuoQuanThingShow(){this.owner&&6==Ve.map.map.gamePkType&&(this.endScale||(this.endScale=new Laya.Vector3(1,1,1)),this.owner.active=!0)}SuoQuanAction(e){if(this.owner&&e&&6==Ve.map.map.gamePkType){var t=!1;t=Ve.game.allSuoQuanMonsterThing.get(e.configId.toString()).length>0;for(var i=a.remon.getTbByThingType(3),s=0;s<i.length&&!t;s++)for(var n=i[s].thingID.split("|"),o=0;o<n.length;o++)if(e.configId.toString()==n[o]){t=!0;break}t&&(Ve.game.allSuoQuanMonsterThing&&Ve.game.allSuoQuanMonsterThing.add(e.configId.toString(),this),this.SuoQuanThingConceal())}}onDestroy(){Laya.timer.clearAll(this),this.isdispose||(this.isdispose=!0,super.onDestroy())}}class Es{static startLoadCam2(e,t,i,s=2){var a=this;ea.scene.GamePause=!0,Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,n=>{if(n&&n.transform){var o=n.getChildByName("Camera");n.transform.localRotationEulerY=e;var r=ea.scene.player.owner.transform.position.clone(),l=new Laya.Vector3(r.x+t.x,r.y+t.y,r.z+t.z);n.transform.position=l,this.LoadSkyMat(o,ea.scene.mainscene),Es.specialCam=n,cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),ts.position(n.transform,1500,new Laya.Vector3(r.x+i.x,r.y+i.y,r.z+i.z),null,initHandler(this,()=>{Ve.game.DuoMaoMaoInt(),setTimeout(()=>{n.removeSelf(),n.destroy(),a.removeCam(),ea.scene.GamePause=!1},1e3*s)}))}}))}static startLoadCam4(e,t){ea.scene.GamePause=!0;var i=Xe.getBody(e,"cameraPoi").addChild(new Laya.Camera(0,.1,100));i&&i.transform&&(Es.specialCam=i,Laya.Material.load("res/res3D/Assets/Mesh/BG/"+Ve.map.map.skymat,initHandler(this,function(e){i.clearFlag=Laya.CameraClearFlags.Sky;var t=i.skyRenderer;t.mesh=Laya.SkyBox.instance,t.material=e})),setTimeout(()=>{i.removeSelf(),i.destroy(),ea.scene.GamePause=!1,t&&t.run(),Es.specialCam=null},3500))}static startLoadCam5(e,t,i,s){Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,a=>{if(a&&a.transform){var n=a.getChildByName("Camera"),o=new Laya.Vector3(i.x-1.2,-3.8,i.z-3.2);a.transform.position=o,a.transform.localRotationEulerY=t,a.transform.localRotationEulerX=5,n.fieldOfView=60,Laya.Material.load("res/res3D/Assets/Mesh/BG/"+Ve.map.map.skymat,initHandler(this,function(e){n.clearFlag=Laya.CameraClearFlags.Sky;var t=n.skyRenderer;t.mesh=Laya.SkyBox.instance,t.material=e})),ts.position(e.transform,1500,new Laya.Vector3(i.x,.3,i.z),null,initHandler(this,()=>{Tn.inst.sound.play(15051),e.getComponent(ks).ani.speed=.8,e.getComponent(ks).ani.play(ie.idle)})),setTimeout(()=>{a.removeSelf(),a.destroy(),s&&s.run()},3500)}}))}static startLoadCam6(e,t,i,s){Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_12000601_lh],ea.scene.mainscene,1,{},initHandler(this,s=>{if(s&&s.transform){var a=s.getChildByName("Camera"),n=new Laya.Vector3(i.x,0,i.z);s.transform.localPosition=n,s.transform.localRotationEulerY=t-180,s.transform.localRotationEulerX=5,a.transform.localPosition=new Laya.Vector3(0,2,-4.5),a.fieldOfView=40,Es.specialCam=s,Laya.Material.load("res/res3D/Assets/Mesh/BG/"+Ve.map.map.skymat,initHandler(this,function(e){a.clearFlag=Laya.CameraClearFlags.Sky;var t=a.skyRenderer;t.mesh=Laya.SkyBox.instance,t.material=e})),ts.position(e.transform,500,new Laya.Vector3(i.x,i.y,i.z),null,initHandler(this,()=>{Tn.inst.sound.play(15051),e.getComponent(ks).ani.speed=1,e.getComponent(ks).ani.play(ie.idle)}))}}))}static SplitCamView(e){e&&(this.splitCam&&this.ClearCam(),Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,t=>{if(t&&t.transform){var i=t.getChildByName("Camera");i.normalizedViewport=new Laya.Viewport(1,0,.5,1),t.transform.rotate=e.transform.rotate,this.LoadSkyMat(i,ea.scene.mainscene),this.splitCam=t,e.addChild(t)}})))}static SplitCamAni(e){if(this.splitCam){ea.scene.GamePause=!0;var t=this.splitCam.getChildByName("Camera"),i=ea.scene.camera;if(t&&i){var s=0;Laya.timer.frameLoop(1,this,()=>{t.normalizedViewport.x<=.5&&(Laya.timer.clearAll(this),ea.scene.GamePause=!1,e&&e.run()),(s+=.005)>=.5&&(s=.5),t.normalizedViewport.x=1-s,i.normalizedViewport.width=1-s,ea.scene.cameraCode.setCamera(ea.scene.camera)})}}}static ClearCam(){this.splitCam&&(this.splitCam.removeSelf(),this.splitCam.destroy(),this.splitCam=null)}static startLoadCam7(e,t,i,s,a=2,n){ea.scene.GamePause=!0,Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,o=>{if(o&&o.transform){var r=o.getChildByName("Camera");o.transform.localRotationEulerY=e,o.transform.localRotationEulerX=t;var l=ea.scene.player.owner.transform.position.clone(),h=new Laya.Vector3(l.x+i.x,l.y+i.y,l.z+i.z);o.transform.position=h,this.LoadSkyMat(r,ea.scene.mainscene),Es.specialCam=o,cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),ts.position(o.transform,1e3*a,new Laya.Vector3(l.x+s.x,l.y+s.y,l.z+s.z),null,initHandler(this,()=>{setTimeout(()=>{Es.removeCam(),ea.scene.GamePause=!1,n&&n.run()},1e3)}))}}))}static startLoadCam8(e,t,i,s,a=2){ea.scene.GamePause=!0,Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,n=>{if(n&&n.transform){var o=n.getChildByName("Camera");n.transform.localRotationEulerY=e,n.transform.localRotationEulerX=t;var r=ea.scene.player.owner.transform.position.clone(),l=new Laya.Vector3(r.x+i.x,r.y+i.y,r.z+i.z);n.transform.position=l,this.LoadSkyMat(o,ea.scene.mainscene),ea.scene.player.playAni(ie.qingzhu),ea.scene.player.FlyBagHidden(),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),ts.position(n.transform,1e3*a,new Laya.Vector3(r.x+s.x,r.y+s.y,r.z+s.z),null,initHandler(this,()=>{setTimeout(()=>{n.removeSelf(),n.destroy(),ea.scene.player.playAni(ie.idle),ea.scene.GamePause=!1},1e3)}))}}))}static startLoadCam9(e,t,i,s,a=2,n){ea.scene.GamePause=!0,Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_20270003_lh],ea.scene.mainscene,1,{},initHandler(this,o=>{if(o&&o.transform){var r=o.getChildByName("Camera");o.transform.localRotationEulerY=e,o.transform.localRotationEulerX=t;var l=new Laya.Vector3(i.x,i.y,i.z);o.transform.position=l,this.LoadSkyMat(r,ea.scene.mainscene),Es.specialCam=o,cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),ts.position(o.transform,1e3*a,new Laya.Vector3(s.x,s.y,s.z),null,initHandler(this,()=>{setTimeout(()=>{Es.removeCam(),ea.scene.GamePause=!1,n&&n.run()},1e3)}))}}))}static LoadSkyMat(e,t){Laya.Material.load("res/res3D/Assets/Mesh/BG/Sky2.lmat",initHandler(this,function(i){e.clearFlag=Laya.CameraClearFlags.Sky;var s=e.skyRenderer;s.mesh=Laya.SkyBox.instance,s.material=i,i.textureCube&&(t.customReflection=i.textureCube)}))}static removeCam(){Es.specialCam&&(Es.specialCam.removeSelf(),Es.specialCam.destroy(),Es.specialCam=null)}static AddFeixuTo(e){Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum._prop_res_11270001_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,t=>{t.transform.position=e}))}static AddcheckAll3DModes(e,t,i){return e.getComponent(Yi)?this.checkAction=e.getComponent(Yi):this.checkAction=e.addComponent(Yi),this.checkAction.checkAll3DModes(t,i)}static AddCheckAll(e,t,i){return e.getComponent(Yi)?this.checkAction=e.getComponent(Yi):this.checkAction=e.addComponent(Yi),this.checkAction.checkAll(t,i)}static AddCheckAll3D(e,t,i){return e.getComponent(Yi)?this.checkAction=e.getComponent(Yi):this.checkAction=e.addComponent(Yi),this.checkAction.checkAll3D(t,i)}static DesTroy(e){var t=this;oi.singleton.removeThing(e),(e=>{Laya.Tween.to(e,{},1,null,initHandler(t,()=>{e.removeSelf(),e.removeChildren(),e.destroy()}))})(e)}static LookFromAt(e,t){var i=t.transform;if(null!=i){var s=e.transform.position,a=calcPosAngle({x:s.x,y:-s.z},{x:i.position.x,y:-i.position.z},!0),n=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(n.x,a,n.z)}}static LookFromAt1(e,t){if(null!=t){var i=e.transform.position,s=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0),a=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(a.x,s,a.z)}}static LookFromAtXY(e,t){var i=t.transform;if(null!=i){var s=e.transform.position,a=calcPosAngle({x:s.x,y:-s.y},{x:i.position.x,y:-i.position.y},!0),n=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(n.x,a,n.y)}}static LookFromAtZY(e,t){var i=t.transform;if(null!=i){var s=e.transform.position,a=calcPosAngle({x:s.z,y:-s.y},{x:i.position.z,y:-i.position.y},!0),n=e.transform.rotationEuler.clone();e.transform.rotationEuler=new Laya.Vector3(n.z,a,n.y)}}static AddSpriteTo(e,t,i){var s=Xe.getBody(t,i);Tn.inst.load3d.res(ce.d3res+Re.res_dic[Re.res_enum["role_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{s.addChild(e),e.transform.position=s.transform.position}))}static Play(e){if(e){var t=Xe.getBody(e,"act");if(t){var i=t.getChildByName("act1");if(i){var s=i.getChildAt(0);s.particleSystem.play();for(var a=0;a<s.numChildren;a++){s.getChildAt(a).particleSystem.play()}}var n=t.getChildByName("act2");if(n){var o=n.getChildAt(0);o.particleSystem.play();for(a=0;a<o.numChildren;a++){o.getChildAt(a).particleSystem.play()}}}}}static Stop(e){if(e){var t=Xe.getBody(e,"act");if(t){var i=t.getChildByName("act1");if(i){var s=i.getChildAt(0);s.particleSystem.stop();for(var a=0;a<s.numChildren;a++){s.getChildAt(a).particleSystem.stop()}}var n=t.getChildByName("act2");if(n){var o=n.getChildAt(0);o.particleSystem.stop();for(a=0;a<o.numChildren;a++){o.getChildAt(a).particleSystem.stop()}}}}}}Es.specialCam=null;class Is extends it{constructor(){super()}onEnable(){this.monitor(se.MAP_MPT_LOADED,this.on_map_mpt_loaded),this.monitor(se.MAP_ROLE_LOADED,this.on_map_role_loaded),this.monitor(se.MAP_MPT_REF,this.on_map_role_loaded),this.monitor(se.GAME_REPLACE_PLAYER_MODE,this.on_replace_player_mode),this.monitor(se.GAME_RIDE_PLAYER_MODE,this.on_ride_player_mode),this.monitor(se.GAME_UNRIDE_PLAYER_MODE,this.on_unride_player_mode)}init(){}on_map_mpt_loaded(e){e.voidMapPos=[],e.randomVoidPos=[]}on_map_role_loaded(){ea.scene.thingCode.createPlayer()}on_replace_player_mode(e){ea.scene.thingCode.replacePlayer(e)}on_ride_player_mode(e){ea.scene.thingCode.ridePlayer(e)}on_unride_player_mode(){ea.scene.thingCode.unRidePlayer()}createMap(e){let t=this;console.log("初始化游戏"),Laya.Scene3D.load("res/res3D/scene/map_scene.ls",initHandler(t,s=>{ea.scene.mainscene=t.owner.mask3D.addChild(s),ea.scene.mainscene.ambientMode=Laya.AmbientMode.SolidColor,ea.scene.mainscene.ambientColor=i.ambientColor.clone(),1!=Ve.map.map.LightType&&(ea.scene.mainscene.ambientColor=new Laya.Vector3(.75,.75,.75)),Laya.Scene3D.octreeCulling=!0,ea.scene.mainscene.fogRange=Ve.map.map.view,ea.scene.mainscene.fogStart=-5,ea.scene.mainscene.enableFog=!0,Ve.map.setMap(ea.scene.mainscene.getChildByName("map"));var a=ea.scene.mainscene.getChildByName("m_light");a.color=new Laya.Vector3(.55,.55,.55),a.transform.localRotationEulerX=i.sunAngle,a.intensity=i.intensity,1!=Ve.map.map.LightType&&(a.intensity=.8),window.conchConfig&&-1!=window.conchConfig.getOS().indexOf("android")&&(s.ambientColor=new Laya.Vector3(1,1,1)),ea.scene.cameraCode.setCamera(ea.scene.mainscene.getChildByName("m_camera")),oi.singleton.mapId=e,Es.LoadSkyMat(ea.scene.camera,ea.scene.mainscene),Ve.map.loadMpt()}))}createMapScene(){let e=this;console.log("初始化场景"),Laya.Scene3D.load("res/res3D/scene/map_scene.ls",initHandler(e,t=>{ea.scene.mainscene=e.owner.mask3D.addChild(t),ea.scene.mainscene.ambientMode=Laya.AmbientMode.SolidColor,ea.scene.mainscene.ambientColor=i.ambientColor.clone(),Laya.Scene3D.octreeCulling=!0,ea.scene.mainscene.fogColor=i.fogColor.clone(),ea.scene.mainscene.fogRange=18,ea.scene.mainscene.fogStart=-5,ea.scene.mainscene.enableFog=!0;let s=ea.scene.mainscene.skyRenderer;s.mesh=Laya.SkyDome.instance,s.material=new Laya.SkyProceduralMaterial,ea.scene.mainscene.skyRenderer.material.exposure=Math.sin(i.exposure)+1,Ve.map.setMap(ea.scene.mainscene.getChildByName("map"));var a=ea.scene.mainscene.getChildByName("m_light");a.color=new Laya.Vector3(.55,.55,.55),a.transform.localRotationEulerX=i.sunAngle,a.intensity=i.intensity,ea.scene.cameraCode.setCamera(ea.scene.mainscene.getChildByName("m_camera"))}))}createThing(){console.log("创建地物")}onDestroy(){super.onDestroy(),ea.scene.mainscene&&ea.scene.mainscene.parent&&(ea.scene.mainscene.removeSelf(),ea.scene.mainscene.destroy()),ea.scene.mainscene=null}}class Cs extends it{constructor(){super(),this.ro_angle=0,this.upAlpha=.5,this.downAlpha=1,this.is_click=!1,this.dir=0}onEnable(){this.initUi(),this.monitor(Cs.BTNCARUP_DIR_LOCK,this.yglock),this.monitor(Laya.Event.RESIZE,this.onStageResize)}yglock(e){this.is_click=e}setParams(e){this.upAlpha=e.upAlpha?e.upAlpha:.5,this.downAlpha=e.downAlpha?e.downAlpha:1,this.owner.btn_carupleft.alpha=this.upAlpha,this.owner.btn_carupright.alpha=this.upAlpha}onStageResize(){console.log("修改摇杆点击范围：",this.owner.width,this.owner.height,Laya.stage)}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner.btn_carupleft),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner.btn_carupleft),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner.btn_carupleft),this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner.btn_carupright),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner.btn_carupright),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner.btn_carupright),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyQ",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyQ",this.onKeyUpHandler),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyE",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyE",this.onKeyUpHandler),this.onStageResize()}onKeyDownHandler(e){switch(null==this.cur_angle&&(this.cur_angle=0),e.key){case"runKeyQ":this.dir=1,this.owner.btn_carupleft.alpha=this.downAlpha;break;case"runKeyE":this.dir=2,this.owner.btn_carupright.alpha=this.downAlpha}}onKeyUpHandler(e){this.dir=0,this.owner.btn_carupleft.alpha=this.upAlpha,this.owner.btn_carupright.alpha=this.upAlpha}onUpdate(){ea.scene.isGameStop||ea.scene.GamePause||0!=this.dir&&(1==this.dir&&this.ro_angle>0?this.ro_angle=0:2==this.dir&&this.ro_angle<0&&(this.ro_angle=0),this.ro_angle-=1==this.dir?10:-10,this.ro_angle<-540?this.ro_angle=-540:this.ro_angle>540&&(this.ro_angle=540),cafe.event.dispatch(Cs.BTNCARUP_DIR_REF,{dir_angle:this.ro_angle}))}onDistanceMouseHandler(e){let t=this;if(!t.is_click)switch(e.type){case Laya.Event.MOUSE_DOWN:e.target==t.owner.btn_carupleft?t.dir=1:t.dir=2,e.target.alpha=t.downAlpha;break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.dir=0,e.target.alpha=t.upAlpha}}onDestroy(){super.onDestroy()}}Cs.BTNCARUP_DIR_LOCK="BTNCARUP_DIR_LOCK",Cs.BTNCARUP_DIR_REF="BTNCARUP_DIR_REF";class Ls extends it{constructor(){super(),this.ro_angle=0,this.upAlpha=.5,this.downAlpha=1,this.is_click=!1,this.dir=0}onEnable(){this.initUi(),this.monitor(Ls.BTN_LOCK,this.yglock),this.monitor(Laya.Event.RESIZE,this.onStageResize)}yglock(e){this.is_click=e}setParams(e){this.upAlpha=e.upAlpha?e.upAlpha:.5,this.downAlpha=e.downAlpha?e.downAlpha:1,this.owner.btn_carleft.alpha=this.upAlpha,this.owner.btn_carright.alpha=this.upAlpha}onStageResize(){}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner.btn_carleft),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner.btn_carleft),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner.btn_carleft),this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner.btn_carright),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner.btn_carright),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner.btn_carright),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyA",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyA",this.onKeyUpHandler),this.monitor(se.KEY_BOARD_LISTENER+"_run_KeyD",this.onKeyDownHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+"_run_KeyD",this.onKeyUpHandler),this.onStageResize()}onKeyDownHandler(e){switch(null==this.cur_angle&&(this.cur_angle=0),e.key){case"runKeyA":this.dir=1,this.owner.btn_carleft.alpha=this.downAlpha;break;case"runKeyD":this.dir=2,this.owner.btn_carright.alpha=this.downAlpha}}onKeyUpHandler(e){this.dir=0,this.owner.btn_carleft.alpha=this.upAlpha,this.owner.btn_carright.alpha=this.upAlpha}onUpdate(){ea.scene.isGameStop||ea.scene.GamePause||(0!=this.dir?(1==this.dir&&this.ro_angle>0?this.ro_angle=0:2==this.dir&&this.ro_angle<0&&(this.ro_angle=0),this.ro_angle-=1==this.dir?20:-20,this.ro_angle<-540?this.ro_angle=-540:this.ro_angle>540&&(this.ro_angle=540),cafe.event.dispatch(Ls.BTN_REF,{dir_angle:this.ro_angle})):cafe.event.dispatch(Cs.BTNCARUP_DIR_REF))}onDistanceMouseHandler(e){let t=this;if(!t.is_click)switch(e.type){case Laya.Event.MOUSE_DOWN:e.target==t.owner.btn_carleft?t.dir=1:t.dir=2,e.target.alpha=t.downAlpha;break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.dir=0,e.target.alpha=t.upAlpha}}onDestroy(){super.onDestroy()}}Ls.BTN_LOCK="BTN_DIR_LOCK",Ls.BTN_REF="BTN_DIR_REF";class Ms extends it{constructor(){super(),this.isDown=!1}onEnable(){this.initUi()}initUi(){this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onDistanceMouseHandler,this.owner),this.layaMonitor(Laya.Event.MOUSE_UP,this.onDistanceMouseHandler,this.owner),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onDistanceMouseHandler,this.owner)}onUpdate(){ea.scene.isGameStop||ea.scene.GamePause||this.isDown&&cafe.event.dispatch(Ms.CAR_REF+"_"+this.type)}onDistanceMouseHandler(e){let t=this;switch(e.type){case Laya.Event.MOUSE_DOWN:t.isDown=!0,t.downBack&&t.downBack.run();break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:t.isDown=!1,cafe.event.dispatch(Ms.CAR_UP+"_"+t.type)}}onDestroy(){super.onDestroy()}}Ms.CAR_REF="CAR_REF",Ms.CAR_UP="CAR_UP";class Ss extends it{constructor(){super(),this.upAlpha=.5,this.downAlpha=1,this.isPlayingYY=!1}onEnable(){this.initUi()}setParams(e){this.upAlpha=e.upAlpha?e.upAlpha:.5,this.downAlpha=e.downAlpha?e.downAlpha:1,this.owner.alpha=this.upAlpha}initUi(){let e=this;if(!ea.scene.isGameStop&&!ea.scene.GamePause){var t=e.addCom(e.owner.btn_go,Ms);t.type="GO",t.downBack=new Laya.Handler(e,()=>{e.owner.box_guide1.visible=!1,e.owner.ani_guide1.stop(),e.isPlayingYY&&(e.isPlayingYY=!1)}),e.addCom(e.owner.btn_break,Ms).type="BREAK",e.addCom(e.owner.btn_sc,Ms).type="BRAKE"}}onDestroy(){this.owner.ani_guide1.stop(),super.onDestroy()}}Ss.BTN_LOCK="BTN_DIR_LOCK",Ss.BTN_REF="BTN_DIR_REF";class Ps{constructor(){this.isGameStop=!1,this.GamePause=!1,this.npcGamePause=!0,this.isOpenTask=!1,this.isGuide=!1,this.isSceneGuide=!1,this.isNoFunc=!1,this.isControlDebug=!1,this.isKillWorking=!1,this.showState=0,this.FUNC_NOACTIVE_STATE=0,this.FUNC_ACTIVE_STATE=1,this.gameState=0}install(e){this.isGameing=!0,this.isGameEnd=!1,this.isGameStop=!1,this.GamePause=!1,ea.hall.isEnterMission=!1,this.owner=e,this.things={},this.mapCode=e.addCom(e,Is),this.thingCode=e.addCom(e,$i),this.cameraCode=e.addCom(e,Ii),this.mapCode.init()}installUi(e){this.ui=e,this.steering=e.addCom(e,bi),ea.scene.player&&ea.scene.player.info.thingHandler.run(),mi.init(e)}switchControl(e=!1){if(console.log("iscar="+e),e){this.ui.v_steering.visible=!1,this.ui.removeCom(this.ui.v_steering,Ti),this.ui.removeCom(this.ui.v_steeringbtndir,Ls),this.ui.removeCom(this.ui.v_steeringbtndir,Ai),(t=this.ui.addCom(this.ui.v_steeringbtndir,Ls)).setParams("YG",{upAlpha:.5,downAlpha:1}),this.ui.addCom(this.ui.v_steeringbtndir,Ai).setParams("CAMERA",{range:256}),this.ui.addCom(this.ui.v_speedCar,Ss),this.ui.box_car.visible=!0,ea.scene.player.playAni(ie.ride),console.log("self.ui.box_car.visible="+this.ui.box_car.visible)}else{if(this.ui.box_car.visible=!1,t)return;var t;this.ui.v_steering.visible=!0,this.ui.removeCom(this.ui.v_steering,Ti),this.ui.removeCom(this.ui.v_steering,wi),this.ui.removeCom(this.ui.v_steering,Ai),(t=this.ui.addCom(this.ui.v_steering,wi)).setParams("YG",{upAlpha:.5,downAlpha:1,range:110}),this.ui.addCom(this.ui.v_steering,Ai).setParams("CAMERA",{range:1024})}}hideAd(){}refAd(){}hideNoFuncBtn(){this.isGameStop=!0,this.ui.v_steering.visible=!1,this.isNoFunc=!0}dispose(){mi.destroy(),this.hitResultNode&&(this.hitResultNode.removeSelf(),this.hitResultNode.destroy(),this.hitResultNode=null),this.ui&&(this.ui.removeSelf(),this.ui.destroy(),this.ui=null),this.isGameing=!1}}class Rs{strToInfo(e){var t=e.split(":"),i={};return i.goodsId=Number(t[1]),i.tb=a.goods.fetchGoodsTb(i.goodsId),i.type,i.tb.type,i.count=Number(t[2]),i}isGoodCount(e){return 3==e.split(":").length}}class Ds{constructor(){this.enter_count=0,this.isEnterMission=!1,this.isShowAddD=!1}enter(){}start(e){}exit(){}onIOSPlat(){if(this.scene&&this.scene.stage){var e=Laya.stage.width/fe.sourceW,t=fe.sourceW/Laya.stage.width;fe.width,fe.height,fe.height,fe.width,fe.height}}}class Ns{strToInfo(e){var t=e.split(":"),i={};return i.type=Number(t[0]),i.count=Number(t[1]),i.unit=t[2]?t[2]:"",i}isMoneyPrice(e){return e.split(":").length<=2}}class js extends he{constructor(){super()}static get inst(){return js._inst||(js._inst=new js),js._inst}localPet(e){var t=Ve.npc.getCurrNpc().tb.configId,i=ea.scene.player.owner;i.getChildByName(t.toString())||Tn.inst.load3d.thingRes("res/res3D/role/"+t+".lh",i,Laya.Handler.create(this,function(e){var t=e.transform,i=t.localScale,s=t.rotationEuler;t.localPosition=new Laya.Vector3(-.3,.3,-.3),i.setValue(.6,.6,.6),t.localScale=i,s.setValue(0,0,0),t.rotationEuler=s}))}dispose(){}}class Gs extends Te{onGetHandler(e){this.owner;be.closepanel(we.GetRolePanel),Ue.show("解锁成功"),e&&e.runWith([1])}unbin(){super.unbin()}}class Bs extends Te{onSelectHandler(e,t){this.owner;Ve.game.roleid=e.info.roleId,be.closepanel(we.RoleListPanel),Ve.role.haveRole(e.info.roleId,!0),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),ea.scene.GamePause=!1,Ve.signin.isOneOpen&&(Ve.signin.isOneOpen=!1),Ue.show("装备成功"),t&&t.run()}onSelect2Handler(e,t){this.owner;Ve.role.haveRole(e.info.roleId),Ve.signin.isOneOpen=!1,t&&t.run()}onSelect4Handler(e,t){this.owner;Ve.role.selectRole(e.info.roleId),Ve.signin.isOneOpen=!1,t&&t.run()}onSelect3Handler(e,t){this.owner;Ve.role.selectRole(e.info.roleId),Ve.signin.isOneOpen=!1,t&&t.run()}onCloseHandler(e){this.owner;if(be.closepanel(we.RoleListPanel),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),Ve.signin.isOneOpen){Ve.signin.isOneOpen=!1,Ve.signin.isOneOpen=!1}e&&e.run()}onBuyHandler(e){this.owner;e&&e.run()}unbin(){super.unbin()}}class Hs extends Te{onTestHandler(e){var t=this,s=t.owner;be.closepanel(we.GetRoleTestPanel),e&&e.runWith([1]);var a=Ve.role.rolemap[s.info.roleId];Ve.role.test_role=s.info.roleId,cafe.event.dispatch(Z.EQUIP_ROLE,Ve.role.test_role),setTimeout(()=>{be.openTopTipPanel(we.GetRolePanel,{info:a,isClick:!0,handler:initHandler(t,e=>{ea.scene.GamePause=!1,1==e?(i.save("localrole","1"),Ve.role.test_role=null,Ve.role.haveRole(a.roleId)):(Ve.role.test_role=null,cafe.event.dispatch(Z.EQUIP_ROLE,Ve.role.equip_role))})})},1e4)}unbin(){super.unbin()}}class Os{constructor(){this.list=new Bs,this.get=new Gs,this.test=new Hs}}class zs extends ae{constructor(){super(),this.weaponLlist=[],this.npcweaponLlist=[]}static get inst(){return zs._inst||(zs._inst=new zs),zs._inst}equipWeapon(e){var t=this;if(ea.scene.player&&ea.scene.player.owner){var i=ea.scene.player.owner;if(t.weaponLlist.length>0){for(var s=0;s<t.weaponLlist.length;s++){var n=Xe.getBody(i,t.weaponLlist[s].name);n&&(n.removeSelf(),n.destroy())}t.weaponLlist=[]}if(cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),Ve.game.changeCharm(),t.bodyMoveTarget(),e)for(var o=0;o<e.length;o++)for(var r=a.equip.getTbByEquipId(e[o]),l=r.weaponEquipName.split("-"),h=0;h<l.length;h++)for(var c=Xe.getBodys(i,l[h]),d=0;d<c.length;d++){var u=r.equipMod,p=r.equipScale;Tn.inst.load3d.thingRes(ce.getPropUrl(u+".lh"),c[d],initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.transform.localScale=new Laya.Vector3(p,p,p),t.weaponLlist.push(e),cafe.event.dispatch(se.INITROLEEQUIP,Ve.role.equip_role),"20080020"==u&&e&&e.numChildren>0&&(e.getChildAt(0).active=!1,e.getChildAt(1).active=!1)}))}}}npcequipWeapon(e){var t=this;if(Ve.npc.equip_npc&&Ve.game.equipNpc){var i=Ve.game.equipNpc;if(t.npcweaponLlist.length>0){for(var s=0;s<t.npcweaponLlist.length;s++){var n=Xe.getBody(i,t.npcweaponLlist[s].name);n&&(n.removeSelf(),n.destroy())}t.npcweaponLlist=[]}if(e){for(var o=0;o<e.length;o++)for(var r=a.equip.getTbByEquipId(e[o]),l=r.weaponEquipName.split("-"),h=0;h<l.length;h++)for(var c=Xe.getBodys(i,l[h]),d=0;d<c.length;d++){var u=r.equipMod;80011!=r.equipId&&80006!=r.equipId||(u=0==h?r.equipMod+"L":r.equipMod+"R"),Tn.inst.load3d.thingRes(ce.getPropUrl(u+".lh"),c[d],initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),t.npcweaponLlist.push(e),cafe.event.dispatch(se.INITNPCEQUIP,Ve.npc.equip_npc)}))}cafe.event.dispatch(se.INITNPCEQUIP,Ve.npc.equip_npc)}}}bodyMoveTarget(){}dispose(){}}class Vs extends Te{onRunHandler(e){this.owner;be.closepanel(we.SignInPanel),Lt.reportSignIn(6),Ve.signin.sync_signIn(1),Ve.signin.isOneOpen=!1,e&&e.run()}onBuyHandler(e){this.owner;be.closepanel(we.SignInPanel),Ve.signin.sync_signIn(0),Lt.reportSignIn(3),e&&e.run()}unbin(){super.unbin()}}class Fs extends Te{onRunHandler(e){var t=this.owner;be.closepanel(we.SkillUnlockPanel),ea.scene.GamePause=!1,Ve.skill.haveSkill(t.info.skillId),e&&e.runWith([1])}onBuyHandler(e){var t=this.owner,i=t.info.tb.openCondition.split("|")[0].split(":");Ve.user.isGold(Number(i[1]))?(Ue.show("购买成功"),Ve.user.removeGold(Number(i[1])),be.closepanel(we.SkillUnlockPanel),ea.scene.GamePause=!1,Ve.skill.haveSkill(t.info.skillId),e&&e.runWith([1])):Ue.show("金币不足")}unbin(){super.unbin()}}class Us{constructor(){this.unlock=new Fs}getSkillValue(e,t){switch(t.skillFunc){case 101:return e+t.value;case 102:return e*t.value;case 103:return e*t.value/100;case 104:return t.value}}}class qs extends Te{onRunRewardHandler(e){this.owner;Lt.logStageLoad(1),Lt.reportTask(this.owner.task.taskId,1),Ve.user.addGold(this.owner.task.tb.taskGold,this.owner.moneypos,null,()=>{be.closepanel(we.TaskFinishPanel),e&&e.run(),ea.scene.GamePause=!1;var t=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(t.music)})}onRunNBRewardHandler(e){this.owner;Lt.logStageLoad(1),Ve.user.addGold(3*this.owner.task.tb.taskGold,this.owner.moneypos,null,()=>{be.closepanel(we.TaskFinishPanel),e&&e.run(),ea.scene.GamePause=!1;var t=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(t.music)})}onBuyHandler(e){this.owner;e&&e.run()}unbin(){super.unbin()}}class Ys{static get_list(){return[{url:"res/table/q_chat.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_device.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_drop.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_effect.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_effectAction.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_equip.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_func.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_furniture.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_fuse.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_global.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_goods.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_guide.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_home.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_language.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_lottery.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_map.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_mapAni.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_mission.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_money.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_monster.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_niudan.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_npc.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_planelayer.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_plot.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_remon.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_role.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_roleLevel.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_roleSkillMod.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_role_level.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_route.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_shop.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_signIn.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_skill.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_skillMod.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_sound.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_talk.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_task.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_test.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_thing.json",type:me.rescfg,restype:pe.rescfg_table},{url:"res/table/q_zhuanpan.json",type:me.rescfg,restype:pe.rescfg_table}]}}class Ws{static get_list(){var e=[{url:"res/common",type:me.res2d,restype:pe.res2d_atlas},{url:"res/bg",type:me.res2d,restype:pe.res2d_atlas}];return e.unshift(...Ys.get_list()),e}static get_list2(){return[{url:we.MoneyView,type:me.res2d,restype:pe.scene2d_res},{url:we.GameStrengthView,type:me.res2d,restype:pe.scene2d_res},{url:we.AlertActionTipPanel,type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game",type:me.res2d,restype:pe.res2d_atlas},{url:"res/modules/shop",type:me.res2d,restype:pe.res2d_atlas},{url:we.FightHeroInfoView,type:me.res2d,restype:pe.scene2d_res},{url:we.HallScene,type:me.res2d,restype:pe.scene2d_res},{url:we.hallListItemView,type:me.res2d,restype:pe.scene2d_res},{url:we.GetRolePanel,type:me.res2d,restype:pe.scene2d_res},{url:we.GetRoleTestPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.RoleListItemView,type:me.res2d,restype:pe.scene2d_res},{url:we.RoleListItemView2,type:me.res2d,restype:pe.scene2d_res},{url:we.RoleListPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.NpcListItemView,type:me.res2d,restype:pe.scene2d_res},{url:we.NpcListPanel,type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/signIn",type:me.res2d,restype:pe.res2d_atlas},{url:we.TipsView,type:me.res2d,restype:pe.scene2d_res},{url:we.MoneyTipsView,type:me.res2d,restype:pe.scene2d_res}]}static get_game_list(e){var t=[{url:we.GameScene,type:me.res2d,restype:pe.scene2d_res,handler:e},{url:"res/modules/game",type:me.res2d,restype:pe.res2d_atlas},{url:"res/modules/game/MainUiTaskItem.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/item/TaskProgress.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/item/Timer.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/view/JackCarSpeedFuncBtnView.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/view/JackCarUpBtnDirView.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/view/JackDirView.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/game/view/JackView1.scene",type:me.res2d,restype:pe.scene2d_res},{url:"res/modules/buff",type:me.res2d,restype:pe.res2d_atlas},{url:we.DropBuffPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.DropEquipPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.DropRewardPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.DropDependPanel,type:me.res2d,restype:pe.scene2d_res},{url:"res/icon/money/1002.png",type:me.res2d,restype:pe.img2d_res},{url:"res/modules/plot",type:me.res2d,restype:pe.res2d_atlas},{url:we.TaskAcceptPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.TalkView,type:me.res2d,restype:pe.scene2d_res},{url:we.MainUiView,type:me.res2d,restype:pe.scene2d_res},{url:we.ShopItemView,type:me.res2d,restype:pe.scene2d_res},{url:we.ShopPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.npcShopItemView,type:me.res2d,restype:pe.scene2d_res},{url:we.npcShopPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.ShopItemView2,type:me.res2d,restype:pe.scene2d_res},{url:we.ShopPanel2,type:me.res2d,restype:pe.scene2d_res},{url:we.RoleTrialPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.GoldPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.ZhuanPanPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.DropAdiPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.NiuDanPanel,type:me.res2d,restype:pe.scene2d_res}];return t.push(),t.push({url:"res/modules/guide",type:me.res2d,restype:pe.res2d_atlas},{url:we.GuidePanel,type:me.res2d,restype:pe.scene2d_res},{url:"res/dbres/anniu/anniu",type:me.res2d,restype:pe.res2d_db},{url:"res/modules/game_end",type:me.res2d,restype:pe.res2d_atlas},{url:we.SignInItem,type:me.res2d,restype:pe.scene2d_res},{url:we.SignInItem2,type:me.res2d,restype:pe.scene2d_res},{url:we.SignInPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.PausePanel,type:me.res2d,restype:pe.scene2d_res},{url:we.EndUpPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.EndUpPanel2,type:me.res2d,restype:pe.scene2d_res},{url:we.EndWinPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.EndLostPanel,type:me.res2d,restype:pe.scene2d_res},{url:we.npcEndLostPanel,type:me.res2d,restype:pe.scene2d_res}),t}}class Xs{static load_list(){return[]}static platPre(){return!1}}class Ks{constructor(){cafe.event.on(ge.game.MAP_TRANSFER_POINT,this.showMap,this)}static get inst(){return Ks._inst||(Ks._inst=new Ks),Ks._inst}static enterGame(){let e=Ks.thisobj;ea.scene.GamePause=!0,be.showloadding();var t,i=a.mission.fetchMissionTb(Ve.game.mission_id),s=!1;1==Ve.map.map.type||(t=Ve.map.map),Ve.game.mission=i,Ve.level.isBossShow=!1,ea.scene&&ea.scene.cameraCode&&ea.scene.cameraCode.clearCamera(),slog("进入"+t.mapConfig+"场景");let n=Ws.get_game_list(initHandler(e,()=>{slog("初始化GameScene场景"),We.openscene(we.GameScene).start(),s&&ea.scene.mapCode&&ea.scene.mapCode.createMap(t.mapId)}));n.push({url:t.mapId+"|"+i.missionId,type:me.resmap,restype:pe.resmap_type},{url:"scene/map_scene.ls",type:me.res3d,restype:pe.res3d_group_scene},{url:Re.res_dic[Re.res_enum[`_role_${Ve.role.getCurrRole().tb.roleMod}_lh`]],type:2});var o=i.missionTriggerPreRes.split("|");if("0"!=i.missionTriggerPreRes)for(var r=0;r<o.length;r++)n[n.length]={url:Pe.res_dic[Pe.res_enum[`_prop_res_${o[r]}_lh`]],type:me.res3d,restype:pe.res3d_group_prop};serror("进入预加载"),be.titlehandler.runWith(["游戏场景"]),Tn.inst.load(n,initHandler(e,()=>{slog("初始化GameScene.mapCode",t.mapId),ea.scene.mapCode&&(ea.scene.mapCode.createMap(t.mapId),Tn.inst.sound.play(0),Tn.inst.sound.play(t.music)),Tn.inst.load(Xs.load_list(),initHandler(e,()=>{cafe.event.dispatch(ge.game.LOAD_END_SHOW_UI),s=!0}))}),ue.LevelB,be.prosshandler),Ks.inst}showMap(e){if(0==e)return;if(!Ve.game.isFinish)return void Ue.show("资源加载中请稍后再试");Ve.game.isFinish=!1,ea.scene.GamePause=!0,mi.device.currentMountGear&&mi.device.unDeviceByMap();var t=a.mission.fetchMissionTb(Ve.game.mission_id);Laya.LocalStorage.setItem("curMap",e.toString()),Ve.game.roleRoadPoi=[];ea.scene&&ea.scene.cameraCode&&ea.scene.cameraCode.clearCamera();var i=a.map.getTbBymap(e);slog("进入"+e+"场景");let s=[];s.push({url:e+"|"+t.missionId,type:me.resmap,restype:pe.resmap_type});var n=t.missionTriggerPreRes.split("|");if("0"!=t.missionTriggerPreRes)for(var o=0;o<n.length;o++)s[s.length]={url:Pe.res_dic[Pe.res_enum[`_prop_res_${n[o]}_lh`]],type:me.res3d,restype:pe.res3d_group_prop};serror("进入预加载"),Tn.inst.load(s,initHandler(this,()=>{oi.singleton.mapId=e,be.showloadding(),be.prosshandler.runWith([0]),Ve.map.loadMpt(),Tn.inst.sound.play(0),Tn.inst.sound.play(i.music),ea.scene.mainscene.fogRange=Ve.map.map.view,ea.weapon.equipWeapon(Ve.shop.equip_weapon)}),ue.LevelB,be.prosshandler)}static loadCurrGame(){let e=Ks.thisobj;var t=a.mission.fetchMissionTb(Ve.game.mission_id),i=Ve.map.map;slog("进入"+i.mapConfig+"场景");let s=Ws.get_game_list();s.push({url:t.missionId,type:me.resmap,restype:pe.resmap_type},{url:"scene/map_scene.ls",type:me.res3d,restype:pe.res3d_group_scene});for(var n=t.missionRouteList.split("|"),o=0;o<n.length;o++){var r=a.route.getTbByRouteId(Number(n[o])),l=a.thing.getTbByThingId(r.routePathNpcId);s.push({url:"res/config/pathdata/"+r.routePathId+".json",type:me.rescfg,restype:pe.rescfg_json}),s.push({url:"prop_res/"+l.path+".lh",type:me.res3d,restype:pe.res3d_group_prop})}var h=t.missionTriggerPreRes.split("|");if("0"!=t.missionTriggerPreRes)for(o=0;o<h.length;o++)s[s.length]={url:Pe.res_dic[Pe.res_enum[`_prop_res_${h[o]}_lh`]],type:me.res3d,restype:pe.res3d_group_prop};serror("进入预加载"),be.titlehandler.runWith(["游戏场景"]),Tn.inst.load(s,initHandler(e,()=>{serror("后台当前关加载完成")}),ue.LevelB,be.prosshandler)}static loadNextGame(){let e=Ks.thisobj;var t=a.mission.fetchMissionTb(Ve.game.mission_id),i=a.mission.fetchMissionTb(t.mission_next),s=Ve.map.map;slog("进入"+s.mapConfig+"场景");let n=Ws.get_game_list();n.push({url:i.missionId,type:me.resmap,restype:pe.resmap_type},{url:"scene/map_scene.ls",type:me.res3d,restype:pe.res3d_group_scene});for(var o=i.missionRouteList.split("|"),r=0;r<o.length;r++){var l=a.route.getTbByRouteId(Number(o[r])),h=a.thing.getTbByThingId(l.routePathNpcId);n.push({url:"res/config/pathdata/"+l.routePathId+".json",type:me.rescfg,restype:pe.rescfg_json}),n.push({url:"prop_res/"+h.path+".lh",type:me.res3d,restype:pe.res3d_group_prop})}var c=i.missionTriggerPreRes.split("|");if("0"!=i.missionTriggerPreRes)for(r=0;r<c.length;r++)n[n.length]={url:Pe.res_dic[Pe.res_enum[`_prop_res_${c[r]}_lh`]],type:me.res3d,restype:pe.res3d_group_prop};serror("进入预加载"),be.titlehandler.runWith(["游戏场景"]),Tn.inst.load(n,initHandler(e,()=>{serror("后台下一关加载完成")}),ue.LevelB,be.prosshandler)}}Ks.thisobj={};class Js{static init(e){var t=Js.thisobj;Js.shop=new Laya.Handler(t,Js.shop_init(e)),Js.level=new Laya.Handler(t,Js.level_init(e)),Js.map=new Laya.Handler(t,Js.map_init(e)),Js.sound=new Laya.Handler(t,Js.sound_init(e)),Js.signin=new Laya.Handler(t,Js.signin_init(e)),Js.money=new Laya.Handler(t,Js.money_init(e))}static add_desk_init(e){return()=>{}}static shop_init(e){return e=>{switch(e){case"open":be.openpanel(we.ShopPanel)}}}static level_init(e){return e=>{switch(e){case"open":be.openpanel(we.LevelPanel)}}}static map_init(e){return(e,t)=>{var s=i.read("GuideGame");s?"1"==s&&i.save("GuideGame","2"):i.save("GuideGame","1"),ea.hall.isEnterMission=!0,Ve.level.select_id?Ve.game.mission_id=Ve.level.select_id:Ve.game.mission_id=e,Ve.role.selectRole(Ve.role.equip_role),Ks.enterGame(),Lt.reportEnter(4)}}static sound_init(e){var t,i=e=>{t=e};return i(1==Ve.setting.isSound),()=>{i(t=!t),Ve.setting.switchSound(t)}}static signin_init(e){return()=>{be.openpanel(we.SignInPanel)}}static money_init(e){return(t,i)=>{switch(t){case"gold":Ve.user.addGold(i,ea.hall.moneypos);break;case"action":if(Ve.user.isMaxAction())return void Ue.show("体力已满无法获得更多体力");Ve.user.addAction(i,ea.hall.actionpos);break;case"getaction":if(Ve.user.isMaxAction())return void Ue.show("体力已满无法获得更多体力");var s=new Laya.Handler(e,e=>{e<0||(Ve.user.addAction(i,ea.hall.actionpos),s.recover())})}}}}Js.thisobj={};class Zs extends Te{onRunHandler(e){this.owner;ea.hall.isEnterMission?Ue.show("请稍等片刻"):(be.closepanel(this.owner.name),Js.map.runWith([Ve.level.select_id,10001]),e&&e.run())}onBuyHandler(e){this.owner;e&&e.run()}unbin(){super.unbin()}}class Qs{constructor(){this.success=new Zs,this.finish=new qs}}class $s extends he{constructor(){super()}static get inst(){return $s._inst||($s._inst=new $s),$s._inst}localTuoWei(e){var t=Ve.shop.getcurTuoWei(),i=ea.scene.player.owner;i.getChildByName(t.toString())||Tn.inst.load3d.thingRes("res/res3D/prop_effect/"+t+".lh",i,Laya.Handler.create(this,function(e){var t=e.transform,i=t.localScale,s=t.rotationEuler;t.localPosition=new Laya.Vector3(0,0,-.3),i.setValue(1,1,1),t.localScale=i,s.setValue(-90,0,0),t.rotationEuler=s}))}dispose(){}}class ea{static init(){ea.car=new de,ea.drop=new yi,ea.end=new vi,ea.scene=new Ps,ea.goods=new Rs,ea.hall=new Ds,ea.money=new Ns,ea.pet=new js,ea.role=new Os,ea.weapon=new zs,ea.signin=new Vs,ea.skill=new Us,ea.task=new Qs,ea.tuowei=new $s}}class ta{static StringAndNumberEqual(e,t){for(var i=e.split("|"),s=0;s<i.length;s++)if(t==Number(i[s]))return!0;return!1}static setList(e){var t=0;return()=>{var i=e[t];return++t>e.length?(serror("获取参数长度"+t+"超过源长度"+e.length),null):i}}static get8DirByAngle(e){return 0==e||360==e||e>337.5||e<=22.5?1:e>22.5&&e<=67.5?2:e>67.5&&e<=112.5?3:e>112.5&&e<=157.5?4:e>157.5&&e<=202.5?5:e>202.5&&e<=247.5?6:e>247.5&&e<=292.5?7:e>292.5&&e<=337.5?8:0}static get4DirByAngle(e){return 0==e||360==e||e>315||e<=45?1:e>45&&e<=135?2:e>135&&e<=225?3:e>225&&e<=315?4:0}static getHandlerBy4Dir(e,t,i,s){return(a,n)=>{switch(a){case 1:e.runWith([n]);break;case 2:t.runWith([n]);break;case 3:i.runWith([n]);break;case 4:s.runWith([n])}}}static getHandlerBy8Dir(e,t,i,s){return(a,n)=>{switch(a){case 1:e.runWith([n]);break;case 2:e.runWith([n]),t.runWith([n]);break;case 3:t.runWith([n]);break;case 4:t.runWith([n]),i.runWith([n]);break;case 5:i.runWith([n]);break;case 6:i.runWith([n]),s.runWith([n]);break;case 7:s.runWith([n]);break;case 8:s.runWith([n]),e.runWith([n])}}}static MainRoleRay(e,t,i,s){var a=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(e,t,a)){for(var n=0;n<a.length;n++){var o=a[n];"group_uninstall"!=o.collider.owner.name&&("b_move_hit"!=o.collider.owner.name&&"qiuCube"!=o.collider.owner.name&&"dmove_hit"!=o.collider.owner.name&&"dmove_hit2"!=o.collider.owner.name&&"group_uninstall"!=o.collider.owner.name&&"attack_hit"!=o.collider.owner.name&&"skill_hit"!=o.collider.owner.name&&"bullet_hit"!=o.collider.owner.name&&"group_hit"!=o.collider.owner.name&&"group_check"!=o.collider.owner.name&&"move_hit"!=o.collider.owner.name&&"umove_hit"!=o.collider.owner.name&&"saveCube"!=o.collider.owner.name&&1!=o.collider.owner.parent.isrole&&1!=o.collider.owner.parent.parent.isrole&&(o.collider.owner.main&&37241==o.collider.owner.main.thingId||("Cube (22)"==o.collider.owner.name&&o.collider.owner.main&&11230479==o.collider.owner.main.tb.configId&&(o.point.y=2.82),i(o))))}s&&s()}}static isMainRoleRay(e,t){var i=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(e,t,i))for(var s=0;s<i.length;s++){var a=i[s];if("qiuCube"!=a.collider.owner.name&&("dmove_hit"!=a.collider.owner.name&&"group_uninstall"!=a.collider.owner.name&&"attack_hit"!=a.collider.owner.name&&"skill_hit"!=a.collider.owner.name&&"bullet_hit"!=a.collider.owner.name&&"group_hit"!=a.collider.owner.name&&"group_check"!=a.collider.owner.name&&"move_hit"!=a.collider.owner.name))return!0}return!1}static MainRoleClimbAngleYRay(e,t,i){var s,a,n=Qe.calcTrajectoryParamstwo(e,i,t).pos,o=i;return ta.MainRoleRay(e,new Laya.Vector3(n.x,e.y,n.y),t=>{var i=getDistance({x:e.x,y:e.z},{x:t.point.x,y:t.point.z});if(!s||o>Math.floor(1e3*i)/1e3){if(!(s=t.collider.owner.main))return;a=t.point.clone();var n=s.tb;n&&n.funcType==Jt.CLIMB&&(o=Math.min(o,i))}}),!a||o>=i?null:a}static MainRoleClimbAngleXRay(e,t){var i=e.clone();i.y+=t;var s=i,a=!1;t<0&&(a=!0);var n,o=i.y,r=!1;return ta.MainRoleRay(e,s,e=>{if(a&&e.point.y>o){o=Math.max(e.point.y,o),n=e.point.clone();var t=e.collider.owner.main.tb;r=!(!t||t.funcType!=Jt.CLIMB)}else if(!a&&e.point.y<o){o=Math.min(e.point.y,o),n=e.point.clone();t=e.collider.owner.main.tb;r=!(!t||t.funcType!=Jt.CLIMB)}}),n?{pos:n,isClimb:r}:null}static ArrayPush(e,t){var i=e.indexOf(t);return-1==i&&(i=e.length,e.push(t)),i}static ArrayCalculatePush(e,t,i){var s=e.filter(e=>i(e))[0],a=e.indexOf(s);return-1==a&&(a=e.length,e.push(t)),a}static trTo9G(e){var t=[];return t.push(e.transform.localPositionX),t.push(e.transform.localPositionY),t.push(e.transform.localPositionZ),t.push(e.transform.localRotationEulerX),t.push(e.transform.localRotationEulerY),t.push(e.transform.localRotationEulerZ),t.push(e.transform.localScaleX),t.push(e.transform.localScaleY),t.push(e.transform.localScaleZ),t}static m9GToTr(e){var t={};return t.localPosition=new Laya.Vector3(e[0],e[1],e[2]),t.localRotationEuler=new Laya.Vector3(e[3],e[4],e[5]),t.localScale=new Laya.Vector3(e[6],e[7],e[8]),t}static m9GToPos(e){return new Laya.Vector3(e[0],e[1],e[2])}static getPos(e){return null!=e.length&&e.length>=3?new Laya.Vector3(e[0],e[1],e[2]):null!=e.transform?e.transform.localPosition.clone():void 0}static toTrBy9G(e,t){e&&e.transform&&(e.transform.localPositionX=t[0],e.transform.localPositionY=t[1],e.transform.localPositionZ=t[2],e.transform.localRotationEulerX=t[3],e.transform.localRotationEulerY=t[4],e.transform.localRotationEulerZ=t[5],e.transform.localScaleX=t[6],e.transform.localScaleY=t[7],e.transform.localScaleZ=t[8])}static toTrBy6G(e,t){e.transform.localPositionX=t[0],e.transform.localPositionZ=t[1],e.transform.localScaleX=t[4],e.transform.localScaleZ=t[5]}static toTrBy9Tr(e,t){e.transform.localPosition=t.transform.localPosition.clone(),e.transform.localRotationEuler=t.transform.localRotationEuler.clone(),e.transform.localScale=t.transform.localScale.clone()}static get9GByTr(e){var t=[];return t.push(e.transform.localPositionX),t.push(e.transform.localPositionY),t.push(e.transform.localPositionZ),t.push(e.transform.localRotationEulerX),t.push(e.transform.localRotationEulerY),t.push(e.transform.localRotationEulerZ),t.push(e.transform.localScaleX),t.push(e.transform.localScaleY),t.push(e.transform.localScaleZ),t}static isTrIn9G(e,t){var i=e.transform.localPosition.clone(),s=new Laya.Vector3(t[0],t[1],t[2]),a=new Laya.Vector3(t[6],t[7],t[8]),n=s.x-a.x/2,o=s.y-a.y/2,r=s.z-a.z/2,l=s.x+a.x/2,h=s.y+a.y/2,c=s.z+a.z/2;return i.x>n&&i.x<l&&i.y>o&&i.y<h&&i.z>r&&i.z<c}}class ia extends Laya.Sprite3D{constructor(){super(...arguments),this._isSelect=!1,this._isWork=!1}initRes(e,t,i,s){this.dataStr=s,this.resFunc=e,this.modelType=t,this.eventmap={},ia.ModelSpriteType=le.type_thing,ia.MptEnumType=J.THING,this.dthing=i;var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(i.l,5,i.w));this.addChild(a),a.transform.localPosition=new Laya.Vector3(0,2.5,0);var n=new Laya.UnlitMaterial;n.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,n.albedoColor=new Laya.Vector4(.1,.1,.1,0),a.meshRenderer.material=n,this.premode=a}get initPoint(){return this._initPoint}setInitPoint(e){this._initPoint=e,this&&ta.toTrBy9G(this,e)}setTracks(e){this.tracks=e}monitor(e,t){this.eventmap[e]={type:e,handler:t},cafe.event.on(e,t,this)}clearMonitor(){for(var e in this.eventmap){var t=this.eventmap[e];cafe.event.off(t.type,t.handler,this),delete this.eventmap[e]}}get isSelect(){return this._isSelect}set isSelect(e){this._isSelect=e,this._isSelect?ea.scene.cameraCode.addMode(this.bpmode):ea.scene.cameraCode.removeMode(this.bpmode)}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length;if(!e._isWork){e._isWork=!0;var s=i=>{var s=i.res;Tn.inst.load3d.thingRes(e.resFunc(s),e,initHandler(e,a=>{if(a){var n=i.thing.offY?i.thing.offY:0;a.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,n,i.thing.z+i.thing.offZ-t.w/2),a.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),a.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),a.name="body",a.main=e,e.mode=a,Xe.setBodyMainPy(a,e),1==e._distancetype?(a.active=!0,e.premode.active=!1):a.active=!1}else serror("mapThingRes加载资源失败：",s)}),ue.LevelG)};for(let e=0;e<i;e++){s(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("40"==t[0]){var i=t[1].split("_"),s=Ve.task.getMainLineTask(),a=!1;if(s)for(var n=s.taskId,o=0;o<i.length;o++){var r=i[o].split(":");if(Number(r[0])<=n&&0==Number(r[1])){a=!0;break}if(Number(r[1])>=n&&0==Number(r[0])){a=!0;break}if(Number(r[1])>=n&&Number(r[0])<=n){a=!0;break}}if(!a)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:this.mode?(this.premode.active=!1,ea.scene.cameraCode.addMode(this.bpmode),this.mode.active=!0):(this.premode.active=!0,this.load());break;case 2:this.mode?this.mode.active=!1:this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:this.mode?this.mode.active=!1:this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode);break;default:this.premode.active=!1,this.mode&&(this.mode.active=!1),ea.scene.cameraCode.removeMode(this.bpmode)}}static getThing(e,t,i){t||(t=this.MptEnumType),i||(i=this.ModelSpriteType);var s=cafe.data.get("MAP_DATA").model(t);if(s){for(var a=s.things,n=0;n<a.length;n++){var o=a[n];if(o.modelType==i&&o.tbId==e)return o}return null}}static getThingList(e,t){e||(e=this.MptEnumType),t||(t=this.ModelSpriteType);var i=cafe.data.get("MAP_DATA").model(e);if(i){for(var s=i.things,a=[],n=0;n<s.length;n++){var o=s[n];o.modelType==t&&(a[a.length]=o)}return a}}static getThingListById(e,t,i){t||(t=this.MptEnumType),i||(i=this.ModelSpriteType);var s=cafe.data.get("MAP_DATA").model(t);if(s){var a=s.things,n=[];if(!a)for(var o=s.owner.buildMpt.buildFlags.length,r=0;r<o;r++)10633021==s.owner.buildMpt.buildFlags[r].tb.configId&&(n[n.length]=s.owner.buildMpt.buildFlags[r].mode);if(a&&a.length>0)for(r=0;r<a.length;r++){var l=a[r];l.modelType==i&&l.tbId==e&&(n[n.length]=l)}return n}}valueApi(e){return null}onDestroy(){super.onDestroy();this.clearMonitor(),this.mode&&this.mode.parent&&(this.mode.removeSelf(),this.mode.destroy()),this.premode&&this.premode.parent&&(this.premode.removeSelf(),this.premode.destroy()),this.mode=null,this.premode=null}}ia.ModelSpriteType=1;class sa extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),sa.ModelSpriteType=le.type_thing,sa.MptEnumType=J.THING;this.addComponent(ht);var n=a.thing.getTbByConfigId(Number(i.thingId));if(this.triggerType=300+n.type,this.tb=n,this.hp=n.hp,this.createtime=(new Date).getTime(),this.name="prop"+this._id,ea.scene.things[this.name]=this,"0"!=this.dataStr){var o=this.dataStr.split("|");if(Number(o[0])==ye.REPLACE_FURNITURE){var r=n.path,l=a.furniture.getTbByFurnitureId(Number(r));this.monitor(ge.game.REPLACE_FURNITURE+"_"+l.type,this.load)}}}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=i=>{var a;if(e.mode&&e.mode.parent&&(e.mode.removeSelf(),e.mode.destroy(),e.mode=null),"0"!=e.dataStr){var n=e.dataStr.split("|");Number(n[0])==ye.REPLACE_FURNITURE||(a=i.res)}else a=i.res;Tn.inst.load3d.thingRes(e.resFunc(a),e,initHandler(e,n=>{if(n){var o=i.thing.offY?i.thing.offY:0;n.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),n.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),n.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),n.name="body",n.main=e,e.mode=n,Xe.setBodyMainPy(n,e);var r=e.getComponent(gs);if(r||(r=e.addComponent(gs)),r.initThingTb(s),"0"!=s.aniModPath){var l=e.getComponent(re);l||(l=e.addComponent(re)),l.thing=s,l.state=ie.wait,l.speed=s.anispeed}1==e._distancetype?(n.active=!0,e.premode&&(e.premode.active=!1)):n.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",a)}),ue.LevelF)};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("1001"==t[0]){var i=!1;if(1==Ve.game.showFYbuff&&t[1]==Ve.game.showFYnum.toString()&&(i=!0),!i)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}else if("2001"==t[0]){t[1].split("_"),Ve.task.getMainLineTask(),i=!0;if(t[1],!i)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}if(!ea.scene.cameraCode.isGlobalCamera||0!=this.tb.type&&1!=this.tb.type){a.furniture.getTbByModId(String(this.tb.configId));this._distancetype=e}else 0==this.tb.type?this._distancetype=1:this._distancetype=2;switch(this._distancetype){case 1:this.mode?(this.premode.active=!1,ea.scene.cameraCode.addMode(this.bpmode),this.mode.active=!0):(this.premode.active=!0,this.load());break;case 2:this.mode?this.mode.active=!1:this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:this.mode?this.mode.active=!1:this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode);break;default:this.premode.active=!1,this.mode&&(this.mode.active=!1),ea.scene.cameraCode.removeMode(this.bpmode)}}TM(e){var t=e.getChildAt(0).meshRenderer.material;t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,t.albedoColorA=.5}BTM(e){var t=e.getChildAt(0).meshRenderer.material;t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_CUTOUT,t.albedoColorA=1}onDestroy(){super.onDestroy()}}class aa extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),aa.ModelSpriteType=le.type_effect,aa.MptEnumType=J.EFFECT,this.triggerType=a.thing.getTbByConfigId(Number(i.thingId)).type,this.tb=a.thing.getTbByConfigId(Number(i.thingId)),this.hp=a.thing.getHpByConfigId(Number(i.thingId)),this.createtime=(new Date).getTime()}onEnable(){super.onEnable()}onDestroy(){super.onDestroy()}}class na extends $e{constructor(){super(...arguments),this.is_add_speed=!1,this.is_buff_magnet=!1,this.is_buff_power=!1}set tb(e){this._tb=e,this.thingHandler&&this.thingHandler.run()}get tb(){return this._tb}}class oa extends he{constructor(e,t,i){super(),this.active=!1,this.isUse=!1;this.pos=t,this.owner=e,this.script=this.owner.getComponent(ht),this.initAct(i)}onEnable(){}initAct(e){this.skill=e,this.onEnable()}install(e){this.active=!0,Ye.add(1,this,this.onFrameEnterHandler)}onUpdate(){}onFrameRun(e){}onFrameEnterHandler(e){this.active&&this.onFrameRun(e)}uninstall(){this.active=!1,Ye.remove(this,this.onFrameEnterHandler)}destroy(){super.destroy(),this.uninstall()}}class ra extends oa{onEnable(){let e=this;super.onEnable(),e.monitor(ge.game.ROLE_USE_SKILL+"_"+e.pos,e.onUseSkillHandler),e.monitor(mt.NAME,e.onSettingChange),e.monitor(se.CANCELSKILL,()=>{e.isUse=!1})}onUseSkillHandler(e){}onSettingChange(){}initAct(e){this.script=this.owner.getComponent(Si),super.initAct(e)}onUpdate(){}destroy(){super.destroy()}}class la extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){Ve.game.MonsterStop||ea.scene.GamePause||(7==Ve.map.map.gamePkType&&(ie.jump2="jump2",ie.jump3="jump3",ie.jump4="jump4"),this.script.ani.state!=ie.lutou&&this.script.ani.state!=ie.chuizi&&this.script.ani.state!=ie.skill&&(this.eventdata=e,this.isUse=e.isDown,this.eventdata.pos=this.pos,0==ea.scene.player.active&&(ea.scene.player.active=!0),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})))}onUpdate(){let e=this,t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script;t&&t.uMoveTrigger&&t.uMoveTrigger.isTrigger&&t.uMoveTrigger.kinematics.length>0&&null==t.uMoveTrigger.kinematics[0].parent&&(t.delTrigger(t.uMoveTrigger.kinematics[0]),t.uMoveTrigger.kinematics=[],t.uMoveTrigger.isTrigger=!1),0==ea.scene.GamePause&&e.isUse&&t&&t.uMoveTrigger&&!t.uMoveTrigger.isTrigger&&cafe.event.dispatch(ge.game.USE_JUMP_ACTION,e.eventdata)}destroy(){super.destroy(),console.log("跳跃回收成功")}}class ha extends he{constructor(e,t,i){super(),this.active=!1;this.name=t,this.owner=e,this.script=this.owner.getComponent(ht),this.initAct(i)}onEnable(){}initAct(e){this.onEnable()}install(e){this.active=!0,Ye.add(1,this,this.onFrameEnterHandler)}onUpdate(e){}onFrameRun(e){}onFrameEnterHandler(e){this.active&&this.onFrameRun(e)}uninstall(){this.active=!1,Ye.remove(this,this.onFrameEnterHandler)}destroy(){super.destroy(),this.uninstall()}}class ca extends ha{constructor(){super(...arguments),this.isGravity=!1,this.isStart=!1,this.isIng=!1,this.isDown=!1,this.isEnd=!1,this.trampolinePower=3,this.jumpType=0,this.maxpower=4,this.kinematics=[],this.isok=!0}onEnable(){this.monitor(ge.game.USE_JUMP_ACTION,this.onUseAction),this.monitor(ge.game.ADD_JUMP_ACTION,this.onAddAction),this.monitor(ge.game.USE_GRAVITY_ACTION,this.onGravityAction),this.monitor(ge.game.STOP_GRAVITY_ACTION,this.onStopGravityAction),this.monitor(ge.game.ONCLIMB,this.checkClimb),7!=Ve.map.map.gamePkType&&(ie.jump2="jump2",ie.jump3="jump3",ie.jump4="jump4")}onUseAction(e){if(!Ve.game.MonsterStop&&!Ve.game.gravitySop)if(1!=this.jumpType){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(mi.device.currentMountGear||Tn.inst.sound.play(Ie.id.跳跃音效),this.isGravity=!0,this.isStart=!0,this.isDown=!1,this.isIng=!1,this.isEnd=!1,t.info.actionstate==$.climb&&t.info.movestate==Q.wait){t.info.actionstate=$.land;var i=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;i.localRotationEulerY+=180,t.info.cur_angleY=i.localRotationEulerY}t.playAni(ie.jump1),cafe.event.dispatch(ge.game.ROLE_USE_ACTION,e.pos),t.ani.speed=2,this.preY=0,this.time=0,4==Ve.game.MaoMaoGameType?(this.power=1.5,this.maxpower=2.5):(this.power=2,this.maxpower=3.6),1==Ve.map.map.gamePkType&&(this.power=1.5,this.maxpower=3),Ve.game.isbig&&(this.power=2,this.maxpower=4),Ve.game.issmall&&(this.power=1,this.maxpower=2.5),this.jumpType=1,Ve.game.isTrampoline=!1}else this.onAddAction(e.value)}onUseAction2(e){if(!Ve.game.MonsterStop&&-1==ea.scene.player.ani.state.indexOf("fly")&&1!=this.jumpType){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(mi.device.currentMountGear||Tn.inst.sound.play(Ie.id.跳跃音效),this.isGravity=!0,this.isStart=!0,this.isDown=!1,this.isIng=!1,this.isEnd=!1,t.info.actionstate==$.climb&&t.info.movestate==Q.wait){t.info.actionstate=$.land;var i=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;i.localRotationEulerY+=180,t.info.cur_angleY=i.localRotationEulerY}t.playAni(ie.jump1),t.ani.speed=2,this.preY=0,this.time=0,4==Ve.game.MaoMaoGameType?(this.power=1.5,this.maxpower=2.5):(this.power=2,this.maxpower=3.8),this.jumpType=1,Ve.game.isTrampoline=!0}}onAddAction(e){this.isDown||2!=this.jumpType&&(this.power>=this.maxpower||(this.power+=e,this.power>=this.maxpower&&(this.power=this.maxpower)))}onGravityAction(){var e=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;this.isGravity=!0,this.isStart=!0,this.isDown=!1,this.isIng=!1,this.isEnd=!1,e.playAni(ie.jump1),e.ani.speed=10,this.preY=0,this.time=0,this.power=-1.5,this.jumpType=2,Ve.game.isTrampoline=!1}onStopGravityAction(){var e=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;this.isEnd=!1,e.ani.speed=1,this.jumpType=0,this.isDown=!1,this.isGravity=!1,Ve.game.isCannon||e.playAni(ie.idle)}checkClimb(){var e=this,t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script,i=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:t.info.speed,s=t.info.movestate==Q.back?-i:i,a=t.info.cur_angleY;let n=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;var o,r=Qe.calcTrajectoryParamstwo(n.position,0,a),l=Qe.calcTrajectoryParamstwo(n.position,s+.8,a),h=r.pos,c=l.pos,d=s+.8;ta.MainRoleRay(new Laya.Vector3(h.x,n.position.y+.8,h.y),new Laya.Vector3(c.x,n.position.y+.8,c.y),e=>{var t=getDistance({x:h.x,y:h.y},{x:e.point.x,y:e.point.z});if(d>Math.floor(1e3*t)/1e3){if(!(o=e.collider.owner.main))return;var i=o.tb;i&&i.funcType==Jt.CLIMB&&(d=Math.min(d,t))}},()=>{d<.8&&(slog("1land碰到了可以爬的墙!!!!!"),e.onStopGravityAction(),t.ani.state=ie.paidle,t.info.actionstate=$.startclimb)})}onUpdate(e){if(ea.scene.GamePause)return;var t=this,i=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):t.script;if(!i.ani)return;if(!i.ani.ani)return;if(!t.isGravity&&i.ani&&i.ani.ani.getCurrentAnimatorPlayState().animatorState.name!=ie.jump4&&i.ani.ani.getCurrentAnimatorPlayState().animatorState.name!=ie.zhuiluoqishen)return;if(1==t.jumpType&&i.ani.state==ie.idle&&(t.isEnd=!1,t.jumpType=0,t.isGravity=!1,cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)),i.ani.ani.getCurrentAnimatorPlayState().normalizedTime>=1&&i.ani.ani.getCurrentAnimatorPlayState()._finish&&(i.ani.ani.getCurrentAnimatorPlayState().animatorState.name==ie.jump1?(i.playAni(ie.jump2),i.ani.speed=1.8,t.isStart=!1,t.isIng=!0):i.ani.ani.getCurrentAnimatorPlayState().animatorState.name==ie.jump4?(t.isEnd=!1,i.playAni(ie.idle),i.ani.speed=1,t.jumpType=0,t.isGravity=!1,cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)):i.ani.ani.getCurrentAnimatorPlayState().animatorState.name==ie.zhuiluoqishen&&(t.isEnd=!1,i.playAni(ie.idle),i.ani.speed=1,t.jumpType=0,t.isGravity=!1,cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH))),t.isStart||!t.isIng||t.isEnd)return;var s=mi.device.currentMountGear?mi.device.currentMountGear.transform:t.owner.transform;this.time=this.time+(t.isDown?.0018:.005);let a;var n=Ve.game.isTrampoline?t.trampolinePower:t.power;Ve.game.wawaJump&&4==Ve.game.MaoMaoGameType&&(n*=1.2),a=2*Math.sin(Math.PI/180*45)*n*this.time-this.time*this.time*40+t.preY;let o=s.localPositionY;var r=a-t.preY;if(!i.uMoveTrigger.isTrigger||r<=0){var l=r;if(r<=0&&Ve.game.isTrampoline&&(l*=.5),s.translate(new Laya.Vector3(0,l,0),!1),r<=0&&(t.isDown=!0,t.checkClimb(),t.isDown)){Ve.game.TrampolineAniSwitch=!0;var h=s.position.y-i.landY;i.ani.ani.getControllerLayer(0).getAnimatorState(ie.zhuiluo)&&h>20&&i.ani.state!=ie.zhuiluo&&i.ani.state!=ie.shengsuo&&i.playAni(ie.zhuiluo),i.ani.state!=ie.jump3&&(i.ani.speed=1,i.playAni(ie.jump3))}}if(i.uMoveTrigger.isTrigger&&(t.power=-2),t.preY=a,o<=i.landY&&t.saveY>o){var c=ea.scene.hitResultNode?ea.scene.hitResultNode.tb:null;if(!c||c.funcType!=Jt.TRAMPOLINE&&c.funcType!=Jt.TRAMPOPOI)if(!c||c.funcType!=Jt.springPOI&&c.funcType!=Jt.springSCA)s.localPositionY=i.landY,i.ani.state==ie.zhuiluo?i.playAni(ie.zhuiluoqishen):i.ani.state!=ie.shengsuo&&(i.playAni(ie.jump4),i.ani.speed=2,ea.scene.player.JumpEffect.active=!1,ea.scene.player.JumpEffect.active=!0),t.isIng=!1,t.isEnd=!0,t.jumpType=0,Ve.game.isTrampoline=!1,1==Ve.game.isshibietiao&&(Ve.game.isshibietiao=!1,be.openpanel(we.EndUpPanel));else{if(!(d=ea.scene.hitResultNode))return;if("player"==d.name)return;t.kinematics.push(d);m=(p=d.transform.localPositionY)-.6;if(t.isok)if(t.isok=!1,t.trampoType=c.funcType,c.funcType==Jt.springPOI)Laya.Tween.to(d.transform,{localPositionY:m},150,null,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p},600,null,initHandler(t,()=>{t.isok=!0}))}));else{g=d.transform.localScale;Laya.Tween.to(d.transform,{localPositionY:p-.2,localScaleX:1.1*g.x,localScaleZ:1.1*g.z,localScaleY:.8*g.y},200,Laya.Ease.quadOut,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p,localScaleX:.9*g.x,localScaleZ:.9*g.z,localScaleY:1.1*g.y},200,null,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p,localScaleX:1*g.x,localScaleZ:1*g.z,localScaleY:1*g.y},50,null,initHandler(t,()=>{t.isok=!0}))}))}))}i.ani.state!=ie.shengsuo&&(i.playAni(ie.idle),i.ani.speed=1,ea.scene.player.JumpEffect.active=!1,ea.scene.player.JumpEffect.active=!0),ea.scene.player.JumpEffect.active=!1,ea.scene.player.JumpEffect.active=!0,s.localPositionY=i.landY,t.isIng=!1,t.isEnd=!0,t.jumpType=0,Ve.game.isTrampoline=!1}else{var d;if(!(d=ea.scene.hitResultNode))return;if("player"==d.name)return;var u=t.kinematics.indexOf(d);if(-1==u){t.kinematics.push(d);var p,m=(p=d.transform.localPositionY)-1;if(t.trampoType=c.funcType,c.funcType==Jt.TRAMPOLINE){Laya.timer.once(250,t,()=>{t.onUseAction2()});var g=d.transform.localScale;Laya.Tween.to(d.transform,{localPositionY:m,localScaleX:1.3*g.x,localScaleZ:1.3*g.z,localScaleY:.8*g.y},250,Laya.Ease.quadOut,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p+.2,localScaleX:.8*g.x,localScaleZ:.8*g.z,localScaleY:1.2*g.y},150,null,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p,localScaleX:1*g.x,localScaleZ:1*g.z,localScaleY:1*g.y},50,null,initHandler(t,()=>{t.kinematics.splice(u,1)}))}))}))}else c.funcType==Jt.TRAMPOPOI&&(Laya.timer.once(280,t,()=>{t.onUseAction2()}),Laya.Tween.to(d.transform,{localPositionY:m},200,Laya.Ease.quadOut,initHandler(t,()=>{Laya.Tween.to(d.transform,{localPositionY:p},150,Laya.Ease.quadOut,initHandler(t,()=>{t.onUseAction2(),t.kinematics.splice(u,1)}))})))}if(!Ve.game.TrampolineAniSwitch)return;Ve.game.TrampolineAniSwitch=!1,i.ani.state!=ie.shengsuo&&(ea.scene.player.JumpEffect.active=!1,ea.scene.player.JumpEffect.active=!0,i.playAni(ie.jump3),i.ani.speed=1),this.time=0,t.isIng=!1,t.isEnd=!0,t.jumpType=0,s.localPositionY=i.landY,t.trampolinePower=c.power,10533006==c.configId&&1==Ve.map.map.gamePkType&&(t.trampolinePower=4),t.isDown=!1}}t.saveY=o}destroy(){super.destroy(),this.uninstall()}}class da extends it{constructor(){super(...arguments),this.speed=.3,this.addspeed=.05,this.maxspeed=.5,this.total=50,this.ishit=!1,this.hitNum=0}onEnable(){super.onEnable(),this.list=[]}run(e){var t=this;t.info=e,t.life=100,t.attackTrigger&&t.attackTrigger.destroy(),t.attackTarget=t.owner.getChildByName("tmode"),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>t.onAttackTrigger(e))),t.active=!0}delTrigger(e){this.attackTrigger.delTrigger(e)}onAttackTrigger(e){var t=e.owner;return!!t&&(-1!=t.name.indexOf("Cube")&&t.main&&t.main.tb&&11230177==t.main.tb.configId?(this.life=1,!1):!(-1==t.name.indexOf("Cube")||!t.main||!t.main.tb||11230179!=t.main.tb.configId))}onUpdate(){if(!this.owner)return;if(!this.active)return;if(!Ve.map.mptData)return;let e=this.speed;this.owner.transform.translate(new Laya.Vector3(0,0,e),!0),this.life--,this.life<=0&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null),this.speed<this.maxspeed&&(this.speed+=this.addspeed,this.speed>=this.maxspeed&&(this.speed=this.maxspeed)),this.hurt()}hurt(){var e=this.info.script.info.tb,t=ea.skill.getSkillValue(e.attack,this.info.skill.tb);if(this.info.script.info.is_buff_power&&(t*=2),Ve.game.isPisa&&(t*=2),this.attackTrigger.isTrigger)for(var i=0;i<this.attackTrigger.kinematics.length;i++){var s=this.attackTrigger.kinematics[i].main,a=s.getComponent(ht);if(a){var n=this.list.filter(e=>e.mode==s)[0],o=this.list.indexOf(n);if(!(n&&n.count>0)){if(a.info)a.info.attribute.headview||a.info.attribute.initView(),a.info.attribute.hitHurt(t),a.info.attribute.thing_hp<=0?(a&&null!=a.drop&&a.drop(),this.info.script.delTrigger(s),this.list.splice(o,1),a.dieMonsterClear?a.dieMonsterClear():(cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),s.removeSelf(),s.destroy()),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:27,count:1}),i--):("0"!=this.info.skill.tb.hitAni&&0==this.ishit?(a.hit(this.info.skill.tb.hitAni),this.ishit=!0):(ss.vibrate(s),this.hitNum++,3==this.hitNum&&(this.ishit=!1,this.hitNum=0)),n?n.count>0?n.count--:n.count=this.total:this.list.push({mode:s,count:this.total}));else{if((a=s.getComponent(gs)).info.attribute.hitHurt(100*t),a.info.attribute.thing_hp<=0){var r=s.transform.position.clone(),l=s.transform.rotationEuler.clone(),h=s.transform.localScale.clone();Tn.inst.load3d.thingRes(ce.getBuildUrl("11230178.lh"),ea.scene.mainscene.getChildByName("map"),initHandler(this,e=>{e.transform.position=r,e.transform.rotationEuler=l,e.transform.localScale=h})),this.info.script.delTrigger(s),this.list.splice(o,1),a.dieMonsterClear?a.dieMonsterClear():(s.removeSelf(),s.destroy()),i--,this.owner&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null);break}ss.vibrate(s),n?n.count>0?n.count--:n.count=this.total:this.list.push({mode:s,count:this.total})}this.owner&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null)}}}}onDestroy(){super.onDestroy()}}class ua extends ra{constructor(){super(...arguments),this.ishit=!1,this.hitNum=0,this.isqiang=!1,this.isExcavate=!1,this.islock=!1,this.locktime=0,this.bloodMultiple=4}onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;"1"==i.read("firstAtt")&&1==Ve.game.MaoMaoGameType&&(ea.scene.ui.firstAtt.visible=!1),"1"==i.read("strikething")&&7==Ve.map.map.gamePkType&&(ea.scene.ui.strikething.visible=!1),ea.scene.ui.firstAtt.visible&&(ea.scene.ui.firstAtt.visible=!1);var s=(new Date).getTime()-t.locktime;if(!(t.islock&&s<1e3)&&(t.islock=!0,t.locktime=(new Date).getTime(),t.script.ani.state!=ie.lutou&&t.script.ani.state!=ie.che&&t.script.ani.state!=ie.skill)){if(ea.scene.ui.weaponTime>0){ea.scene.ui.weaponTime--;var a=100*(Math.round(ea.scene.ui.weaponTime/ea.scene.ui.weaponLength*100)/100);ea.scene.ui.naijiuimg&&(ea.scene.ui.naijiuimg.width=a),ea.scene.ui.weaponTime<=0&&(Ve.shop.useEquip(ea.scene.ui.weaponId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon),ea.scene.ui.naijiubox.visible=!1)}t.eventdata=e,slog("使用技能:",e.skill.skillId),cafe.event.dispatch(ge.game.ROLE_USE_ACTION,t.pos);var n=t.index;t.script.ani.speed=Number(t.speeds[t.index]);var o=t.anis[t.index].split(":");"qiang"==o[0]&&(t.isqiang=!0),"48002"==t.skill.tb.skillIcon&&(t.isExcavate=!0);var r=Es.AddCheckAll3D(t.owner,4,7);r&&r.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger&&Es.LookFromAt(t.owner,r.mode),t.isqiang?t.script.playAni("qiang",initHandler(t,e=>{"finish"==e&&(t.islock=!1),"attack"==e&&(Tn.inst.sound.play(Number(t.sounds[n])),t.sounds,t.attack(),t.script.playAni(ie.idle))})):t.isExcavate?this.ExcavateAction():t.script.playAni(o[0],initHandler(t,e=>{"finish"==e&&(t.islock=!1),"attack"==e&&(Tn.inst.sound.play(Number(t.sounds[n])),t.sounds,t.attack())})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1}),t.index++,t.index>=t.total&&(t.index=0)}}onRoleUseActionFinish(){cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)}attack(){this.isqiang?this.QiangAttack():1!=Ve.map.map.gametype?0!=Ve.map.map.gametype?7!=Ve.map.map.gamePkType||this.StrikefAttack():this.DelThingAttack():this.ZhuiBuAttack()}DelThingAttack(){if(this.script.attackTrigger.isTrigger)for(var e=0;e<this.script.attackTrigger.kinematics.length;e++){var t=this.script.attackTrigger.kinematics[e];if(-1!=t.name.indexOf("body")||-1!=t.name.indexOf("Cube")){var i;if(t.main&&(i=t.main),i||(i=t.parent),!i||!i.transform||1!=i.tb.destroyType){this.DelTrigger(i);continue}this.ShowAttEffect(i),i.removeSelf(),i.destroy(),this.DelTrigger(i)}}}ExcavateAction(){if(!ea.scene.GamePause){var e=null;if(this.script.dMoveTrigger.isTrigger)for(var t=0;t<this.script.dMoveTrigger.kinematics.length;t++){var i=this.script.dMoveTrigger.kinematics[t];if(-1!=i.name.indexOf("dong")&&i.parent){e=i.parent;break}}if(e){ea.scene.GamePause=!0;var s=this.anis[this.index].split(":");this.LoopAni(s[0]),ea.scene.ui.ExcavateJinDu(1.6,initHandler(this,()=>{i.parent.removeSelf(),i.parent.destroy(),ea.scene.GamePause=!1,this.islock=!1}))}else Ue.show("此处不可挖掘")}}LoopAni(e){Laya.timer.frameLoop(1,this,()=>{if(!ea.scene.GamePause)return this.script.playAni(ie.idle),void Laya.timer.clearAll(this);this.script.ani.state==ie.idle&&(Tn.inst.sound.play(16001),this.script.playAni(e))})}StrikefAttack(){if(this.script.attackTrigger.isTrigger)for(var e=0;e<this.script.attackTrigger.kinematics.length;e++){var t=this.script.attackTrigger.kinematics[e];if((-1!=t.name.indexOf("body")||-1!=t.name.indexOf("Cube"))&&t.main&&t.main.tb.funcType&&t.main.tb.funcType==Jt.STEIKEF){var i;t.main&&(i=t.main),i||(i=t.parent);var s=i.transform.localPosition.clone();s||(s=t.transform.localPosition.clone());var a=Xe.getBody(i,"tmode");if(!a)continue;var n=a.transform.localPosition.clone();s=new Laya.Vector3(s.x+n.x,s.y+n.y,s.z+n.z),this.StrikeToFly(i,a)&&Tn.inst.sound.play(15050)}}this.onRoleUseActionFinish()}StrikeToFly(e,t){if(!e)return!1;var i=this.script.owner.transform.localPosition.clone(),s=e.transform.localPosition.clone(),a=t.transform.localPosition.clone();s=new Laya.Vector3(s.x+a.x,s.y+a.y,s.z+a.z);var n=calcPosAngle({x:i.x,y:i.z},{x:s.x,y:s.z}),o=calcAngleDist({x:s.x,y:s.z},10,n),r=new Laya.Vector3(o.x,e.transform.localPositionY+2,o.y),l=new Laya.Vector3(1,.5,1);let h=e.getComponent(Laya.Rigidbody3D);return h||(h=t.getComponent(Laya.Rigidbody3D)),!!h&&(h.applyTorqueImpulse(l),ts.Localposition(e.transform,300,r,Laya.Ease.bounceOut),!0)}AttackEffect(e){var t=ea.scene.mainscene.getChildByName("map").getChildByName("30027");t?(t.transform.localPosition=e,t.active=!1,t.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(self,t=>{t.transform.localPosition=e}))}QiangAttack(){var e=this,t=Xe.getBody(e.owner,"attack_start"),i=Xe.getBody(e.owner,"attack_end"),s=t.transform,a=i.transform;t&&i&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_12019_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(e,t=>{s.position&&(t.transform.position=a.position.clone()),ea.scene.ui.firestqiang.visible&&(ea.scene.ui.firestqiang.visible=!1);var i=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);t.transform.localRotationEulerY=i,t.addComponent(da).run({script:e.script,tb:e.script.info.tb,skill:e.eventdata.skill})}))}ZhuiBuAttack(){var e=this,t=(Xe.getBody(e.owner,"group_effect"),e.script.info.tb,e.script.owner.getComponent(at).max_Attack);ea.skill.getSkillValue(t,e.eventdata.skill.tb);if(e.script.info.is_buff_power&&2,e.script.attackTrigger.isTrigger)for(var s=0;s<e.script.attackTrigger.kinematics.length;s++){var a=e.script.attackTrigger.kinematics[s];if(a.parent){if((-1!=a.name.indexOf("body")||-1!=a.name.indexOf("Cube"))&&a.main&&a.main.tb.destroyType&&1==a.main.tb.destroyType){var n,o;if(Ue.show("没人藏在这里"),n=Xe.getBody(a,"body"),n=-1!=a.name.indexOf("body")?Xe.getBody(a,"body"):a.parent){var r=n.getComponent(Laya.Animator);r&&(r.enabled=!1,r.destroy())}a.main&&(o=a.main),o||(o=a.parent);var l=o.transform.localPosition.clone();l||(l=a.parent.transform.localPosition.clone());var h=ea.scene.mainscene.getChildByName("map").getChildByName("30027");return h?(h.transform.localPosition=l,h.active=!1,h.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(e,e=>{e&&l&&(e.transform.localPosition=l)})),o.removeSelf(),o.destroy(),e.script.attackTrigger.delTrigger(a),e.script.moveTrigger.delTrigger(o),void e.BloodAction()}var c=a.parent,d=c.name;"tmode"==d&&(d=c.parent.name);var u=Ve.game.DuoMaoMaoNpc[d];if(null!=u)if(u.owner){var p=u.owner.transform.localPosition.clone(),m=ea.scene.mainscene.getChildByName("map").getChildByName("30026");if(m?(m.active=!1,m.active=!0,m.transform.localPosition=p):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30026_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(e,e=>{e&&p&&(e.transform.localPosition=p,Tn.inst.sound.play(15050))})),Ve.game.GuideModel&&d==Ve.game.GuideModel.dataStr&&(i.save("firest","0"),Ve.game.GuideModel=null,cafe.event.dispatch(ge.game.MAP_START_REPLACE_FINISH)),Ve.game.TipsNpc&&d==Ve.game.TipsNpc.dataStr&&(Ve.game.TipsNpc=null,cafe.event.dispatch(ge.game.MAP_START_REPLACE_FINISH)),u&&u.FuHuoNum++,2==u.FuHuoNum){cafe.event.dispatch(se.CLOSEQP,u.tbthing.npcId),c.removeSelf(),c.destroy(),u.owner.active=!0,u.playAni(ie.kuqi),e.script.ani.speed=.5;var g=u.owner.getChildByName("body");g&&0==g.active&&(g.active=!0),e.script.attackTrigger.delTrigger(a),e.script.moveTrigger.delTrigger(a),ea.scene.GamePause=!0,Ue.show("哈哈,抓到你了"),e.SpawnHealthAction(),setTimeout(()=>{var t=Xe.getBody(u.owner,"body");if(t){var i=t.getComponent(Laya.Animator);i&&(i.enabled=!1)}var s=u.tbthing.npcId,a=u.tbthing.npcName;cafe.event.dispatch(se.NPCTAOTAI,s),u.owner.removeSelf(),u.owner.destroy(),ea.scene.ui.upDateList(),e.script.moveTrigger.ClearTrigger(),Ve.game.attNum++,ea.scene.GamePause=!1,Ve.game.attNum==Ve.game.npcNum?(ea.scene.ui.cancelNpcqp(),be.openpanel(we.EndWinPanel,{type:1})):be.openpanel(we.EndUpPanel,a)},2e3)}else u.FuHuoTime=(new Date).getTime(),u.isDie=!0,u.owner.active=!0,u.bianshenmodel.active=!1;if(u)break}else c.removeSelf(),c.destroy(),e.script.attackTrigger.delTrigger(c),e.script.moveTrigger.delTrigger(c)}else e.script.attackTrigger.delTrigger(a),e.script.moveTrigger.delTrigger(a)}e.onRoleUseActionFinish()}ShowAttEffect(e){var t=e.transform.localPosition.clone();t||(t=e.parent.transform.localPosition.clone());var i=ea.scene.mainscene.getChildByName("map").getChildByName("30027");i?(i.transform.localPosition=t,i.active=!1,i.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(this,e=>{e&&t&&(e.transform.localPosition=t)}))}DelTrigger(e){this.script.attackTrigger.delTrigger(e),this.script.moveTrigger.delTrigger(e)}BloodAction(){var e=this.owner.getComponent(at);e.hitHurt(10*this.bloodMultiple);var t=Math.round(e.thing_hp/e.max_hp*100)/100;t<=.4&&t>0&&(Ue.show("还剩"+Math.ceil(10*t/this.bloodMultiple)+"次攻击机会"),ea.scene.ui.LoopShowHurtUIByTween())}SpawnHealthAction(){var e=this.owner.getComponent(at);e.addHp(10*this.bloodMultiple),Math.round(e.thing_hp/e.max_hp*100)/100>.4&&ea.scene.ui.ClearShowHurtUIByTween()}destroy(){super.destroy(),console.log("跳跃回收成功")}}class pa extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.total=this.anis.length}onUseSkillHandler(e){e.isDown&&1==this.script.info.is_add_speed||Ve.game.MonsterStop||(this.eventdata=e,slog("使用技能:",e.skill.skillId),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1}),e.isDown?(this.script.info.is_add_speed=!0,cafe.event.dispatch(se.GAME_ADD_SPEED,!0),mi.device.currentMountGear&&200001==mi.device.currentMountGear.tb.defaultEquipSkillMod&&mi.device.currentMountGear.tb.configId):(this.script.info.is_add_speed=!1,cafe.event.dispatch(se.GAME_ADD_SPEED,!1)))}destroy(){super.destroy(),console.log("跳跃回收成功")}}class ma extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){if(e.isDown&&ea.scene.player){this.eventdata=e;this.index;slog("使用技能:",e.skill.skillId);var t=initHandler(this,()=>{10200==Ve.role.getCurrRole().roleId?Ve.role.selectRole(10100):Ve.role.selectRole(10200)});ea.scene.player.ani.speed=.3,ea.scene.player.ani.play("bianshen",initHandler(this,()=>{t&&t.run(),ea.scene.player.ani.speed=1})),Tn.inst.sound.play(15043);var i=Xe.getBody(ea.scene.player.owner,"80004");i?(i.active=!1,i.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80004_lh],ea.scene.player.owner,1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class ga extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){if(this.script.ani.state==ie.skill)return;if(Ve.game.MonsterStop)return;cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION);this.owner.transform;if(this.eventdata=e,slog("使用技能:",e.skill.skillId),ea.scene.player&&(53007==e.skill.skillId?ea.scene.player.FlyBagDisplay():ea.scene.player.FlyBagHidden()),Ve.game.isRideZuoqi){var t=mi.device.currentMountGear.tbId;Ve.game.ZuoqiState=1,cafe.event.dispatch(ge.game.DEVICE_MOD_REPLACE_FINISH,t)}else{if(-1!=Ve.shop.equip_weapon.indexOf(80031)){var i=Xe.getBody(ea.scene.player.owner,"20080020");i&&(i.getChildAt(0).active=!0,i.getChildAt(1).active=!0)}cafe.event.dispatch(ge.game.ROLE_MOD_REPLACE_FINISH,e.value)}}onRoleUseActionFinish(){}destroy(){super.destroy(),console.log("跳跃回收成功")}}class ya extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){if(this.eventdata=e,slog("使用技能:",e.skill.skillId),ea.scene.player&&ea.scene.player.FlyBagHidden(),Ve.game.isRideZuoqi){var t=mi.device.currentMountGear.tbId;cafe.event.dispatch(ge.game.DEVICE_MOD_REPLACE_FINISH,t)}else{if(-1!=Ve.shop.equip_weapon.indexOf(80031)){var i=Xe.getBody(ea.scene.player.owner,"20080020");i&&(i.getChildAt(0).active=!1,i.getChildAt(1).active=!1)}cafe.event.dispatch(ge.game.ROLE_MOD_REPLACE_FINISH,e.value)}cafe.event.dispatch(ge.game.USE_JUMP_ACTION,this.eventdata)}onRoleUseActionFinish(){}destroy(){super.destroy(),console.log("跳跃回收成功")}}class fa extends Ni{constructor(){super()}onEnable(){let e=this;e.thingbody||(e.thingbody=e.owner),super.onEnable(),"70039"==e.thingbody.dataStr?e.type=9:e.type=8}initThingTb(e){var t=this,i=t.owner.getChildByName("body");if(!t.ani){t.ani=t.addCom(t.owner,oe);var s=i;s?t.ani.init(s,new Laya.Handler(t,t.onPlayerEnd)):t.ani.init(i,new Laya.Handler(t,t.onPlayerEnd))}var a=t.owner.transform;t.saveData={pos:a.position.clone(),ro:a.rotation.clone()},t.info||(t.info=new $e,t.info.attribute=t.addCom(t.owner,Di)),t.tbthing=e,t.npcinstallBone=Xe.getBodys(t.owner,e.npcinstallBoneName),t.installBone=Xe.getBody(t.owner,e.installBoneName),t.uninstallBone=Xe.getBody(t.owner,e.uninstallBoneName),ea.scene.things[t.owner.name]=t.owner,t.hitTarget=i,t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.moveTarget=Xe.getBody(i,"move_hit"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ri),t.moveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&(!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.bmoveTarget=Xe.getBody(i,"b_move_hit"),t.bmoveTarget&&(t.bmoveTrigger=t.addCom(t.bmoveTarget,Ri),t.bmoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&(-1!=e.owner.name.indexOf("Cube")?(cafe.event.dispatch(ge.game.PENPENCHEPLAYERMOVE,e.owner.transform),!0):!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.lmoveTarget=Xe.getBody(i,"l_move_hit"),t.lmoveTarget&&(t.lmoveTrigger=t.addCom(t.lmoveTarget,Ri),t.lmoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&(-1!=e.owner.name.indexOf("Cube")?(cafe.event.dispatch(ge.game.PENPENCHEPLAYERMOVE,e.owner.transform),!0):!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.attackTarget=Xe.getBody(i,"move_hit"),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&(!(Number(e.owner.name)<1051e4)&&t.attTrigger(e))))),t.moveTarget=Xe.getBody(i,"move_att"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ci),t.moveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&(!(Number(e.owner.name)<1051e4)&&t.MoveAtt(e))))),t.uMoveTarget=Xe.getBody(i,"umove_hit"),t.uMoveTarget&&(t.uMoveTrigger=t.addCom(t.uMoveTarget,Ri),t.uMoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&t.onMoveTrigger(e)))),t.dMoveTarget=Xe.getBody(i,"dmove_hit"),t.dMoveTarget&&(t.dMoveTrigger=t.addCom(t.dMoveTarget,Ri),t.dMoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&t.onMoveTrigger(e))));var n=Xe.getBody(i,"wheel"),o=Xe.getBody(i,"wheel (1)");n&&(t.ani=n.getComponent(Laya.Animator),t.ani.play(ie.idle),t.ani2=o.getComponent(Laya.Animator),t.ani2.play(ie.idle)),t.owner.tb=t.tbthing,t.owner.deviceId=t.tbthing.deviceId}attTrigger(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(ht);return!("body"!=e.owner.name||!i)}MoveAtt(e){var t=this,i=e.owner,s=i.parent.parent;if(i.main&&i.main.tb&&4==i.main.tb.type){var a=e.owner.parent;if(a&&a.meshRenderer){var n=a.meshRenderer.material;n.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT;var o=e.owner.parent;o.transform.localRotation.x=90;var r=Math.round(360*Math.random());Laya.Tween.to(o.transform,{localRotationEulerX:90,localRotationEulerY:r},2e3,null,initHandler(t,()=>{Laya.Tween.to(n,{albedoColorA:0},3e3,null,initHandler(t,()=>{t.DesTroy(s)}))}))}}return!1}DesTroy(e){var t=this;oi.singleton.removeThing(e),(e=>{Laya.Tween.to(e,{},1,null,initHandler(t,()=>{t.moveTrigger.delTrigger(e),e.getChildAt(0)&&t.moveTrigger.delTrigger(e.getChildAt(0).getChildByName("body")),e.removeSelf(),e.destroy()}))})(e)}uninstall(){setTimeout(()=>{cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION)},100)}hitHurt(e){if(mi.device&&(!mi.device.currentMountGear||mi.device.currentMountGear!=this.owner))return!1;if(70039!=mi.device.currentMountGear.tbId)return!1;if(-1!=e.name.indexOf("Cube")&&cafe.event.dispatch(ge.game.PENPENCHEPLAYERMOVE,e.transform),"move_hit"==e.name||ea.scene.player.info.movestate==Q.wait)return!1;Tt.play(e.transform,Number(10006),{size:1,time:1e3});var t=e.main.tb;if(!t||!t.deviceId)return!1;if(20061003!=t.configId&&20061004!=t.configId&&20061005!=t.configId)return!1;var i=this.owner.getComponent(Ni);return i.penpenScore++,cafe.event.dispatch(se.PENPENCHEPAIHANBAN,{configId:mi.device.currentMountGear.tb.configId,score:i.penpenScore}),"move_hit"!=e.name&&cafe.event.dispatch(se.PENPENCHEAIBEIZHUAN,this.owner),!1}onUpdate(){if(mi.device.currentMountGear&&mi.device.currentMountGear==this.owner&&this.installBone&&ea.scene.player&&ea.scene.player.owner){var e=this.installBone.transform,t=ea.scene.player.owner.transform;t.position=e.position.clone(),t.rotation=e.rotation.clone()}}triggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(ht);if("body"==e.owner.name&&i)return!0;if(t.main&&37241==t.main.thingId){console.log("记录复活点");var s=t.main.transform.position.clone(),a=t.main.transform.rotationEuler.clone();return a&&s&&Ve.game.RisePoi!=s&&(Ve.game.RisePoi=new Laya.Vector3(s.x,s.y,s.z),Ve.game.RiseRot=a,be.openpanel(we.EndUpPanel)),!1}return!1}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ani.speed=this.tbthing.ani_speed}onDestroy(){this.isdispose||(this.isdispose=!0,super.onDestroy())}}class _a extends nt{constructor(){super(),this.workaiCount=0,this.isDeviate=!1,this.speed=.01,this.isFollow=!1}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state;var t=e.getCom(e.owner,ba);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.checkAction=e.addCom(e.owner,Yi)}e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi)),1==e.script.tbthing.isfly?e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getSkyPathLine(e.owner,e.script.owner.tb.move_speed/1e5)):e.owner.tracks&&e.owner.tracks.length&&(e.lineFunc=ss.getPathLine(e.owner,e.script.owner.tb.move_speed/1e5))}refNpc(e){this.isFollow=this.owner.npcId==e,this.isFollow||(this.owner.transform.position=this.initPos.clone(),this.script.playAni(ie.idle))}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}npcTrackAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&mi.device.currentMountGear!=e.owner&&e.script&&e.script.tbthing&&ea.scene.player&&ea.scene.player.owner){var t=ea.scene.player.owner;if(t&&e.script.moveTrigger&&e.script.moveTrigger.isTrigger)e.script.playAni(ie.idle);else if(e.script.owner.tracks&&e.script.owner.tracks.length&&e.script.owner.tracks.length>0){if(e.script&&e.script.moveTrigger&&e.script.moveTrigger.isTrigger)return void e.script.playAni(ie.idle);e.lineFunc&&e.lineFunc(),e.script.playAni(ie.run)}else if(e.isFollow){var i=t.transform.position,s=e.owner.transform.position;if(getDistance({x:i.x,y:i.z},{x:s.x,y:s.z})>20){var a=calcPosAngle({x:i.x,y:i.z},{x:s.x,y:s.z}),n=calcAngleDist({x:i.x,y:i.z},5,a);e.owner.transform.position=new Laya.Vector3(n.x,0,n.y)}e.workaiCount<=0?(e.npcTrackAi(t),e.workaiCount=100,e.isDeviate=!0):(e.npcTrackAi(t),e.workaiCount--)}}}onDestroy(){super.onDestroy(),this.lineFunc&&(this.lineFunc=null)}}class va extends nt{constructor(){super(),this.isTurn=!1,this.targetMode=null,this.mid=null,this.cdTime=0,this.isback=!1,this.workaiCount=0,this.isDeviate=!1,this.speed=.2}onEnable(){let e=this;if(e.preAttTime=0,!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name=e.owner.dthing.thingId,e.owner.state;var t=e.getCom(e.owner,ba);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.checkAction=e.addCom(e.owner,Yi)}e.active=!0,super.onEnable(),e.getCom(e.owner,ws)||(e.control=e.addCom(e.owner,ws)),e.monitor(se.PONPONCHE,e.Active),e.monitor(se.PENPENCHEAIBEIZHUAN,e.From),e.monitor(se.PENPENCHEINITPOS,e.Pos)}Pos(){switch(this.targetMode=null,this.owner.name){case"20061003":var e=Xe.getBody(Ve.game.ponponchan,"pos1");this.owner.transform.position=new Laya.Vector3(e.transform.position.x,0,e.transform.position.z);break;case"20061004":e=Xe.getBody(Ve.game.ponponchan,"pos2");this.owner.transform.position=new Laya.Vector3(e.transform.position.x,0,e.transform.position.z);break;case"20061005":e=Xe.getBody(Ve.game.ponponchan,"pos3");this.owner.transform.position=new Laya.Vector3(e.transform.position.x,0,e.transform.position.z)}}From(e){this.from=e,this.isTurn=!0,this.time=0}Active(e){this.owner.active=!0,this.owner.transform.position.y=0,this.owner.getComponent(ba).info.attribute.hitHurt(-200),this.owner.getComponent(ba).info.attribute.initView()}npcLineAi(){var e,t=this.owner.transform.position.clone(),i=this.speed;e=this.moveIndex>=this.script.owner.tracks.length-1?this.script.owner.tracks[0]:this.script.owner.tracks[this.moveIndex+1];var s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[2]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a);s.d<=n&&(this.moveIndex++,this.moveIndex>=this.script.owner.tracks.length&&(this.moveIndex=0),e=this.moveIndex>=this.script.owner.tracks.length-1?this.script.owner.tracks[0]:this.script.owner.tracks[this.moveIndex+1],s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[2]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a));var o=calcPosAngle({x:t.x,y:-t.z},{x:e[0],y:-e[2]},!0),r=new Laya.Vector3(t.x,t.y+1,t.z),l=new Laya.Vector3(t.x,-1,t.z),h=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(r,l,h)?this.owner.transform.position=new Laya.Vector3(a.x,h.point.y,a.y):this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var c=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(c.x,o,c.z),this.saveMovePos=this.owner.transform.position.clone()}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0),o=new Laya.Vector3(e.x,e.y+1,e.z),r=new Laya.Vector3(e.x,-1,e.z),l=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(o,r,l)?this.owner.transform.position=new Laya.Vector3(a.x,l.point.y,a.y):this.owner.transform.position=new Laya.Vector3(a.x,0,a.y);var h=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(h.x,n,h.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z),this.isDeviate=!1)}hitHurt(e){var t=e.main.tb;if("move_hit"!=e.name&&Tt.play(e.transform,Number(10006),{size:.5,time:700}),t&&t.deviceId){var i=this.owner.getComponent(Ni);i.penpenScore++,cafe.event.dispatch(se.PENPENCHEPAIHANBAN,{configId:this.owner.tb.configId,score:i.penpenScore}),20061002==t.configId&&cafe.event.dispatch(ge.game.PENPENCHEPLAYERMOVE,this.owner.transform)}}npcTrackAi(e){if(e&&e.transform&&e.transform.position){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:o};new Laya.Vector3(t.x,t.y,t.z),new Laya.Vector3(t.x,-1,t.z),new Laya.HitResult;var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z),this.cdTime<8&&this.isback,this.script.moveTrigger.isTrigger?(this.hitHurt(this.script.moveTrigger.kinematics[0]),this.newTarget=this.targetMode,this.targetMode=null,this.isback=!0):(this.cdTime>8&&(this.isback=!1),this.owner.transform.position=new Laya.Vector3(n.x,0,n.y))}}npcTrackAi2(e){if(e&&e.transform&&e.transform.position){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=1.5*this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),o=calcAngleDist({x:t.x,y:t.z},s,n.a),r=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:r};new Laya.Vector3(t.x,t.y,t.z),new Laya.Vector3(t.x,-1,t.z),new Laya.HitResult;var l=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(l.x,r,l.z),this.cdTime>8&&(this.isback=!1),this.owner.transform.position=new Laya.Vector3(o.x,0,o.y),(this.script.bmoveTrigger.isTrigger||this.script.lmoveTrigger.isTrigger)&&(this.isback=!1)}}hit(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:t.x,y:t.z},{x:i.x,y:i.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:t.x,y:-t.z},{x:i.x,y:-i.z},!0);this.anglevalue={a:a.a,ae:o};var r=new Laya.Vector3(t.x,t.y+1,t.z),l=new Laya.Vector3(t.x,-1,t.z),h=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(r,l,h)?this.owner.transform.position=new Laya.Vector3(n.x,h.point.y,n.y):this.owner.transform.position=new Laya.Vector3(n.x,0,n.y);var c=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(c.x,o,c.z)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a),s=new Laya.Vector3(e.x,e.y+1,e.z),a=new Laya.Vector3(e.x,-1,e.z),n=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(s,a,n)?this.owner.transform.position=new Laya.Vector3(i.x,n.point.y,i.y):this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,this.anglevalue.ae,o.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o};new Laya.Vector3(t.x,t.y,t.z),new Laya.Vector3(t.x,-1,t.z),new Laya.HitResult;this.script.moveTrigger.isTrigger?(this.isback=!0,this.owner.transform.position=new Laya.Vector3(n.x,0,n.y)):this.isback=!1;var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}GetPos(){if(Ve.game.ponponchan){this.pos||(this.pos=Xe.getBodys(Ve.game.ponponchan,"pos"));var e=Math.floor(Math.random()*(this.pos.length-1));return this.pos[e]}}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a),s=new Laya.Vector3(e.x,e.y,e.z),a=new Laya.Vector3(e.x,-1,e.z),n=new Laya.HitResult;ea.scene.mainscene.physicsSimulation.raycastFromTo(s,a,n)?this.owner.transform.position=new Laya.Vector3(i.x,n.point.y,i.y):this.owner.transform.position=new Laya.Vector3(i.x,0,i.y);var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,this.anglevalue.ae,o.z)}onFrameRun(e){let t=this;if(Ve.game.isRidePonpon&&Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause&&ea.scene.player&&ea.scene.player.owner&&t.owner.active&&t.script&&t.script.tbthing){t.isTurn&&(this.time++,this.time>5&&(t.isTurn=!1,this.time=0),t.npcTrackAi2(t.from));var i=t.checkAction.checkAll3D(30,9);null==this.targetMode&&i.mode&&(this.targetMode=i.mode),this.targetMode&&0==t.isback?(t.npcTrackAi(this.targetMode),t.workaiCount=120,t.isDeviate=!0,t.cdTime=0):t.isback&&t.newTarget&&(t.cdTime++,t.npcTrackAi2(t.newTarget))}}onDestroy(){super.onDestroy()}}class ba extends Ni{constructor(){super()}onEnable(){let e=this;e.thingbody||(e.thingbody=e.owner),super.onEnable(),e.thingbody.dthing.thingId>=20061002&&e.thingbody.dthing.thingId<=20061005?e.type=9:e.type=6}initThingTb(e){var t=this,i=t.owner.getChildByName("body");if(11861052==e.configId&&(mi.device.curRide=t.owner),!t.ani){t.ani=t.addCom(t.owner,oe);var s="0"!=e.anibodyname?Xe.getBody(t.owner,e.anibodyname):i;s?t.ani.init(s,new Laya.Handler(t,t.onPlayerEnd)):t.ani.init(i,new Laya.Handler(t,t.onPlayerEnd))}var a=t.owner.transform;if(t.saveData={pos:a.position.clone(),ro:a.rotation.clone()},t.info||(t.info=new $e,t.info.movestate=0,t.info.attribute=t.addCom(t.owner,Di)),t.tbthing=e,t._installBone=Xe.getBody(t.owner,e.installBoneName),t._uninstallBone=Xe.getBody(t.owner,e.uninstallBoneName),t._uninstallBone){t._uninstallTrigger=t.addCom(t._uninstallBone,Ri),t._uninstallTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&t._uninstalltriggerEnter(e))),ea.scene.things[t.owner.dthing.thingId]=t.owner,t.hitTarget=i,t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.triggerEnter(e))),t.moveTarget=Xe.getBody(i,"move_hit"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ri),t.moveTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&(!(-1==e.owner.name.indexOf("Cube")||!e.main)||!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.attackTarget=Xe.getBody(i,"move_hit"),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&(!(Number(e.owner.name)<1051e4)&&t.attTrigger(e))))),t.bmoveTarget=Xe.getBody(i,"b_move_hit"),t.bmoveTarget&&(t.bmoveTrigger=t.addCom(t.bmoveTarget,Ri),t.bmoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&(-1!=e.owner.name.indexOf("Cube")||!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.lmoveTarget=Xe.getBody(i,"l_move_hit"),t.lmoveTarget&&(t.lmoveTrigger=t.addCom(t.lmoveTarget,Ri),t.lmoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&((!Ve.game.isRideZuoqi||e.owner.main!=ea.scene.player.owner)&&(-1!=e.owner.name.indexOf("Cube")?(cafe.event.dispatch(se.PENPENCHEAIBEIZHUAN,e.owner),!0):!(Number(e.owner.name)<1051e4)&&t.onMoveTrigger(e))))),t.uMoveTarget=Xe.getBody(i,"umove_hit"),t.uMoveTarget&&(t.uMoveTrigger=t.addCom(t.uMoveTarget,Ri),t.uMoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&(-1!=e.owner.name.indexOf("Cube")||t.triggerEnter(e))))),t.dMoveTarget=Xe.getBody(i,"dmove_hit"),t.dMoveTarget&&(t.dMoveTrigger=t.addCom(t.dMoveTarget,Ri),t.dMoveTrigger.isEnter=(e=>e.owner.main!=t.owner&&(e.owner.main!=ea.scene.player.owner&&t.onMoveTrigger(e))));var n=Xe.getBody(i,"wheel"),o=Xe.getBody(i,"wheel (1)");n&&(t.ani=n.getComponent(Laya.Animator),t.ani&&t.ani.play(ie.idle),o&&(t.ani2=o.getComponent(Laya.Animator),t.ani2.play(ie.idle))),t.info.attribute.init(2,t.tbthing.hp),t.owner.tb=t.tbthing,t.owner.deviceId=t.tbthing.deviceId,t.owner.tracks&&t.owner.tracks.length&&t.addCom(t.owner,_a),9==t.type&&t.tbthing.configId>20061002&&t.tbthing.configId<=20061005&&t.addCom(t.owner,va)}}attTrigger(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;if("Cube"==t.name&&t.main&&t.main.dthing.thingId>=20061002)return!0;var i=t.parent.parent.getComponent(ht);return!("body"!=e.owner.name||!i)}uninstall(){this.owner.transform;setTimeout(()=>{cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION)},100)}drop(){mi.drop.addDrop(this.owner)}get installBone(){return!this._installBone&&this.tbthing&&this.tbthing.installBoneName&&(this._installBone=Xe.getBody(this.owner,this.tbthing.installBoneName)),this._installBone}get uninstallBone(){return!this._uninstallBone&&this.tbthing&&this.tbthing.uninstallBoneName&&(this._uninstallBone=Xe.getBody(this.owner,this.tbthing.uninstallBoneName)),this._uninstallBone}hitHurt(e){return!1}onUpdate(){if(!mi.device||mi.device.currentMountGear&&mi.device.currentMountGear==this.owner){if(this.installBone&&ea.scene.player&&ea.scene.player.owner&&this.installBone.numChildren<1){this.installBone.transform;var e=mi.device.currentMountGear.tb.scale,t=ea.scene.player.owner.transform;this.installBone.addChild(ea.scene.player.owner),ea.scene.player.playAni(mi.device.currentMountGear.tb.roleani),"40810216"==ea.scene.player.owner.tb.roleMod&&11861010==this.thingbody.dthing.thingId?t.localPosition=new Laya.Vector3(0,.5,0):t.localPosition=new Laya.Vector3(0,0,0),t.localRotationEuler=new Laya.Vector3(0,0,0),t.localScale=new Laya.Vector3(e,e,e)}}else if(this.lineFunc&&this.lineFunc(),this.owner&&this.installBone&&this.installBone.numChildren&&this.installBone.numChildren>0){ea.scene.mainscene.getChildByName("map").addChild(ea.scene.player.owner),ea.scene.player.owner.transform.localScale=new Laya.Vector3(1,1,1),ea.scene.player.owner.transform.position=this.uninstallBone.transform.position.clone(),ea.scene.player.owner.transform.localRotationEuler=new Laya.Vector3(0,0,0),cafe.event.dispatch(ge.game.UNDEVICE_MOD_REPLACE_FINISH);var i=Xe.getBody(this.owner,"videoNode");i&&(i.active=!0)}}triggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;if(-1!=e.owner.name.indexOf("Cube"))return!0;if(t.main&&37241==t.main.thingId){console.log("记录复活点");var i=t.main.transform.position.clone(),s=new Laya.Vector3(Math.floor(i.x),Math.floor(i.y),Math.floor(i.y)),a=t.main.transform.rotationEuler.clone();return a&&s&&Ve.game.RisePoi!=s&&(Ve.game.RisePoi=new Laya.Vector3(s.x,s.y,s.z),Ve.game.RiseRot=a,be.openpanel(we.EndUpPanel)),!1}return!1}_uninstalltriggerEnter(e){var t=e.owner;return!(!t||!t.main||-1==t.main.name.indexOf("npc"))||!!(t&&t.name&&-1!=t.name.indexOf("Cube")&&t.main)}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ani.speed=this.tbthing.ani_speed}onDestroy(){this.isdispose||(this.isdispose=!0,super.onDestroy())}}class wa extends ha{constructor(){super(...arguments),this.isCameraInit=!0}onEnable(){super.onEnable(),this.monitor("YG"+wi.POS_REF,this.onYGHandler),this.monitor("CAMERA"+Ai.DIR_REF,this.onCameraHandler),this.monitor(mt.NAME,this.onSettingChange)}setRoYTarget(e){this.roYTargetTr=e.transform}rotateY(e){this.ownerRoY+=e}set ownerRoY(e){this._ownerRoY=e;var t=this.roYTargetTr.rotationEuler.clone();t.y=this._ownerRoY,this.roYTargetTr.rotationEuler=t}get ownerRoY(){return this._ownerRoY}onYGHandler(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(!e){if(t.info.movestate=Q.wait,mi.device.currentMountGear&&Ve.game.isRideZuoqi){var i,s=mi.device.currentMountGear.getComponent(fa),n=mi.device.currentMountGear.tbId,o=a.device.getTbByDeviceId(n);if(this.script.ani.state=o.roleani,0==Ve.game.ZuoqiState)if(s)s.ani.state==ie.run&&s.playAni(ie.idle);else(i=mi.device.currentMountGear.getComponent(ba)).ani.state==ie.run&&i.playAni(ie.idle);else if(s)s.ani.state==ie.run&&70049==s.tbthing.deviceId&&s.playAni(ie.idle2);else(i=mi.device.currentMountGear.getComponent(ba)).ani.state==ie.run&&70049==i.tbthing.deviceId&&i.playAni(ie.idle2)}else t.ani.state==ie.run?t.playAni(ie.idle):t.ani.state==ie.qianxing&&t.isQingXing?t.playAni(ie.qianxingidle):t.ani.state!=ie.qianxing||t.isQingXing?t.ani.state==ie.walk&&t.playAni(ie.idle):t.playAni(ie.idle);return t.ani.state==ie.pa&&t.playAni(ie.paidle),t.ani.state==ie.baoqi&&t.playAni(ie.baoqidaiji),t.ani.state==ie.run?t.playAni(ie.idle):t.ani.state==ie.walk&&t.playAni(ie.idle),!1}if(!this.script.info.is_move)return!1;if(e||(e={center_pos:{x:0,y:0},pos:{x:0,y:0}}),10300==Ve.role.equip_role){var r=Xe.getBody(ea.scene.player.owner,"meishaonaitoufa");if(r)r.getComponent(Laya.Animator).play("run")}return this.script.ani.state!=ie.attack&&this.script.ani.state!=ie.qiang||(this.script.info.movestate=Q.wait,!1)}onCameraHandler(e){if(!e)return!1;if(!this.script.info.is_move)return!1;var t=ea.scene.cameraCode.playYGroup.transform,i=(ea.scene.cameraCode.playZGroup.transform,calcPosAngle(e.center_pos,e.pos)),s=calcPosAngle({x:-e.center_pos.x,y:e.center_pos.y},{x:-e.pos.x,y:e.pos.y}),a=(Math.round(180*i/Math.PI),Math.round(180*s/Math.PI)+90);let n=Qe.calcTrajectoryParamsone(t,.5,a);var o=n.pos.x-n.p.x,r=n.pos.y-n.p.y;this.roey=this.roey+5*o*fe.minScale,this.roex=this.roex+2*r*fe.minScale,this.roex>=this.script.info.tb.cameraRoX+30?this.roex=this.script.info.tb.cameraRoX+30:this.roex<=this.script.info.tb.cameraRoX-60&&(this.roex=this.script.info.tb.cameraRoX-60)}cameraRo(){var e=ea.scene.cameraCode.playYGroup.transform,t=ea.scene.cameraCode.playZGroup.transform;this.croey+=(this.roey-this.croey)/4,this.croex+=(-this.roex-this.croex)/4,e.localRotationEulerY=this.croey,t.localRotationEulerX=this.croex}onSettingChange(){}initAct(e){this.script=this.owner.getComponent(Si),super.initAct(e)}onUpdate(){}destroy(){super.destroy()}}class Ta extends wa{constructor(){super(...arguments),this.isHZSound=180,this.isFJSound=60,this.cd=18}onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.checkSound(0)}initAct(e){super.initAct(e);let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;t.localPositionY;this.script.ani.state!=ie.jump2&&t.position.y<30&&(this.owner.transform.localPositionY+=.5);var i=t.position,s=new Laya.Vector3(i.x,i.y+1.2,i.z),a=new Laya.Vector3(i.x,-1,i.z),n=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(s,a,n)){for(var o=0,r=0;r<n.length;r++){var l=n[r];"dmove_hit"!=l.collider.owner.name&&("skill_hit"!=l.collider.owner.name&&"bullet_hit"!=l.collider.owner.name&&"group_hit"!=l.collider.owner.name&&"umove_hit"!=l.collider.owner.name&&(o=Math.max(o,l.point.y)))}this.script.landY=o}if(mi.device.currentMountGear){var h=mi.device.currentMountGear.getComponent(fa),c=mi.device.currentMountGear.tb;if(this.script.ani.state=c.roleani,h)h.playAni(ie.idle1);else mi.device.currentMountGear.getComponent(ba).playAni(ie.idle1)}else this.script.playAni(ie.fly)}onSettingChange(){}checkSound(e){}refRotationEuler(e,t){this.croey=e,this.croex=t;let i=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,s=i;i.localRotationEulerY=this.roey,s.localRotationEulerX=-this.roex,this.roex>=60?this.roex=60:this.roex<=-60&&(this.roex=-60);var a=ea.scene.cameraCode.playXGroup.transform,n=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),a.localRotationEulerY=this.croey,n.localRotationEulerX=-this.croex}onYGHandler(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if("che"==t.ani.state)return!1;if(!super.onYGHandler(e))return!1;if(this.cd++,mi.device.CarMove&&36==this.cd&&mi.device.currentMountGear&&mi.device.currentMountGear.tb&&11861051!=mi.device.currentMountGear.tb.configId&&(mi.device.CarMove.stop(),mi.device.CarMove.play(),this.cd=0),mi.device.currentMountGear){var i=mi.device.currentMountGear.getComponent(fa),s=mi.device.currentMountGear.tb;if(this.script.ani.state=s.roleani,Ve.game.isRideZuoqi)if(i)i.playAni(ie.run);else mi.device.currentMountGear.getComponent(ba).playAni(ie.run)}else t.ani.state!=ie.idle&&t.ani.state!=ie.run||t.playAni(ie.fly);var a=calcPosAngle(e.center_pos,e.pos),n=calcPosAngle({x:e.center_pos.x,y:-e.center_pos.y},{x:e.pos.x,y:-e.pos.y}),o=(Math.round(180*a/Math.PI),Math.round(180*n/Math.PI)+90),r=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,l=ea.scene.camera.transform;return r.localRotationEulerY=l.rotationEuler.y+o,t.info.cur_angleY=r.localRotationEulerY,t.info.movestate=Q.move,!0}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/8,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}run(e){}onFrameRun(){if(ea.scene.GamePause||ea.scene.player&&ea.scene.player.UpdateFlyBagPos(),this.active){this.cameraRo();var e=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(e.info.is_move){if(mi.device.currentMountGear&&40007==mi.device.currentMountGear.tbId&&(this.isHZSound++,this.isHZSound>=180&&(this.isHZSound=0)),mi.device.currentMountGear&&40004==mi.device.currentMountGear.tbId&&(this.isFJSound++,this.isFJSound>=60&&(this.isFJSound=0)),e&&e.moveTrigger&&e.moveTrigger.isTrigger)return!0,void(e.moveTrigger.kinematics.length>0&&null==e.moveTrigger.kinematics[0].parent&&(ea.scene.player.owner.getComponent(Ni).delTrigger(e.moveTrigger.kinematics[0]),e.moveTrigger.kinematics=[],e.moveTrigger.isTrigger=!1));var t,i=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed;if(e.info.movestate==Q.move||e.info.movestate==Q.back){let u;t=e.info.cur_angleY,u=e.info.movestate==Q.back?-i:i,e.info.is_add_speed&&(u=mi.device.currentMountGear?2*i:e.info.tb.roleStartAddMoveSpeed*Ve.map.map.scale/1e5),e.ani.state!=ie.jump2&&e.ani.state!=ie.zhuiluo||(u*=2),this.owner.name;let p=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var s=p.localPositionY,a=p.position,n=new Laya.Vector3(a.x,a.y+1.2,a.z),o=new Laya.Vector3(a.x,-1,a.z),r=[];if(!mi.device.currentMountGear&&ea.scene.mainscene.physicsSimulation.raycastAllFromTo(n,o,r))for(var l=0,h=0;h<r.length;h++){var c=r[h];"equip"!=c.collider.owner.name&&("dmove_hit"!=c.collider.owner.name&&"skill_hit"!=c.collider.owner.name&&"bullet_hit"!=c.collider.owner.name&&"group_hit"!=c.collider.owner.name&&"group_check"!=c.collider.owner.name&&"attack_hit"!=c.collider.owner.name&&(l=Math.max(l,c.point.y)))}let m=Qe.calcTrajectoryParamsone(p,u,t);this.play_angle=m.angle;let g=Ve.map.mptData.gridHeightNum,y=Ve.map.mptData.gridWidthNum,f=Ve.map.mptData.gridX,_=Ve.map.mptData.gridY;Ve.game.isStartGame&&!Ve.game.isPauseGame&&(p.localPosition=new Laya.Vector3(m.pos.x,s,m.pos.y));var d=p.localPosition.clone();d.x>g&&(d.x=g),d.z>y&&(d.z=y),d.x<f&&(d.x=f),d.z<_&&(d.z=_),p.localPosition=d.clone()}}}}onDestroy(){}}class Aa extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){this.eventdata=e,this.speed=e.value/1e5,this.isUse=e.isDown,this.eventdata.pos=this.pos}onFrameRun(){let e=this;if(!e.script.owner)return;let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;var i=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script;e.script&&e.script.uMoveTrigger&&e.script.uMoveTrigger.isTrigger&&e.script.uMoveTrigger.kinematics.length>0&&null==e.script.uMoveTrigger.kinematics[0].parent&&(e.script.delTrigger(e.script.uMoveTrigger.kinematics[0]),e.script.uMoveTrigger.kinematics=[],e.script.uMoveTrigger.isTrigger=!1),0==ea.scene.GamePause&&e.isUse&&i&&i.uMoveTrigger&&!i.uMoveTrigger.isTrigger&&(t.localPositionY+=e.speed,ea.scene.player&&ea.scene.player.UpdateFlyBagPos())}destroy(){super.destroy(),console.log("跳跃回收成功")}}class xa extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){this.eventdata=e,this.speed=e.value/1e5,this.isUse=e.isDown,this.eventdata.pos=this.pos}onFrameRun(){let e=this;if(!e.script.owner)return;let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;var i=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script,s=new Laya.HitResult,a=e.script.dMoveTrigger.owner._transform._position,n=new Laya.Vector3(a.x,a.y-2,a.z);if(ea.scene.mainscene.physicsSimulation.raycastFromTo(a,n,s)){if(a.y-.2<s.point.y)return}e.script&&e.script.dMoveTrigger&&e.script.dMoveTrigger.isTrigger&&e.script.dMoveTrigger.kinematics.length>0&&null==e.script.dMoveTrigger.kinematics[0].parent&&(e.script.delTrigger(e.script.dMoveTrigger.kinematics[0]),e.script.dMoveTrigger.kinematics=[],e.script.dMoveTrigger.isTrigger=!1),0==ea.scene.GamePause&&e.isUse&&i&&i.dMoveTrigger&&!i.dMoveTrigger.isTrigger&&(t.localPositionY-=e.speed,ea.scene.player&&ea.scene.player.UpdateFlyBagPos())}destroy(){super.destroy(),console.log("跳跃回收成功")}}class ka extends ra{constructor(){super(...arguments),this.time=0}onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length,this.checkAction=this.addCom(this.owner,Yi),this.time=ea.scene.ui.weaponTime}onUseSkillHandler(e){var t=this;if("1"==i.read("yxrhfirstAtt")&&(ea.scene.ui.firstAtt.visible=!1),t.script.ani.state!=ie.lutou&&t.script.ani.state!=ie.che&&t.script.ani.state!=ie.skill&&e.isDown){ea.scene.ui.img_target.visible=!0;var s=new Laya.Vector2(ea.scene.ui.img_target.x,ea.scene.ui.img_target.y),a=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0));t.hits=[],t.hit=new Laya.HitResult,ea.scene.camera.viewportPointToRay(s,a),ea.scene.mainscene.physicsSimulation.rayCastAll(a,t.hits);for(var n=0;n<t.hits.length;n++)if("body"!=this.hits[n].collider.owner.parent.name){t.hit=this.hits[n];break}t.eventdata=e,slog("使用技能:",e.skill.skillId),t.script.ani.speed=Number(t.speeds[t.index]);var o=t.anis[t.index].split(":"),r=t.index;if(t.target=null,t.hit.succeeded){if(t.pointPos=t.hit.point,Es.LookFromAt1(t.owner,t.pointPos),mi.device.currentMountGear){t.target&&t.target.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger&&Es.LookFromAt(mi.device.currentMountGear,t.target.mode);var l=mi.device.currentMountGear.getComponent(ba);if(!l){var h=mi.device.currentMountGear.getComponent(fa);return Tn.inst.sound.play(Number(t.sounds[r])),t.RidefireSkill(Number(o[1])),void h.playAni(ie[o[0]],initHandler(t,e=>{}))}return Tn.inst.sound.play(Number(t.sounds[r])),t.RidefireSkill(Number(o[1])),void l.playAni(ie[o[0]],initHandler(t,e=>{}))}if(ea.scene.ui.weaponTime>=0){var c=100*(Math.round(ea.scene.ui.weaponTime/ea.scene.ui.weaponLength*100)/100);if(ea.scene.ui.naijiuimg&&(ea.scene.ui.naijiuimg.width=c),ea.scene.ui.weaponTime<=1)return ea.scene.player.ani.play(ie.idle),Ve.shop.useEquip(ea.scene.ui.weaponId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon),void(ea.scene.ui.naijiubox.visible=!1)}t.script.playAni(ie[o[0]],initHandler(t,e=>{ea.scene.ui.weaponTime<=0?ea.scene.player.ani.play(ie.idle):ea.scene.ui.weaponTime>0&&"skillfire"==e&&(Tn.inst.sound.play(Number(t.sounds[r])),-1!=Ve.shop.equip_weapon.indexOf(80027)?t.fireshoot(10751002):-1!=Ve.shop.equip_weapon.indexOf(80028)?t.fireshoot(10751001):-1!=Ve.shop.equip_weapon.indexOf(80029)&&t.fireshoot(10851002))})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}}RidefireSkill(e){for(var t=this,i=Xe.getBodys(mi.device.currentMountGear,"group_firestart"),s=Xe.getBodys(mi.device.currentMountGear,"group_firedir"),a=0;i&&a<i.length;a++){var n=i[a].transform,o=s[a].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{if(null==t.owner.scene)return e.removeSelf(),void e.destroy();var i=n,s=o;if(t.target&&t.target.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger){if(!(s=t.target.mode.transform)||!s.position)return e.removeSelf(),void e.destroy();s.position.y+=1}if(i.position&&(e.transform.position=i.position.clone()),t.target&&t.target.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger){e.transform.lookAt(s.position,new Laya.Vector3(0,0,0));var a=Qe.getTAndSpeedToXYObj(e.transform.position,s.localRotationEulerY,s.localRotationEulerX,1);e.transform.position=new Laya.Vector3(a.pos.x,a.pos.y,a.pos.z),e.transform.localRotationEulerX=e.transform.localRotationEulerX-180,e.transform.localRotationEulerZ=180}else{var r=calcPosAngle({x:i.position.x,y:-i.position.z},{x:s.position.x,y:-s.position.z},!0);e.transform.localRotationEulerY=r}e.addComponent(da).run({script:t.script,tb:t.script.info.tb,skill:t.eventdata.skill})}))}}fireSkill(e){for(var t=this,i=Xe.getBodys(t.owner,"group_firestart"),s=Xe.getBodys(t.owner,"group_firedir"),a=0;i&&a<i.length;a++){var n=i[a].transform,o=s[a].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{var i=n,s=o;if(t.target){if(!(s=t.target.mode.transform)||!s.position)return e.removeSelf(),void e.destroy();s.position.y+=1}if(i.position&&(e.transform.position=i.position.clone()),t.target){e.transform.lookAt(s.position,new Laya.Vector3(0,0,0));var a=Qe.getTAndSpeedToXYObj(e.transform.position,s.localRotationEulerY,s.localRotationEulerX,1);e.transform.position=new Laya.Vector3(a.pos.x,a.pos.y,a.pos.z),e.transform.localRotationEulerX=e.transform.localRotationEulerX-180,e.transform.localRotationEulerZ=180}else{var r=calcPosAngle({x:i.position.x,y:-i.position.z},{x:s.position.x,y:-s.position.z},!0);e.transform.localRotationEulerY=r}e.addComponent(da).run({script:t.script,tb:t.script.info.tb,skill:t.eventdata.skill})}))}}fireshoot(e){for(var t=this,i=Xe.getBodys(t.owner,"qian_firestart"),s=Xe.getBodys(t.owner,"qian_firedir"),a=0;i&&a<i.length;a++){ea.scene.ui.weaponTime--;var n=i[a].transform,o=s[a].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{var i=n,s=o;i.position&&(e.transform.position=i.position),s.position=t.pointPos,e.transform.lookAt(t.pointPos,new Laya.Vector3(0,0,0));Qe.getTAndSpeedToXYObj(e.transform.position,s.localRotationEulerY,0,1);e.transform.localRotationEulerX=e.transform.localRotationEulerX-180,e.transform.localRotationEulerZ=180,e.addComponent(da).run({script:t.script,tb:t.script.info.tb,skill:t.eventdata.skill})}))}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Ea extends wa{onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.checkSound(0)}initAct(e){super.initAct(e);let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;t.localPositionY;var i=t.position,s=new Laya.Vector3(i.x,i.y+1.2,i.z),a=new Laya.Vector3(i.x,-1,i.z),n=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(s,a,n)){for(var o=0,r=0;r<n.length;r++){var l=n[r];"dmove_hit"!=l.collider.owner.name&&(o=Math.max(o,l.point.y))}this.script.landY=o}this.script.playAni(ie.idle)}onSettingChange(){}checkSound(e){}refRotationEuler(e,t){this.croey=e,this.croex=t;let i=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,s=i;i.localRotationEulerY=this.roey,s.localRotationEulerX=-this.roex,this.roex>=60?this.roex=60:this.roex<=-60&&(this.roex=-60);var a=ea.scene.cameraCode.playXGroup.transform,n=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),a.localRotationEulerY=this.croey,n.localRotationEulerX=-this.croex}onYGHandler(e){if(!super.onYGHandler(e))return!1;this.script.ani.state!=ie.idle&&this.script.ani.state!=ie.run||this.script.playAni(ie.fly);var t=calcPosAngle(e.center_pos,e.pos),i=calcPosAngle({x:e.center_pos.x,y:-e.center_pos.y},{x:e.pos.x,y:-e.pos.y}),s=(Math.round(180*t/Math.PI),Math.round(180*i/Math.PI)+90),a=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,n=ea.scene.camera.transform;return a.localRotationEulerY=n.rotationEuler.y+s,this.script.info.cur_angleY=a.localRotationEulerY,this.script.info.movestate=Q.move,!0}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/8,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}run(e){}onFrameRun(){if(!this.active)return;if(!this.script.info.is_move)return;this.cameraRo();if(this.script&&this.script.moveTrigger&&this.script.moveTrigger.isTrigger)return void!0;var e=this.script.info.speed;let t;this.script.info.cur_angleY,t=this.script.info.movestate==Q.back?-e:e,this.script.info.is_add_speed&&(t=this.script.info.tb.roleStartAddMoveSpeed*Ve.map.map.scale/1e5),this.script.ani.state!=ie.jump2&&this.script.ani.state!=ie.zhuiluo||(t*=2),this.owner.name;let i=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;i.localPositionY,i.position;if(i.localPositionY>=70)return this.active=!1,Li.BoomShow(i.position.clone(),2),void mi.device.unDevice();i.translate(new Laya.Vector3(0,.2,0),!1)}onDestroy(){}}class Ia extends it{constructor(){super(...arguments),this.life=800,this.speed=0,this.addspeed=0,this.maxspeed=0,this.total=50}onEnable(){super.onEnable(),this.list=[],this.speed=0,this.addspeed=.02,this.maxspeed=.8,this.active=!0;var e=this.owner.getComponent(Ni),t=this.owner.getComponent(nt);e.isDie=!0,t.destroy(),e.info.attribute.destroy(),e.info.attribute=null,e.playAni(ie.death)}run(e){this.active=!0}onUpdate(){if(!this.owner)return;if(!this.active)return;if(!Ve.map.mptData)return;let e=this.speed;(this.owner.transform.translate(new Laya.Vector3(0,0,e),!0),this.life--,this.life<=0)&&this.owner.getComponent(ht).dieMonsterClear();this.speed<this.maxspeed&&(this.speed+=this.addspeed,this.speed>=this.maxspeed&&(this.speed=this.maxspeed))}onDestroy(){super.onDestroy()}}class Ca extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;if(e.isDown){t.eventdata=e,slog("使用技能:",e.skill.skillId);var i=t.index,s=Xe.getBody(t.owner,"group_effect"),a=t.script.owner.getComponent(at).max_Attack,n=ea.skill.getSkillValue(a,t.eventdata.skill.tb);t.script.info.is_buff_power&&(n*=2),t.script.ani.speed=Number(t.speeds[t.index]),t.script.playAni(ie[t.anis[t.index]],new Laya.Handler(t,()=>{var e=Ve.map.mptData.mptModel[J.ROLE].things;Tn.inst.sound.play(Number(t.sounds[i]));for(var a=Qe.getSprite3DListByDistance(t.owner,e,t.eventdata.skill.tb.range),o=0;o<a.in.length;o++){if((d=(c=a.in[o]).getComponent(ht))&&d.info&&d.info.attribute)if(d.info.attribute.headview||d.info.attribute.initView(),d.info.attribute.hitHurt(n),d.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(c)),t.script.delTrigger(c);var r=t.owner.transform,l=c.transform,h=calcPosAngle({x:r.position.x,y:-r.position.z},{x:l.position.x,y:-l.position.z},!0);l.localRotationEulerY=h,l.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:4,count:1}),Li.BoomShow(c.transform.position.clone(),2),c.addComponent(Ia).run(),o--}else"0"!=t.skill.tb.hitAni?d.hit(t.skill.tb.hitAni):ss.vibrate(c),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0])}if(t.script.attackTrigger.isTrigger)for(o=0;o<t.script.attackTrigger.kinematics.length;o++){var c,d,u=t.script.attackTrigger.kinematics[o];if((d=(c=u.main).getComponent(ht))&&(!d.info&&c.getComponent(gs)))if((d=c.getComponent(gs)).info.attribute.headview||d.info.attribute.initView(),d.info.attribute.hitHurt(n),Li.showTipText(c.transform.position,n),Tt.play(c.transform,Number(10007),{size:3,time:1e3}),d.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(c)),t.script.delTrigger(c);r=t.owner.transform;4!=c.tb.type&&Es.AddFeixuTo(c.transform.position),1002!=Ve.level.select_id&&1005!=Ve.level.select_id&&1008!=Ve.level.select_id||cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:29,count:1}),Li.BoomShow(c.transform.position.clone(),2),setTimeout(()=>{c.removeSelf(),c.destroy()},100),o--}else ss.vibrate(c),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0])}})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class La extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;if(e.isDown){t.eventdata=e;var i=t.index;slog("使用技能:",e.skill.skillId);var s=t.anis[t.index].split(":");t.script.ani.speed=Number(t.speeds[t.index]),t.script.playAni(ie[s[0]],new Laya.Handler(t,()=>{t.EffectSkill(Number(s[1])),Tn.inst.sound.play(Number(t.sounds[i])),t.attack()})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}attack(){var e=Xe.getBody(this.owner,"group_effect"),t=(this.script.info.tb,this.script.owner.getComponent(at).max_Attack),i=ea.skill.getSkillValue(t,this.eventdata.skill.tb);if(this.script.info.is_buff_power&&(i*=2),this.script.attackTrigger.isTrigger)for(var s=0;s<this.script.attackTrigger.kinematics.length;s++){var a=this.script.attackTrigger.kinematics[s].main,n=a.getComponent(ht);if(n)if(n.info)if(n.info.attribute.headview||n.info.attribute.initView(),n.info.attribute.hitHurt(i),n.info.attribute.thing_hp<=0){this.script.delTrigger(a);l=this.owner.transform;var o=a.transform,r=calcPosAngle({x:l.position.x,y:-l.position.z},{x:o.position.x,y:-o.position.z},!0);o.localRotationEulerY=r,o.localRotationEulerX=-30,n.drop(),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:27,count:1}),Li.BoomShow(a.transform.position.clone(),2),a.addComponent(Ia).run(),s--}else"0"!=this.skill.tb.hitAni?n.hit(this.skill.tb.hitAni):ss.vibrate(a),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[e,1,100,0]);else if((n=a.getComponent(gs)).info.attribute.headview||n.info.attribute.initView(),n.info.attribute.hitHurt(i),Li.showTipText(a.transform.position,i),Tt.play(a.transform,Number(10007),{size:3,time:1e3}),n.info.attribute.thing_hp<=0){this.script.delTrigger(a);var l=this.owner.transform;n.drop(),1002!=Ve.level.select_id&&1005!=Ve.level.select_id&&1008!=Ve.level.select_id||cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:29,count:1}),Li.BoomShow(a.transform.position.clone(),2),4!=a.tb.type&&Es.AddFeixuTo(a.transform.position),setTimeout(()=>{a.removeSelf(),a.destroy()},100),s--}else ss.vibrate(a),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[e,1,100,0])}}EffectSkill(e){}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Ma extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;if(e.isDown){t.eventdata=e,slog("使用技能:",e.skill.skillId);var i=t.anis[t.index].split(":");t.script.ani.speed=Number(t.speeds[t.index]);var s=Xe.getBody(t.owner,"group_effect"),a=t.index,n=t.script.owner.getComponent(at).max_Attack,o=ea.skill.getSkillValue(n,t.eventdata.skill.tb);t.script.info.is_buff_power&&(o*=2),t.script.playAni(ie[i[0]],new Laya.Handler(t,()=>{t.rangeEffectSkill(Number(i[1])),Tn.inst.sound.play(Number(t.sounds[a]));for(var e=Ve.map.mptData.mptModel[J.ROLE].things,n=Qe.getSprite3DListByDistance(t.owner,e,t.eventdata.skill.tb.range),r=0;r<n.in.length;r++){if((u=(d=n.in[r]).getComponent(ht))&&u.info&&u.info.attribute)if(u.info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(o),u.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(d)),t.script.delTrigger(d);var l=t.owner.transform,h=d.transform,c=calcPosAngle({x:l.position.x,y:-l.position.z},{x:h.position.x,y:-h.position.z},!0);h.localRotationEulerY=c,h.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:27,count:1}),Li.BoomShow(d.transform.position.clone(),2),d.addComponent(Ia).run(),r--}else"0"!=t.skill.tb.hitAni?u.hit(t.skill.tb.hitAni):ss.vibrate(d),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0])}if(t.script.attackTrigger.isTrigger)for(r=0;r<t.script.attackTrigger.kinematics.length;r++){var d,u,p=t.script.attackTrigger.kinematics[r];if(u=(d=p.main).getComponent(ht))if(!u.info&&d.getComponent(gs))if((u=d.getComponent(gs)).info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(o),Li.showTipText(d.transform.position,o),Tt.play(d.transform,Number(10007),{size:3,time:1e3}),u.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(d)),t.script.delTrigger(d);l=t.owner.transform;4!=d.tb.type&&Es.AddFeixuTo(d.transform.position),1002!=Ve.level.select_id&&1005!=Ve.level.select_id&&1008!=Ve.level.select_id||cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:29,count:1}),Li.BoomShow(d.transform.position.clone(),2),setTimeout(()=>{d.removeSelf(),d.destroy()},100),r--}else ss.vibrate(d),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0]);else if(u.info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(o),Li.showTipText(d.transform.position,o),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0]),u.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(d)),t.script.delTrigger(d);l=t.owner.transform,h=d.transform,c=calcPosAngle({x:l.position.x,y:-l.position.z},{x:h.position.x,y:-h.position.z},!0);if(h.localRotationEulerY=c,h.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:27,count:1}),Li.BoomShow(d.transform.position.clone(),2),null!=d.tb.monsterId)d.addComponent(Ia).run();else cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),setTimeout(()=>{d.removeSelf(),d.destroy()},100);r--}else"0"!=t.skill.tb.hitAni?u.hit(t.skill.tb.hitAni):ss.vibrate(d)}})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}rangeEffectSkill(e){var t=Xe.getBody(this.owner,"fong_effect");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{var i=t.transform;i.position&&(e.transform.position=i.position.clone())}))}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Sa extends wa{onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX;e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}initAct(e){super.initAct(e),mi.device.currentMountGear?"0"==mi.device.currentMountGear.tb.roleani?this.script.playAni(ie.idle):this.script.playAni(mi.device.currentMountGear.tb.roleani):this.script.playAni(ie.idle)}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/8,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}run(e){}onFrameRun(){this.active&&this.script.info.is_move&&this.cameraRo()}onDestroy(){}}class Pa extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){if(e.isDown&&(this.eventdata=e,slog("使用技能:",e.skill.skillId),!ea.scene.targetpoint)){var t=new Laya.Vector2(ea.scene.ui.img_target.x,ea.scene.ui.img_target.y),i=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0));ea.scene.camera.viewportPointToRay(t,i);var s,a,n,o=[];ea.scene.mainscene.physicsSimulation.rayCastAll(i,o);for(var r=0;r<o.length;r++){var l=o[r];if("qiuCube"!=l.collider.owner.name&&("dmove_hit"!=l.collider.owner.name&&"group_uninstall"!=l.collider.owner.name&&"attack_hit"!=l.collider.owner.name&&"skill_hit"!=l.collider.owner.name&&"bullet_hit"!=l.collider.owner.name&&"group_hit"!=l.collider.owner.name&&"group_check"!=l.collider.owner.name&&"move_hit"!=l.collider.owner.name&&l.succeeded)){s=l.point.clone();var h=Qe.get3DRangeDistance(ea.scene.player.owner.transform,s);(null==a||a>h)&&(a=h,n=l,this.targetpoint=s)}}var c=new Laya.Sprite3D("ropeX"),d=new Laya.Sprite3D("ropeY");ea.scene.mainscene.getChildByName("map").addChild(d),d.addChild(c);let u=ea.scene.player.owner.transform.position.clone(),p=this.targetpoint.clone(),m=180*calcPosAngle({x:u.x,y:-u.z},{x:p.x,y:-p.z})/Math.PI+90;ea.scene.player.owner.transform.localRotationEulerY=m,this.script.info.cur_angleY=m,c.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.02,.02,1))).transform.localPositionZ=.5,ea.scene.targetBox=c,ea.scene.ropeTarget=d,ea.scene.targetpoint=this.targetpoint,ea.scene.ropetargetSp=n.collider.owner.main,this.script.info.actionstate=$.rope1,this.rope1(),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}rope1(){var e=this;e.script.playAni(ie.shengsuo,initHandler(e,t=>{if("finish"!=t)return;var i=Xe.getBody(ea.scene.player.owner,"Bip001 R Hand");ea.scene.ropeTarget.transform.position=i.transform.position.clone();var s=Qe.get3DRangeDistance(ea.scene.targetBox.transform.position,ea.scene.targetpoint),a=getDistance({x:ea.scene.targetBox.transform.position.x,y:ea.scene.targetBox.transform.position.z},{x:ea.scene.targetpoint.x,y:ea.scene.targetpoint.z});s=Math.round(1e3*s)/1e3;var n=ea.scene.ropeTarget.transform,o=n.position.clone(),r=ea.scene.targetpoint.clone();let l=180*calcPosAngle({x:o.x,y:-o.z},{x:r.x,y:-r.z})/Math.PI+90,h=180*calcPosAngle({x:o.y,y:0},{x:r.y,y:a})/Math.PI-90;n.localRotationEulerY=l;var c=ea.scene.targetBox.transform,d=ea.scene.ropeTarget;ea.scene.targetBox.transform.localRotationEulerX=h;var u=s/(1e3/60*.8)*180;let p=ea.scene.targetBox.transform.localScale.clone();ts.localscale(ea.scene.targetBox.transform,u,p,null,initHandler(e,()=>{ea.scene.ropetargetSp?ea.scene.ropetargetSp.triggerType==Pi.device?e.rope3_1():e.rope2_1():e.rope4_1()}),new Laya.Handler(e,e=>{var t=e/1e4,s=Qe.get3DRangeDistance(c.position,ea.scene.targetpoint);c.localScaleZ=s*t,d.transform.position=i.transform.position.clone();var a=d.transform,n=a.position.clone(),o=ea.scene.targetpoint.clone(),r=Qe.get3DPosToAngleYX(n,o,!0);a.localRotationEulerY=r.y,c.localRotationEulerX=r.x}))}))}rope2_1(){var e=this;cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),e.script.info.actionstate=$.rope2_1,e.script.playAni(ie.shengsuofeixing);var t=ea.scene.player.owner.transform,i=Xe.getBody(ea.scene.player.owner,"Bip001 R Hand"),s=ea.scene.targetBox.transform,a=ea.scene.ropeTarget,n=t.position.clone(),o=i.transform.position.clone().y-n.y,r=ea.scene.targetpoint.clone();r.y=r.y-o;var l=Qe.get3DPosToAngleYX(r,t.position,!0);let h=Qe.getTAndSpeedToXYObj2(r,l.y,l.x,.8);var c=Qe.get3DRangeDistance(t,h)/(1e3/60*.8)*360;slog("飞行所需要时间=> :"+c),ts.position(t,c,h,null,initHandler(e,()=>{e.script.info.actionstate=$.rope2_2}),new Laya.Handler(e,e=>{a.transform.position=i.transform.position.clone();var t=Qe.get3DRangeDistance(s.position,ea.scene.targetpoint);s.localScaleZ=t;var n=a.transform,o=n.position.clone(),r=ea.scene.targetpoint.clone(),l=Qe.get3DPosToAngleYX(o,r,!0);n.localRotationEulerY=l.y,s.localRotationEulerX=l.x}))}rope3_1(){var e=this;e.script.info.actionstate=$.rope3_1;var t=ea.scene.ropetargetSp.transform,i=ea.scene.player.owner.transform,s=Xe.getBody(ea.scene.player.owner,"Bip001 R Hand"),a=i.position.clone(),n=s.transform.position.clone().y-a.y,o=t.position.y,r=ea.scene.targetpoint.clone();r.y=r.y-n;var l=Qe.get3DPosToAngleYX(r,i.position,!0);let h=Qe.getTAndSpeedToXYObj2(t.position,l.y,l.x,1.8),c=Qe.getTAndSpeedToXYObj2(t.position,l.y,l.x,4);h.y=4,c.y=o;var d=ea.scene.ropetargetSp;ts.position(t,180,h,null,initHandler(e,()=>{ts.position(t,360,c,null,initHandler(e,()=>{let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;var i=t.position.clone();i.y+=80;var s=t.position.clone(),a=s.y;s.y=-5,ta.MainRoleRay(i,s,e=>{e.collider.owner.main==d&&(a=Math.max(a,e.point.y))}),e.script.landY=a,t.position=new Laya.Vector3(t.position.x,a,t.position.z)}))}));var u=ea.scene.targetBox.transform.localScaleZ/(1e3/60*.8)*100;Laya.Tween.to(ea.scene.targetBox.transform,{localScaleZ:0},u,null,initHandler(e,()=>{Laya.Tween.clearTween(ea.scene.targetBox.transform),e.script.info.actionstate=$.rope3_2}))}rope4_1(){var e=this;e.script.info.actionstate=$.rope3_1;var t=ea.scene.targetBox.transform.localScaleZ/(1e3/60*.8)*100;Laya.Tween.to(ea.scene.targetBox.transform,{localScaleZ:0},t,null,initHandler(e,()=>{Laya.Tween.clearTween(ea.scene.targetBox.transform),e.script.info.actionstate=$.rope3_2}))}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Ra extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length,this.checkAction=this.addCom(this.owner,Yi)}onUseSkillHandler(e){if(e.isDown){this.eventdata=e,slog("使用技能:",e.skill.skillId),this.script.ani.speed=Number(this.speeds[this.index]);var t=this.anis[this.index].split(":"),i=this.index;this.target=null,this.target=this.checkAction.checkAll3D(20,7),this.target&&this.target.mode&&this.script.findTarget&&this.script.findTrigger.isTrigger&&Es.LookFromAt(this.owner,this.target.mode),this.script.playAni(ie[t[0]],initHandler(this,e=>{})),Tn.inst.sound.play(Number(this.sounds[i])),this.fireSkill(Number(t[1])),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}fireSkill(e){for(var t=this,i=Xe.getBodys(t.owner,"pao_firestart"),s=Xe.getBodys(t.owner,"pao_firedir"),a=0;i&&a<i.length;a++){var n=i[a].transform,o=s[a].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{var i=n,s=o;if(t.target&&t.target.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger){if(!(s=t.target.mode.transform)||!s.position)return e.removeSelf(),void e.destroy();s.position.y+=1}if(i.position&&(e.transform.position=i.position.clone()),t.target&&t.target.mode&&t.script.findTarget&&t.script.findTrigger.isTrigger){e.transform.lookAt(s.position,new Laya.Vector3(0,0,0));var a=Qe.getTAndSpeedToXYObj(e.transform.position,s.localRotationEulerY,s.localRotationEulerX,1);e.transform.position=new Laya.Vector3(a.pos.x,a.pos.y,a.pos.z),e.transform.localRotationEulerX=e.transform.localRotationEulerX-180,e.transform.localRotationEulerZ=180}else{var r=calcPosAngle({x:i.position.x,y:-i.position.z},{x:s.position.x,y:-s.position.z},!0);e.transform.localRotationEulerY=r}e.addComponent(da).run({script:t.script,tb:t.script.info.tb,skill:t.eventdata.skill})}))}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Da extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;if(e.isDown){t.eventdata=e;var i=t.index;slog("使用技能:",e.skill.skillId);var s=t.anis[t.index].split(":");t.script.ani.speed=Number(t.speeds[t.index]),t.EffectSkill(Number(s[1])),t.script.playAni(ie[s[0]],new Laya.Handler(t,()=>{Tn.inst.sound.play(Number(t.sounds[i])),t.attack()})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}attack(){var e=Xe.getBody(this.owner,"group_effect"),t=(this.script.info.tb,this.script.owner.getComponent(at).max_Attack),i=ea.skill.getSkillValue(t,this.eventdata.skill.tb);if(this.script.info.is_buff_power&&(i*=2),this.script.skillTrigger.isTrigger)for(var s=0;s<this.script.skillTrigger.kinematics.length;s++){var a=this.script.skillTrigger.kinematics[s].main,n=a.getComponent(ht);if(n)if(n.info)if(n.info.attribute.headview||n.info.attribute.initView(),n.info.attribute.hitHurt(i),n.info.attribute.thing_hp<=0){this.script.delTrigger(a);l=this.owner.transform;var o=a.transform,r=calcPosAngle({x:l.position.x,y:-l.position.z},{x:o.position.x,y:-o.position.z},!0);if(o.localRotationEulerY=r,o.localRotationEulerX=-30,Ve.game.ZaiHaiScoure+=50,ea.scene.ui.UpdareZaiHaiScoure(),Ve.game.ZaiHaiScoure>1e3&&Ve.game.isZaiHai&&(Ve.game.ZaiHaiScoure=0,Ve.game.MonsterLevel++),n.drop(),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:a.tbId,taskType:27,count:1}),Li.BoomShow(a.transform.position.clone(),2),null!=a.tb.monsterId)a.addComponent(Ia).run();else cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),setTimeout(()=>{a.removeSelf(),a.destroy()},100);s--}else"0"!=this.skill.tb.hitAni?n.hit(this.skill.tb.hitAni):ss.vibrate(a),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[e,1,100,0]);else if((n=a.getComponent(gs)).info.attribute.headview||n.info.attribute.initView(),n.info.attribute.hitHurt(i),Li.showTipText(a.transform.position,i),Tt.play(a.transform,Number(10007),{size:3,time:1e3}),n.info.attribute.thing_hp<=0){this.script.delTrigger(a);var l=this.owner.transform;Ve.game.ZaiHaiScoure+=100,ea.scene.ui.UpdareZaiHaiScoure(),Ve.game.ZaiHaiScoure>1e3&&Ve.game.isZaiHai&&(Ve.game.ZaiHaiScoure=0,Ve.game.MonsterLevel++),4!=a.tb.type&&Es.AddFeixuTo(a.transform.position),n.drop(),1002!=Ve.level.select_id&&1005!=Ve.level.select_id&&1008!=Ve.level.select_id||cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:29,count:1}),Li.BoomShow(a.transform.position.clone(),2),setTimeout(()=>{a.removeSelf(),a.destroy()},100),s--}else ss.vibrate(a),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[e,1,100,0])}}EffectSkill(e){var t=this,i=Xe.getBody(t.owner,"che");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{i.transform;i.addChild(e),e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),setTimeout(()=>{t.rangeEffectSkill(11452002)},1600),setTimeout(()=>{e.removeSelf(),e.destroy()},2e3)}))}rangeEffectSkill(e){var t=Xe.getBody(this.owner,"che");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{var i=t.transform;i.position&&(e.transform.position=i.position.clone())}))}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Na extends it{constructor(){super(...arguments),this.speed=0,this.addspeed=0,this.maxspeed=0,this.total=50,this.ishit=!1,this.hitNum=0}onEnable(){super.onEnable(),this.list=[]}run(e){var t=this;t.info=e,t.life=t.info.skill.tb.powerOrTime;var i=t.info.skill.tb.speed.split("|");t.speed=0,t.addspeed=Number(i[1])/1e5,t.maxspeed=Number(i[0])/1e5,t.attackTrigger&&t.attackTrigger.destroy(),t.attackTarget||(t.attackTarget=t.owner.getChildByName("tmode").getChildByName("bullet_hit")),t.attackTarget&&(t.attackTrigger=t.addCom(t.attackTarget,Ci),t.attackTrigger.isEnter=(e=>t.onAttackTrigger(e))),t.active=!0}delTrigger(e){this.attackTrigger.delTrigger(e)}onAttackTrigger(e){var t=e.owner;return!!t&&("body"==t.name&&t!=this.owner||(!!(t.main&&t.main.tb&&t.main.tb.monsterId)||!(-1==t.name.indexOf("Cube")||!t.main||1!=t.main.tb.destroyType)))}onUpdate(){if(!this.owner)return;if(!this.active)return;if(!Ve.map.mptData)return;let e=this.speed;this.owner.transform.translate(new Laya.Vector3(0,-e,0),!0),this.owner.transform.position.y<.5&&(this.hurt(),Tt.play(this.owner.transform,Number(10008),{size:2,time:1e3})),this.owner.transform.position.y<-5&&(this.owner.removeSelf(),this.owner.destroy(),this.owner=null),this.speed<this.maxspeed&&(this.speed+=this.addspeed,this.speed>=this.maxspeed&&(this.speed=this.maxspeed)),this.Build()}Build(){var e=this.info.script.info.tb,t=ea.skill.getSkillValue(e.attack,this.info.skill.tb);if(this.info.script.info.is_buff_power&&(t*=2),this.attackTrigger.isTrigger){for(var i=0;i<this.attackTrigger.kinematics.length;i++){var s=this.attackTrigger.kinematics[i].main,a=s.getComponent(ht);if(a){var n=this.list.filter(e=>e.mode==s)[0],o=this.list.indexOf(n);n&&n.count>0||a.info||((a=s.getComponent(gs)).info.attribute.headview||a.info.attribute.initView(),a.info.attribute.hitHurt(t),a.info.attribute.thing_hp<=0?(Tt.play(this.owner.transform,Number(10008),{size:1,time:1e3}),4!=s.tb.type&&Es.AddFeixuTo(s.transform.position),mi.drop.addRomDrop(ta.get9GByTr(s)),this.info.script.delTrigger(s),this.list.splice(o,1),a.dieMonsterClear?a.dieMonsterClear():(s.removeSelf(),s.destroy()),i--):(ss.vibrate(s),n?n.count>0?n.count--:n.count=this.total:this.list.push({mode:s,count:this.total})))}}this.owner.removeSelf(),this.owner.destroy(),this.owner=null}}hurt(){for(var e=Ve.map.mptData.mptModel[J.ROLE].things,t=Qe.getSprite3DListByDistance(this.owner,e,this.info.skill.tb.range),i=0;i<t.in.length;i++){var s=t.in[i];if(!s.getComponent(vs)){var a=s.getComponent(ht);if(a&&a.info&&a.info.attribute){a.info.attribute.headview||a.info.attribute.initView();var n=this.info.script.info.tb,o=ea.skill.getSkillValue(n.attack,this.info.skill.tb);this.info.script.info.is_buff_power&&(o*=2),a.info.attribute.hitHurt(o),a.info.attribute.thing_hp<=0?(mi.drop.addRomDrop(ta.get9GByTr(s)),this.info.script.delTrigger(s),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:s.tbId,taskType:27,count:1}),s.removeSelf(),s.destroy(),setTimeout(()=>{},100),i--):"0"!=this.info.skill.tb.hitAni?a.hit(this.info.skill.tb.hitAni):ss.vibrate(s)}}}}rangeEffectSkill(e){var t=Xe.getBody(this.owner,"bullet_hit");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{var i=t.transform;i.position&&(e.transform.position=i.position.clone())}))}onDestroy(){super.onDestroy()}}class ja extends ra{onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;if(e.isDown){t.eventdata=e,slog("使用技能:",e.skill.skillId);var i=t.anis[t.index].split(":");t.script.ani.speed=Number(t.speeds[t.index]);var s=Xe.getBody(t.owner,"group_effect"),a=t.index;if(mi.device.currentMountGear){var n=mi.device.currentMountGear.getComponent(ba);if(!n){var o=mi.device.currentMountGear.getComponent(fa);return Tn.inst.sound.play(Number(t.sounds[a])),t.RidefireSkill(Number(i[1])),void o.playAni(ie[i[0]],initHandler(t,e=>{}))}return Tn.inst.sound.play(Number(t.sounds[a])),t.RidefireSkill(Number(i[1])),void n.playAni(ie[i[0]],initHandler(t,e=>{}))}var r=t.script.owner.getComponent(at).max_Attack,l=ea.skill.getSkillValue(r,t.eventdata.skill.tb);t.script.info.is_buff_power&&(l*=2),t.script.playAni(ie[i[0]],new Laya.Handler(t,()=>{t.rangeEffectSkill(Number(i[1])),Tn.inst.sound.play(Number(t.sounds[a]));for(var e=Ve.map.mptData.mptModel[J.ROLE].things,n=Qe.getSprite3DListByDistance(t.owner,e,t.eventdata.skill.tb.range),o=0;o<n.in.length;o++){if((u=(d=n.in[o]).getComponent(ht))&&u.info&&u.info.attribute)if(u.info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(l),u.info.attribute.thing_hp<=0){t.script.delTrigger(d);var r=t.owner.transform,h=d.transform,c=calcPosAngle({x:r.position.x,y:-r.position.z},{x:h.position.x,y:-h.position.z},!0);h.localRotationEulerY=c,h.localRotationEulerX=-30,mi.drop.addRomDrop(ta.get9GByTr(d)),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:27,count:1}),Li.BoomShow(d.transform.position.clone(),2),d.addComponent(Ia).run(),o--}else"0"!=t.skill.tb.hitAni?u.hit(t.skill.tb.hitAni):ss.vibrate(d),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0])}if(t.script.attackTrigger.isTrigger)for(o=0;o<t.script.attackTrigger.kinematics.length;o++){var d,u,p=t.script.attackTrigger.kinematics[o];if(u=(d=p.main).getComponent(ht))if(!u.info&&d.getComponent(gs))if((u=d.getComponent(gs)).info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(l),Li.showTipText(d.transform.position,l),Tt.play(d.transform,Number(10007),{size:3,time:1e3}),u.info.attribute.thing_hp<=0){t.script.delTrigger(d);r=t.owner.transform;4!=d.tb.type&&Es.AddFeixuTo(d.transform.position),mi.drop.addRomDrop(ta.get9GByTr(d)),1002!=Ve.level.select_id&&1005!=Ve.level.select_id&&1008!=Ve.level.select_id||cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:29,count:1}),Li.BoomShow(d.transform.position.clone(),2),setTimeout(()=>{d.removeSelf(),d.destroy()},100),o--}else ss.vibrate(d),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0]);else if(u.info.attribute.headview||u.info.attribute.initView(),u.info.attribute.hitHurt(l),Li.showTipText(d.transform.position,l),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[s,1,100,0]),u.info.attribute.thing_hp<=0){mi.drop.addRomDrop(ta.get9GByTr(d)),t.script.delTrigger(d);r=t.owner.transform,h=d.transform,c=calcPosAngle({x:r.position.x,y:-r.position.z},{x:h.position.x,y:-h.position.z},!0);if(h.localRotationEulerY=c,h.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:d.tbId,taskType:27,count:1}),Li.BoomShow(d.transform.position.clone(),2),null!=d.tb.monsterId)d.addComponent(Ia).run();else cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),setTimeout(()=>{d.removeSelf(),d.destroy()},100);o--}else"0"!=t.skill.tb.hitAni?u.hit(t.skill.tb.hitAni):ss.vibrate(d)}})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1})}}RidefireSkill(e){for(var t=this,i=Xe.getBodys(mi.device.currentMountGear,"group_firestart"),s=Xe.getBodys(mi.device.currentMountGear,"group_firedir"),a=0;i&&a<i.length;a++){var n=i[a].transform,o=s[a].transform;Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(t,e=>{if(null==t.owner.scene)return e.removeSelf(),void e.destroy();var i=n,s=o;i.position&&(e.transform.position=i.position.clone());var a=calcPosAngle({x:i.position.x,y:-i.position.z},{x:s.position.x,y:-s.position.z},!0);e.transform.localRotationEulerY=a,e.addComponent(Na).run({script:t.script,tb:t.script.info.tb,skill:t.eventdata.skill})}))}}rangeEffectSkill(e){var t=Xe.getBody(this.owner,"fong_effect");Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum["_prop_res_"+e+"_lh"]],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(this,e=>{var i=t.transform;i.position&&(e.transform.position=i.position.clone())}))}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Ga{static Intersection(e,t){var i=e.pos2.x-e.pos1.x,s=t.pos1.x-t.pos2.x,a=e.pos2.y-e.pos1.y,n=t.pos1.y-t.pos2.y,o=t.pos1.x-e.pos1.x,r=t.pos1.y-e.pos1.y,l=i*n-s*a;if(Math.abs(l)<1e-6)return null;var h=(n*o-s*r)/l,c=(-a*o+i*r)/l;return 0>h||h>1?null:0>c||c>1?null:{x:e.pos1.x+h*(e.pos2.x-e.pos1.x),y:e.pos1.y+h*(e.pos2.y-e.pos1.y)}}static rectIntersection(e,t){var i;return(i=Ga.Intersection(e,{pos1:t.p1,pos2:t.p2}))?i:(i=Ga.Intersection(e,{pos1:t.p2,pos2:t.p3}))?i:(i=Ga.Intersection(e,{pos1:t.p3,pos2:t.p4}))?i:(i=Ga.Intersection(e,{pos1:t.p4,pos2:t.p1}))||null}}class Ba extends wa{constructor(){super(...arguments),this.isRun=0,this.is_lock_more=!1,this.is_game_lock=!1,this.move_speed=0,this.startmove_speed=1e-5,this.maxmove_speed=.25,this.backmaxmove_speed=.244,this.add_speed=.004,this.friction=.001,this.brake_friction=.004,this.start_add_speed=.001,this.cur_angle=0,this.dq_speed=.4,this.dq_time=4,this.isdq=!1,this.turn=0,this.turnspeed=1.2,this.turnaspeed=.5,this.tweenloop=new Laya.Tween,this.isCarSound=120,this.camMove=!1,this.isPlaySound=!1}onEnable(){super.onEnable(),this.par=ea.scene.camera.parent,this.move_speed=this.startmove_speed;Ve.map.map.scale;this.maxmove_speed=.15,this.backmaxmove_speed=.144,this.start_add_speed=.001,this.add_speed=.001,this.friction=.001,this.brake_friction=.004,this.ai=this.owner.getComponent(Xa);var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.monitor(ge.game.MAP_REPLACE_FINISH,this.onMapReplaceCamera),this.checkSound(0),this.monitor(Ti.YG_REF,this.onYGDirRef),this.monitor(Ls.BTN_REF,this.onBtnDirRef),this.monitor(Ls.BTN_REFLR,this.BtnLR),this.monitor(Cs.BTNCARUP_DIR_REF,this.onBtnCarUpDirRef),this.monitor(Ms.CAR_REF+"_GO",this.onGoHandler),this.monitor(Ms.CAR_UP+"_GO",this.onGoUpHandler),this.monitor(Ms.CAR_REF+"_BREAK",this.onBreakHandler),this.monitor(Ms.CAR_UP+"_BREAK",this.onBreakUpHandler),this.monitor(Ms.CAR_REF+"_BRAKE",this.onBrakeHandler),this.monitor(Ms.CAR_UP+"_BRAKE",this.onBrakeUpHandler),this.monitor(se.INITCARSPEED,this.InitCarSpeed),this.monitor(se.DQ,this.useDq),this.monitor(se.StopCar,this.StopCar),this.setRoYTarget(mi.device.currentMountGear),this.ownerRoY=this.roYTargetTr.rotationEuler.y,ea.scene.cameraCode.endRoY=this.ownerRoY,ea.scene.cameraCode.currRoY=this.ownerRoY,this.lts=Xe.getBodys(mi.device.currentMountGear,"Tail_Wheel1"),this.StopLTEffect()}Shexian(){var e=new Laya.Vector2(ea.scene.ui.img_target.x,ea.scene.ui.img_target.y),t=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0));this.hits=[],this.hit=new Laya.HitResult,ea.scene.camera.viewportPointToRay(e,t),ea.scene.mainscene.physicsSimulation.rayCastAll(t,this.hits);for(var i=0;i<this.hits.length;i++)if("body"!=this.hits[i].collider.owner.parent.name){this.hit=this.hits[i];break}this.hit.succeeded&&(this.pointPos=this.hit.point,Es.LookFromAt1(this.pao,this.pointPos))}useDq(e=!1){var t=this;t.ai.movestate=Q.move,t.isCameraInit&&(t.RCamera(),t.isCameraInit=!1,Ve.game.carmove_camera=!1),e&&(cafe.event.dispatch(ge.game.ROLE_SPRINT,!0),t.isdq=!0,t.move_speed=t.maxmove_speed,t.DQEffect(),setTimeout(()=>{t.isdq&&(t.isdq=!1,t.StopDQEffect(),t.ai.movestate=Q.wait,cafe.event.dispatch(ge.game.ROLE_SPRINT,!1))},t.dq_time))}LTQEffect(){var e=Xe.getBodys(mi.device.currentMountGear,"luntaiqi");if(e.length>0)if(e[0].numChildren>0)for(let t=0;t<e.length;t++){e[t].getChildAt(0).particleSystem.play()}else for(let t=0;t<e.length;t++);}DQEffect(){var e=Xe.getBodys(mi.device.currentMountGear,"dqPos");if(e.length>0)for(let t=0;t<e.length;t++);}StopDQEffect(){var e=Xe.getBodys(mi.device.currentMountGear,"dqPos");if(e.length>0)for(let t=0;t<e.length;t++)e[t].numChildren>0&&e[t].removeChildren()}StopLTEffect(){if(this.lts.length>0)for(let e=0;e<this.lts.length;e++)this.lts[e].active=!1}PlayLTEffect(){if(this.lts.length>0)for(let e=0;e<this.lts.length;e++)this.lts[e].active=!0}StopCar(){this.isdq=!1,this.move_speed=0,this.ai.movestate=Q.wait}InitCarSpeed(){var e=this,t=a.device.getTbByDeviceId(mi.device.currentMountGear.tbId);e.move_speed=0,e.maxmove_speed=t.move_speed/1e5,e.backmaxmove_speed=t.backmaxmove_speed/1e5,e.add_speed=t.add_speed/1e5,e.friction=t.friction/1e5,e.dq_speed=t.dq_speed/1e5,e.dq_time=1e3*t.dq_time,e.MaxRoAngle=t.MaxRoAngle,e.JointRoSpeed=t.JointRoSpeed,e.ai.movestate=Q.wait,e.isPlaySound=!1,setTimeout(()=>{e.RCamera()},100),Ve.game.carmove_camera=!1,e.wheels=Xe.getBodys(mi.device.currentMountGear,"zx"),e.pao=Xe.getBody(mi.device.currentMountGear,"pao")}onYGDirRef(e){}BtnLR(e){if(this.wheels)switch(e){case 0:for(let e=0;e<this.wheels.length;e++){this.wheels[e].transform.localRotationEulerY=0}break;case 1:for(let e=0;e<this.wheels.length;e++){this.wheels[e].transform.localRotationEulerY=25}break;case 2:for(let e=0;e<this.wheels.length;e++){this.wheels[e].transform.localRotationEulerY=-25}}}onBtnDirRef(e){if(!(this.is_game_lock&&e.dir_angle<=0)&&(this.PlayLTEffect(),e.dir_angle>0&&mi.device.currentMountGear&&this&&(this.is_game_lock=!1),this.ai&&this&&mi.device.currentMountGear)){var t=Math.floor(e.dir_angle/540*100)/100,i=Math.floor(t*(this.MaxRoAngle+this.JointRoSpeed))/1e3;this.move_speed!=this.startmove_speed&&(this.ai.movestate==Q.back||this.script.info.movestate==Q.back?(this.rotateY(i),i>.1?(this.turn=2,this.RigthCamera()):i<-.1&&(this.turn=1,this.LeftCamera())):(this.rotateY(-i),i>.1?(this.turn=2,this.RigthCamera()):i<-.1&&(this.turn=1,this.LeftCamera())))}}onBtnCarUpDirRef(e){this.turn=0,this.StopLTEffect()}onGoHandler(){if(this.ai&&this&&mi.device.currentMountGear){var e=mi.device.currentMountGear.transform;0!=this.move_speed&&this.move_speed!=this.startmove_speed||this.LTQEffect(),this.cur_angle=e.localRotationEulerY,this.is_lock_more=!1,this.isPlaySound=!0,this.ai.movestate=Q.move,this.script.info.movestate=Q.move,this.isCameraInit&&(this.RCamera(),this.isCameraInit=!1,Ve.game.carmove_camera=!1)}}onGoUpHandler(){this.ai&&this&&mi.device.currentMountGear&&(this.StopAu(this.sound),this.is_lock_more=!0,this.isPlaySound=!1,this.ai.movestate=Q.wait,this.script.info.movestate=Q.wait)}onBreakHandler(){if(this.ai&&this&&mi.device.currentMountGear){var e=mi.device.currentMountGear.transform;this.cur_angle=e.localRotationEulerY,this.is_lock_more=!1,this.ai.movestate=Q.back,this.script.info.movestate=Q.back,this.isCameraInit&&(this.RCamera(),console.log("onBreakHandler=============="),this.isCameraInit=!1,Ve.game.carmove_camera=!1)}}onBreakUpHandler(){this.ai&&this&&mi.device.currentMountGear&&(this.is_lock_more=!0,this.StopAu(this.sound))}PlayAu(e,t,i){this.isCarSound++,this.isCarSound>=t&&(this.isCarSound=0,Tn.inst.sound.play(i))}StopAu(e){this.isCarSound=120}PlaySound(){mi.device.currentMountGear.tbId}onBrakeHandler(){this.ai&&(this.ai.isBrake=!0)}onBrakeUpHandler(){this.ai&&(this.ai.isBrake=!1)}onMapReplaceCamera(){if(mi.device.currentMountGear){var e=mi.device.currentMountGear.transform;ea.scene.cameraCode.playXGroup.transform.localRotationEulerY=e.localRotationEulerY;var t=ea.scene.cameraCode.playXGroup.transform,i=ea.scene.cameraCode.playYGroup.transform;this.croey=t.localRotationEulerY,this.croex=-i.localRotationEulerX,this.roey=t.localRotationEulerY,this.roex=-i.localRotationEulerX}}initAct(e){super.initAct(e);var t=mi.device.currentMountGear.transform.position,i=new Laya.Vector3(t.x,t.y+1.2,t.z),s=new Laya.Vector3(t.x,-1,t.z),a=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(i,s,a)){for(var n=0,o=0;o<a.length;o++){var r=a[o];"dmove_hit"!=r.collider.owner.name&&("skill_hit"!=r.collider.owner.name&&"bullet_hit"!=r.collider.owner.name&&(n=Math.max(n,r.point.y)))}this.script.landY=n}if(mi.device&&mi.device.currentMountGear){var l=mi.device.currentMountGear.tb;if("0"!=l.roleShangani&&this.script.ani.state==l.roleShangani||this.script.playAni(l.roleani),Ve.game.isRideZuoqi){var h=mi.device.currentMountGear.getComponent(fa);if(h)h.playAni(ie.idle);else mi.device.currentMountGear.getComponent(ba).playAni(ie.idle)}}else this.script.playAni(ie.idle)}onSettingChange(){}checkSound(e){}refRotationEuler(e,t){this.croey=e,this.croex=t;let i=mi.device.currentMountGear.transform,s=mi.device.currentMountGear.getChildByName("mode").transform;i.localRotationEulerY=this.roey,s.localRotationEulerX=-this.roex,this.roex>=60?this.roex=60:this.roex<=-60&&(this.roex=-60);var a=ea.scene.cameraCode.playXGroup.transform,n=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),a.localRotationEulerY=this.croey,n.localRotationEulerX=-this.croex}cameraRo(){this.camMove=!0;var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/8,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}run(e){}LeftCamera(){}RigthCamera(){}RCamera(){}Camera(){if(this.isdq)this.CameraDq();else{var e=Xe.getBody(mi.device.currentMountGear,"group_camera");Qe.isDistanceIn(ea.scene.camera.transform,e.transform,1)?(ea.scene.camera.transform.position=e.transform.position,ea.scene.camera.transform.rotationEuler=new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180,mi.device.currentMountGear.transform.rotationEuler.z)):this.Tween(ea.scene.camera,e,new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180,mi.device.currentMountGear.transform.rotationEuler.z),this.turnspeed,this.turnaspeed)}}CameraL(){var e=Xe.getBody(mi.device.currentMountGear,"group_camera_left");Qe.isDistanceIn(ea.scene.camera.transform,e.transform,1)?(ea.scene.camera.transform.position=e.transform.position,ea.scene.camera.transform.rotationEuler=new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180-25,mi.device.currentMountGear.transform.rotationEuler.z)):this.Tween(ea.scene.camera,e,new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180-25,mi.device.currentMountGear.transform.rotationEuler.z),this.turnspeed,this.turnaspeed)}CameraR(){var e=Xe.getBody(mi.device.currentMountGear,"group_camera_right");Qe.isDistanceIn(ea.scene.camera.transform,e.transform,1)?(ea.scene.camera.transform.position=e.transform.position,ea.scene.camera.transform.rotationEuler=new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180+25,mi.device.currentMountGear.transform.rotationEuler.z)):this.Tween(ea.scene.camera,e,new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180+25,mi.device.currentMountGear.transform.rotationEuler.z),this.turnspeed,this.turnaspeed)}CameraDq(){var e=Xe.getBody(mi.device.currentMountGear,"group_camera_dq");Qe.isDistanceIn(ea.scene.camera.transform,e.transform,1)?(ea.scene.camera.transform.position=e.transform.position,ea.scene.camera.transform.rotationEuler=new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x,mi.device.currentMountGear.transform.rotationEuler.y-180,mi.device.currentMountGear.transform.rotationEuler.z)):this.Tween(ea.scene.camera,e,new Laya.Vector3(mi.device.currentMountGear.transform.rotationEuler.x-15,mi.device.currentMountGear.transform.rotationEuler.y-180,mi.device.currentMountGear.transform.rotationEuler.z),this.turnspeed,this.turnaspeed)}Tween(e,t,i,s=.1,a=1){var n=e.transform.position,o=Math.abs(this.move_speed);n.x>t.transform.position.x?e.transform.position=new Laya.Vector3(n.x-(n.x-t.transform.position.x)*o/s,n.y,n.z):n.x<t.transform.position.x&&(e.transform.position=new Laya.Vector3(n.x+(t.transform.position.x-n.x)*o/s,n.y,n.z)),n.z>t.transform.position.z?e.transform.position=new Laya.Vector3(n.x,n.y,n.z-(n.z-t.transform.position.z)*o/s):n.z<t.transform.position.z&&(e.transform.position=new Laya.Vector3(n.x,n.y,n.z+(t.transform.position.z-n.z)*o/s)),e.transform.position=new Laya.Vector3(n.x,t.transform.position.y,n.z);var r=e.transform.rotationEuler;r.y>i.y?e.transform.rotationEuler=new Laya.Vector3(r.x,r.y-a,r.z):r.y<i.y&&(e.transform.rotationEuler=new Laya.Vector3(r.x,r.y+a,r.z))}onFrameRun(){if(ea.scene.GamePause)return this.ai.movestate=Q.wait,void(this.move_speed=0);let e=this;if(e.owner&&!ea.scene.isGameStop&&!e.is_game_lock&&mi.device.currentMountGear){e.is_lock_more&&e.pao&&e.cameraRo();var t=!1;e.isPlaySound&&e.PlaySound(),this.pao&&this.Shexian(),ea.scene.player.ani.state!=ie.fuckcar&&ea.scene.player.ani.state!=ie.motuo&&ea.scene.player.ani.state!=ie.xiacar&&ea.scene.player.ani.state!=ie.xiamotuo&&ea.scene.player.ani.state!=ie.fuckmotuo&&(e.ai.movestate!=Q.wait?ea.scene.player.playAni(mi.device.currentMountGear.tb.roleani):70064==mi.device.currentMountGear.tb.deviceId?ea.scene.player.playAni("dancheidle"):ea.scene.player.playAni(ie.idle));var i,s,a=mi.device.currentMountGear.getComponent(ht),n=mi.device.currentMountGear;if(0==e.move_speed){if(mi.device.currentMountGear&&mi.device.currentMountGear.getComponent(ht).anis)for(var o=mi.device.currentMountGear.getComponent(ht).anis,r=0;r<o.length;r++)o[r].play(ie.idle)}else if(mi.device.currentMountGear&&mi.device.currentMountGear.getComponent(ht).anis)for(o=mi.device.currentMountGear.getComponent(ht).anis,r=0;r<o.length;r++)o[r].play(ie.run);if(e.ai&&a.moveTrigger&&a.moveTrigger.isTrigger&&(e.ai.movestate==Q.move||e.move_speed>0||e.isdq))return t=!0,!0,e.move_speed=0,void(e.isdq&&(e.isdq=!1,e.StopDQEffect(),e.ai.movestate=Q.wait,cafe.event.dispatch(ge.game.ROLE_SPRINT,!1)));if(e.ai&&a.bmoveTrigger&&a.bmoveTrigger.isTrigger&&(e.ai.movestate==Q.back||e.move_speed<0))return t=!0,!0,void(e.move_speed=0);if(e.is_lock_more||e.ai.movestate!=Q.move&&e.script.info.movestate!=Q.move&&!e.isdq)if(e.is_lock_more||e.ai.movestate!=Q.back&&e.script.info.movestate!=Q.back){if(e.move_speed>e.startmove_speed){if(Ve.game.savePos||(t=!1),t){if((m=Ga.rectIntersection({pos1:{x:n.transform.position.x,y:n.transform.position.z},pos2:Ve.game.savePos},Ve.game.saveRectV4))||(m=Ve.game.savePos),i=180*(calcPosAngle({x:n.transform.position.x,y:-n.transform.position.z},{x:m.x,y:-m.y})+90*Math.PI/180)/Math.PI,1!=(l=Qe.getAngleState(n.transform.localRotationEulerY,Qe.to3DAngle(i)))){if(2==l){let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}{let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}}s=-.02,e.move_speed=-e.move_speed/2}t||(e.move_speed-=e.friction,e.move_speed<=e.startmove_speed&&(e.move_speed=e.startmove_speed),s=e.move_speed)}if(e.move_speed<e.startmove_speed){if(Ve.game.savePos||(t=!1),t){(m=Ga.rectIntersection({pos1:{x:n.transform.position.x,y:n.transform.position.z},pos2:Ve.game.savePos},Ve.game.saveRectV4))||(m=Ve.game.savePos),i=180*(calcPosAngle({x:n.transform.position.x,y:-n.transform.position.z},{x:m.x,y:-m.y})+90*Math.PI/180)/Math.PI;let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}t||(e.move_speed+=e.friction,e.move_speed>=e.startmove_speed&&(e.move_speed=e.startmove_speed),s=e.move_speed)}}else{if(Ve.game.savePos||(t=!1),t){(m=Ga.rectIntersection({pos1:{x:n.transform.position.x,y:n.transform.position.z},pos2:Ve.game.savePos},Ve.game.saveRectV4))||(m=Ve.game.savePos),i=180*(calcPosAngle({x:n.transform.position.x,y:-n.transform.position.z},{x:m.x,y:-m.y})+90*Math.PI/180)/Math.PI;let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}t||(e.move_speed>e.startmove_speed?e.move_speed-=e.add_speed+e.friction:e.move_speed==e.startmove_speed?e.move_speed-=e.start_add_speed:e.move_speed-=e.add_speed,e.move_speed<=-e.backmaxmove_speed&&(e.move_speed=-e.backmaxmove_speed),s=e.move_speed)}else{if(Ve.game.savePos||(t=!1),t){var l;if((m=Ga.rectIntersection({pos1:{x:n.transform.position.x,y:n.transform.position.z},pos2:Ve.game.savePos},Ve.game.saveRectV4))||(m=Ve.game.savePos),i=180*(calcPosAngle({x:n.transform.position.x,y:-n.transform.position.z},{x:m.x,y:-m.y})+90*Math.PI/180)/Math.PI,1!=(l=Qe.getAngleState(n.transform.localRotationEulerY,Qe.to3DAngle(i)))){if(2==l){let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}{let e=n.transform,t=Qe.calcTrajectoryParamsone(e,-.1,i);return void(e.localPosition=new Laya.Vector3(t.pos.x,0,t.pos.y))}}e.move_speed>=.05&&Lt.vibrateShort(),s=-.02,e.move_speed=-e.move_speed/2}t||(e.move_speed<e.startmove_speed?e.move_speed+=e.add_speed+e.friction:e.move_speed==e.startmove_speed?e.move_speed+=e.start_add_speed:e.move_speed+=e.add_speed,e.move_speed>=e.maxmove_speed&&(e.move_speed=e.maxmove_speed),s=e.move_speed)}if(1==e.ai.isBrake&&(e.move_speed=e.startmove_speed,s=e.move_speed),e.move_speed!=e.startmove_speed){let t;(null==e.cur_angle||e.isdq||0!=e.move_speed)&&(e.cur_angle=n.transform.localRotationEulerY),i||(i=e.cur_angle),e.isdq?(e.move_speed=e.maxmove_speed,t=e.dq_speed):t=s;let a=mi.device.currentMountGear.transform;var h=a.localPositionY,c=Qe.calcTrajectoryParamstwo(a.position,t,i),d=Qe.calcTrajectoryParamstwo(a.position,t+.8,i),u=c.pos,p=(d.pos,-5);ta.MainRoleRay(new Laya.Vector3(u.x,a.position.y+1,u.y),new Laya.Vector3(u.x,-10,u.y),e=>{p<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),p=Math.max(p,e.point.y)},()=>{e.script.landY=p,h+=Math.round((e.script.landY-h)/4*1e3)/1e3});e.cur_angle;let o=Qe.calcTrajectoryParamsone(a,t,i);e.play_angle=o.angle;let r=Ve.map.mptData.gridHeightNum,l=Ve.map.mptData.gridWidthNum,_=Ve.map.mptData.gridX,v=Ve.map.mptData.gridY;var m={x:o.pos.x-o.p.x,y:o.p.y-o.pos.y},g=Qe.calcTrajectoryParamstwo(a.localPosition,t+1,i);oi.singleton.mptData.getPointFlag({localPosition:new Laya.Vector3(g.pos.x,0,g.pos.y)});Ve.game.isStartGame&&!Ve.game.isPauseGame&&(a.localPosition=new Laya.Vector3(o.pos.x,h,o.pos.y));var y=a.localPosition.clone();y.x>r&&(y.x=r),y.z>l&&(y.z=l),y.x<_&&(y.x=_),y.z<v&&(y.z=v),a.localPosition=y.clone();var f=Ve.map.mptData.checkThing(n,.5);if(f&&f.tb){if(e.tiggerDataStr!=f.dataStr)switch(slog("来来来",f.dataStr),e.tiggerDataStr=f.dataStr,f.dthing.type){case 9:cafe.event.dispatch(ge.game.TOOLCMD,f.dataStr)}}else e.tiggerDataStr=null}}}onDestroy(){}}class Ha extends wa{constructor(){super(...arguments),this.isRun=0,this.isCarSound=120,this.time=0,this.isTurn=!1,this.isZlSound=60}onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.monitor(ge.game.MAP_REPLACE_FINISH,this.onMapReplaceCamera),this.monitor(ge.game.PENPENCHEPLAYERMOVE,this.PnepenCheMoveFrom),this.checkSound(0)}PnepenCheMoveFrom(e){this.from=e,this.isTurn=!0,this.time=0,ss.vibrate(ea.scene.camera,.1)}PnepenCheMove(){if(mi.device.currentMountGear){var e=mi.device.currentMountGear.transform.position,t=this.from.position,i=mi.device.currentMountGear.tb.move_speed/1e5*2,s=(posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),posToAngleDist({x:t.x,y:t.z},{x:e.x,y:e.z})),a=calcAngleDist({x:e.x,y:e.z},i,s.a);calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);mi.device.currentMountGear.transform.position=new Laya.Vector3(a.x,0,a.y)}}onMapReplaceCamera(){if(ea.scene.player&&ea.scene.player.owner){var e=ea.scene.player.owner.transform;ea.scene.cameraCode.playXGroup.transform.localRotationEulerY=e.localRotationEulerY;var t=ea.scene.cameraCode.playXGroup.transform,i=ea.scene.cameraCode.playYGroup.transform;this.croey=t.localRotationEulerY,this.croex=-i.localRotationEulerX,this.roey=t.localRotationEulerY,this.roex=-i.localRotationEulerX}}initAct(e){super.initAct(e);var t=this.owner.transform.position,s=new Laya.Vector3(t.x,t.y+1.2,t.z),a=new Laya.Vector3(t.x,-1,t.z),n=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(s,a,n)){for(var o=0,r=0;r<n.length;r++){var l=n[r];"dmove_hit"!=l.collider.owner.name&&("skill_hit"!=l.collider.owner.name&&"bullet_hit"!=l.collider.owner.name&&(o=Math.max(o,l.point.y)))}this.script.landY=o}if(mi.device&&mi.device.currentMountGear){var h=mi.device.currentMountGear.tb;if(this.script.ani.state=h.roleani,Ve.game.isRideZuoqi){var c=mi.device.currentMountGear.getComponent(fa);if(c)c.playAni(ie.idle);else mi.device.currentMountGear.getComponent(ba).playAni(ie.idle)}}else this.script.playAni(ie.idle);"1"!=i.read("firesLOAD")&&(i.save("lnnGuide","0"),this.owner.transform.position=new Laya.Vector3(463,.12,288),i.save("firesLOAD","1"))}onSettingChange(){}checkSound(e){}refRotationEuler(e,t){this.croey=e,this.croex=t;let i=this.owner.transform,s=this.owner.getChildByName("mode").transform;i.localRotationEulerY=this.roey,s.localRotationEulerX=-this.roex,this.roex>=60?this.roex=60:this.roex<=-60&&(this.roex=-60);var a=ea.scene.cameraCode.playXGroup.transform,n=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),a.localRotationEulerY=this.croey,n.localRotationEulerX=-this.croex}onYGHandler(e){if(this.script.ani.speed=1,"che"==this.script.ani.state)return!1;if(!super.onYGHandler(e)){if(mi.device.currentMountGear){var t=mi.device.currentMountGear.tb;if(this.script.ani.state=t.roleani,Ve.game.isRideZuoqi)if(i=mi.device.currentMountGear.getComponent(fa))i.playAni(ie.idle);else mi.device.currentMountGear.getComponent(ba).playAni(ie.idle);return!1}return this.isRun=0,!1}if(this.isRun++,this.script.ani.speed=this.script.move_anispeed,mi.device.currentMountGear){var i;t=mi.device.currentMountGear.tb;if(this.script.ani.state=t.roleani,Ve.game.isRideZuoqi)if(i=mi.device.currentMountGear.getComponent(fa))i.playAni(ie.run);else mi.device.currentMountGear.getComponent(ba).playAni(ie.run)}else this.script.ani.state==ie.idle?this.script.ani.state=ie.walk:this.script.ani.state==ie.walk&&this.isRun>30&&(this.script.ani.state=ie.run),this.isZlSound++,this.isZlSound>=60&&(this.isZlSound=0);var s=calcPosAngle(e.center_pos,e.pos),a=calcPosAngle({x:e.center_pos.x,y:-e.center_pos.y},{x:e.pos.x,y:-e.pos.y}),n=(Math.round(180*s/Math.PI),Math.round(180*a/Math.PI)+90),o=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,r=ea.scene.camera.transform;return o.localRotationEulerY=r.rotationEuler.y+n,this.script.info.cur_angleY=o.localRotationEulerY,this.script.info.movestate=Q.move,!0}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/8,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}run(e){}onFrameRun(){if(!ea.scene.GamePause&&this.active&&this.script.info.is_move&&Ve.map.mptData){if(this.cameraRo(),this.isTurn)return this.time++,this.time>=10&&(this.isTurn=!1,this.time=0),void this.PnepenCheMove();var e=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(mi.device.currentMountGear&&(mi.device.currentMountGear.tbId>=70003&&mi.device.currentMountGear.tbId<=70007||mi.device.currentMountGear.tbId>=70020&&mi.device.currentMountGear.tbId<=70030)&&(this.isCarSound++,this.isCarSound>=120&&(this.isCarSound=0)),e&&e.moveTrigger&&e.moveTrigger.isTrigger){if(!0,e.moveTrigger.kinematics.length>0&&null==e.moveTrigger.kinematics[0].parent&&(ea.scene.player.owner.getComponent(Ni).delTrigger(e.moveTrigger.kinematics[0]),e.moveTrigger.kinematics=[],e.moveTrigger.isTrigger=!1),this.script.ani.state!=ie.jump1&&this.script.ani.state!=ie.jump2&&this.script.ani.state!=ie.zhuiluo){let e=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;e.localPositionY+=Math.round((this.script.landY-e.localPositionY)/4*1e3)/1e3}}else if(!this.script.ani.state||this.script.ani.state==ie.idle||this.script.ani.state==ie.jump2||this.script.ani.state==ie.run||this.script.ani.state==ie.walk||this.script.ani.state==ie.run2||this.script.ani.state==ie.ride1||this.script.ani.state==ie.ride2||this.script.ani.state==ie.ride||this.script.ani.state==ie.qi){var t,i=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed;if(this.script.info.movestate==Q.move||this.script.info.movestate==Q.back){let e;mi.device.currentMountGear&&(mi.device.currentMountGear.getComponent(ht).ani&&mi.device.currentMountGear.getComponent(ht).ani.play(ie.run),mi.device.currentMountGear.getComponent(ht).ani2&&mi.device.currentMountGear.getComponent(ht).ani2.play(ie.run)),t=this.script.info.cur_angleY,e=this.script.info.movestate==Q.back?-i:i,this.script.info.is_add_speed&&(e=mi.device.currentMountGear?2*i:this.script.info.tb.roleStartAddMoveSpeed*Ve.map.map.scale/1e5,this.script.ani.state==ie.walk&&(this.script.ani.state=ie.run)),this.script.ani.state==ie.jump2&&(e*=2),this.isRun<30&&(e/=2);let m=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var s=m.localPositionY,a=Qe.calcTrajectoryParamstwo(m.position,mi.device.currentMountGear?e+1.2:e,t).pos,n=new Laya.Vector3(a.x,m.position.y+.8,a.y),o=new Laya.Vector3(a.x,-5,a.y),r=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(n,o,r)){for(var l=-5,h=0;h<r.length;h++){var c=r[h];"equip"!=c.collider.owner.name&&("qiuCube"!=c.collider.owner.name&&"dmove_hit"!=c.collider.owner.name&&"group_uninstall"!=c.collider.owner.name&&"skill_hit"!=c.collider.owner.name&&"bullet_hit"!=c.collider.owner.name&&"group_hit"!=c.collider.owner.name&&"group_check"!=c.collider.owner.name&&"attack_hit"!=c.collider.owner.name&&(l<c.point.y&&(ea.scene.hitResultNode=c.collider.owner.main),l=Math.max(l,c.point.y)))}this.script.ani.state==ie.jump2?this.script.landY=l:(this.script.landY=l,!mi.device.currentMountGear&&s-this.script.landY>.3?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):s+=Math.round((this.script.landY-s)/4*1e3)/1e3)}this.script.info.cur_angleY;let g=Qe.calcTrajectoryParamsone(m,e,t);this.play_angle=g.angle;let y=Ve.map.mptData.gridHeightNum,f=Ve.map.mptData.gridWidthNum,_=Ve.map.mptData.gridX,v=Ve.map.mptData.gridY;g.pos.x,g.p.x,g.p.y,g.pos.y;var d=Qe.calcTrajectoryParamstwo(m.localPosition,e+1,t);oi.singleton.mptData.getPointFlag({localPosition:new Laya.Vector3(d.pos.x,0,d.pos.y)});Ve.game.isStartGame&&!Ve.game.isPauseGame&&(m.localPosition=new Laya.Vector3(g.pos.x,s,g.pos.y));var u=m.localPosition.clone();u.x>y&&(u.x=y),u.z>f&&(u.z=f),u.x<_&&(u.x=_),u.z<v&&(u.z=v),m.localPosition=u.clone();var p=Ve.map.mptData.checkThing(this.owner,.5);if(p&&p.tb){if(this.tiggerDataStr!=p.dataStr)switch(slog("来来来",p.dataStr),this.tiggerDataStr=p.dataStr,p.dthing.type){case 9:cafe.event.dispatch(ge.game.TOOLCMD,p.dataStr)}}else this.tiggerDataStr=null}else mi.device.currentMountGear&&(mi.device.currentMountGear.getComponent(ht).ani&&mi.device.currentMountGear.getComponent(ht).ani.play(ie.idle),mi.device.currentMountGear.getComponent(ht).ani2&&mi.device.currentMountGear.getComponent(ht).ani2.play(ie.idle))}}}onDestroy(){}}class Oa extends ra{onEnable(){super.onEnable()}onUseSkillHandler(e){Ve.game.MonsterStop||ea.scene.GamePause||this.script.ani.state!=ie.lutou&&this.script.ani.state!=ie.chuizi&&this.script.ani.state!=ie.skill&&(this.eventdata=e,this.isUse=e.isDown,this.eventdata.pos=this.pos)}onFrameRun(){let e=this;if(!e.script.owner)return;mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script;t&&t.uMoveTrigger&&t.uMoveTrigger.isTrigger&&t.uMoveTrigger.kinematics.length>0&&null==t.uMoveTrigger.kinematics[0].parent&&(t.delTrigger(t.uMoveTrigger.kinematics[0]),t.uMoveTrigger.kinematics=[],t.uMoveTrigger.isTrigger=!1),0==ea.scene.GamePause&&e.isUse&&t&&t.uMoveTrigger&&!t.uMoveTrigger.isTrigger&&cafe.event.dispatch(ge.game.USE_JUMP_ACTION,e.eventdata)}destroy(){super.destroy(),console.log("跳跃回收成功")}}class za extends wa{constructor(){super(...arguments),this.endupcd=0,this.gg=!0}onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.monitor(ge.game.MAP_REPLACE_FINISH,this.onMapReplaceCamera)}onMapReplaceCamera(){if(ea.scene.player&&ea.scene.player.owner){var e=ea.scene.player.owner.transform;ea.scene.cameraCode.playXGroup.transform.localRotationEulerY=e.localRotationEulerY;var t=ea.scene.cameraCode.playXGroup.transform,i=ea.scene.cameraCode.playYGroup.transform;this.croey=t.localRotationEulerY,this.croex=-i.localRotationEulerX,this.roey=t.localRotationEulerY,this.roex=-i.localRotationEulerX}}initAct(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;super.initAct(e);var i=this.owner.transform.position,s=new Laya.Vector3(i.x,i.y+1.2,i.z),a=new Laya.Vector3(i.x,-1,i.z),n=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(s,a,n)){for(var o=0,r=0;r<n.length;r++){var l=n[r];"dmove_hit"!=l.collider.owner.name&&("group_hit"!=l.collider.owner.name&&"umove_hit"!=l.collider.owner.name&&(o=Math.max(o,l.point.y)))}t.landY?t.landY=o:t.landY=i.y}t.info.actionstate=$.land,t.playAni(ie.idle)}onYGHandler(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(!super.onYGHandler(e))return!1;t.ani.state==ie.idle&&(t.ani.state=ie.run);var i=calcPosAngle(e.center_pos,e.pos),s=calcPosAngle({x:e.center_pos.x,y:-e.center_pos.y},{x:e.pos.x,y:-e.pos.y}),a=Math.round(180*i/Math.PI)+180,n=Math.round(180*s/Math.PI)+90,o=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,r=ea.scene.camera.transform;return t.info.actionstate==$.land?(o.localRotationEulerY=r.rotationEuler.y+n,t.info.cur_angleY=o.localRotationEulerY):(slog("angleE : "+a),this.dir=ta.get4DirByAngle(a)),t.info.movestate=Q.move,!0}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;e&&t&&(this.croey+=(this.roey-this.croey)/14,this.croex+=(this.roex-this.croex)/14,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex)}onFrameRun(){if(!ea.scene.GamePause&&this.active&&Ve.map.mptData){var e=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):this.script;if(e.info.is_move){this.cameraRo();var t;if(e.info.actionstate==$.land){if(e&&e.moveTrigger&&e.moveTrigger.isTrigger&&e.moveTrigger.kinematics.length>0){for(let t=0;t<e.moveTrigger.kinematics.length;t++){var i=e.moveTrigger.kinematics[t],s=i.main,a=Ve.game.fuhuoTime,n=(new Date).getTime();if(s&&-1!=s.name.indexOf("npc"))return;if(s&&s.tb.funcType&&1008==s.tb.funcType){var o=s.transform.localPosition.clone();Tn.inst.sound.play(15047),Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_10008_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(o.x,o.y+1,o.z),ea.scene.cameraCode.zhengDong(),setTimeout(()=>{e.removeSelf(),e.destroy()},500)})),e.dMoveTrigger.ClearTrigger(),e.moveTrigger.ClearTrigger(),s.removeSelf(),s.destroy()}else("group_hit"==i.name||s&&37203==s.thingId||s&&37439==s.thingId)&&n-a>5e3&&(ea.scene.GamePause=!0,e.moveTrigger.ClearTrigger(),cafe.event.dispatch(se.GAME_PLAYER_DIE))}return}if(e.ani.state&&e.ani.state!=ie.idle&&e.ani.state!=ie.baoqidaiji&&e.ani.state!=ie.baoqi&&e.ani.state!=ie.paidle&&e.ani.state!=ie.pa&&e.ani.state!=ie.jump2&&e.ani.state!=ie.zhuiluo&&e.ani.state!=ie.run&&e.ani.state!=ie.run2&&e.ani.state!=ie.ride1&&e.ani.state!=ie.ride2&&e.ani.state!=ie.ride){if(e.ani.state!=ie.jump1&&e.ani.state!=ie.jump2&&e.ani.state!=ie.zhuiluo){let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;t.localPositionY+=Math.round((e.landY-t.localPositionY)/4*1e3)/1e3}return}var r=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:e.info.speed;if(e.info.movestate==Q.move||e.info.movestate==Q.back){let i;t=e.info.cur_angleY,i=e.info.movestate==Q.back?-r:r,e.info.is_add_speed||Ve.game.addSpeedBuff?(i=mi.device.currentMountGear?1.2*r:e.info.tb.roleStartAddMoveSpeed*Ve.map.map.scale/1e5,1.5!=e.ani.speed&&(e.ani.speed=1.5)):1!=e.ani.speed&&(e.ani.speed=1),e.ani.state!=ie.jump2&&e.ani.state!=ie.zhuiluo||(i*=1.2),Ve.game.isYinliao&&(i*=2),Ve.game.isTrampoline&&(i*=.8),Ve.game.isjiasu&&(i*=2,e.ani.speed=2),Ve.game.isjiansu&&(i*=.3,e.ani.speed),Ve.game.isbig&&(e.ani.speed=.7),Ve.game.issmall&&(i*=.7,e.ani.speed=1.2),Ve.game.isjiasu||Ve.game.isjiansu||Ve.game.isbig||Ve.game.issmall||(e.ani.speed=1);let s=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var l=s.localPositionY,h=Qe.calcTrajectoryParamstwo(s.position,i,t),c=Qe.calcTrajectoryParamstwo(s.position,i+.8,t),d=h.pos,u=(c.pos,-5);ta.MainRoleRay(new Laya.Vector3(d.x,s.position.y+.5,d.y),new Laya.Vector3(d.x,-5,d.y),e=>{u<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),u=Math.max(u,e.point.y)},()=>{e.ani.state==ie.jump2||e.ani.state==ie.zhuiluo?e.landY=u:(e.landY=u,!mi.device.currentMountGear&&l-e.landY>.3?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):l+=Math.round((e.landY-l)/4*1e3)/1e3)});e.info.cur_angleY;let a=Qe.calcTrajectoryParamsone(s,i,t);this.play_angle=a.angle;let n=Ve.map.mptData.gridHeightNum,o=Ve.map.mptData.gridWidthNum,y=Ve.map.mptData.gridX,f=Ve.map.mptData.gridY;a.pos.x,a.p.x,a.p.y,a.pos.y;var p=Qe.calcTrajectoryParamstwo(s.localPosition,i+1,t);oi.singleton.mptData.getPointFlag({localPosition:new Laya.Vector3(p.pos.x,0,p.pos.y)});Ve.game.isStartGame&&!Ve.game.isPauseGame&&(s.localPosition=new Laya.Vector3(a.pos.x,l,a.pos.y));var m=s.localPosition.clone();m.x>n&&(m.x=n),m.z>o&&(m.z=o),m.x<y&&(m.x=y),m.z<f&&(m.z=f),s.localPosition=m.clone();var g=Ve.map.mptData.checkThing(this.owner,.5);if(g&&g.tb){if(this.tiggerDataStr!=g.dataStr)switch(slog("来来来",g.dataStr),this.tiggerDataStr=g.dataStr,g.dthing.type){case 9:cafe.event.dispatch(ge.game.TOOLCMD,g.dataStr)}}else this.tiggerDataStr=null}}}}}destroy(){super.destroy()}onDestroy(){}}class Va extends ra{constructor(){super(...arguments),this.islock=!1}onEnable(){super.onEnable()}onUseSkillHandler(e){this.eventdata=e,this.isUse=e.isDown,this.script.ani.state==ie.run&&this.isUse?this.script.ani.state=ie.qianxing:this.script.ani.state==ie.idle&&this.isUse?this.script.ani.state=ie.qianxingidle:-1==this.script.ani.state.indexOf("qianxing")||this.isUse||(this.script.ani.state==ie.qianxing?this.script.ani.state=ie.run:this.script.ani.state==ie.qianxingidle&&(this.script.ani.state=ie.idle)),slog("使用技能:",this.eventdata.skill.skillId)}onUpdate(){0==ea.scene.GamePause&&this.isUse?ea.scene.player.isQingXing=!0:ea.scene.player.isQingXing=!1}destroy(){super.destroy(),console.log("下潜回收成功")}}class Fa extends ra{constructor(){super(...arguments),this.ishit=!1,this.hitNum=0,this.isqiang=!1,this.islock=!1,this.locktime=0,this.targetMode={},this.roleidList=[11810066,11810067,11810068,11810069,11810070,11810071]}onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;"1"==i.read("firstAtt")&&(ea.scene.ui.firstAtt.visible=!1);var s=(new Date).getTime()-t.locktime;if(!(t.islock&&s<1e3)){t.islock=!0,t.locktime=(new Date).getTime(),t.eventdata=e,slog("使用技能:",e.skill.skillId);var a=Xe.getBody(ea.scene.player.owner,"80003");a?(a.active=!1,a.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80003_lh],ea.scene.player.owner,1,null,initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)})),t.script.ani.speed=Number(t.speeds[t.index]);var n=t.anis[t.index].split(":"),o=ea.scene.player.owner.transform.position.clone();t.script.playAni(n[0],initHandler(t,e=>{if(t.targetMode[11810073]){var i=t.targetMode[11810073].clone();ea.scene.mainscene.getChildByName("map").addChild(i),i.transform.position=o,Ve.game.wawaHeight&&(i.transform.localScale=new Laya.Vector3(1.6,1.6,1.6)),i.transform.rotationEuler=ea.scene.player.owner.transform.rotationEuler.clone();var s=i.getComponent(Laya.Animator);s&&s.play("modeldie"),t.script.moveTrigger.ClearTrigger(),Laya.timer.once(100,t,()=>{t.script.playAni(ie.idle),Ve.game.setPlayerFuHuo()})}else Laya.Sprite3D.load("res/res3D/role/"+11810073..toString()+".lh",initHandler(t,e=>{t.targetMode[11810073]=e.clone();var i=ea.scene.mainscene.getChildByName("map").addChild(e);i.transform.position=ea.scene.player.owner.transform.position.clone(),Ve.game.wawaHeight&&(i.transform.localScale=new Laya.Vector3(1.4,1.4,1.4)),i.transform.rotationEuler=ea.scene.player.owner.transform.rotationEuler.clone();var s=i.getComponent(Laya.Animator);s&&s.play("modeldie"),t.script.moveTrigger.ClearTrigger(),Laya.timer.once(100,t,()=>{t.script.playAni(ie.idle),Ve.game.setPlayerFuHuo()})}))})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1}),t.index++,t.index>=t.total&&(t.index=0)}}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}onRoleUseActionFinish(){cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)}attack(){var e=this;if(e.isqiang){var t=Xe.getBody(e.owner,"attack_start"),i=Xe.getBody(e.owner,"attack_end"),s=t.transform,a=i.transform;t&&i&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_12020_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(e,t=>{t.transform.localScale=new Laya.Vector3(4,4,4),s.position&&(t.transform.position=a.position.clone());var i=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);t.transform.localRotationEulerY=i,t.addComponent(da).run({script:e.script,tb:e.script.info.tb,skill:e.eventdata.skill})}))}else{var n=Xe.getBody(e.owner,"group_effect"),o=(e.script.info.tb,e.script.owner.getComponent(at).max_Attack),r=ea.skill.getSkillValue(o,e.eventdata.skill.tb);if(e.script.info.is_buff_power&&(r*=2),e.script.attackTrigger.isTrigger)for(var l=[],h=0;h<e.script.attackTrigger.kinematics.length;h++){var c=e.script.attackTrigger.kinematics[h].main;if(-1==c.name.indexOf("npc")){var d=c.getComponent(ht);if(d&&(!c||-1==l.indexOf(c.name))&&(c&&l.push(c.name),d.info)){if(!d.info.attribute)return;if(d.info.attribute.headview||d.info.attribute.initView(),d.info.attribute.hitHurt(r),Li.showTipText(c.transform.position,r),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[n,1,100,0]),d.info.attribute.thing_hp<=0){e.script.delTrigger(c);s=e.owner.transform,a=c.transform;var u=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);if(a.localRotationEulerY=u,a.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:27,count:1}),null!=c.tb.monsterId)c.addComponent(Ia).run();else cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),setTimeout(()=>{c.removeSelf(),c.destroy()},100);h--}else"0"!=e.skill.tb.hitAni&&0==e.ishit?(d.hit(e.skill.tb.hitAni),e.ishit=!0):(ss.vibrate(c),e.hitNum++,3==this.hitNum&&(e.ishit=!1,e.hitNum=0))}}}e.onRoleUseActionFinish()}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Ua extends ra{constructor(){super(...arguments),this.ishit=!1,this.hitNum=0,this.isqiang=!1,this.islock=!1,this.locktime=0,this.targetMode={},this.roleidList=[11810066,11810067,11810068,11810069,11810070,11810071]}onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){if("1"==i.read("firstAtt")&&(ea.scene.ui.firstAtt.visible=!1),ea.scene.ui.tips_box_fengyingjindu.visible)Ue.show("正在认真收集符咒");else{var t=(new Date).getTime()-this.locktime;if(!(this.islock&&t<1e3)){this.islock=!0,this.locktime=(new Date).getTime(),this.eventdata=e,slog("使用技能:",e.skill.skillId),this.script.ani.speed=Number(this.speeds[this.index]);var s=Ve.game.curChangeModel.split("|"),a=1;s[2]&&(a=Number(s[2])),ea.scene.player&&ea.scene.player.owner&&(1==ea.scene.player.owner.isthing?cafe.event.dispatch(se.LOADTHING,{Id:s[0],isrole:!0,scale:a}):0==ea.scene.player.owner.isthing&&cafe.event.dispatch(se.LOADTHING,{Id:s[0],isrole:!1,scale:a})),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1}),this.index++,this.index>=this.total&&(this.index=0)}}}RandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}onRoleUseActionFinish(){cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)}attack(){var e=this;if(e.isqiang){var t=Xe.getBody(e.owner,"attack_start"),i=Xe.getBody(e.owner,"attack_end"),s=t.transform,a=i.transform;t&&i&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_12020_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(e,t=>{t.transform.localScale=new Laya.Vector3(4,4,4),s.position&&(t.transform.position=a.position.clone());var i=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);t.transform.localRotationEulerY=i,t.addComponent(da).run({script:e.script,tb:e.script.info.tb,skill:e.eventdata.skill})}))}else{var n=Xe.getBody(e.owner,"group_effect"),o=(e.script.info.tb,e.script.owner.getComponent(at).max_Attack),r=ea.skill.getSkillValue(o,e.eventdata.skill.tb);if(e.script.info.is_buff_power&&(r*=2),e.script.attackTrigger.isTrigger)for(var l=[],h=0;h<e.script.attackTrigger.kinematics.length;h++){var c=e.script.attackTrigger.kinematics[h].main;if(-1==c.name.indexOf("npc")){var d=c.getComponent(ht);if(d&&(!c||-1==l.indexOf(c.name))&&(c&&l.push(c.name),d.info)){if(!d.info.attribute)return;if(d.info.attribute.headview||d.info.attribute.initView(),d.info.attribute.hitHurt(r),Li.showTipText(c.transform.position,r),Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_MONSTER_HIT,[n,1,100,0]),d.info.attribute.thing_hp<=0){e.script.delTrigger(c);s=e.owner.transform,a=c.transform;var u=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);if(a.localRotationEulerY=u,a.localRotationEulerX=-30,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:4,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:25,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:26,count:1}),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:c.tbId,taskType:27,count:1}),null!=c.tb.monsterId)c.addComponent(Ia).run();else cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:null,taskType:28,count:1}),setTimeout(()=>{c.removeSelf(),c.destroy()},100);h--}else"0"!=e.skill.tb.hitAni&&0==e.ishit?(d.hit(e.skill.tb.hitAni),e.ishit=!0):(ss.vibrate(c),e.hitNum++,3==this.hitNum&&(e.ishit=!1,e.hitNum=0))}}}e.onRoleUseActionFinish()}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class qa extends wa{constructor(){super(...arguments),this.endupcd=0,this.gg=!0,this.driveTarget=null,this.undrive=null,this.tmodeAni=null,this.driveType=0,this.tweenCd=0,this.isYiDong=!1,this.speed=0,this.flyFrame=120}onEnable(){super.onEnable();var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey=e.localRotationEulerY,this.croex=-t.localRotationEulerX,this.roey=e.localRotationEulerY,this.roex=-t.localRotationEulerX,this.monitor(ge.game.MAP_REPLACE_FINISH,this.onMapReplaceCamera),this.climbHandler=ta.getHandlerBy4Dir(new Laya.Handler(this,this.ClimbLeft),new Laya.Handler(this,this.ClimbUp),new Laya.Handler(this,this.ClimbRight),new Laya.Handler(this,this.ClimbDown)),this.checkSound(0),Ve.game.continuePoi=this.script.owner.transform.position.clone(),this.checkAction=this.addCom(this.owner,Yi)}startCamera(){}onMapReplaceCamera(){if(ea.scene.player&&ea.scene.player.owner){var e=ea.scene.player.owner.transform;ea.scene.cameraCode.playXGroup.transform.localRotationEulerY=e.localRotationEulerY;var t=ea.scene.cameraCode.playXGroup.transform,i=ea.scene.cameraCode.playYGroup.transform;this.croey=t.localRotationEulerY,this.croex=-i.localRotationEulerX,this.roey=t.localRotationEulerY,this.roex=-i.localRotationEulerX,this.playRotationEulerY=t.localRotationEulerY}}initAct(e){super.initAct(e);var t=this.owner.transform.position,i=new Laya.Vector3(t.x,t.y+1.2,t.z),s=new Laya.Vector3(t.x,-1,t.z),a=[];if(ea.scene.mainscene.physicsSimulation.raycastAllFromTo(i,s,a)){for(var n=0,o=0;o<a.length;o++){var r=a[o];"dmove_hit"!=r.collider.owner.name&&("group_hit"!=r.collider.owner.name&&"umove_hit"!=r.collider.owner.name&&(n=Math.max(n,r.point.y)))}this.script.landY?this.script.landY=n:this.script.landY=t.y}this.script.info.actionstate=$.land,mi.device&&!mi.device.currentMountGear?this.script.playAni(ie.idle):this.script.playAni(ie.ride)}onSettingChange(){}checkSound(e){}refRotationEuler(e,t){this.croey=e,this.croex=t;let i=this.owner.transform,s=this.owner.getChildByName("mode").transform;i.localRotationEulerY=this.roey,s.localRotationEulerX=-this.roex;var a=ea.scene.cameraCode.playXGroup.transform,n=ea.scene.cameraCode.playYGroup.transform;this.croey=this.roey,this.croex=this.roex,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),a.localRotationEulerY=this.croey,n.localRotationEulerX=-this.croex}onYGHandler(e){if(this.script.ani.state!=ie.skill&&!ea.scene.isOpenTask){if(Ve.game.isfirest)return!1;if(!super.onYGHandler(e))return!1;mi.device.currentMountGear?this.script.ani.state=ie.ride:this.script.info.actionstate==$.climb?this.script.ani.state!=ie.jump1&&this.script.ani.state!=ie.jump2&&this.script.ani.state!=ie.jump3&&this.script.ani.state!=ie.zhuiluo&&this.script.ani.state!=ie.zhuiluoqishen&&this.script.ani.state!=ie.pa&&this.script.playAni(ie.pa):this.script.ani.state==ie.idle||this.script.ani.state==ie.qianxingidle?1==this.script.isQingXing?this.script.ani.state=ie.qianxing:this.script.ani.state=ie.run:this.script.ani.state==ie.baoqidaiji&&(this.script.ani.state=ie.baoqi);var t=calcPosAngle(e.center_pos,e.pos),i=calcPosAngle({x:e.center_pos.x,y:-e.center_pos.y},{x:e.pos.x,y:-e.pos.y}),s=Math.round(180*t/Math.PI)+180,a=Math.round(180*i/Math.PI)+90,n=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform,o=ea.scene.camera.transform;return this.script.info.actionstate==$.land?(n.localRotationEulerY=o.rotationEuler.y+a,1==Ve.map.map.gamePkType&&(n.localRotationEulerY=0+a,0<n.localRotationEulerY&&n.localRotationEulerY<181?n.localRotationEulerY=90:n.localRotationEulerY=-90),this.script.info.cur_angleY=n.localRotationEulerY):this.dir=ta.get4DirByAngle(s),this.script.info.movestate=Q.move,!0}}cameraRo(){var e=ea.scene.cameraCode.playXGroup.transform,t=ea.scene.cameraCode.playYGroup.transform;this.croey+=(this.roey-this.croey)/16,this.croex+=(this.roex-this.croex)/8,Math.round(1e3*this.roex)==Math.round(1e3*this.croex)&&(this.croex=Math.round(1e3*this.roex)/1e3),Math.round(1e3*this.roey)==Math.round(1e3*this.croey)&&(this.croey=Math.round(1e3*this.roey)/1e3),e.localRotationEulerY=this.croey,t.localRotationEulerX=-this.croex}cameraRo2(){var e=ea.scene.cameraCode.playXGroup.transform,t=this.script.owner.transform.localRotationEulerY%360;this.playRotationEulerY=this.playRotationEulerY%360;var i=t-this.playRotationEulerY;this.playRotationEulerY+=i/100,Math.round(1e3*this.playRotationEulerY)==Math.round(1e3*t)&&(this.playRotationEulerY=Math.round(1e3*t)/1e3),e.localRotationEulerY=this.playRotationEulerY}run(e){}answer(e,t){for(var i=[11230346,11230347,11230348,11230349,11230350,11230351,11230352,11230353,11230354,11230355],s=["A","B","B","A","A","B","B","A","A","A"],a=0;a<i.length;a++)if(e==i[a]){if(s[a]==t)return!0;if(s[a]!=t)return!1}}onClimbRef(){var e=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,t=this.script.info.movestate==Q.back?-e:e,i=this.script.info.cur_angleY;let s=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;s.localPositionY;var a,n,o,r,l=Qe.calcTrajectoryParamstwo(s.position,.1,i+90),h=Qe.calcTrajectoryParamstwo(s.position,.1,i-90),c=Qe.calcTrajectoryParamstwo(new Laya.Vector3(l.pos.x,s.position.y+.8,l.pos.y),t+1.5,i),d=Qe.calcTrajectoryParamstwo(new Laya.Vector3(h.pos.x,s.position.y+.8,h.pos.y),t+1.5,i),u=l.pos,p=h.pos,m=c.pos,g=d.pos,y=t+1.5,f=t+1.5;if(ta.MainRoleRay(new Laya.Vector3(u.x,s.position.y+.8,u.y),new Laya.Vector3(m.x,s.position.y+.8,m.y),e=>{var t=getDistance({x:u.x,y:u.y},{x:e.point.x,y:e.point.z});if((!a||y>Math.floor(1e3*t)/1e3)&&(a=e.collider.owner.main)){o=e.point.clone();var i=a.tb;i&&i.funcType==Jt.CLIMB&&(y=Math.min(y,t))}}),ta.MainRoleRay(new Laya.Vector3(p.x,s.position.y+.8,p.y),new Laya.Vector3(g.x,s.position.y+.8,g.y),e=>{var t=getDistance({x:p.x,y:p.y},{x:e.point.x,y:e.point.z});if((!n||f>Math.floor(1e3*t)/1e3)&&(n=e.collider.owner.main)){r=e.point.clone();var i=n.tb;i&&i.funcType==Jt.CLIMB&&(f=Math.min(f,t))}}),!o||!r||y>=t+1.5&&f>=t+1.5)slog("onClimbRef没碰到了可以爬的墙!!!!!");else if(o&&r){var _=calcPosAngle({x:o.x,y:-o.z},{x:r.x,y:-r.z}),v=Math.round(180*_/Math.PI)+180,b=calcPosAngle({x:u.x,y:-u.y},{x:p.x,y:-p.y}),w=Math.round(180*b/Math.PI)+180;360==v&&(v=0),360==w&&(w=0),s.localRotationEulerY=this.climbAngle+(v-w),this.script.info.cur_angleY=s.localRotationEulerY}}onClimbEditError(){var e=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,t=this.script.info.movestate==Q.back?-e:e,i=this.script.info.cur_angleY;let s=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var a=s.position.y,n=new Laya.Vector3(s.position.x,s.position.y+.8,s.position.z);if(!ta.isMainRoleRay(n,new Laya.Vector3(s.position.x,s.position.y+1.6,s.position.z))){var o,r,l=Qe.calcTrajectoryParamstwo(n,t+1.2,i),h=n,c=l.pos,d=t+1.2;if(ta.MainRoleRay(h,new Laya.Vector3(c.x,s.position.y+.8,c.y),e=>{var t=getDistance({x:h.x,y:h.z},{x:e.point.x,y:e.point.z});if(!o||d>Math.floor(1e3*t)/1e3){if(!(o=e.collider.owner.main))return;r=e.point.clone();var i=o.tb;i&&i.funcType==Jt.CLIMB&&(d=Math.min(d,t))}}),r&&.5!=d){slog("onClimbEditError没碰到了可以爬的墙!!!!!");var u=calcPosAngle({x:r.x,y:-r.z},{x:n.x,y:-n.z}),p=Math.round(180*u/Math.PI)+90,m=Qe.calcTrajectoryParamstwo(new Laya.Vector3(r.x,a,r.z),.5,p);s.position=new Laya.Vector3(m.pos.x,a,m.pos.y)}}}onClimbEditError2(){var e=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,t=this.script.info.movestate==Q.back?-e:e,i=this.script.info.cur_angleY;let s=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var a=s.position.y,n=new Laya.Vector3(s.position.x,s.position.y+.8,s.position.z);new Laya.Vector3(s.position.x,s.position.y+1.6,s.position.z);if(!ta.isMainRoleRay(n,new Laya.Vector3(s.position.x,s.position.y+1.6,s.position.z))){var o,r,l=Qe.calcTrajectoryParamstwo(n,-2,i),h=new Laya.Vector3(l.pos.x,s.position.y+.8,l.pos.y),c=Qe.calcTrajectoryParamstwo(h,t+1.2+2,i),d=h,u=c.pos,p=t+1.2;if(ta.MainRoleRay(d,new Laya.Vector3(u.x,s.position.y+.8,u.y),e=>{var t=getDistance({x:d.x,y:d.z},{x:e.point.x,y:e.point.z});if(!o||p>Math.floor(1e3*t)/1e3){if(!(o=e.collider.owner.main))return;r=e.point.clone();var i=o.tb;i&&i.funcType==Jt.CLIMB&&(p=Math.min(p,t))}}),r&&.5!=p){slog("onClimbEditError2没碰到了可以爬的墙!!!!!");var m=calcPosAngle({x:r.x,y:-r.z},{x:h.x,y:-h.z}),g=Math.round(180*m/Math.PI)+90,y=Qe.calcTrajectoryParamstwo(new Laya.Vector3(r.x,a,r.z),.5,g);s.position=new Laya.Vector3(y.pos.x,a,y.pos.y)}}}ClimbUp(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,i=this.script.info.movestate==Q.back?-t:t,s=this.script.info.cur_angleY;let a=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var n=a.localPositionY,o=new Laya.Vector3(a.position.x,a.position.y+.8,a.position.z),r=(new Laya.Vector3(a.position.x,a.position.y+1.6,a.position.z),a.position.clone());if(r.y+=.8,null==ta.MainRoleClimbAngleXRay(r,.8)){if("20110015"!=Ve.game.role.roleMod||!ta.isMainRoleRay(o=new Laya.Vector3(o.x,a.position.y+1.06,o.z),new Laya.Vector3(a.position.x,a.position.y+1.62,a.position.z))){var l,h,c=Qe.calcTrajectoryParamstwo(o,i+e,s),d=o,u=c.pos,p=i+e;if(ta.MainRoleRay(d,new Laya.Vector3(u.x,a.position.y+.8,u.y),e=>{var t=getDistance({x:d.x,y:d.z},{x:e.point.x,y:e.point.z});if(!l||p>Math.floor(1e3*t)/1e3){if(!(l=e.collider.owner.main))return;h=e.point.clone();var i=l.tb;i&&i.funcType==Jt.CLIMB&&(p=Math.min(p,t))}}),!h||p>=i+e){c=Qe.calcTrajectoryParamstwo(o,i+e+1,s),(d=o).y=a.position.y+.8;p=i+e+1;u=c.pos,ta.MainRoleRay(d,new Laya.Vector3(u.x,a.position.y+.8,u.y),e=>{var t=getDistance({x:d.x,y:d.z},{x:e.point.x,y:e.point.z});if(!l||p>Math.floor(1e3*t)/1e3){if(!(l=e.collider.owner.main))return;h=e.point.clone();var i=l.tb;i&&i.funcType==Jt.CLIMB&&(p=Math.min(p,t),p=Math.floor(1e3*p)/1e3)}}),(d=o).y=a.position.y+.9,u=c.pos;var m=i+e+1;if(ta.MainRoleRay(d,new Laya.Vector3(u.x,a.position.y+.9,u.y),e=>{var t=getDistance({x:d.x,y:d.z},{x:e.point.x,y:e.point.z});if(!l||m>Math.floor(1e3*t)/1e3){if(!(l=e.collider.owner.main))return;h=e.point.clone();var i=l.tb;i&&i.funcType==Jt.CLIMB&&(m=Math.min(m,t),m=Math.floor(1e3*m)/1e3)}}),m!=p&&m-p<.3){let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;n=t.localPositionY;var g=Qe.calcTrajectoryParamstwo(t.position,i+e+.2,s),y=(c=Qe.calcTrajectoryParamstwo(t.position,i+e,s),g.pos),f=(u=c.pos,-5);ta.MainRoleRay(new Laya.Vector3(y.x,t.position.y+1.2,y.y),new Laya.Vector3(y.x,-5,y.y),e=>{f<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),f=Math.max(f,e.point.y)}),this.script.ani.state==ie.jump2||this.script.ani.state==ie.zhuiluo?this.script.landY=f:(this.script.landY=f,!mi.device.currentMountGear&&n-this.script.landY>.7?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):n+=Math.round((this.script.landY-n)/4*1e3)/1e3),slog("ClimbUp没碰到了可以爬的墙2!!!!!"),this.script.info.actionstate=$.land,o.x=g.pos.x,o.y=n,o.z=g.pos.y,t.position=o.clone(),this.script.playAni(ie.idle)}else if(!h||p>=i+e+1){let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;n=t.localPositionY,g=Qe.calcTrajectoryParamstwo(t.position,i+e+.6,s),c=Qe.calcTrajectoryParamstwo(t.position,i+e,s),y=g.pos,u=c.pos,f=-5;ta.MainRoleRay(new Laya.Vector3(y.x,t.position.y+1.2,y.y),new Laya.Vector3(y.x,-5,y.y),e=>{f<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),f=Math.max(f,e.point.y)}),this.script.ani.state==ie.jump2||this.script.ani.state==ie.zhuiluo?this.script.landY=f:(this.script.landY=f,!mi.device.currentMountGear&&n-this.script.landY>.7?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):n+=Math.round((this.script.landY-n)/4*1e3)/1e3),slog("ClimbUp没碰到了可以爬的墙!!!!!"),this.script.info.actionstate=$.land,o.x=g.pos.x,n-this.script.landY<.7&&(o.y=n),o.z=g.pos.y,t.position=o.clone(),this.script.playAni(ie.idle)}else this.script.info.movestate==Q.move&&(a.localPositionY+=i),this.onClimbRef(),this.onClimbEditError()}else this.script.info.movestate==Q.move&&(a.localPositionY+=i)}}else{var _=Qe.calcTrajectoryParamstwo(a.position,-.8,s);if(ta.isMainRoleRay(new Laya.Vector3(_.pos.x,a.position.y+.8,_.pos.y),new Laya.Vector3(_.pos.x,a.position.y+1.6,_.pos.y)))return void(a.position=new Laya.Vector3(r.x,n,r.z));var v=ta.MainRoleClimbAngleYRay(new Laya.Vector3(_.pos.x,r.y+.8,_.pos.y),s,1.2);if(null!=v){a.position=new Laya.Vector3(_.pos.x,n+.8,_.pos.y);var b=calcPosAngle({x:_.pos.x,y:-_.pos.y},{x:v.x,y:-v.z}),w=Math.round(180*b/Math.PI)+90;return this.script.info.cur_angleY=w,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}}}ClimbDown(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,i=this.script.info.movestate==Q.back?-t:t,s=this.script.info.cur_angleY;let a=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var n,o,r=a.localPositionY,l=a.position.y-.8,h=a.position.y-1,c=new Laya.Vector3(a.position.x,a.position.y,a.position.z),d=new Laya.Vector3(a.position.x,l,a.position.z),u=Qe.calcTrajectoryParamstwo(c,i+e,s),p=Qe.calcTrajectoryParamstwo(c,-.5,s),m=new Laya.Vector3(p.pos.x,c.y,p.pos.y),g=new Laya.Vector3(p.pos.x,c.y-1,p.pos.y),y=i+e,f=l,_=h;if(ta.MainRoleRay(c,d,e=>{e.point.y>f&&(f=Math.max(e.point.y,f),e.point.clone())}),f>l){if(ta.MainRoleRay(m,g,e=>{e.point.y>_&&(_=Math.max(e.point.y,_),e.point.clone())}),_>h){let e=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;r=e.localPositionY;var v=-5;return ta.MainRoleRay(new Laya.Vector3(e.position.x,e.position.y+1.2,e.position.z),new Laya.Vector3(e.position.x,-5,e.position.z),e=>{v<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),v=Math.max(v,e.point.y)}),this.script.ani.state==ie.jump2||this.script.ani.state==ie.zhuiluo?this.script.landY=v:(this.script.landY=v,!mi.device.currentMountGear&&r-this.script.landY>.7?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):r+=Math.round((this.script.landY-r)/4*1e3)/1e3),slog("ClimbDown没碰到了可以爬的墙2!!!!!"),this.script.info.actionstate=$.land,c.x=e.position.x,e.position.y-this.script.landY<.7&&(c.y=this.script.landY),c.z=e.position.z,e.position=c.clone(),void(this.script.ani.state=ie.idle)}var b=Qe.calcTrajectoryParamstwo(a.position,-.8,s),w=ta.MainRoleClimbAngleYRay(new Laya.Vector3(b.pos.x,a.position.y-.8,b.pos.y),s,1.2);if(null!=w){a.position=new Laya.Vector3(b.pos.x,r-.8,b.pos.y);var T=calcPosAngle({x:b.pos.x,y:-b.pos.y},{x:w.x,y:-w.z}),A=Math.round(180*T/Math.PI)+90;return this.script.info.cur_angleY=A,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}}else{var x=u.pos;if(ta.MainRoleRay(c,new Laya.Vector3(x.x,a.position.y,x.y),e=>{var t=getDistance({x:c.x,y:c.z},{x:e.point.x,y:e.point.z});if(!n||y>Math.floor(1e3*t)/1e3){if(!(n=e.collider.owner.main))return;o=e.point.clone();var i=n.tb;i&&i.funcType==Jt.CLIMB&&(y=Math.min(y,t))}}),!o||y>=i+e){u=Qe.calcTrajectoryParamstwo(c,i+e+1,s);var k=c;if(k.y=a.position.y+.9,x=u.pos,ta.MainRoleRay(k,new Laya.Vector3(x.x,a.position.y+.9,x.y),e=>{var t=getDistance({x:k.x,y:k.z},{x:e.point.x,y:e.point.z});if(!n||y>Math.floor(1e3*t)/1e3){if(!(n=e.collider.owner.main))return;o=e.point.clone();var i=n.tb;i&&i.funcType==Jt.CLIMB&&(y=Math.min(y,t))}}),!o||y>=i+e+1){let e=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;r=e.localPositionY,v=-5;ta.MainRoleRay(new Laya.Vector3(e.position.x,e.position.y+1.2,e.position.z),new Laya.Vector3(e.position.x,-5,e.position.z),e=>{v<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),v=Math.max(v,e.point.y)}),this.script.ani.state==ie.jump2||this.script.ani.state==ie.zhuiluo?this.script.landY=v:(this.script.landY=v,!mi.device.currentMountGear&&r-this.script.landY>.7?cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION):r+=Math.round((this.script.landY-r)/4*1e3)/1e3),slog("ClimbDown没碰到了可以爬的墙!!!!!"),this.script.info.actionstate=$.land,c.x=e.position.x,e.position.y-this.script.landY<.7&&(c.y=this.script.landY),c.z=e.position.z,e.position=c.clone(),this.script.ani.state=ie.idle}else this.script.info.movestate==Q.move&&(a.localPositionY-=i),this.onClimbRef(),this.onClimbEditError()}else this.script.info.movestate==Q.move&&(a.localPositionY-=i)}}ClimbLeft(e){e+=.4;var t=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,i=this.script.info.movestate==Q.back?-t:t,s=this.script.info.cur_angleY;let a=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var n=a.localPositionY,o=Qe.calcTrajectoryParamstwo(a.position,.8,s+90),r=Qe.calcTrajectoryParamstwo(a.position,1.2,s+90),l=a.position.clone();l.y+=.8;var h=ta.MainRoleClimbAngleYRay(l,s+90,.8);if(null==h){var c,d,u=o.pos,p=Qe.calcTrajectoryParamstwo(new Laya.Vector3(o.pos.x,a.position.y+.8,o.pos.y),i+e,s).pos,m=Qe.calcTrajectoryParamstwo(new Laya.Vector3(r.pos.x,a.position.y+.8,r.pos.y),1,s).pos,g=i+e;if(ta.MainRoleRay(new Laya.Vector3(u.x,a.position.y+.8,u.y),new Laya.Vector3(p.x,a.position.y+.8,p.y),e=>{var t=getDistance({x:u.x,y:u.y},{x:e.point.x,y:e.point.z});if(!c||g>Math.floor(1e3*t)/1e3){if(!(c=e.collider.owner.main))return;d=e.point.clone();var i=c.tb;i&&i.funcType==Jt.CLIMB&&(g=Math.min(g,t))}}),!d||g>=i+e){slog("ClimbLeft没碰到了可以爬的墙!!!!!");var y,f,_=Qe.calcTrajectoryParamstwo(new Laya.Vector3(m.x,a.position.y+.8,m.y),1.5,s-90).pos,v=i+e;if(ta.MainRoleRay(new Laya.Vector3(m.x,a.position.y+.8,m.y),new Laya.Vector3(_.x,a.position.y+.8,_.y),e=>{var t=getDistance({x:m.x,y:m.y},{x:e.point.x,y:e.point.z});if(!y||v>Math.floor(1e3*t)/1e3){if(!(y=e.collider.owner.main))return;f=e.point.clone();var i=y.tb;i&&i.funcType==Jt.CLIMB&&(v=Math.min(v,t))}}),!f||v>=i+e)this.script.info.actionstate=$.land;else{slog("新的墙"),a.position=new Laya.Vector3(m.x,n,m.y);A=calcPosAngle({x:m.x,y:-m.y},{x:f.x,y:-f.z}),x=Math.round(180*A/Math.PI)+90;this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),this.onClimbEditError()}}else if(this.script.info.movestate==Q.move){var b=Qe.calcTrajectoryParamstwo(a.position,i,s+90);a.position=new Laya.Vector3(b.pos.x,n,b.pos.y)}}else{var w=Qe.calcTrajectoryParamstwo(a.position,-.8,s),T=Qe.calcTrajectoryParamstwo(new Laya.Vector3(w.pos.x,a.position.y,w.pos.y),1.2,s+90);if(ta.isMainRoleRay(new Laya.Vector3(w.pos.x,a.position.y,w.pos.y),new Laya.Vector3(T.pos.x,a.position.y+.8,T.pos.y))){a.position=new Laya.Vector3(l.x,n,l.z);var A=calcPosAngle({x:l.x,y:-l.z},{x:h.x,y:-h.z}),x=Math.round(180*A/Math.PI)+90;return this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}if(null!=(h=ta.MainRoleClimbAngleYRay(new Laya.Vector3(T.pos.x,a.position.y+.8,T.pos.y),s,1.2))){a.position=new Laya.Vector3(T.pos.x,n,T.pos.y);var A=calcPosAngle({x:T.pos.x,y:-T.pos.y},{x:h.x,y:-h.z}),x=Math.round(180*A/Math.PI)+90;return this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}}}ClimbRight(e){var t=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:this.script.info.speed,i=this.script.info.movestate==Q.back?-t:t,s=this.script.info.cur_angleY;let a=mi.device.currentMountGear?mi.device.currentMountGear.transform:this.owner.transform;var n=a.position.y,o=a.position.clone();o.y+=.8;var r=Qe.calcTrajectoryParamstwo(a.position,.8,s-90),l=Qe.calcTrajectoryParamstwo(a.position,1.2,s-90),h=ta.MainRoleClimbAngleYRay(o,s-90,.8);if(null==h){var c,d,u=r.pos,p=Qe.calcTrajectoryParamstwo(new Laya.Vector3(r.pos.x,a.position.y+.8,r.pos.y),i+e,s).pos,m=Qe.calcTrajectoryParamstwo(new Laya.Vector3(l.pos.x,a.position.y+.8,l.pos.y),1,s).pos,g=i+e;if(ta.MainRoleRay(new Laya.Vector3(u.x,a.position.y+.8,u.y),new Laya.Vector3(p.x,a.position.y+.8,p.y),e=>{var t=getDistance({x:u.x,y:u.y},{x:e.point.x,y:e.point.z});if(!c||g>Math.floor(1e3*t)/1e3){if(!(c=e.collider.owner.main))return;d=e.point.clone();var i=c.tb;i&&i.funcType==Jt.CLIMB&&(g=Math.min(g,t))}}),!d||g>=i+e){slog("ClimbRight没碰到了可以爬的墙!!!!!");var y,f,_=Qe.calcTrajectoryParamstwo(new Laya.Vector3(m.x,a.position.y+.8,m.y),1.5,s+90).pos,v=i+e;if(ta.MainRoleRay(new Laya.Vector3(m.x,a.position.y+.8,m.y),new Laya.Vector3(_.x,a.position.y+.8,_.y),e=>{var t=getDistance({x:m.x,y:m.y},{x:e.point.x,y:e.point.z});if(!y||v>Math.floor(1e3*t)/1e3){if(!(y=e.collider.owner.main))return;f=e.point.clone();var i=y.tb;i&&i.funcType==Jt.CLIMB&&(v=Math.min(v,t))}}),!f||v>=i+e)this.script.info.actionstate=$.land;else{slog("新的墙"),a.position=new Laya.Vector3(m.x,n,m.y);A=calcPosAngle({x:m.x,y:-m.y},{x:f.x,y:-f.z}),x=Math.round(180*A/Math.PI)+90;this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),this.onClimbEditError()}}else if(this.script.info.movestate==Q.move){var b=Qe.calcTrajectoryParamstwo(a.position,i,s-90);a.position=new Laya.Vector3(b.pos.x,n,b.pos.y)}}else{var w=Qe.calcTrajectoryParamstwo(a.position,-.8,s),T=Qe.calcTrajectoryParamstwo(new Laya.Vector3(w.pos.x,a.position.y,w.pos.y),1.2,s-90);if(ta.isMainRoleRay(new Laya.Vector3(w.pos.x,a.position.y,w.pos.y),new Laya.Vector3(T.pos.x,a.position.y+.8,T.pos.y))){a.position=new Laya.Vector3(o.x,n,o.z);var A=calcPosAngle({x:o.x,y:-o.z},{x:h.x,y:-h.z}),x=Math.round(180*A/Math.PI)+90;return this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}if(null!=(h=ta.MainRoleClimbAngleYRay(new Laya.Vector3(T.pos.x,a.position.y+.8,T.pos.y),s,1.2))){a.position=new Laya.Vector3(T.pos.x,n,T.pos.y);var A=calcPosAngle({x:T.pos.x,y:-T.pos.y},{x:h.x,y:-h.z}),x=Math.round(180*A/Math.PI)+90;return this.script.info.cur_angleY=x,this.climbAngle=this.script.info.cur_angleY,this.onClimbRef(),void this.onClimbEditError()}}}framefly(e){if(0==this.flyFrame)return Laya.timer.clearAll(this),ea.scene.GamePause=!1,Ve.game.isCannon=!1,this.script.ani.play(ie.idle),void cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH);cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION);var t=ea.scene.player.owner.transform.position.clone(),i=e,s=new Laya.Vector3((i.x-t.x)/this.flyFrame,(i.y-t.y)/this.flyFrame,(i.z-t.z)/this.flyFrame);ea.scene.player.owner.transform.position=new Laya.Vector3(t.x+s.x,t.y+s.y,t.z+s.z),this.flyFrame--}onFrameRun(){var e=this;if(ea.scene.GamePause)return;if(ea.scene.isOpenTask)return;if(!e.active)return;if(!e.script.info.is_move)return;if(!Ve.map.mptData)return;if(Ve.game.isfirest)return;e.cameraRo(),ea.scene&&ea.scene.ui&&ea.scene.ui.img_fraction&&(ea.scene.ui.lab_fraction.text="目前："+Ve.game.fraction.toString()+"分");var t,i=.8;Ve.game.fuhuoTime,(new Date).getTime();if(e.script.info.actionstate==$.startclimb)e.script.info.actionstate=$.climb,e.climbAngle=e.script.info.cur_angleY,e.onClimbRef();else if(e.script.info.actionstate==$.climb)i=.8,e.climbHandler(e.dir,i);else if(e.script.info.actionstate==$.land){var s=mi.device.currentMountGear?mi.device.currentMountGear.getComponent(ht):e.script;if(2==Ve.game.MaoMaoGameType){var a=e.checkAction.checkAll3D(10,7);a&&a.mode}if(Ve.game.MonsterStop)return;this.AttackTriggerAction(s),this.MoveTriggerAction(s)}else Ve.game.curSaveNpc&&(ea.scene.ui.CancelDevide(),Ve.game.curSaveNpc=null),ea.scene.ui&&ea.scene.ui.btn_huati&&(ea.scene.ui.btn_huati.visible=!1);if(e.script.ani.state!=ie.jump3&&e.script.ani.state&&e.script.ani.state!=ie.qianxing&&e.script.ani.state!=ie.idle&&e.script.ani.state!=ie.baoqidaiji&&e.script.ani.state!=ie.baoqi&&e.script.ani.state!=ie.paidle&&e.script.ani.state!=ie.pa&&e.script.ani.state!=ie.jump2&&e.script.ani.state!=ie.zhuiluo&&e.script.ani.state!=ie.run&&e.script.ani.state!=ie.run2&&e.script.ani.state!=ie.ride1&&e.script.ani.state!=ie.ride2&&e.script.ani.state!=ie.ride){if(e.script.ani.state!=ie.jump1&&e.script.ani.state!=ie.jump2&&e.script.ani.state!=ie.zhuiluo){let t=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;t.localPositionY+=Math.round((e.script.landY-t.localPositionY)/4*1e3)/1e3}return}var n=mi.device.currentMountGear?mi.device.currentMountGear.tb.move_speed/1e5:e.script.info.speed;let o;t=e.script.info.cur_angleY,o=e.script.info.movestate==Q.back?-n:n,e.script.info.is_add_speed||Ve.game.addSpeedBuff?(o=mi.device.currentMountGear?1.2*n:e.script.info.tb.roleStartAddMoveSpeed*Ve.map.map.scale/1e5,e.script.ani.speed!=1.5*e.script.info.tb.moveanispeed&&(e.script.ani.speed=1.5*e.script.info.tb.moveanispeed)):e.script.ani.speed!=e.script.info.tb.moveanispeed&&e.script.ani.state&&-1==e.script.ani.state.indexOf("jump")&&(e.script.ani.speed=e.script.info.tb.moveanispeed),e.script.ani.state!=ie.jump2&&e.script.ani.state!=ie.zhuiluo||(o*=1.2),Ve.game.isYinliao&&(o*=2),Ve.game.isTrampoline&&(o*=1.5),Ve.game.isjiasu?(o*=2,e.script.ani.speed=2):e.script.info.is_add_speed,Ve.game.isjiansu&&(o*=.3,e.script.ani.speed),Ve.game.isbig&&(e.script.ani.speed=.7),Ve.game.issmall&&(o*=.7,e.script.ani.speed=1.2),Ve.game.isjiasu||Ve.game.isjiansu||Ve.game.isbig||Ve.game.issmall||!e.script.ani.state||-1!=e.script.ani.state.indexOf("jump")||(e.script.ani.speed=e.script.info.tb.moveanispeed),e.script.isQingXing&&(o*=.75);let r=mi.device.currentMountGear?mi.device.currentMountGear.transform:e.owner.transform;Qe.calcTrajectoryParamstwo(r.position,o+i,t).pos;var l=r.localPositionY,h=Qe.calcTrajectoryParamstwo(r.position,2*o+(mi.device.currentMountGear?1.2:0),t),c=h.pos,d=r.position.clone();c=t?h.pos:new Laya.Vector2(d.x,d.z);var u=-20;if(!(e.script.ani.state&&-1!=e.script.ani.state.indexOf("pa")||(ta.MainRoleRay(new Laya.Vector3(c.x,r.position.y+1,c.y),new Laya.Vector3(c.x,-20,c.y),e=>{u<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),u=Math.max(u,e.point.y)},()=>{if(e.script.ani.state==ie.jump2||e.script.ani.state==ie.zhuiluo)e.script.landY=u;else if(e.script.landY=u,!mi.device.currentMountGear&&l-e.script.landY>.35&&e.script.ani.state!=ie.jump3)cafe.event.dispatch(ge.game.USE_GRAVITY_ACTION);else if(e.script.ani.state==ie.jump3){if(0==Ve.game.TrampolineAniSwitch){var t=Math.round((e.script.landY-l)/4*1e3)/1e3;return void(r.localPositionY+=.5*t)}}else{t=Math.round((e.script.landY-l)/4*1e3)/1e3;r.localPositionY+=.5*t}}),s&&s.moveTrigger&&e.script.moveTrigger.isTrigger||e.script.ani.state==ie.jump3&&0==Ve.game.TrampolineAniSwitch)))if(e.script.info.movestate==Q.move||e.script.info.movestate==Q.back){e.script.info.cur_angleY;let i=Qe.calcTrajectoryParamsone(r,o,t);e.play_angle=i.angle;let s=Ve.map.mptData.gridHeightNum,a=Ve.map.mptData.gridWidthNum,n=Ve.map.mptData.gridX,l=Ve.map.mptData.gridY;i.pos.x,i.p.x,i.p.y,i.pos.y;var p=Qe.calcTrajectoryParamstwo(r.localPosition,o+1,t);oi.singleton.mptData.getPointFlag({localPosition:new Laya.Vector3(p.pos.x,0,p.pos.y)});Ve.game.isStartGame&&!Ve.game.isPauseGame&&1!=Ve.map.map.gamePkType?r.localPosition=new Laya.Vector3(i.pos.x,r.localPositionY,i.pos.y):1==Ve.map.map.gamePkType&&(r.localPosition=new Laya.Vector3(i.pos.x,r.localPositionY,r.localPosition.z));var m=r.localPosition.clone();m.x>s&&(m.x=s),m.z>a&&(m.z=a),m.x<n&&(m.x=n),m.z<l&&(m.z=l),r.localPosition=m.clone();var g=Ve.map.mptData.checkThing(e.owner,.5);if(g&&g.tb){if(e.tiggerDataStr!=g.dataStr)switch(slog("来来来",g.dataStr),e.tiggerDataStr=g.dataStr,g.dthing.type){case 9:cafe.event.dispatch(ge.game.TOOLCMD,g.dataStr)}}else e.tiggerDataStr=null}else e.speed=0}AttackTriggerAction(e){if(1==Ve.map.map.gametype){if(!e||!e.attackTrigger||!e.attackTrigger.isTrigger)return ea.scene.ui&&ea.scene.ui.firstAtt.visible&&(ea.scene.ui.firstAtt.visible=!1),void ea.scene.player.ShowAttackCheckEffect(!1);if(Ve.game.GuideModel)for(let t=0;t<e.attackTrigger.kinematics.length;t++){(s=(i=e.attackTrigger.kinematics[t]).parent)&&s.name==Ve.game.GuideModel.dataStr&&(ea.scene.ui.firstAtt.visible=!0)}var t=!1;for(let n=0;n<e.attackTrigger.kinematics.length;n++){var i;if((i=e.attackTrigger.kinematics[n]).parent){var s,a=(s=i.parent).name;"tmode"==a&&(a=s.parent.name),null!=Ve.game.DuoMaoMaoNpc[a]&&(t=!0)}}ea.scene.player.ShowAttackCheckEffect(t)}}MoveTriggerAction(e){if(e&&e.moveTrigger&&e.moveTrigger.isTrigger)for(let a=0;a<e.moveTrigger.kinematics.length;a++){var t=e.moveTrigger.kinematics[a];if(null!=t.parent){var i=t.main;if("huati"==t.name&&(ea.scene.ui.btn_huati.visible=!0),i&&-1!=i.name.indexOf("npc")&&2==Ve.game.MaoMaoGameType){var s=i.getComponent(fs);if(s&&!Ve.game.curSaveNpc&&s.isDie)return Ve.game.curSaveNpc=s,void ea.scene.ui.deviceJinDu(3)}this.QuestionAction(t,i),this.PlayerTriggerAction(t),this.FallDownCheck(t),this.BaoXiangAction(i),this.CannonAction(i),this.EquipRoleChange(i)}else this.script.moveTrigger.kinematics.splice(a,1),a--}}PlayerTriggerAction(e){if(e&&("shopCube"==e.name||"NiuDanCube"==e.name||"ZhuanPanCube"==e.name||"MapSelectCube"==e.name)){cafe.event.dispatch(se.ClOSEPANELHANDLE),ea.scene.player.ClearTrigger(),ea.scene.GamePause=!0;var t=initHandler(this,()=>{});switch(e.name){case"shopCube":if(Ve.game.shopdelaytime&&Ve.game.shopdelaytime==ea.scene.ui.lab_gameTime.text){ea.scene.GamePause=!1,Ve.game.shopdelaytime++;break}Ve.game.shopdelaytime=ea.scene.ui.lab_gameTime.text,be.openpanel(Ve.shop.ShopPanel,{handler:t});break;case"NiuDanCube":be.openpanel(we.NiuDanPanel,{handler:t});break;case"ZhuanPanCube":be.openpanel(we.ZhuanPanPanel,{handler:t});break;case"MapSelectCube":if(Ve.game.shopdelaytime&&Ve.game.shopdelaytime==ea.scene.ui.lab_gameTime.text){ea.scene.GamePause=!1,Ve.game.shopdelaytime++;break}Ve.game.shopdelaytime=ea.scene.ui.lab_gameTime.text,ea.scene.ui.btn_openMap.disabled=!0,be.openpanel(Ve.shop.ShopPanel,{handler:t})}}}FallDownCheck(e){e.main&&e.main.tb&&e.main.tb.funcType==Jt.PUSHOVER&&e.main.getComponent(gs).FallDown(0)}BaoXiangAction(e){var t=this;if(e&&e.tb&&11230470==e.tb.configId){if(ea.scene.GamePause)return;return ea.scene.GamePause=!0,void yt.getInstance().showVideo(null,null,()=>{Ve.game.BaoxiangTarget=e;for(let t=0;t<4;t++)if(e.getChildByName("body")._children[t].active)var i=e.getChildByName("body")._children[t].getComponent(Laya.Animator);i&&(i.play("kaigai"),Laya.timer.once(800,t,()=>{e.removeSelf(),e.destroy(),ea.scene.player.moveTrigger.ClearTrigger(),be.openpanel(we.DropDependPanel)}))},()=>{ea.scene.player.moveTrigger.ClearTrigger(),ea.scene.GamePause=!1},()=>{ea.scene.player.moveTrigger.ClearTrigger(),ea.scene.GamePause=!1})}if(e&&e.tb&&11230471==e.tb.configId){if(ea.scene.GamePause)return;ea.scene.GamePause=!0,Ve.game.BaoxiangTarget=e;for(let t=0;t<4;t++)if(e.getChildByName("body")._children[t].active)var i=e.getChildByName("body")._children[t].getComponent(Laya.Animator);i&&(i.play("kaigai"),Laya.timer.once(800,t,()=>{e.removeSelf(),e.destroy(),ea.scene.player.moveTrigger.ClearTrigger(),be.openpanel(we.DropDependPanel)}))}else;}CannonAction(e){var t=this;if(e&&e.tb&&e.tb.funcType==Jt.CANNON){ea.scene.GamePause=!0,t.flyFrame=90;for(var i=e.dataStr,s=0;s<Ve.game.GuangquanOwner.length;s++){var a=Ve.game.GuangquanOwner[s].dataStr;if(Number(i)==Number(a)){Ve.game.isCannon=!0,t.script.ani.play(ie.fly);var n=Ve.game.GuangquanOwner[s];Es.LookFromAt1(ea.scene.player.owner,n.transform.position),ea.scene.cameraCode.playXGroup.transform.rotationEuler=ea.scene.player.owner.transform.rotationEuler;var o=n.transform.position.clone();Laya.timer.frameLoop(1,t,()=>{t.framefly(o)});break}}}else;}EquipRoleChange(e){if(e&&11230285==e.dthing.thingId||e&&11230284==e.dthing.thingId){this.script.moveTrigger.ClearTrigger(),cafe.event.dispatch(se.ClOSEPANELHANDLE);Ve.shop.getShopListByType(3),e.dataStr;yt.getInstance().showVideo(null,null,()=>{this.GetRole(e)})}}GetRole(e){var t=Ve.shop.getShopListByType(3),i=e.dataStr-10001;Ve.shop.noMoneyBuyShop(e.dataStr),Ve.shop.useRoleShop(t[i].tb.targetId),Ve.role.equip_role=t[i].tb.targetId,cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF);var s=e.mode.parent;s.removeSelf(),s.destroy(),s=null,ea.scene.GamePause=!1}QuestionAction(e,t){if(0==Ve.map.map.gametype){if(t&&t.tb&&401==t.tb.funcType){Ue.show("回答正确，获得奖励"),Ve.user.addGold(200),Tn.inst.sound.play(15043);var i=Xe.getBody(ea.scene.player.owner,"80003");return i?(i.active=!1,i.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80003_lh],ea.scene.player.owner,1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)})),e.removeSelf(),e.destroy(),void this.script.moveTrigger.delTrigger(t)}if(t&&t.tb&&402==t.tb.funcType)return e.removeSelf(),e.destroy(),this.script.moveTrigger.delTrigger(t),void Ue.show("回答错误,请继续努力");var s;if(e&&"ACube"==e.name&&t)(s=e.parent.getChildByName("BCube")).removeSelf(),s.destroy(),s=null,e.removeSelf(),e.destroy(),e=null,1==this.answer(Number(t.dthing.thingId),"A")?(Ue.show("回答正确！"),Ve.game.fraction+=10):Ue.show("回答错误"),this.script.moveTrigger.ClearTrigger();if(e&&"BCube"==e.name&&t)(s=e.parent.getChildByName("ACube")).removeSelf(),s.destroy(),s=null,e.removeSelf(),e.destroy(),e=null,1==this.answer(Number(t.dthing.thingId),"B")?(Ue.show("回答正确！"),Ve.game.fraction+=10):Ue.show("回答错误"),this.script.moveTrigger.ClearTrigger();t&&t.tb&&t.tb.funcType==Jt.QUESTION&&(1==t.dataStr?(ea.scene.ui.ZhengQueAni(),e.removeSelf(),e.destroy(),this.script.moveTrigger.delTrigger(t)):this.FuHuo())}}FuHuo(){if(!ea.scene.GamePause&&!Es.specialCam)return Ve.game.savetppoi?mi.device.currentMountGear?(mi.device.unDevice(),void Laya.timer.once(200,this,()=>{this.XiuFuAction()})):void this.XiuFuAction():(cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),cafe.event.dispatch(se.CANCELSKILL),void ta.toTrBy9G(ea.scene.player.owner,Ve.map.mptData.initPoint))}XiuFuAction(){var e=Ve.game.savetppoi.clone();ea.scene.player.owner.transform.position=new Laya.Vector3(e.x,e.y+.1,e.z),ea.scene.player.EndTp(),cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION)}destroy(){super.destroy()}onDestroy(){}}class Ya extends ra{constructor(){super(...arguments),this.ishit=!1,this.hitNum=0,this.isqiang=!1,this.islock=!1,this.locktime=0,this.attNum=0}onEnable(){super.onEnable(),this.index=0,this.total=0,this.anis=this.skill.tb.ani.split("|"),this.speeds=this.skill.tb.aniSpeed.split("|"),this.sounds=this.skill.tb.skillSound.split("|"),this.total=this.anis.length}onUseSkillHandler(e){var t=this;"1"==i.read("firstSkill")&&ea.scene.ui.firstSkill.visible&&(i.save("firstSkill","0"),ea.scene.ui.firstSkill.visible=!1);var s=(new Date).getTime()-t.locktime;if(!(t.islock&&s<1e3)){t.islock=!0,t.locktime=(new Date).getTime(),t.eventdata=e,slog("使用技能:",e.skill.skillId),cafe.event.dispatch(ge.game.ROLE_USE_ACTION,t.pos);var a=t.index;t.script.ani.speed=Number(t.speeds[t.index]);var n=t.anis[t.index].split(":");"qiang"==n[0]&&(t.isqiang=!0),t.isqiang?t.script.playAni("qiang",initHandler(t,e=>{"finish"==e&&(t.islock=!1),"attack"==e&&(Tn.inst.sound.play(Number(t.sounds[a])),t.sounds,t.attack(),t.script.playAni(ie.idle))})):("42810008"==ea.scene.player.info._tb.roleMod?(ea.scene.player.penhuoEffect2.active=!1,ea.scene.player.penhuoEffect2.active=!0,ea.scene.player.penhuoEffect2.transform.rotation=ea.scene.player.owner.transform.rotation):(ea.scene.player.penhuoEffect.active=!1,ea.scene.player.penhuoEffect.active=!0,ea.scene.player.penhuoEffect.transform.rotation=ea.scene.player.owner.transform.rotation),t.script.playAni(n[0],initHandler(t,e=>{"finish"==e&&(t.islock=!1),"attack"==e&&(t.attack(),ea.scene.player.penhuoEffect.active=!1,ea.scene.player.penhuoEffect2.active=!1)}))),cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{id:e.skill.skillId,taskType:jt.USE_SKILL,count:1}),t.index++,t.index>=t.total&&(t.index=0)}}onRoleUseActionFinish(){cafe.event.dispatch(ge.game.ROLE_USE_ACTION_FINISH)}attack(){var e=this;if(e.isqiang){var t=Xe.getBody(e.owner,"attack_start"),i=Xe.getBody(e.owner,"attack_end"),s=t.transform,a=i.transform;t&&i&&Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_12019_lh],ea.scene.mainscene.getChildByName("map"),1,{},initHandler(e,t=>{s.position&&(t.transform.position=a.position.clone()),ea.scene.ui.firestqiang.visible&&(ea.scene.ui.firestqiang.visible=!1);var i=calcPosAngle({x:s.position.x,y:-s.position.z},{x:a.position.x,y:-a.position.z},!0);t.transform.localRotationEulerY=i,t.addComponent(da).run({script:e.script,tb:e.script.info.tb,skill:e.eventdata.skill})}))}else{Xe.getBody(e.owner,"group_effect"),e.script.info.tb;var n=e.script.owner.getComponent(at).max_Attack;ea.skill.getSkillValue(n,e.eventdata.skill.tb);if(e.script.info.is_buff_power&&2,e.script.skillTrigger.isTrigger)for(var o=0;o<e.script.skillTrigger.kinematics.length;o++){var r=e.script.skillTrigger.kinematics[o];if(r.parent){if((-1!=r.name.indexOf("body")||-1!=r.name.indexOf("Cube"))&&r.main&&r.main.tb.destroyType&&2==r.main.tb.destroyType){var l,h;if(l=Xe.getBody(r,"body"),l=-1!=r.name.indexOf("body")?Xe.getBody(r,"body"):r.parent){var c=l.getComponent(Laya.Animator);c&&(c.enabled=!1,c.destroy())}r.main&&(h=r.main),h||(h=r.parent);var d=h.transform.localPosition.clone();d||(d=r.parent.transform.localPosition.clone());var u=ea.scene.mainscene.getChildByName("map").getChildByName("30027");return u?(u.transform.localPosition=d,u.active=!1,u.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30027_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(e,e=>{e&&d&&(e.transform.localPosition=d)})),h.removeSelf(),h.destroy(),e.script.attackTrigger.delTrigger(r),void e.script.moveTrigger.delTrigger(h)}}else e.script.attackTrigger.delTrigger(r),e.script.moveTrigger.delTrigger(r)}e.onRoleUseActionFinish()}}destroy(){super.destroy(),console.log("跳跃回收成功")}}class Wa extends Wi{constructor(){super()}onEnable(){super.onEnable();this.monitor(ge.game.ROLE_INSTALL_MOVE,this.onMoveInstallHandler),this.monitor(ge.game.ROLE_INSTALL_SKILL,this.onSkillInstallHandler),this.monitor(ge.game.ROLE_INSTALL_ACTION,this.onActionInstallHandler)}onMoveInstallHandler(e){if(e&&e.tb)switch(a.skill.getTbBySkillId(e.tb.equipMove).actionName){case"LandMoveAction":this.script.action.install(Ei.MoveAction,qa);break;case"LandMove2Action":this.script.action.install(Ei.MoveAction,Ha);break;case"LandMoveAction3":this.script.action.install(Ei.MoveAction,za);break;case"FlyMoveAction":this.script.action.install(Ei.MoveAction,Ta);break;case"FireArrowMoveAction":this.script.action.install(Ei.MoveAction,Ea);break;case"AniDeviceAction":this.script.action.install(Ei.MoveAction,Sa);break;case"CarMoveAction":this.script.action.install(Ei.MoveAction,Ba)}}onSkillInstallHandler(e){if(e.info)switch(e.info.tb.actionName){case"JumpAction":this.script.skill.install(e.pos,la,e.info);break;case"GuaiShouJumpAction":this.script.skill.install(e.pos,Oa,e.info);break;case"AttAction":this.script.skill.install(e.pos,ua,e.info);break;case"BianShenAction":this.script.skill.install(e.pos,Ua,e.info);break;case"BuWaWaAction":this.script.skill.install(e.pos,Fa,e.info);break;case"QianXingAction":this.script.skill.install(e.pos,Va,e.info);break;case"AddSpeedAction":this.script.skill.install(e.pos,pa,e.info);break;case"SkillAction":this.script.skill.install(e.pos,ma,e.info);break;case"SkillAction2":this.script.skill.install(e.pos,Ya,e.info);break;case"FireSkillAction":this.script.skill.install(e.pos,ka,e.info);break;case"PaoFireSkillAction":this.script.skill.install(e.pos,Ra,e.info);break;case"RangeSkillAction":this.script.skill.install(e.pos,Ca,e.info);break;case"TiggerSkillAction":this.script.skill.install(e.pos,La,e.info);break;case"cheTiggerSkillAction":this.script.skill.install(e.pos,Da,e.info);break;case"BoomSkillAction":this.script.skill.install(e.pos,ja,e.info);break;case"RangeEffectSkillAction":this.script.skill.install(e.pos,Ma,e.info);break;case"RopeAction":this.script.skill.install(e.pos,Pa,e.info);break;case"SwitchSky":this.script.skill.install(e.pos,ga,e.info);break;case"SwitchLand":this.script.skill.install(e.pos,ya,e.info);break;case"FlyUpAction":this.script.skill.install(e.pos,Aa,e.info);break;case"FlyDownAction":this.script.skill.install(e.pos,xa,e.info)}}onActionInstallHandler(e){if(e)for(var t=e.tb.equipAction.split("|"),i=0;i<t.length;i++){switch(a.skill.getTbBySkillId(Number(t[i])).actionName){case"GravityAction":this.script.action.install(Ei.GravityAction,ca)}}}onDestroy(){super.onDestroy()}}class Xa extends nt{constructor(){super(),this.hitcount=0}onEnable(){let e=this;super.onEnable(),e.init(),e.getCom(e.owner,Wa)||(e.control=e.addCom(e.owner,Wa)),e.movestate=Q.wait}init(){let e=this;e.script||(e.owner.state=1,e.script=e.getCom(e.owner,ht),e.script.movestate=Q.wait)}onAttHitHandler(){this.attHitHandler()}attHitHandler(){var e=this;if(e.script.hitTrigger)for(var t=t=>{Laya.Tween.to(t,{},100,null,initHandler(e,()=>{cafe.event.dispatch(se.GAME_TIGGER_REMOVE,t.getChildByName("body")),e.script.moveTrigger.delTrigger(t.getChildByName("body")),t.removeSelf(),t.destroy()}))},i=0;i<e.script.hitTrigger.kinematics.length;i++){var s=e.script.hitTrigger.kinematics[i];if(s.main&&(s=s.main),"move_hit"!=s.name){var a=s.tb;if(a){if(1!=a.type&&4!=a.type&&7!=a.type){var n=s.getComponent(Di);n||(n=s.addComponent(Di)).init(2,a.hp),n.hitHurt(e.script.info.is_buff_power?2*e.script.info.tb.attack:e.script.info.tb.attack),n.thing_hp<=0?("0"!=a.dieEffect&&s.transform&&Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_COMMON_EFFECT,[s,Number(a.dieEffect),1,2e3,.9]),mi.drop.addDrop(s),s.transform&&Li.BoomShow(s.transform.position.clone(),a.boomscale),oi.singleton.removeThing(s),e.script.hitTrigger.kinematics.splice(i,1),i--,t(s)):s.transform&&(Et.connect(kt.D3_GLOBAL_ANI,kt.ANI_COMMON_EFFECT,[s,Number(a.attEffect),1,1e3,.9]),ss.vibrate(s))}}else ss.vibrate(s)}}}onAttHandler(){this.script.saveFlyFromPos||(this.script.saveFlyFromPos=this.owner.transform.position.clone(),this.script.saveFlyFromRo=this.owner.transform.localRotationEuler.clone())}onUpdate(){if(mi.drop&&(super.onUpdate(),this.script&&Ve.map.mptData))if(this.owner){this.hitcount>0&&(this.hitcount%5==0&&this.attHitHandler(),this.hitcount--);var e=mi.drop.hitDrop(this.owner,this.script.info.is_buff_magnet);if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t].getChildByName("mode");if(i){i.getComponent(_t).playNext()}}}else this.destroy()}onDestroy(){let e=this;super.onDestroy(),e.script&&(e.script=null)}}class Ka extends Laya.Script3D{constructor(){super(),this.isHit=!1,this.isTrigger=!1;this.kinematics=[],cafe.event.on(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}onGameBodyDieHandler(e){var t=this.kinematics.indexOf(e);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1))}onUpdate(){this.kinematicSprite&&this.kinematicSprite.destroyed&&(this.isHit=!1,this.kinematicSprite=null)}isHitType(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];if(i.main&&(i=i.main),i.triggerType==e)return!0}return!1}onTriggerEnter(e){}delTrigger(e){if(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];i.main!=e&&i!=e||(this.kinematics.splice(t,1),t--)}this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1)}}onCollisionExit(e){this.lastMovePos&&(this.lastMovePos=null)}onCollisionStay(e){var t=e.other.owner.main;if(t&&!mi.device.currentMountGear&&0!=t.tb.collType){var i=ea.scene.player.owner.getComponent(Si).moveTarget.getComponent(Ri).isTrigger;if(1001==t.tb.collType){var s=e.other.owner.main.transform.position.clone(),n=ea.scene.player.owner.transform.position.clone(),o=Math.abs(s.x-n.x),r=Math.abs(s.z-n.z),l=Math.sqrt(o*o+r*r),h=Math.atan2(n.z-s.z,n.x-s.x),c=new Laya.Vector2;c.x=s.x+l*Math.cos(h+t.tb.collValue),c.y=s.z+l*Math.sin(h+t.tb.collValue),ea.scene.player.owner.transform.position=new Laya.Vector3(c.x,n.y,c.y)}else if(1002==t.tb.collType){var d=ea.scene.player.owner.transform.position.clone(),u=Xe.getBody(t,"Capsule").transform.position.clone();if(!this.lastMovePos)return void(this.lastMovePos=u);var p=posToAngleDist({x:this.lastMovePos.x,y:this.lastMovePos.z},{x:u.x,y:u.z}),m=calcAngleDist({x:d.x,y:d.z},p.d,p.a);ea.scene.player.owner.transform.position=new Laya.Vector3(m.x,d.y+(u.y-this.lastMovePos.y),m.y),this.lastMovePos=u}else if(1004==t.tb.collType&&!i){u=Xe.getBody(t,"Capsule").transform.position.clone(),s=e.other.owner.main.transform.position.clone(),d=ea.scene.player.owner.transform.position.clone(),p=posToAngleDist({x:u.x,y:u.z},{x:s.x,y:s.z});var g=t.tb.collValue;6==Ve.map.map.gamePkType&&(g=a.remon.getTbBySuoQuanId(Ve.game.suoQuanId).thingActionValue);m=calcAngleDist({x:d.x,y:d.z},g,p.a);-1==ea.scene.player.ani.state.indexOf("jump")?ea.scene.player.owner.transform.position=new Laya.Vector3(m.x,ea.scene.player.landY,m.y):ea.scene.player.owner.transform.position=new Laya.Vector3(m.x,d.y,m.y)}}}ClearTrigger(){this.kinematics=[],this.isTrigger=!1,this.isHit=!1}onDestroy(){super.onDestroy();cafe.event.off(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}}class Ja extends Laya.Script3D{constructor(){super(),this.isHit=!1,this.isTrigger=!1,this.isgo=!1,this.collF=0,this.mocaF=.5;this.kinematics=[],cafe.event.on(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}onGameBodyDieHandler(e){var t=this.kinematics.indexOf(e);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1))}onUpdate(){this.kinematicSprite&&this.kinematicSprite.destroyed&&(this.isHit=!1,this.kinematicSprite=null)}isHitType(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];if(i.main&&(i=i.main),i.triggerType==e)return!0}return!1}onTriggerEnter(e){}delTrigger(e){if(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];i.main!=e&&i!=e||(this.kinematics.splice(t,1),t--)}this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1)}}onCollisionEnter(e){var t=e.other.owner.main;if(t){if(t.tb.npcId&&t!=this.owner){var i=t.getComponent(fs);if(!i)return;if(-1!=i.ani.state.indexOf("jump"))return;t.transform.localRotationEulerY=ea.scene.player.owner.transform.localRotationEulerY;var s=i.ani.speed;i.ani.speed=2,i.ani.play(ie.liangqiang,initHandler(this,()=>{i.ani.speed=s}))}else{if(0==t.tb.collType)return;if(mi.device.currentMountGear)return;1e3!=t.tb.collType||Ve.game.isUnLockQiMa||this.StrikeToFly(e)}}}StrikeToFly(e){var t=e.contacts[0].colliderA.owner,i=e.contacts[0].colliderB.owner,s=1;t.main!=this.owner&&i.main==this.owner&&(s=2),t&&i&&(1==s?(this.hitone=e.contacts[0].positionOnA,this.hittwo=e.contacts[0].positionOnB):(this.hitone=e.contacts[0].positionOnB,this.hittwo=e.contacts[0].positionOnA),this.xangle=calcPosAngle({x:this.hitone.x,y:this.hitone.z},{x:this.hittwo.x,y:this.hittwo.z}),this.isgo=!0,this.collF=20,6==Ve.map.map.gamePkType&&(this.collF=a.remon.getTbBySuoQuanId(Ve.game.suoQuanId).thingActionValue))}onCollisionStay(e){var t=e.other.owner.main;if(t&&!mi.device.currentMountGear&&0!=t.tb.collType&&(1003==t.tb.collType||1002==t.tb.collType)){var i=e.contacts[0].colliderA.owner,s=e.contacts[0].colliderB.owner,a=1;if(i.main!=this.owner&&s.main==this.owner&&(a=2),i&&s){1==a?(this.hitone=e.contacts[0].positionOnA,this.hittwo=e.contacts[0].positionOnB):(this.hitone=e.contacts[0].positionOnB,this.hittwo=e.contacts[0].positionOnA),this.xangle=calcPosAngle({x:this.hitone.x,y:this.hitone.z},{x:this.hittwo.x,y:this.hittwo.z});var n=t.tb.collValue,o=this.owner.transform.position.clone(),r=calcAngleDist({x:o.x,y:o.z},n,this.xangle),l=new Laya.Vector3(r.x,o.y,r.y);this.owner.transform.position=l}}}onLateUpdate(){if(this.isgo){this.collF<=0&&(this.collF=0,this.isgo=!1),this.collF=this.collF-this.mocaF;var e=this.collF/100,t=ea.scene.player.owner.transform.position.clone(),i=calcAngleDist({x:t.x,y:t.z},e,this.xangle),s=new Laya.Vector3(i.x,t.y+=e/2,i.y);ea.scene.player.owner.transform.position=s}}ClearTrigger(){this.kinematics=[],this.isTrigger=!1,this.isHit=!1}onDestroy(){super.onDestroy();cafe.event.off(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}}class Za extends Laya.Script3D{constructor(){super(),this.isHit=!1,this.isTrigger=!1,this.colorList=[];this.kinematics=[],cafe.event.on(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}onGameBodyDieHandler(e){var t=this.kinematics.indexOf(e);-1!=t&&(this.kinematics.splice(t,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1))}onUpdate(){this.kinematicSprite&&this.kinematicSprite.destroyed&&(this.isHit=!1,this.kinematicSprite=null)}isHitType(e){for(var t=0;t<this.kinematics.length;t++){var i=this.kinematics[t];if(i.main&&(i=i.main),i.triggerType==e)return!0}return!1}onTriggerEnter(e){var t=e.owner;if((t=t.main)&&"player"!=t.name){if(t&&t.tb.funcType==Jt.Color&&-1==this.colorList.indexOf(t)){var i=t.getChildByName("body"),s=Xe.getMeshBody(i);if(s){var a=s.meshRenderer.material;a&&(a.albedoIntensity+=.2),this.colorList.push(t)}}if(this.kinematicSprite=e.owner,this.isHit=!0,-1==this.kinematics.indexOf(e.owner)&&this.isEnter&&this.isEnter(e)){this.kinematics.push(e.owner),this.isTrigger=!0;var n=e.owner;n.main&&(n=n.main),Ve.guide.isGuideBoolean(3)?Ve.guide.refSetup():Ve.guide.isGuideBoolean(4)&&n.triggerType==Pi.monster&&Ve.guide.refSetup()}this.handler&&this.handler.runWith([e])}}onTriggerStay(e){}onTriggerExit(e){var t=e.owner;if((t=t.main)&&"player"!=t.name){if(t&&t.tb.funcType==Jt.Color&&-1!=this.colorList.indexOf(t)){var i=t.getChildByName("body"),s=Xe.getMeshBody(i);if(s){var a=s.meshRenderer.material;a&&(a.albedoIntensity-=.2),this.colorList.splice(this.colorList.indexOf(t),1)}}this.kinematicSprite=null,this.isHit=!1;var n=this.kinematics.indexOf(e.owner);-1!=n&&(this.kinematics.splice(n,1),this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1));var o=e.owner;-1==o.name.indexOf("Cube")&&"0"!=o.name[3]||o.main&&o.main.dataStr&&(ea.scene.ui.btn_pon.visible=!1,cafe.event.dispatch(ge.game.TOOLCMD,"0|"+o.main.dataStr)),o.main&&37858==o.main.thingId&&this.owner.main==ea.scene.player.owner&&ea.scene.ui.CancelFUDJ();var r=e.owner;r.main&&(r=r.main),Ve.guide.isGuideBoolean(3)?Ve.guide.refSetup():Ve.guide.isGuideBoolean(4)&&r.triggerType==Pi.monster&&Ve.guide.refSetup()}}delTrigger(e){if(e){for(var t=0;t<this.kinematics.length;t++){this.kinematics[t].main==e&&(this.kinematics.splice(t,1),t--)}this.kinematics.length<=0&&(this.isTrigger=!1,this.isHit=!1)}}ClearTrigger(){this.kinematics=[],this.isTrigger=!1,this.isHit=!1}onDestroy(){super.onDestroy();cafe.event.off(se.GAME_TIGGER_REMOVE,this.onGameBodyDieHandler,this)}}class Qa extends Ni{constructor(){super(),this.isride=!1,this.isInitRole=!1,this.isShowReplace=!1,this.isHideReplace=!1,this.isSaving=!1,this.isOpenTask=!0}onEnable(){let e=this;var t=e.owner.getChildByName("mode"),i=t.getChildByName("body");e.mode=t,"tmode"==i.getChildAt(0).name?e.thingbody=i.getChildAt(0):e.thingbody=i,super.onEnable(),e.type=1,e.monitor(se.UPDATEROLESPEED,e.UpdateSpeed);var s=Xe.getBody(e.owner,"30022");s&&!Ve.game.isjiansu&&(s.active=!1);var a=Xe.getBody(e.owner,"30023");a&&!Ve.game.isjiasu&&(a.active=!1);var n=Xe.getBody(e.owner,"bosseff");n&&(n.active=!0)}initThing(){if(!this.thingbody){var e=this.owner.getChildByName("mode"),t=e.getChildByName("body");this.mode=e,"tmode"==t.getChildAt(0).name?this.thingbody=t.getChildAt(0):this.thingbody=t}var i=this.thingbody.getChildByName("mode");this.ani||(this.ani=this.addCom(this.owner,oe),i?this.ani.init(i,new Laya.Handler(this,this.onPlayerEnd)):this.ani.init(this.thingbody,new Laya.Handler(this,this.onPlayerEnd))),this.info||(this.info=new na,this.info.attribute=this.addCom(this.owner,at),0!=Ve.game.playerHp&&(this.info.attribute.thing_hp=Ve.game.playerHp),this.info.thingHandler=new Laya.Handler(this,this.onTbHandler)),this.action||(this.action=this.addCom(this.owner,ot)),this.effectaction||(this.effectaction=this.addCom(this.owner,ot)),this.buffaction||(this.buffaction=this.addCom(this.owner,ot)),this.skill||(this.skill=this.addCom(this.owner,rt)),this.ai||(this.ai=this.addCom(this.owner,Xa)),ea.scene.things[this.owner.name]=this.owner,ea.scene.player=this,this.anzhuang=Xe.getBody(this.owner,"anzhuang"),this.initEffect(),ea.weapon.equipWeapon(Ve.shop.equip_weapon),Ve.npc.getCurrNpc()&&ea.pet.localPet(Ve.npc.getCurrNpc().npcId),Ve.shop.getcurTuoWei()&&ea.tuowei.localTuoWei(Ve.shop.getcurTuoWei()),this.EffCreate(),this.FlyBagCreate()}FlyBagCreate(){var e=Xe.getBody(this.owner,"40001");if(e)return this.flybagowner=e,void this.FlyBagHidden();this.psp=Xe.getBody(this.owner,"cb"),this.psp?Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_40001_lh],this.owner,1,null,initHandler(this,e=>{this.flybagowner=e,this.flybagowner.transform.position=this.psp.transform.position,this.flybagowner.transform.rotation=this.psp.transform.rotation;var t=e.getChildByName("videoNode");t&&(t.active=!1),this.FlyBagHidden()})):console.log("当前模型缺少cb节点")}FlyBagDisplay(){this.flybagowner&&(this.flybagowner.active=!0)}FlyBagHidden(){this.flybagowner&&(this.flybagowner.active=!1)}UpdateFlyBagPos(){this.flybagowner&&(this.psp=Xe.getBody(this.owner,"cb"),this.flybagowner.transform.position=this.psp.transform.position,this.flybagowner.transform.rotation=this.psp.transform.rotation)}EffCreate(){var e=this,t=Xe.getBody(e.owner,"33009");t?e.JumpEffect=t:Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33009_lh],e.owner,1,null,initHandler(e,t=>{t.transform.localPosition=new Laya.Vector3(0,.02,0),e.JumpEffect=t}));var i=Xe.getBody(e.owner,"90002");i?(e.runEffect=i,e.runEffect.transform.rotation=e.owner.transform.rotation,e.runEffect.transform.localRotationEulerY+=180):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_90002_lh],e.owner,1,null,initHandler(e,t=>{t.transform.localPosition=new Laya.Vector3(0,.2,0),e.runEffect=t,e.runEffect.transform.rotation=e.owner.transform.rotation,e.runEffect.transform.localRotationEulerY+=180}));var s=Xe.getBody(e.owner,"90001");s?e.tpEffect=s:Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_90001_lh],e.owner,1,null,initHandler(e,t=>{t.transform.localPosition=new Laya.Vector3(0,1,0),e.tpEffect=t}))}StartTp(){this.tpEffect&&(this.tpEffect.active=!1,this.tpEffect.active=!0,this.tpEffect.transform.localPosition=new Laya.Vector3(0,.1,0),this.tpEffect.transform.localRotationEulerX=-90)}EndTp(){this.tpEffect&&(this.tpEffect.active=!1,this.tpEffect.active=!0,this.tpEffect.transform.localPosition=new Laya.Vector3(0,1.5,0),this.tpEffect.transform.localRotationEulerX=90)}ShowAttackCheckEffect(e=!1){this.attackCheckEffect&&(1==Ve.map.map.gametype?(this.lv||(this.lv=Xe.getBody(this.attackCheckEffect,"lv")),this.hong||(this.hong=Xe.getBody(this.attackCheckEffect,"hong")),this.lv&&this.hong&&(this.lv.active=!e,this.hong.active=e)):this.attackCheckEffect.active=!1)}showReplace(){}hideReplace(){}checkType(e){for(var t=this.info.tb.roleTypes.split("|"),i=0;i<t.length;i++)if(e==Number(t[i]))return!0;return!1}checkThingType(e){for(var t=this.info.tb.roleThingTypes.split("|"),i=0;i<t.length;i++)if(e==Number(t[i]))return!0;return!1}hitHurt(e){return!1}onTbHandler(){var e=this;if(e.move_speed=e.info.tb.speed,e.move_anispeed=e.info.tb.moveanispeed,ea.scene.ui){if(e.isInitRole){var t=this.thingbody.getChildByName("mode");e.ani=t?e.addCom(t,oe):e.addCom(e.thingbody,oe)}else ea.scene.switchControl(!1),ea.scene.cameraCode.lockTarget=ea.scene.player.owner,cafe.event.dispatch(se.PLAYER_GAMESCENE_PLAYER_COUNT),e.isInitRole=!0;e.hitTrigger&&e.hitTrigger.destroy(),e.hitTarget=Xe.getBody(e.owner,"group_hit"),e.hitTarget&&(e.hitTrigger=e.addCom(e.hitTarget,Ja),e.hitTrigger.owner=e.owner,e.hitTrigger.isEnter=(t=>e.triggerEnter(t))),e.bodyTrigger&&e.bodyTrigger.destroy(),e.bodyTarget=e.thingbody,e.bodyTarget&&(e.bodyTrigger=e.addCom(e.bodyTarget,Ci),e.bodyTrigger.isEnter=(t=>e.bodyTriggerEnter(t))),e.moveTrigger&&e.moveTrigger.destroy(),e.moveTarget=Xe.getBody(e.owner,"move_hit"),e.moveTarget&&(e.moveTrigger=e.addCom(e.moveTarget,Ri),e.moveTrigger.ClearTrigger(),e.moveTrigger.isEnter=(t=>(!t.owner||!t.owner.main||-1==t.owner.main.name.indexOf("monster"))&&e.onMoveTrigger(t))),e.uMoveTrigger&&e.uMoveTrigger.destroy(),e.uMoveTarget=Xe.getBody(e.owner,"umove_hit"),e.uMoveTarget&&(e.uMoveTrigger=e.addCom(e.uMoveTarget,Ri),e.uMoveTrigger.ClearTrigger(),e.uMoveTrigger.isEnter=(t=>e.onMoveTrigger(t))),e.dMoveTrigger&&e.dMoveTrigger.destroy(),e.dMoveTarget=Xe.getBody(e.owner,"dmove_hit"),e.dMoveTarget&&(e.dMoveTrigger=e.addCom(e.dMoveTarget,Za),e.dMoveTrigger.ClearTrigger(),e.dMoveTrigger.isEnter=(t=>e.onMoveTrigger(t))),e.dMoveTarget2=Xe.getBody(e.owner,"dmove_hit2"),e.dMoveTrigger2=e.addCom(e.dMoveTarget2,Ka),e.attackTrigger&&e.attackTrigger.destroy(),e.attackTarget=Xe.getBody(e.owner,"attack_hit"),e.attackTarget&&(e.attackTrigger=e.addCom(e.attackTarget,Ci),e.attackTrigger.isEnter=(t=>e.onAttackTrigger(t))),e.skillTrigger&&e.skillTrigger.destroy(),e.skillTarget=Xe.getBody(e.owner,"skill_hit"),e.skillTarget&&(e.skillTrigger=e.addCom(e.skillTarget,Ci),e.skillTrigger.isEnter=(t=>e.onAttackTrigger(t))),e.findTrigger&&e.findTrigger.destroy(),e.findTarget=Xe.getBody(e.owner,"find_hit"),e.findTarget&&(e.findTrigger=e.addCom(e.findTarget,Ci),e.findTrigger.isEnter=(t=>e.onfindTrigger(t)));var i=Ve.map.map.scale;e.info.attribute.init(1,e.info.tb.hp),e.info.speed=e.info.tb.speed*i/1e5,e.info.addSpeed=e.info.tb.roleStartAddMoveSpeed*i/1e5}}UpdateSpeed(){var e=this.owner.getComponent(at);this.move_speed=e.max_Speed;var t=Ve.map.map.scale;this.info.speed=e.max_Speed*t/1e5}ClearTrigger(){this.uMoveTrigger.ClearTrigger(),this.dMoveTrigger.ClearTrigger(),super.ClearTrigger()}bodyTriggerEnter(e){var t=e.owner;return!!t&&("move_hit"!=t.name&&"group_hit"!=t.name&&"group_uninstall"!=t.name&&"dmove_hit"!=t.name&&"umove_hit"!=t.name&&!!(t&&t.parent&&t.parent.parent))}hit(e){-1==this.ani.state.indexOf("attack")&&this.ani.state!=ie.show&&this.ani.state!=ie.attack101&&this.ani.state!=ie.attack102&&this.ani.state!=ie.attack103&&this.ani.state!=ie.attack201&&this.ani.state!=ie.attack202&&this.ani.state!=ie.attack203&&this.ani.state!=ie.attack2&&this.ani.state!=ie.qiang&&this.ani.state!=ie.che&&this.ani.state!=ie.skill&&(this.ani.speed=Math.floor(this.info.tb.delay/100*10*100)/100,this.ani.state!=ie.jump1&&this.ani.state!=ie.jump3&&this.playAni(ie.hit))}onDestroy(){this.isdispose||(this.isdispose=!0,super.onDestroy())}}class $a extends ia{constructor(){super(...arguments),this.isFrist=!0,this.isHangup=!1,this.isthing=!1}initRes(e,t,i,s){$a.isInit=!0,super.initRes(e,t,i,s),$a.ModelSpriteType=le.type_role,$a.MptEnumType=J.ROLE;var n=a.role.getTbByRoleId(Number(Ve.game.roleid));this.createtime=(new Date).getTime(),this.tbId=n.roleId,this.triggerType=Pi.role,this.hp=n.hp,this.tb=a.role.getTbByRoleId(n.roleId),this.mod=new Laya.Sprite3D("mode"),this.mod.transform.localPosition=new Laya.Vector3(0,0,0),this.mod.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.addChild(this.mod),Ve.map.mptData.playerBody=this,this.onRefThing()}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length;e.modelType;if(!e._isWork){e._isWork=!0;var s=i=>{var s=i.res;e.rolething&&e.rolething.destroy(),e.mode&&e.mode.removeSelf();var a=Ve.role.test_role?Ve.role.rolemap[Ve.role.test_role].tb:Ve.role.getCurrRole().tb;Tn.inst.load3d.thingRes(e.resFunc(a.roleMod+".lh"),e.mod,initHandler(e,a=>{if(a){var n=e.getChildByName("33006");n?(n.active=!1,n.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],e,1,null,initHandler(e,e=>{e.transform.localPosition=new Laya.Vector3(0,.5,0)})),e.isthing=!1,e.isFrist||(Tn.inst.sound.play(15053),Ve.map.mptData.mptModel[J.ROLE].pushRole(e));var o=i.thing.offY?i.thing.offY:0;a.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),a.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),a.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),a.name="body",a.main=e,e.mode=a,Xe.setBodyMainPy(a,e),e.bpmode=a.getChildByName("bpmode"),e.rolething=e.addComponent(Qa),e.rolething||(e.rolething=e.addComponent(Qa)),e.rolething.initThing(),e.rolething.info.tb=Ve.role.getCurrRole().tb,cafe.event.dispatch(ge.game.ROLE_REPLACE_FINISH),e.isHangup=!1,e.isFrist&&setTimeout(()=>{cafe.event.dispatch(se.MAP_ROLE_LOADED)},100),1==e._distancetype?(a.active=!0,e.premode.active=!1):a.active=!1,e.isFrist=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",s)}),ue.LevelB)};for(let e=0;e<i;e++){s(t.resThing[e])}}}loadThing(e){var t=this,i=t.dthing,s=t.dthing.resThing.length;if(!t._isWork&&e&&e.Id)if(t.rolething&&(Ve.game.playerHp=t.rolething.info.attribute.thing_hp),1==e.isrole&&t.isthing||null!=e.isrole&&1==e.isrole)t.load();else{t._isWork=!0;var a=i=>{t.rolething&&t.rolething.destroy(),t.mode&&t.mode.removeSelf(),Tn.inst.load3d.thingRes(t.resFunc("11810077.lh"),t.getChildByName("mode"),initHandler(t,s=>{if(s){t.isthing=!0,Tn.inst.sound.play(15053);var a=Xe.getBody(t,"33006");a?(a.active=!1,a.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],t,1,null,initHandler(t,e=>{e.transform.localPosition=new Laya.Vector3(0,.5,0)}));i.thing.offY&&i.thing.offY;s.transform.localPosition=new Laya.Vector3(0,0,0),s.transform.localRotationEuler=new Laya.Vector3(0,0,0),s.transform.localScale=new Laya.Vector3(1,1,1),e.scale&&(s.transform.localScale=new Laya.Vector3(e.scale,e.scale,e.scale)),s.name="body",s.main=t,t.mode=s,Xe.setBodyMainPy(s,t),t.bpmode=s.getChildByName("bpmode");var n=Xe.getBody(s,"boneNode");Tn.inst.load3d.thingRes(ce.getBuildUrl(e.Id+".lh"),n,initHandler(t,e=>{e.isrole=!0,e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),e.transform.localScale=new Laya.Vector3(1,1,1)})),Ve.map.mptData.mptModel[J.ROLE].pushRole(t),t.rolething=t.addComponent(Qa),t.rolething.initThing(),t.rolething.info.tb=Ve.role.getCurrRole().tb,cafe.event.dispatch(ge.game.ROLE_REPLACE_FINISH),t.isHangup=!1,t.isFrist&&setTimeout(()=>{cafe.event.dispatch(se.MAP_ROLE_LOADED)},100),1==t._distancetype?(s.active=!0,t.premode.active=!1):s.active=!1,t.isFrist=!1,t._isWork=!1}else serror("mapThingRes加载资源失败：",e.Id)}))};for(let e=0;e<s;e++){a(i.resThing[e])}}}onEnable(){super.onEnable();Ve.game.playerHp=0,cafe.event.on(Z.EQUIP_ROLE,this.hangup,this),cafe.event.on(se.GAME_PLAYER_ACTION_REF,this.onPlayerActionRef,this),cafe.event.on(se.LOADTHING,this.loadThing,this)}onPlayerActionRef(){!mi.core.isSpawnHealth&&this.rolething&&this.rolething.action.isInstall(Ei.MoveAction)&&!be.IsOpenPanel()&&this.load()}hangup(){this.isHangup=!0,this.onPlayerActionRef()}onRefThing(e){this._distancetype=1,this.mode?(this.premode.active=!1,this.mode.active=!0):(this.premode.active=!0,this.load())}static getThing(e){return super.getThing(e)}static getThingList(){return super.getThingList()}static getThingListById(e){return super.getThingListById(e)}onDestroy(){super.onDestroy();$a.isInit=!1,cafe.event.off(Z.EQUIP_ROLE,this.load,this),cafe.event.off(se.LOADTHING,this.loadThing,this),cafe.event.off(se.GAME_PLAYER_ACTION_REF,this.onPlayerActionRef,this)}}$a.isInit=!1;class en extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),en.ModelSpriteType=le.type_npc,en.MptEnumType=J.THING;var n=a.npc.getTbByConfigId(Number(i.thingId));this.triggerType=Pi.monster;this.addComponent(fs);this.createtime=(new Date).getTime(),this.tbId=n.npcId,this.hp=100,this.tb=n}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=i=>{var a=i.res;Tn.inst.load3d.thingRes(e.resFunc(a),e,initHandler(e,n=>{if(n){var o=i.thing.offY?i.thing.offY:0;n.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),n.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),n.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),n.name="body",n.main=e,e.mode=n,Xe.setBodyMainPy(n,e),e.bpmode=n.getChildByName("bpmode");var r=e.getComponent(fs);r||(r=e.addComponent(fs)),r.initThingTb(s),r.ani.curAniState!=r.ani.state&&r.playAni(r.ani.curAniState),1==e._distancetype&&(-1!=Ve.npc.npc_list.indexOf(n.main.tb.npcId)||2!=Math.floor(Ve.map.mapId/1e3))?(n.active=!0,ea.scene.cameraCode.addMode(e.bpmode),e.premode.active=!1):n.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",a)}),ue.LevelE)};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("40"==t[0]){var i=t[1].split("_"),s=Ve.task.getMainLineTask(),a=!1;if(s)for(var n=s.taskId,o=0;o<i.length;o++){var r=i[o].split(":");if(Number(r[0])<=n&&0==Number(r[1])){a=!0;break}if(Number(r[1])>=n&&0==Number(r[0])){a=!0;break}if(Number(r[1])>=n&&Number(r[0])<=n){a=!0;break}}if(!a)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:if(this.mode)if(3==Ve.game.MaoMaoGameType){var l=this.getComponent(fs);l&&l.ai&&l.isbianshen||(this.premode.active=!1,this.mode.active=!0,ea.scene.cameraCode.addMode(this.bpmode))}else this.premode.active=!1,this.mode.active=!0,ea.scene.cameraCode.addMode(this.bpmode);else this.premode.active=!0,this.load();break;case 2:this.mode?this.mode&&(this.mode.active=!1):this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:this.mode?this.mode&&(this.mode.active=!1):this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode);break;default:this.mode&&(this.mode.active=!1),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode)}}onDestroy(){super.onDestroy()}}class tn extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),tn.ModelSpriteType=le.type_carnpc,tn.MptEnumType=J.THING;var n=a.thing.getTbByConfigId(Number(i.thingId));this.addComponent(ji);this.createtime=(new Date).getTime(),this.tbId=n.thingId,this.hp=n.hp,this.tb=n}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=i=>{var a=i.res;Tn.inst.load3d.thingRes(e.resFunc(a),e,initHandler(e,n=>{if(n){var o=i.thing.offY?i.thing.offY:0;if(n.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),n.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),n.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),n.name="body",n.main=e,e.mode=n,e.bpmode=n.getChildByName("bpmode"),Xe.setBodyMainPy(n,e),6==s.type){var r=e.getComponent(ji);r||(r=e.addComponent(ji)),r.initThingTb(s)}1==e._distancetype?(n.active=!0,ea.scene.cameraCode.addMode(e.bpmode),e.premode.active=!1):n.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",a)}),ue.LevelE)};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onDestroy(){super.onDestroy();this.getComponent(ji).destroy()}}!function(e){e.SHELL_DROP="SHELL_DROP",e.FONT_NUMBER="FONT_NUMBER",e.filter_0=function(){return new Laya.ColorFilter([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,.5,0])},e.filter_1=function(){return new Laya.ColorFilter([.7647,0,0,0,0,.7254,0,0,0,0,.6196,0,0,0,0,0,0,0,1,0])},e.filter_2=function(){return new Laya.ColorFilter([.4,0,0,0,0,.3058,0,0,0,0,.2784,0,0,0,0,0,0,0,1,0])}}(De||(De={})),function(e){class t{}t.NORMAL=1,t.WARN=2,e.action_state=t;class i{}i.not=0,i.action=1,i.gold=2,i.light=3,e.money_type=i}(Ne||(Ne={})),function(e){e.money_CH_key_dic={0:"无",1:"体力",2:"金币",3:"灯泡",4:"兑换劵"},e.money_path_key_dic={0:"",1:"res/common/img_action.png",2:"res/common/img_icon_gold.png",3:"res/common/dengpao_img.png",4:"res/common/img_duihuanq.png"},e.money_num_key_dic={0:0,1:1,2:100,3:1,4:1}}(je||(je={}));class sn extends nt{constructor(){super(),this.workaiCount=0,this.workaiCount2=0,this.isDeviate=!1,this.isDeviate2=!1,this.speed=.01,this.warnCount=0,this.warnMaxCount=180,this.warnTime=0,this.warnMaxTime=180,this.attCount=0,this.attMaxCount=180,this.nextAttCount=0,this.nextAttMaxCount=60,this.warnAttCount=0,this.warnAttMaxCount=100,this.isride=!1}onEnable(){let e=this;if(!e.script){e.initPos=e.owner.transform.position.clone(),e.owner.name="npc"+e.owner._id,e.owner.state,e.state=Ne.action_state.NORMAL;var t=e.getCom(e.owner,an);e.script=t,e.totalTime=30,e.time=e.totalTime,e.moveIndex=0,e.owner.ai=e,e.script.playAni(ie.idle),e.checkAction=e.addCom(e.owner,Yi),e.monitor(se.GAME_PLAYER_DIE,e.onPlayerDie),e.monitor(se.GAME_NPC_CH,e.onPlayerDie),e.isride=!1}e.getCom(e.owner,Zi)||(e.control=e.addCom(e.owner,Zi))}onPlayerDie(){this.warnTime=0,this.warnCount=0,this.attCount=0,this.workaiCount=0,this.nextAttCount=0,this.state=Ne.action_state.NORMAL,this.script.playAni(ie.idle)}npcLineAi(){var e,t=this.owner.transform.position.clone(),i=this.speed;e=this.moveIndex>=this.script.pathinfo.lines.length-1?this.script.pathinfo.lines[0]:this.script.pathinfo.lines[this.moveIndex+1];var s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[1]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a);s.d<=n&&(this.moveIndex++,this.moveIndex>=this.script.pathinfo.lines.length&&(this.moveIndex=0),e=this.moveIndex>=this.script.pathinfo.lines.length-1?this.script.pathinfo.lines[0]:this.script.pathinfo.lines[this.moveIndex+1],s=posToAngleDist({x:t.x,y:t.z},{x:e[0],y:e[1]}),a=calcAngleDist({x:t.x,y:t.z},i,s.a),n=getDistance({x:t.x,y:t.z},a));var o=calcPosAngle({x:t.x,y:-t.z},{x:e[0],y:-e[1]},!0);this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(a.x,t.y,a.y));var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z),this.saveMovePos=this.owner.transform.position.clone()}npcDeviateLineAi(){var e=this.owner.transform.position.clone(),t=this.saveMovePos.clone(),i=this.speed,s=posToAngleDist({x:e.x,y:e.z},{x:t.x,y:t.z}),a=calcAngleDist({x:e.x,y:e.z},i,s.a),n=calcPosAngle({x:e.x,y:-e.z},{x:t.x,y:-t.z},!0);this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(a.x,e.y,a.y));var o=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(o.x,n,o.z),getDistance({x:this.owner.transform.position.x,y:this.owner.transform.position.z},{x:this.saveMovePos.x,y:this.saveMovePos.z})<=i&&(this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(this.saveMovePos.x,this.saveMovePos.y,this.saveMovePos.z)),this.isDeviate=!1)}npcTrackAi(e,t=!1){var i=this.owner.transform.position.clone(),s=e.transform.position.clone(),a=this.speed,n=posToAngleDist({x:i.x,y:i.z},{x:s.x,y:s.z}),o=calcAngleDist({x:i.x,y:i.z},a,n.a),r=calcPosAngle({x:i.x,y:-i.z},{x:s.x,y:-s.z},!0);this.anglevalue={a:n.a,ae:r},!this.script.checkTrigger.isTrigger||this.script.checkHitTrigger.isTrigger||t||(this.owner.transform.position=new Laya.Vector3(o.x,i.y,o.y));var l=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(l.x,r,l.z)}npcTrackWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(i.x,e.y,i.y));var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}npcEscapeAi(e){var t=this.owner.transform.position.clone(),i=e.transform.position.clone(),s=this.speed,a=posToAngleDist({x:i.x,y:i.z},{x:t.x,y:t.z}),n=calcAngleDist({x:t.x,y:t.z},s,a.a),o=calcPosAngle({x:i.x,y:-i.z},{x:t.x,y:-t.z},!0);this.anglevalue={a:a.a,ae:o},this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(n.x,t.y,n.y));var r=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(r.x,o,r.z)}npcEscapeWorkAi(){var e=this.owner.transform.position.clone(),t=this.speed,i=calcAngleDist({x:e.x,y:e.z},t,this.anglevalue.a);this.script.checkTrigger.isTrigger&&!this.script.checkHitTrigger.isTrigger&&(this.owner.transform.position=new Laya.Vector3(i.x,e.y,i.y));var s=this.owner.transform.rotationEuler.clone();this.owner.transform.rotationEuler=new Laya.Vector3(s.x,this.anglevalue.ae,s.z)}onUpdate(){let e=this;if(Ve.game.isStartGame&&!ea.scene.isGameEnd&&!ea.scene.GamePause)if(e.state==Ne.action_state.NORMAL)if(mi.core.isSpawnHealth&&mi.core.bloodTarget==e.owner)e.warnCount+=2,e.warnCount>=e.warnMaxCount&&(e.state=Ne.action_state.WARN,slog("切换为警戒模式1"),e.warnTime=0,e.warnCount=0);else if(e.script&&e.script.tbthing&&ea.scene.player&&ea.scene.player.owner){if(e.script&&e.script.tbthing&&ea.scene.player&&ea.scene.player.owner){if(e.isride){if(e.rideTarget){if(!(c=(s=e.rideTarget).getChildByName("body")))return;var t=(d=c.getChildByName("group_body")).transform.position.clone(),i=d.transform.rotationEuler.clone();e.owner.transform.position=t.clone(),30051==s.tb.thingId||30052==s.tb.thingId?e.owner.transform.rotationEuler=new Laya.Vector3(i.x-90,i.y,i.z):e.owner.transform.rotationEuler=new Laya.Vector3(i.x+90,i.y,i.z),e.script.playAni(ie[s.tb.rideAniName])}return}var s=(l=e.checkAction.checkAll(5,3,3)).mode,a=(o=ea.scene.player.owner).transform.position,n=e.owner.transform.position;if(getDistance({x:a.x,y:a.z},{x:n.x,y:n.z})>5)if(s&&3==s.tb.type){if(!(c=s.getChildByName("body")))return;t=(d=c.getChildByName("group_body")).transform.position.clone(),i=d.transform.rotationEuler.clone();e.script.playAni(ie[s.tb.rideAniName]),e.owner.transform.position=new Laya.Vector3(t.x,t.y,t.z),30051==s.tb.thingId||30052==s.tb.thingId?e.owner.transform.rotationEuler=new Laya.Vector3(i.x-90,i.y,i.z):e.owner.transform.rotationEuler=new Laya.Vector3(i.x+90,i.y,i.z),e.rideTarget=s,e.isride=!0}else e.warnTime++,e.warnTime>=e.warnMaxTime&&(e.warnCount=0,e.warnTime=0);else e.warnCount>=e.warnMaxCount/2?(e.warnCount++,e.warnCount>=e.warnMaxCount&&(e.state=Ne.action_state.WARN,slog("切换为警戒模式2"),e.warnTime=0,e.warnCount=0)):(e.warnCount--,e.warnCount<0&&(e.warnTime=0,e.warnCount=0))}}else e.warnTime++,e.warnTime>=e.warnMaxTime&&(e.warnCount=0,e.warnTime=0);else if(e.state==Ne.action_state.WARN)if(e.script&&e.script.tbthing&&ea.scene.player&&ea.scene.player.owner){var o=ea.scene.player.owner;if(!e.isride&&o&&e.script.hitTrigger&&e.script.hitTrigger.isTrigger){e.script.ani.state!=ie.heixuanfeng&&e.script.playAni(ie.heixuanfeng);var r=o.getComponent(at);r&&(e.nextAttCount++,e.nextAttCount>e.nextAttMaxCount&&(e.nextAttCount=0,e.script.hitTrigger.isTrigger&&(r.hitHurt(e.script.tbthing.attack),cafe.event.dispatch(se.GAME_ZD_EFFECT,!0))))}else if(mi.core.isSpawnHealth&&mi.core.bloodTarget==e.owner);else{a=o.transform.position,n=e.owner.transform.position;if(getDistance({x:a.x,y:a.z},{x:n.x,y:n.z})>5)e.warnTime++,e.warnTime>=e.warnMaxTime&&(e.state=Ne.action_state.NORMAL,e.isride||e.script.playAni(ie.idle),slog("切换为正常模式"),e.warnTime=0,e.warnCount=0);else{var l=e.checkAction.checkAll(2,1),h=ie.heixuanfeng;if(e.isride){if(e.rideTarget){if(!(c=(s=e.rideTarget).getChildByName("body")))return;t=(d=c.getChildByName("group_body")).transform.position.clone(),i=d.transform.rotationEuler.clone();e.owner.transform.position=t.clone(),30051==s.tb.thingId||30052==s.tb.thingId?e.owner.transform.rotationEuler=new Laya.Vector3(i.x-90,i.y,i.z):e.owner.transform.rotationEuler=new Laya.Vector3(i.x+90,i.y,i.z),e.script.playAni(ie[s.tb.rideAniName])}return}if(e.script.ani.state==h){if(e.attCount++,!(e.attCount>=e.attMaxCount))return;e.isride||e.script.playAni(ie.run),e.attCount=0}if((s=(l=e.checkAction.checkAll(5,3)).mode)&&3==s.tb.type){var c;if(!(c=s.getChildByName("body")))return;var d;t=(d=c.getChildByName("group_body")).transform.position.clone(),i=d.transform.rotationEuler.clone();e.script.playAni(ie[s.tb.rideAniName]),e.owner.transform.localPosition=t.clone(),30051==s.tb.thingId||30052==s.tb.thingId?e.owner.transform.localRotationEuler=new Laya.Vector3(i.x-90,i.y,i.z):e.owner.transform.localRotationEuler=new Laya.Vector3(i.x+90,i.y,i.z),e.rideTarget=s,e.isride=!0}else(l=e.checkAction.checkAll(1,1))&&l.mode?e.isDeviate2?e.workaiCount2>0?(e.npcEscapeWorkAi(),e.workaiCount2--):e.isDeviate2=!1:(e.npcEscapeAi(l.mode),e.isride||e.script.playAni(ie.run),e.workaiCount2=10,e.isDeviate2=!0):(l=e.checkAction.checkAll(2,1))&&l.mode?(e.npcTrackAi(l.mode,!0),e.isride||e.script.playAni(ie.idle)):(l=e.checkAction.checkAll(5,1))&&l.mode?(e.npcTrackAi(l.mode),e.isride||e.script.playAni(ie.run),e.workaiCount=100,e.isDeviate=!0):e.workaiCount>0?(e.npcTrackWorkAi(),e.workaiCount--):e.isDeviate=!1}}}else e.warnTime--,e.warnTime<0&&(e.warnTime=0)}onDestroy(){super.onDestroy()}}class an extends Ni{constructor(){super()}onEnable(){this.thingbody||(this.thingbody=this.owner),super.onEnable(),this.type=5}initThingTb(e){var t=this,i=t.owner.getChildByName("body"),s=i;t.ani=t.addCom(t.owner,oe),s?t.ani.init(s,new Laya.Handler(t,t.onPlayerEnd)):t.ani.init(i,new Laya.Handler(t,t.onPlayerEnd)),t.ai||(t.ai=t.addCom(t.owner,sn)),t.state||(t.state=t.addCom(t.owner,lt)),t.tbthing=e,ea.scene.things[t.owner.name]=t.owner,t.moveTarget=i.getChildByName("group_move"),t.moveTarget&&(t.moveTrigger=t.addCom(t.moveTarget,Ci),t.moveTrigger.isEnter=(e=>t.moveTriggerEnter(e))),t.hitTarget=i.getChildByName("group_hit"),t.hitTarget&&(t.hitTrigger=t.addCom(t.hitTarget,Ci),t.hitTrigger.isEnter=(e=>t.hitTriggerEnter(e))),t.checkTarget=i.getChildByName("group_check"),t.checkTarget&&(t.checkTrigger=t.addCom(t.checkTarget,Ci),t.checkTrigger.isEnter=(e=>t.checkTriggerEnter(e))),t.checkHitTarget=i.getChildByName("group_checkhit"),t.checkHitTarget&&(t.checkHitTrigger=t.addCom(t.checkHitTarget,Ci),t.checkHitTrigger.isEnter=(e=>t.checkHitTriggerEnter(e))),t.bloodBodys=Xe.getBodys(t.owner,"hit"),t.weapon=Xe.getBodys(t.owner,"weapon")[0],t.weaponEffect=Xe.getBodys(t.owner,"weaponEffect")[0],t.weapon&&(t.weapon.active=!1),t.weaponEffect&&(t.weaponEffect.active=!1),t.owner.tb=t.tbthing,t.owner.npcId=t.tbthing.thingId}checkTriggerEnter(e){var t=e.owner;return-1!=t.name.indexOf("Cube")||-1!=t.name.indexOf("Sand_01")}checkHitTriggerEnter(e){return-1!=e.owner.name.indexOf("Cube")}moveTriggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(ht);return!("body"!=e.owner.name||!i)}hitTriggerEnter(e){var t=e.owner;if(!t||!t.parent||!t.parent.parent)return!1;var i=t.parent.parent.getComponent(ht);return!("body"!=e.owner.name||!i)}playAni(e){super.playAni(e),e==ie.heixuanfeng?(this.weapon&&(this.weapon.active=!0),this.weaponEffect&&(this.weaponEffect.active=!0)):(this.weapon&&(this.weapon.active=!1),this.weaponEffect&&(this.weaponEffect.active=!1))}get tbthing(){return this._thing}set tbthing(e){this._thing=e,this.ai.speed=this.tbthing.speed/1e5,this.ani.speed=this.tbthing.anispeed}onDestroy(){this.isdispose||(this.isdispose=!0,super.onDestroy())}}class nn extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),nn.ModelSpriteType=le.type_wznpc,nn.MptEnumType=J.ROLE;var n=a.thing.getTbByConfigId(Number(i.thingId));this.triggerType=n.type;this.addComponent(an);this.createtime=(new Date).getTime(),this.tbId=n.thingId,this.hp=n.hp,this.tb=n}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=t=>{var i=t.res;Tn.inst.load3d.thingRes(e.resFunc(i),e,initHandler(e,a=>{if(a){t.thing.offY&&t.thing.offY;a.transform.localPosition=new Laya.Vector3(t.thing.x,0,t.thing.z),a.transform.localRotationEuler=new Laya.Vector3(t.thing.rX,t.thing.rY,t.thing.rZ),a.transform.localScale=new Laya.Vector3(t.thing.l,1,t.thing.w),a.name="body",a.main=e,e.mode=a,Xe.setBodyMainPy(a,e),e.bpmode=a.getChildByName("bpmode"),e.locationBloodList=Xe.getBodys(a,"blood");var n=e.getComponent(an);n||(n=e.addComponent(an)),n.initThingTb(s),n.ani.curAniState!=n.ani.state&&n.playAni(n.ani.curAniState),1==e._distancetype?(a.active=!0,e.isSelect&&ea.scene.cameraCode.addMode(e.bpmode),e.premode.active=!1):a.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",i)}))};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("40"==t[0]){var i=t[1].split("_"),s=Ve.task.getMainLineTask(),a=!1;if(s)for(var n=s.taskId,o=0;o<i.length;o++){var r=i[o].split(":");if(Number(r[0])<=n&&0==Number(r[1])){a=!0;break}if(Number(r[1])>=n&&0==Number(r[0])){a=!0;break}if(Number(r[1])>=n&&Number(r[0])<=n){a=!0;break}}if(!a)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:if(this.mode){this.premode.active=!1,this.mode.active=!0;var l=this.getComponent(an);l.ani.curAniState&&l.playAni(l.ani.curAniState),this.isSelect&&ea.scene.cameraCode.addMode(this.bpmode)}else this.premode.active=!0,this.load();break;case 2:this.mode?this.mode.active=!1:this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:this.mode?this.mode.active=!1:this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode);break;default:this.mode&&(this.mode.active=!1),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode)}}static getThing(e){return super.getThing(e)}static getThingList(){return super.getThingList()}static getThingListById(e){return super.getThingListById(e)}onDestroy(){super.onDestroy()}}class on extends ia{constructor(){super(...arguments),this.exitCar=!1}initRes(e,t,i,s){super.initRes(e,t,i,s),on.ModelSpriteType=le.type_device,on.MptEnumType=J.DEVICE;var n=a.device.getTbByConfigId(Number("0"!=s?s:i.thingId));"0"!=s?(n=a.device.getTbByDeviceId(Number(s)),this.exitCar=!0):n=a.device.getTbByConfigId(Number(i.thingId)),this.triggerType=Pi.device;this.addComponent(ba);this.createtime=(new Date).getTime(),n||console.log(i),this.tbId=n.deviceId,this.tb=n}setInitPoint(e){if(super.setInitPoint(e),5==this.tb.deviceType){var t=Ve.carlib.getLastCar();t&&ea.car.loadCar(this,t.shopId)}}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=i=>{var a;a="0"!=e.dataStr?e.tb.configId+".lh":i.res,Tn.inst.load3d.thingRes(e.resFunc(a),e,initHandler(e,n=>{if(n){var o=i.thing.offY?i.thing.offY:0;n.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),n.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),n.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),n.name="body",n.main=e,e.mode=n,Xe.setBodyMainPy(n,e),e.bpmode=n.getChildByName("bpmode");var r=e.getComponent(ba);r||(r=e.addComponent(ba)),r.initThingTb(s),r.ani&&(r.ani.curAniState!=r.ani.state&&r.playAni(r.ani.curAniState),r.ani.speed=e.tb.ani_speed),"0"!=e.dataStr&&(n.transform.localRotationEulerY+=-90,n.transform.localPositionX+=.5,n.transform.localPositionZ-=.25,r.playAni(ie.idle)),1==e._distancetype?(n.active=!0,ea.scene.cameraCode.addMode(e.bpmode),e.premode.active=!1):n.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",a)}),ue.LevelD)};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("40"==t[0]){var i=t[1].split("_"),s=Ve.task.getMainLineTask(),a=!1;if(s)for(var n=s.taskId,o=0;o<i.length;o++){var r=i[o].split(":");if(Number(r[0])<=n&&0==Number(r[1])){a=!0;break}if(Number(r[1])>=n&&0==Number(r[0])){a=!0;break}if(Number(r[1])>=n&&Number(r[0])<=n){a=!0;break}}if(!a)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:this.mode?(this.premode.active=!1,this.mode.active=!0,ea.scene.cameraCode.addMode(this.bpmode)):(this.premode.active=!0,this.load());break;case 2:this.mode||this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:default:this.mode||this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode)}}onDestroy(){super.onDestroy()}}class rn extends ia{initRes(e,t,i,s){super.initRes(e,t,i,s),rn.ModelSpriteType=le.type_monster,rn.MptEnumType=J.MONSTER;var n=a.monster.getTbByConfigId(Number(i.thingId));this.triggerType=Pi.monster;this.addComponent(ks);this.createtime=(new Date).getTime(),this.tbId=n.monsterId,this.hp=n.hp,this.tb=n}load(){var e=this,t=e.dthing,i=e.dthing.resThing.length,s=(e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var a=i=>{var a=i.res;Tn.inst.load3d.thingRes(e.resFunc(a),e,initHandler(e,n=>{if(n){var o=i.thing.offY?i.thing.offY:0;n.transform.localPosition=new Laya.Vector3(i.thing.x+i.thing.offX-t.l/2,o,i.thing.z+i.thing.offZ-t.w/2),n.transform.localRotationEuler=new Laya.Vector3(i.thing.rX,i.thing.rY,i.thing.rZ),n.transform.localScale=new Laya.Vector3(i.thing.l,1,i.thing.w),n.name="body",n.main=e,e.mode=n,Xe.setBodyMainPy(n,e),e.bpmode=n.getChildByName("bpmode");var r=e.getComponent(ks);r||(r=e.addComponent(ks)),r.initThingTb(s),r.ani.curAniState!=r.ani.state&&r.playAni(r.ani.curAniState),1==e._distancetype?(n.active=!0,ea.scene.cameraCode.addMode(e.bpmode),e.premode.active=!1):n.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",a)}),ue.LevelE)};for(let e=0;e<i;e++){a(t.resThing[e])}}}onEnable(){super.onEnable()}onRefThing(e){this.dataStr.split("|");if(Number(this.dataStr)>1e3){var t=!1;if(Math.floor(Ve.task.task_list[0])==Math.floor(Number(this.dataStr))&&(t=!0),!t)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:this.mode?(this.premode.active=!1,this.mode.active=!0,ea.scene.cameraCode.addMode(this.bpmode)):(this.premode.active=!0,this.load());break;case 2:this.mode||this.load(),this.premode.active=!0,ea.scene.cameraCode.removeMode(this.bpmode);break;case 3:default:this.mode||this.load(),this.premode.active=!1,ea.scene.cameraCode.removeMode(this.bpmode)}}onDestroy(){super.onDestroy()}}class ln extends ia{initRes(e,t,i,s){this.dataStr=s,this.resFunc=e,this.modelType=t,this.eventmap={},ia.ModelSpriteType=le.type_thing,ia.MptEnumType=J.THING,this.dthing=i,ln.ModelSpriteType=le.type_device,ln.MptEnumType=J.DEVICE;var n=a.device.getTbByDeviceId(Number(s));this.triggerType=Pi.car;this.addComponent(fa);this.createtime=(new Date).getTime(),this.tbId=n.deviceId,this.tb=n}load(){var e=this,t=(e.dthing,e.dthing.resThing.length,e.modelType,e.tb);if(!e._isWork){e._isWork=!0;var i=e.tb.configId+".lh";Tn.inst.load3d.thingRes(e.resFunc(i),e,initHandler(e,s=>{if(s){var a=ea.scene.player.owner.transform;s.transform.position=a.position.clone(),s.transform.rotation=a.rotation.clone(),s.name="body",s.main=e,e.mode=s,Xe.setBodyMainPy(s,e);var n=e.getComponent(fa);n||(n=e.addComponent(fa)),n.initThingTb(t),mi.device.rideTargetDevice(e),1==e._distancetype?(s.active=!0,ea.scene.cameraCode.addMode(e.bpmode)):s.active=!1,e._isWork=!1}else serror("mapThingRes加载资源失败：",i)}),ue.LevelE)}}onEnable(){super.onEnable()}onRefThing(e){var t=this.dataStr.split("|");if("40"==t[0]){var i=t[1].split("_"),s=Ve.task.getMainLineTask(),a=!1;if(s)for(var n=s.taskId,o=0;o<i.length;o++){var r=i[o].split(":");if(Number(r[0])<=n&&0==Number(r[1])){a=!0;break}if(Number(r[1])>=n&&0==Number(r[0])){a=!0;break}if(Number(r[1])>=n&&Number(r[0])<=n){a=!0;break}}if(!a)return this.premode.active=!1,this.mode&&(this.mode.active=!1),void ea.scene.cameraCode.removeMode(this.bpmode)}switch(this._distancetype=e,e){case 1:this.mode?(this.mode.active=!0,ea.scene.cameraCode.addMode(this.bpmode)):this.load();break;case 2:case 3:default:this.mode||this.load(),ea.scene.cameraCode.removeMode(this.bpmode)}}onDestroy(){super.onDestroy()}}!function(e){class t{}t._scene_map_scene_ls=0,t._scene_role_ls=1,e.res_enum=t,e.res_dic={0:"scene/map_scene.ls",1:"scene/role.ls"},e.res={"scene/map_scene.ls":[],"scene/role.ls":[]},e.config={"scene/map_scene.ls":["Assets/Mesh/BG/Sky2.lmat"],"scene/role.ls":["Assets/Mesh/BG/Sky2.lmat"]}}(Ge||(Ge={})),function(e){class t{}t._3dmap_119007_lh=0,t._3dmap_119010_lh=1,t._3dmap_20100002_lh=2,e.res_enum=t,e.res_dic={0:"3dmap/119007.lh",1:"3dmap/119010.lh",2:"3dmap/20100002.lh"},e.res={"3dmap/119007.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"3dmap/119010.lh":["Assets/ditu/lv.jpg"],"3dmap/20100002.lh":["Assets/modules/effect/water/Water_Color.png","Assets/modules/effect/water/WaterNormals.jpg"]},e.config={"3dmap/119007.lh":["Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"3dmap/119010.lh":["Assets/ditu/lvdi-lvdi.lm","Assets/ditu/Materials/lv 1.lmat"],"3dmap/20100002.lh":["Assets/modules/effect/water/Water-Water.lm","Assets/modules/effect/water/Water.lmat"]}}(Be||(Be={})),function(e){class t{}t._build_10533006_lh=0,t._build_10634014_lh=1,t._build_11180058_lh=2,t._build_11180102_lh=3,t._build_11180107_lh=4,t._build_11180160_lh=5,t._build_11180161_lh=6,t._build_11180166_lh=7,t._build_11180205_lh=8,t._build_11180210_lh=9,t._build_11180312_lh=10,t._build_11180335_lh=11,t._build_11180351_lh=12,t._build_11180359_lh=13,t._build_11180410_lh=14,t._build_11180411_lh=15,t._build_11180412_lh=16,t._build_11180426_lh=17,t._build_11180427_lh=18,t._build_11180436_lh=19,t._build_11180453_lh=20,t._build_11180464_lh=21,t._build_11180469_lh=22,t._build_11180471_lh=23,t._build_11180472_lh=24,t._build_11180474_lh=25,t._build_11180477_lh=26,t._build_11180478_lh=27,t._build_11180540_lh=28,t._build_11180541_lh=29,t._build_11180542_lh=30,t._build_11180543_lh=31,t._build_11180544_lh=32,t._build_11180545_lh=33,t._build_11180557_lh=34,t._build_11180607_lh=35,t._build_11186025_lh=36,t._build_11186026_lh=37,t._build_11210005_lh=38,t._build_11210006_lh=39,t._build_11210091_lh=40,t._build_11210098_lh=41,t._build_11210099_lh=42,t._build_11210100_lh=43,t._build_11210101_lh=44,t._build_11210128_lh=45,t._build_11220015_lh=46,t._build_11220020_lh=47,t._build_11220029_lh=48,t._build_11230018_lh=49,t._build_11230034_lh=50,t._build_11230076_lh=51,t._build_11230159_lh=52,t._build_11230160_lh=53,t._build_11230161_lh=54,t._build_11230187_lh=55,t._build_11230225_lh=56,t._build_11230255_lh=57,t._build_11230266_lh=58,t._build_11230267_lh=59,t._build_11230268_lh=60,t._build_11230272_lh=61,t._build_11230273_lh=62,t._build_11230284_lh=63,t._build_11230321_lh=64,t._build_11230323_lh=65,t._build_11230327_lh=66,t._build_11230328_lh=67,t._build_11230329_lh=68,t._build_11230330_lh=69,t._build_11230342_lh=70,t._build_11230359_lh=71,t._build_11230360_lh=72,t._build_11230363_lh=73,t._build_11230365_lh=74,t._build_11230367_lh=75,t._build_11230370_lh=76,t._build_11230391_lh=77,t._build_11230396_lh=78,t._build_11230473_lh=79,t._build_18110010_lh=80,t._build_20234018_lh=81,t._build_20234301_lh=82,t._build_20235003_lh=83,t._build_20236002_lh=84,t._build_20236004_lh=85,t._build_20236005_lh=86,t._build_30135026_lh=87,t._build_31534003_lh=88,t._build_31633010_lh=89,t._build_32034010_lh=90,t._build_32233001_lh=91,t._build_33834004_lh=92,t._build_40810011_lh=93,t._build_40810045_lh=94,t._build_40810048_lh=95,t._build_40810110_lh=96,t._build_40810142_lh=97,t._build_40810143_lh=98,t._build_40810144_lh=99,t._build_40810156_lh=100,t._build_40810183_lh=101,t._build_40810184_lh=102,t._build_40810185_lh=103,t._build_40810186_lh=104,t._build_40810187_lh=105,t._build_40810188_lh=106,t._build_40810189_lh=107,t._build_40810190_lh=108,t._build_40810191_lh=109,t._build_40810192_lh=110,t._build_40810193_lh=111,t._build_40810195_lh=112,t._build_40810196_lh=113,t._build_40810198_lh=114,t._build_40810199_lh=115,t._build_40810200_lh=116,t._build_40810201_lh=117,t._build_40810202_lh=118,t._build_40810203_lh=119,t._build_40810204_lh=120,t._build_40810205_lh=121,t._build_40810206_lh=122,t._build_40810207_lh=123,t._build_40810208_lh=124,t._build_40810209_lh=125,t._build_40810210_lh=126,t._build_40810211_lh=127,t._build_40810212_lh=128,t._build_40810213_lh=129,t._build_40810214_lh=130,t._build_40810215_lh=131,t._build_40810216_lh=132,t._build_40810217_lh=133,t._build_40810218_lh=134,t._build_40810219_lh=135,t._build_40810220_lh=136,t._build_40810221_lh=137,t._build_50233006_lh=138,t._build_50233009_lh=139,t._build_50234001_lh=140,t._build_50234016_lh=141,t._build_50234022_lh=142,t._build_50234023_lh=143,t._build_51634014_lh=144,t._build_52134004_lh=145,t._build_52134009_lh=146,t._build_52134012_lh=147,t._build_52434008_lh=148,t._build_52834016_lh=149,t._build_52834017_lh=150,t._build_52834025_lh=151,t._build_53134001_lh=152,t._build_53134005_lh=153,t._build_53134006_lh=154,t._build_53134007_lh=155,t._build_53134008_lh=156,t._build_53134010_lh=157,t._build_53134011_lh=158,t._build_53134012_lh=159,t._build_53134013_lh=160,t._build_53134020_lh=161,t._build_53134022_lh=162,t._build_53134024_lh=163,t._build_53134025_lh=164,t._build_53134026_lh=165,t._build_53134027_lh=166,t._build_54734020_lh=167,t._build_54734022_lh=168,t._build_54734023_lh=169,t._build_54734024_lh=170,t._build_55134017_lh=171,t._build_58834003_lh=172,t._build_60834011_lh=173,e.res_enum=t,e.res_dic={0:"build/10533006.lh",1:"build/10634014.lh",2:"build/11180058.lh",3:"build/11180102.lh",4:"build/11180107.lh",5:"build/11180160.lh",6:"build/11180161.lh",7:"build/11180166.lh",8:"build/11180205.lh",9:"build/11180210.lh",10:"build/11180312.lh",11:"build/11180335.lh",12:"build/11180351.lh",13:"build/11180359.lh",14:"build/11180410.lh",15:"build/11180411.lh",16:"build/11180412.lh",17:"build/11180426.lh",18:"build/11180427.lh",19:"build/11180436.lh",20:"build/11180453.lh",21:"build/11180464.lh",22:"build/11180469.lh",23:"build/11180471.lh",24:"build/11180472.lh",25:"build/11180474.lh",26:"build/11180477.lh",27:"build/11180478.lh",28:"build/11180540.lh",29:"build/11180541.lh",30:"build/11180542.lh",31:"build/11180543.lh",32:"build/11180544.lh",33:"build/11180545.lh",34:"build/11180557.lh",35:"build/11180607.lh",36:"build/11186025.lh",37:"build/11186026.lh",38:"build/11210005.lh",39:"build/11210006.lh",40:"build/11210091.lh",41:"build/11210098.lh",42:"build/11210099.lh",43:"build/11210100.lh",44:"build/11210101.lh",45:"build/11210128.lh",46:"build/11220015.lh",47:"build/11220020.lh",48:"build/11220029.lh",49:"build/11230018.lh",50:"build/11230034.lh",51:"build/11230076.lh",52:"build/11230159.lh",53:"build/11230160.lh",54:"build/11230161.lh",55:"build/11230187.lh",56:"build/11230225.lh",57:"build/11230255.lh",58:"build/11230266.lh",59:"build/11230267.lh",60:"build/11230268.lh",61:"build/11230272.lh",62:"build/11230273.lh",63:"build/11230284.lh",64:"build/11230321.lh",65:"build/11230323.lh",66:"build/11230327.lh",67:"build/11230328.lh",68:"build/11230329.lh",69:"build/11230330.lh",70:"build/11230342.lh",71:"build/11230359.lh",72:"build/11230360.lh",73:"build/11230363.lh",74:"build/11230365.lh",75:"build/11230367.lh",76:"build/11230370.lh",77:"build/11230391.lh",78:"build/11230396.lh",79:"build/11230473.lh",80:"build/18110010.lh",81:"build/20234018.lh",82:"build/20234301.lh",83:"build/20235003.lh",84:"build/20236002.lh",85:"build/20236004.lh",86:"build/20236005.lh",87:"build/30135026.lh",88:"build/31534003.lh",89:"build/31633010.lh",90:"build/32034010.lh",91:"build/32233001.lh",92:"build/33834004.lh",93:"build/40810011.lh",94:"build/40810045.lh",95:"build/40810048.lh",96:"build/40810110.lh",97:"build/40810142.lh",98:"build/40810143.lh",99:"build/40810144.lh",100:"build/40810156.lh",101:"build/40810183.lh",102:"build/40810184.lh",103:"build/40810185.lh",104:"build/40810186.lh",105:"build/40810187.lh",106:"build/40810188.lh",107:"build/40810189.lh",108:"build/40810190.lh",109:"build/40810191.lh",110:"build/40810192.lh",111:"build/40810193.lh",112:"build/40810195.lh",113:"build/40810196.lh",114:"build/40810198.lh",115:"build/40810199.lh",116:"build/40810200.lh",117:"build/40810201.lh",118:"build/40810202.lh",119:"build/40810203.lh",120:"build/40810204.lh",121:"build/40810205.lh",122:"build/40810206.lh",123:"build/40810207.lh",124:"build/40810208.lh",125:"build/40810209.lh",126:"build/40810210.lh",127:"build/40810211.lh",128:"build/40810212.lh",129:"build/40810213.lh",130:"build/40810214.lh",131:"build/40810215.lh",132:"build/40810216.lh",133:"build/40810217.lh",134:"build/40810218.lh",135:"build/40810219.lh",136:"build/40810220.lh",137:"build/40810221.lh",138:"build/50233006.lh",139:"build/50233009.lh",140:"build/50234001.lh",141:"build/50234016.lh",142:"build/50234022.lh",143:"build/50234023.lh",144:"build/51634014.lh",145:"build/52134004.lh",146:"build/52134009.lh",147:"build/52134012.lh",148:"build/52434008.lh",149:"build/52834016.lh",150:"build/52834017.lh",151:"build/52834025.lh",152:"build/53134001.lh",153:"build/53134005.lh",154:"build/53134006.lh",155:"build/53134007.lh",156:"build/53134008.lh",157:"build/53134010.lh",158:"build/53134011.lh",159:"build/53134012.lh",160:"build/53134013.lh",161:"build/53134020.lh",162:"build/53134022.lh",163:"build/53134024.lh",164:"build/53134025.lh",165:"build/53134026.lh",166:"build/53134027.lh",167:"build/54734020.lh",168:"build/54734022.lh",169:"build/54734023.lh",170:"build/54734024.lh",171:"build/55134017.lh",172:"build/58834003.lh",173:"build/60834011.lh"},e.res={"build/10533006.lh":["Assets/ToonCity/Models/Skyscraper666.jpg"],"build/10634014.lh":["Assets/common/Textures/Skyscraper666.jpg"],"build/11180058.lh":["Assets/changjing/changjing_.jpg"],"build/11180102.lh":["Assets/changjing/changjing_.jpg"],"build/11180107.lh":["Assets/changjing/junshijidi/militarybase_d.jpg"],"build/11180160.lh":["Assets/modules/effect/task/Re/Light.png"],"build/11180161.lh":["Assets/modules/effect/task/Re/Light.png"],"build/11180166.lh":["Assets/Skyscraper666.jpg"],"build/11180205.lh":["Assets/npc_d.jpg"],"build/11180210.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/11180312.lh":["Assets/PolygonMinis_Texture_01.jpg"],"build/11180335.lh":["Assets/Skyscraper666.jpg"],"build/11180351.lh":["Assets/modules/paokuxuqiu/shengdan/shengdan.jpg"],"build/11180359.lh":["Assets/modules/paokuxuqiu/haili/701.png"],"build/11180410.lh":["Assets/Textures/duomaomao/333.jpg"],"build/11180411.lh":["Assets/Textures/duomaomao/333.jpg"],"build/11180412.lh":["Assets/Textures/duomaomao/333.jpg"],"build/11180426.lh":["Assets/Skyscraper666.jpg"],"build/11180427.lh":["Assets/Textures/bingxuedashijie/qier.jpg"],"build/11180436.lh":["Assets/Skyscraper666.jpg"],"build/11180453.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/zhuanqianpaoku.jpg"],"build/11180464.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/zhuanqianpaoku.jpg"],"build/11180469.lh":["Assets/Textures/paokudaoju/longnianpaoku.jpg"],"build/11180471.lh":["Assets/Prefabs/paokuxuqiu/paokudaoju/longnianpaoku.jpg"],"build/11180472.lh":["Assets/Textures/paokudaoju/longnianpaoku.jpg"],"build/11180474.lh":["Assets/Textures/paokuxuqiu/yanjiang2.jpg"],"build/11180477.lh":["Assets/Textures/paokuxuqiu/zhugoupaoku/666.jpg"],"build/11180478.lh":["Assets/Textures/paokuxuqiu/zhugoupaoku/666.jpg"],"build/11180540.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180541.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180542.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180543.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180544.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180545.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11180557.lh":["Assets/300/Textures/510/02.jpg"],"build/11180607.lh":["Assets/Textures/paokuxuqiu/legaorenshuban/666.jpg"],"build/11186025.lh":["Assets/modules/res/img/tietu.jpg"],"build/11186026.lh":["Assets/modules/res/img/xzmm.png","Assets/modules/effect/huojianshangche/Textures/glow.png","Assets/modules/effect/huojianshangche/Textures/shangche.png"],"build/11210005.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/11210006.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/11210091.lh":["Assets/Models/zhaocha/zc2/chugui02/chugui02.jpg"],"build/11210098.lh":["Assets/changjing/jianzhu.jpg"],"build/11210099.lh":["Assets/changjing/jianzhu.jpg"],"build/11210100.lh":["Assets/changjing/jianzhu.jpg"],"build/11210101.lh":["Assets/changjing/jianzhu.jpg"],"build/11210128.lh":[],"build/11220015.lh":["Assets/juese/kawayiyinghuawuping/wupin/textures/muxiang.jpg"],"build/11220020.lh":["Assets/Textures/paokuxuqiu/paokudaoju/666.jpg"],"build/11220029.lh":["Assets/Textures/paokuxuqiu/legaopaoku/xiangsukuluomi.jpg"],"build/11230018.lh":["Assets/Textures/shijuepaoku/shijuepaoku.jpg"],"build/11230034.lh":["Assets/Textures/xiangsuduomaomao/xiangsuduomaomao.jpg"],"build/11230076.lh":["Assets/Textures/taolijianyu/jianyu.jpg"],"build/11230159.lh":["Assets/Textures/duomaomao/666.jpg"],"build/11230160.lh":["Assets/Textures/duomaomao/666.jpg"],"build/11230161.lh":["Assets/Textures/duomaomao/666.jpg"],"build/11230187.lh":["Assets/Textures/paokuxuqiu/shuishangleyuan/666.jpg"],"build/11230225.lh":["Assets/300/Textures/505/03.jpg"],"build/11230255.lh":["Assets/300/Textures/505/03.jpg"],"build/11230266.lh":["Assets/Textures/yinghuaxuqiu/yinghuarenshengmoniqi/chuansongmen.png","Assets/FX/chuansongzhen/csddd.jpg"],"build/11230267.lh":[],"build/11230268.lh":[],"build/11230272.lh":["Assets/Textures/yinghuaxuqiu/xiaoyuan/666.jpg"],"build/11230273.lh":["Assets/Textures/paokuxuqiu/tiaogao/666.jpg"],"build/11230284.lh":["Assets/juese/xiaohuangren/bai.jpg","Assets/FX/jiantou/mfd2.png"],"build/11230321.lh":["Assets/Textures/duomaomao/wupin02.png"],"build/11230323.lh":["Assets/Textures/duomaomao/wupin01.png"],"build/11230327.lh":["Assets/Textures/duomaomao/wupin01.png"],"build/11230328.lh":["Assets/Textures/duomaomao/wupin01.png"],"build/11230329.lh":["Assets/Textures/duomaomao/wupin01.png"],"build/11230330.lh":["Assets/Textures/duomaomao/wupin01.png"],"build/11230342.lh":["Assets/Textures/paokuxuqiu/danzaizuqiuchang/666.jpg"],"build/11230359.lh":["Assets/300/Textures/509/01.jpg","Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/11230360.lh":["Assets/300/Textures/509/01.jpg"],"build/11230363.lh":["Assets/300/Textures/509/01.jpg"],"build/11230365.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg","Assets/300/Textures/509/01.jpg"],"build/11230367.lh":["Assets/300/Textures/511/02.jpg"],"build/11230370.lh":["Assets/Textures/ji/01.jpg"],"build/11230391.lh":["Assets/300/Textures/541/01.jpg"],"build/11230396.lh":["Assets/300/Textures/541/01.jpg"],"build/11230473.lh":["Assets/300/Textures/za/72/1.jpg","Assets/modules/effect/task/Re/Flow.png"],"build/18110010.lh":["Assets/300/Textures/za/8/02.jpg"],"build/20234018.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/20234301.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/20235003.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/20236002.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/20236004.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/20236005.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/30135026.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/31534003.lh":["Assets/300/Textures/315/MapTexture.jpg"],"build/31633010.lh":["Assets/300/Textures/316/PolygonMinis_Texture_01.jpg"],"build/32034010.lh":["Assets/300/Textures/320/tiyuguang.jpg"],"build/32233001.lh":["Assets/common/Textures/PolygonMinis_Texture_01.jpg"],"build/33834004.lh":["Assets/300/Textures/338/chunse.jpg"],"build/40810011.lh":["Assets/300/Textures/513/03.jpg"],"build/40810045.lh":["Assets/juese/yinghuajuese/mailiangjuese/textures/004toufa.jpg"],"build/40810048.lh":["Assets/300/Textures/za/6/2.jpg"],"build/40810110.lh":["Assets/Models/chuansong4.jpg"],"build/40810142.lh":["Assets/juese/yinghuajuese/niudanji/textures/niudanji.jpg","Assets/juese/yinghuajuese/niudanji/textures/boli01.png","Assets/juese/yinghuajuese/niudanji/textures/qiu.png","Assets/FX/Textures/niudanji.png"],"build/40810143.lh":["Assets/juese/yinghuajuese/niudanji/textures/666.jpg","Assets/FX/Textures/dazhuanpan.png"],"build/40810144.lh":["Assets/300/Textures/za/50/04.jpg"],"build/40810156.lh":["Assets/300/Textures/600/01.jpg"],"build/40810183.lh":["Assets/modules/res/img/zuqiu.jpg"],"build/40810184.lh":["Assets/300/Textures/za/80/80.jpg"],"build/40810185.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810186.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810187.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810188.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810189.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810190.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810191.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810192.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810193.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810195.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810196.lh":["Assets/300/Textures/za/81/01.jpg"],"build/40810198.lh":["Assets/juese/tunshijinghuajuese/textures/1.jpg"],"build/40810199.lh":["Assets/juese/tunshijinghuajuese/textures/2.jpg"],"build/40810200.lh":["Assets/juese/tunshijinghuajuese/textures/3.jpg"],"build/40810201.lh":["Assets/juese/tunshijinghuajuese/textures/4.jpg"],"build/40810202.lh":["Assets/juese/tunshijinghuajuese/textures/5.jpg"],"build/40810203.lh":["Assets/juese/tunshijinghuajuese/textures/6.jpg"],"build/40810204.lh":["Assets/juese/tunshijinghuajuese/textures/7.jpg"],"build/40810205.lh":["Assets/juese/tunshijinghuajuese/textures/8.jpg"],"build/40810206.lh":["Assets/juese/tunshijinghuajuese/textures/9.jpg"],"build/40810207.lh":["Assets/juese/tunshijinghuajuese/textures/10.jpg"],"build/40810208.lh":["Assets/juese/tunshijinghuajuese/textures/11.jpg"],"build/40810209.lh":["Assets/juese/tunshijinghuajuese/textures/12.jpg"],"build/40810210.lh":["Assets/juese/tunshijinghuajuese/textures/13.jpg"],"build/40810211.lh":["Assets/juese/tunshijinghuajuese/textures/14.jpg"],"build/40810212.lh":["Assets/juese/tunshijinghuajuese/textures/15.jpg"],"build/40810213.lh":["Assets/juese/tunshijinghuajuese/textures/16.jpg"],"build/40810214.lh":["Assets/juese/tunshijinghuajuese/textures/17.jpg"],"build/40810215.lh":["Assets/juese/tunshijinghuajuese/textures/18.jpg"],"build/40810216.lh":["Assets/juese/tunshijinghuajuese/textures/19.jpg"],"build/40810217.lh":["Assets/juese/tunshijinghuajuese/textures/20.jpg"],"build/40810218.lh":["Assets/juese/tunshijinghuajuese/textures/666.jpg"],"build/40810219.lh":["Assets/juese/tunshijinghuajuese/textures/666.jpg"],"build/40810220.lh":["Assets/300/Textures/za/84/01.jpg"],"build/40810221.lh":["Assets/300/Textures/za/84/01.jpg"],"build/50233006.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/50233009.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/50234001.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/50234016.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/50234022.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/50234023.lh":["Assets/300/Textures/502/aeb29e99e3a6e0cc821bfbf8b8fa4bb0.jpg"],"build/51634014.lh":["Assets/300/Textures/516/01.jpg"],"build/52134004.lh":["Assets/Textures/yhpk/sspk/sspk.jpg"],"build/52134009.lh":["Assets/Textures/yhpk/sspk/sspk.jpg"],"build/52134012.lh":["Assets/Textures/yhpk/sspk/sspk.jpg"],"build/52434008.lh":["Assets/Textures/524/nsnsxqc.jpg"],"build/52834016.lh":["Assets/300/Textures/528/01.jpg"],"build/52834017.lh":["Assets/300/Textures/528/01.jpg"],"build/52834025.lh":["Assets/300/Textures/528/01.jpg"],"build/53134001.lh":["Assets/300/Textures/531/01.jpg"],"build/53134005.lh":[],"build/53134006.lh":["Assets/300/Textures/531/03.jpg"],"build/53134007.lh":["Assets/300/Textures/531/01.jpg"],"build/53134008.lh":["Assets/300/Textures/531/02.jpg"],"build/53134010.lh":["Assets/300/Textures/531/02.jpg"],"build/53134011.lh":["Assets/300/Textures/531/02.jpg"],"build/53134012.lh":["Assets/300/Textures/531/02.jpg"],"build/53134013.lh":["Assets/300/Textures/531/04.jpg"],"build/53134020.lh":["Assets/300/Textures/531/02.jpg"],"build/53134022.lh":["Assets/300/Textures/531/01.jpg"],"build/53134024.lh":["Assets/300/Textures/531/02.jpg"],"build/53134025.lh":["Assets/300/Textures/531/01.jpg"],"build/53134026.lh":["Assets/300/Textures/531/01.jpg"],"build/53134027.lh":["Assets/300/Textures/531/01.jpg"],"build/54734020.lh":["Assets/300/Textures/547/01.png"],"build/54734022.lh":["Assets/300/Textures/547/01.png"],"build/54734023.lh":["Assets/300/Textures/547/01.png"],"build/54734024.lh":["Assets/300/Textures/547/01.png"],"build/55134017.lh":["Assets/300/Textures/551/01.png"],"build/58834003.lh":["Assets/300/Textures/588/02.png"],"build/60834011.lh":["Assets/300/Textures/608/01.jpg"]},e.config={"build/10533006.lh":["Assets/ToonCity/Models/Umbrella_2C-Umbrella_2C.lm","Assets/ToonCity/Models/Materials/Skyscraper666.lmat"],"build/10634014.lh":["Assets/changjing/jianzhu/weilan02-weilan02.lm","Assets/common/Materials/Skyscraper666.lmat"],"build/11180058.lh":["Assets/changjing/huayuan_yezishu1-huayuan_yezishu1.lm","Assets/changjing/Materials/changjing_.lmat"],"build/11180102.lh":["Assets/changjing/yushi_matong-yushi_matong.lm","Assets/changjing/Materials/changjing_.lmat"],"build/11180107.lh":["Assets/daoju/daoju2/bengchuang-Object001.lm","Assets/changjing/junshijidi/muxiang.lmat"],"build/11180160.lh":["Assets/modules/effect/task/Re/Light.lmat"],"build/11180161.lh":["Assets/modules/effect/task/Re/Light.lmat"],"build/11180166.lh":["Assets/daoju/Tree311-Tree31.lm","Assets/Materials/Skyscraper666.lmat"],"build/11180205.lh":["Assets/tongdao01-tongdao01.lm","Assets/Materials/npc_d.lmat"],"build/11180210.lh":["Assets/lujian1-lujian1.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/11180312.lh":["Assets/dianti/dianti@kai-kai.lani","Assets/dianti/dianti@guan-guan.lani","Assets/Materials/PolygonMinis_Texture_01.lmat","Assets/dianti/dianti-dianti.lm"],"build/11180335.lh":["Assets/Models/louti02-louti02.lm","Assets/Materials/Skyscraper666.lmat"],"build/11180351.lh":["Assets/modules/paokuxuqiu/shengdan/lingdang-lingdang.lm","Assets/modules/paokuxuqiu/shengdan/Materials/shengdan.lmat"],"build/11180359.lh":["Assets/modules/paokuxuqiu/haili/fangkuai-fangkuai.lm","Assets/modules/paokuxuqiu/haili/Materials/701.lmat"],"build/11180410.lh":["Assets/Models/duomaomao/qiu-qiu.lm","Assets/Materials/duomaomao/duomaomaodaoju.lmat"],"build/11180411.lh":["Assets/Models/duomaomao/sanlunche-sanlunche.lm","Assets/Materials/duomaomao/duomaomaodaoju.lmat"],"build/11180412.lh":["Assets/Models/duomaomao/shubao-shubao.lm","Assets/Materials/duomaomao/duomaomaodaoju.lmat"],"build/11180426.lh":["Assets/Models/bingxuedashijie/lihe-lihe.lm","Assets/Materials/Skyscraper666.lmat"],"build/11180427.lh":["Assets/Models/bingxuedashijie/qier-qier.lm","Assets/juese/zhizhuxia@jineng/wangergou/bingxuedashijie/qier.lmat"],"build/11180436.lh":["Assets/Models/bingxuedashijie/xueren-xueren.lm","Assets/Materials/Skyscraper666.lmat"],"build/11180453.lh":["Assets/Models/paokudaoju/baoxiang003-baoxiang003.lm","Assets/Materials/paokudaoju/daoju3.lmat"],"build/11180464.lh":["Assets/Models/paokudaoju/xitang-xitang.lm","Assets/Materials/paokudaoju/daoju3.lmat"],"build/11180469.lh":["Assets/Models/paokudaoju/zhaocaimao-zhaocaimao.lm","Assets/Textures/paokudaoju/Materials/longnianpaoku.lmat"],"build/11180471.lh":["Assets/Models/paokudaoju/louti02-louti02.lm","Assets/Prefabs/paokuxuqiu/paokudaoju/Materials/longnianpaoku.lmat"],"build/11180472.lh":["Assets/Models/paokudaoju/yuantong-yuantong.lm","Assets/Textures/paokudaoju/Materials/longnianpaoku.lmat"],"build/11180474.lh":["Assets/Models/paokuxuqiu/yanjiangdiban-yanjiangdiban.lm","Assets/Materials/paokuxuqiu/yanjiang.lmat"],"build/11180477.lh":["Assets/Models/paokuxuqiu/daoju01-daoju01.lm","Assets/Materials/paokuxuqiu/daoju.lmat"],"build/11180478.lh":["Assets/Models/paokuxuqiu/daoju02-daoju02.lm","Assets/Materials/paokuxuqiu/daoju.lmat"],"build/11180540.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai01-fangkuai01.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180541.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai02-fangkuai02.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180542.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai03-fangkuai03.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180543.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai04-fangkuai04.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180544.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai05-fangkuai05.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180545.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai06-fangkuai06.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11180557.lh":["Assets/xuanzhuan-xuanzhuan.lani","Assets/changzhidao01-changzhidao.lm","Assets/300/Materials/510/02.lmat"],"build/11180607.lh":["Assets/Models/paokuxuqiu/legaorenshuban/ban04-ban04.lm","Assets/Materials/paokuxuqiu/legaorenshuban/666.lmat"],"build/11186025.lh":["Assets/modules/res/ani/haidaochuan/hdc@loop-loop.lani","Assets/modules/res/ani/haidaochuan/hdc@wait-wait.lani","Assets/modules/res/materials/tietu.lmat","Assets/modules/res/mode/hdc-hdc.lm"],"build/11186026.lh":["Assets/modules/res/ani/xzmm/xzmm@loop-loop.lani","Assets/modules/res/ani/xzmm/xzmm@wait-wait.lani","Assets/modules/res/materials/xzmm.lmat","Assets/modules/res/mode/xzmm-xuanzhuanmuma.lm","Assets/modules/effect/huojianshangche/Materials/FX Glow 2.lmat","Assets/modules/effect/huojianshangche/Materials/FX Comic Text POW.lmat"],"build/11210005.lh":["Assets/baixue/building/fz2-fz2.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/11210006.lh":["Assets/baixue/building/fz3-fz3.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/11210091.lh":["Assets/Models/zhaocha/zc2/chugui02/chugui022-001.lm","Assets/Models/zhaocha/zc2/chugui02/Materials/chugui02.lmat","Assets/Models/zhaocha/zc2/chugui02/chugui022-002.lm","Assets/Models/zhaocha/zc2/chugui02/chugui022-guizi.lm"],"build/11210098.lh":["Assets/changjing/shu03-shu03.lm","Assets/changjing/Materials/jianzhu.lmat"],"build/11210099.lh":["Assets/changjing/yinghuashu01-yinghuashu01.lm","Assets/changjing/Materials/jianzhu.lmat"],"build/11210100.lh":["Assets/changjing/yinghuashu02-yinghuashu02.lm","Assets/changjing/Materials/jianzhu.lmat"],"build/11210101.lh":["Assets/changjing/yinghuashu03-yinghuashu03.lm","Assets/changjing/Materials/jianzhu.lmat"],"build/11210128.lh":[],"build/11220015.lh":["Assets/juese/kawayiyinghuawuping/wupin/models/muxiang-muxiang.lm","Assets/juese/kawayiyinghuawuping/wupin/materials/muxiang.lmat"],"build/11220020.lh":["Assets/Models/paokuxuqiu/robloxpaoku/fangkuai02-fangkuai02.lm","Assets/Materials/paokudaoju/daoju2.lmat"],"build/11220029.lh":["Assets/Models/duomaomao/legaoduomaomao/legao@modeldie-modeldie.lani","Assets/Models/paokuxuqiu/legaopaoku/kuluomitou-kuluomitou.lm","Assets/Materials/paokuxuqiu/legaopaoku/kuluomi.lmat","Assets/Models/paokuxuqiu/legaopaoku/legao01-legao01.lm"],"build/11230018.lh":["Assets/Models/shijuepaoku/jiangbei-6.lm","Assets/Materials/shijuepaoku/shijuepaoku.lmat"],"build/11230034.lh":["Assets/Models/xiangsuduomaomao/tizi-01.lm","Assets/Materials/xiangsuduomaomao/xaingsuduomaomaowupin.lmat"],"build/11230076.lh":["Assets/Models/taolijianyu/tieweilan02-tieweilan02.lm","Assets/Materials/taolijianyu/jianyu.lmat"],"build/11230159.lh":["Assets/Models/duomaomao/youleyuanduomaomao/qiu01-qiu01.lm","Assets/Materials/duomaomao/666.lmat"],"build/11230160.lh":["Assets/Models/duomaomao/youleyuanduomaomao/qiu02-qiu02.lm","Assets/Materials/duomaomao/666.lmat"],"build/11230161.lh":["Assets/Models/duomaomao/youleyuanduomaomao/qiu03-qiu03.lm","Assets/Materials/duomaomao/666.lmat"],"build/11230187.lh":["Assets/Models/paokuxuqiu/shuishangleyuan/yongquan01-yongquan01.lm","Assets/Materials/paokuxuqiu/shuishangleyuan/shuishangleyuan1.lmat"],"build/11230225.lh":["Assets/300/Models/505/50534006-50534006.lm","Assets/300/Materials/505/03.lmat"],"build/11230255.lh":["Assets/300/Models/505/50535005-50535005.lm","Assets/300/Materials/505/03.lmat"],"build/11230266.lh":["Assets/Models/yinghuaxuqiu/yinghuarenshengmoniqi/jiayuanmoxing/chuansongmen-chuansongmen.lm","Assets/Materials/yinghuaxuqiu/yinghuarenshengmoniqi/chuansongmen.lmat","Assets/FX/chuansongzhen/Materials/csddd.lmat","Assets/FX/mudidi/666-666.lm"],"build/11230267.lh":["Assets/Models/duomaomao/huanpi01/zuozhi-zuozhi.lm","Assets/Materials/taolilaoma/daoju.lmat"],"build/11230268.lh":[],"build/11230272.lh":["Assets/Models/yinghuaxuqiu/yinghuarenshengmoniqi/jiayuanmoxing/tizi-tizi.lm","Assets/Materials/xiaoyuan/03.lmat"],"build/11230273.lh":["Assets/Models/paokuxuqiu/tiaogao/lingjiangtai-lingjiangtai.lm","Assets/Materials/paokuxuqiu/tiaogao/666.lmat"],"build/11230284.lh":["Assets/FX/mudidi/Materials/lvtouming.lmat","Assets/FX/mudidi/fangbian-fangbian.lm","Assets/FX/xingzhejineng/Hovl Studio/Sword slash VFX/Models/Materials/mfd2.lmat","Assets/FX/jiantou/pian-Plane001.lm"],"build/11230321.lh":["Assets/Models/duomaomao/fangjian/02/lvzhi-lvzhi.lm","Assets/Materials/duomaomao/wupin02.lmat"],"build/11230323.lh":["Assets/Models/duomaomao/fangjian/02/qiqiu01-qiqiu01.lm","Assets/Materials/duomaomao/wupin01.lmat"],"build/11230327.lh":["Assets/Models/duomaomao/fangjian/02/shuzi1-shuzi1.lm","Assets/Materials/duomaomao/wupin01.lmat"],"build/11230328.lh":["Assets/Models/duomaomao/fangjian/02/xiong01-xiong01.lm","Assets/Materials/duomaomao/wupin01.lmat"],"build/11230329.lh":["Assets/Models/duomaomao/fangjian/02/xiong02-xiong02.lm","Assets/Materials/duomaomao/wupin01.lmat"],"build/11230330.lh":["Assets/Models/duomaomao/fangjian/02/xiong03-xiong03.lm","Assets/Materials/duomaomao/wupin01.lmat"],"build/11230342.lh":["Assets/Models/paokuxuqiu/danzaizuqiuchang/penquan-penquan.lm","Assets/Materials/paokuxuqiu/danzaizuqiuchang/666.lmat"],"build/11230359.lh":["Assets/300/Models/509/50934013@yuanpan-yuanpan.lani","Assets/300/Models/509/50934013-50934013.lm","Assets/300/Materials/509/01.lmat","Assets/300/Models/509/50934013.lmat","Assets/300/Models/509/50934013-yuanpan.lm"],"build/11230360.lh":["Assets/300/Models/509/50934037@xuanzhuan-xuanzhuan.lani","Assets/300/Models/509/50934037-50934037.lm","Assets/300/Materials/509/01.lmat","Assets/300/Models/509/50934037-zhuti.lm"],"build/11230363.lh":["Assets/300/Models/509/50934033@yuanxin02-yuanxin02.lani","Assets/300/Models/509/50934033-50934033.lm","Assets/300/Materials/509/01.lmat","Assets/300/Models/509/50934033-yuanxin02.lm"],"build/11230365.lh":["Assets/300/Models/509/50934036@yaobai-yaobai.lani","Assets/300/Models/509/50934036-50934036.lm","Assets/300/Models/509/50934036.lmat","Assets/300/Materials/509/01.lmat","Assets/300/Models/509/50934036-xiaoyuanpan.lm"],"build/11230367.lh":["Assets/300/Models/511/51134023@tiaoban-tiaoban.lani","Assets/300/Materials/511/02.lmat","Assets/300/Models/511/51134023-51134023.lm"],"build/11230370.lh":["Assets/Models/taolishujiazuoye/books-books.lm","Assets/Materials/taolishujiazuoye/01.lmat"],"build/11230391.lh":["Assets/300/Models/541/54134006-54134006.lm","Assets/300/Materials/541/01.lmat"],"build/11230396.lh":["Assets/300/Models/541/54134011-54134011.lm","Assets/300/Materials/541/01.lmat"],"build/11230473.lh":["Assets/300/Models/za/72/1-1.lm","Assets/300/Materials/za/72/1.lmat","Assets/modules/effect/task/Re/Flow.lmat"],"build/18110010.lh":["Assets/300/Models/za/8/010-010.lm","Assets/300/Materials/za/8/02.lmat"],"build/20234018.lh":["Assets/modules/thing/zys-zys.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/20234301.lh":["Assets/fbx/jiantou-jiantou.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/20235003.lh":["Assets/common/molandi/20235003-d54.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/20236002.lh":["Assets/changjing/xinfangwu/fbxtex/d460-d460.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/20236004.lh":["Assets/changjing/xinfangwu/fbxtex/d232-d232.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/20236005.lh":["Assets/changjing/xinfangwu/fbxtex/d217-d217.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/30135026.lh":["Assets/300/Models/301/map/dadiaosu-dadiaosu.lm","Assets/common/Materials/PolygonMinis_Texture_01.lmat"],"build/31534003.lh":["Assets/300/Models/315/che3-che03.lm","Assets/300/Materials/315/MapTexture.lmat"],"build/31633010.lh":["Assets/300/Models/316/fangzi011-fangzi011.lm","Assets/300/Materials/316/Poly.lmat"],"build/32034010.lh":["Assets/300/Models/320/louti04-louti04.lm","Assets/300/Materials/320/tiyuguang.lmat"],"build/32233001.lh":["Assets/300/Models/322/chengqiang01-chengqiang01.lm","Assets/common/Materials/PolygonMinis_Texture_02.lmat"],"build/33834004.lh":["Assets/300/Models/338/qiao-qiao.lm","Assets/300/Materials/338/chunse.lmat"],"build/40810011.lh":["Assets/300/Models/513/51334003@zhuti-zhuti.lani","Assets/300/Materials/513/03.lmat","Assets/300/Models/513/51334003-zhuti.lm","Assets/300/Models/513/51334003-51334003.lm"],"build/40810045.lh":["Library/unitydefaultresources-Cube.lm","Assets/juese/yinghuajuese/mailiangjuese/materials/004toufa.lmat"],"build/40810048.lh":["Assets/300/Models/za/6/12@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/za/6/2.lmat","Assets/300/Models/za/6/12-12.lm"],"build/40810110.lh":["Assets/Models/chuansongdai-chuansongdai.lm","Assets/Models/Materials/chuansong4.lmat"],"build/40810142.lh":["Assets/juese/yinghuajuese/niudanji/niudanji-niudanji.lm","Assets/juese/yinghuajuese/niudanji/materials/niudanji.lmat","Assets/juese/yinghuajuese/niudanji/niudanji-boli.lm","Assets/juese/yinghuajuese/niudanji/materials/boli01.lmat","Assets/juese/yinghuajuese/niudanji/niudanji-niudan.lm","Assets/juese/yinghuajuese/niudanji/materials/qiu.lmat","Assets/FX/Materials/niudanji.lmat"],"build/40810143.lh":["Assets/juese/yinghuajuese/niudanji/dazhuanpan-dazhuanpan.lm","Assets/juese/yinghuajuese/niudanji/materials/666.lmat","Assets/FX/Materials/dazhuanpan.lmat"],"build/40810144.lh":["Assets/300/Models/za/50/1-1.lm","Assets/300/Materials/za/50/4.lmat"],"build/40810156.lh":["Assets/300/Models/600/60034001-60034001.lm","Assets/300/Materials/600/01.lmat"],"build/40810183.lh":["Assets/modules/res/mode/zuqiu-zuqiu.lm","Assets/modules/res/img/Materials/zuqiu.lmat"],"build/40810184.lh":["Assets/300/Models/za/80/80-80.lm","Assets/300/Materials/za/80/80.lmat"],"build/40810185.lh":["Assets/300/Models/za/81/1-1.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810186.lh":["Assets/300/Models/za/81/2-2.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810187.lh":["Assets/300/Models/za/81/3-3.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810188.lh":["Assets/300/Models/za/81/4-4.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810189.lh":["Assets/300/Models/za/81/5-5.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810190.lh":["Assets/300/Models/za/81/6-6.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810191.lh":["Assets/300/Models/za/81/7-7.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810192.lh":["Assets/300/Models/za/81/8-8.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810193.lh":["Assets/300/Models/za/81/9-9.lm","Assets/300/Materials/za/81/1.lmat"],"build/40810195.lh":["Assets/300/Models/za/82/z1-z1.lm","Assets/300/Materials/za/82/82.lmat"],"build/40810196.lh":["Assets/300/Models/za/82/z2-z2.lm","Assets/300/Materials/za/82/82.lmat"],"build/40810198.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/1.lmat"],"build/40810199.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/2.lmat"],"build/40810200.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/3.lmat"],"build/40810201.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/4.lmat"],"build/40810202.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/5.lmat"],"build/40810203.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/6.lmat"],"build/40810204.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/7.lmat"],"build/40810205.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/8.lmat"],"build/40810206.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/9.lmat"],"build/40810207.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/10.lmat"],"build/40810208.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/11.lmat"],"build/40810209.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/12.lmat"],"build/40810210.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/13.lmat"],"build/40810211.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/14.lmat"],"build/40810212.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/15.lmat"],"build/40810213.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/16.lmat"],"build/40810214.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/17.lmat"],"build/40810215.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/18.lmat"],"build/40810216.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/19.lmat"],"build/40810217.lh":["Assets/juese/tunshijinghuajuese/ban-ban.lm","Assets/juese/tunshijinghuajuese/materials/20.lmat"],"build/40810218.lh":["Assets/juese/tunshijinghuajuese/jiantou-jiantou.lm","Assets/juese/tunshijinghuajuese/materials/666.lmat"],"build/40810219.lh":["Assets/juese/tunshijinghuajuese/liushengji-liushengji.lm","Assets/juese/tunshijinghuajuese/materials/666.lmat"],"build/40810220.lh":["Assets/300/Models/za/84/1-1.lm","Assets/300/Materials/za/84/1.lmat"],"build/40810221.lh":["Assets/300/Models/za/84/2-2.lm","Assets/300/Materials/za/84/1.lmat"],"build/50233006.lh":["Assets/300/Models/502/hanbaodian-hanbaodian.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/50233009.lh":["Assets/300/Models/502/shangdian04-shangdian04.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/50234001.lh":["Assets/300/Models/502/caipantai-caipantai.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/50234016.lh":["Assets/300/Models/502/tangyi-tangyi.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/50234022.lh":["Assets/300/Models/502/zhaopai-zhaopai.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/50234023.lh":["Assets/300/Models/502/zheyangsan01-zheyangsan01.lm","Assets/300/Materials/502/T_All_in_one_copy.lmat"],"build/51634014.lh":["Assets/300/Models/516/51634014-51634014.lm","Assets/300/Materials/516/01.lmat"],"build/52134004.lh":["Assets/Models/yhpk/sspk/ch-ch.lm","Assets/Materials/yhpk/sspk/sspk.lmat"],"build/52134009.lh":["Assets/Models/yhpk/sspk/lt-lt.lm","Assets/Materials/yhpk/sspk/sspk.lmat"],"build/52134012.lh":["Assets/Models/yhpk/sspk/lt4-lt4.lm","Assets/Materials/yhpk/sspk/sspk.lmat"],"build/52434008.lh":["Assets/Models/524/langan3-langan3.lm","Assets/Materials/524/nsnsxqc.lmat"],"build/52834016.lh":["Assets/300/Models/528/52834016@yidong-yidong.lani","Assets/300/Materials/528/01.lmat","Assets/300/Models/528/52834016-52834016.lm"],"build/52834017.lh":["Assets/300/Models/528/52834017@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/528/01.lmat","Assets/300/Models/528/52834017-52834017.lm"],"build/52834025.lh":["Assets/300/Models/528/52834025@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/528/01.lmat","Assets/300/Models/528/52834025-52834025.lm"],"build/53134001.lh":["Assets/300/Models/531/53134001-53134001.lm","Assets/300/Materials/531/01.lmat"],"build/53134005.lh":["Assets/300/Models/531/53134005-53134005.lm","Assets/300/Materials/531/05.lmat"],"build/53134006.lh":["Assets/300/Models/531/53134006-53134006.lm","Assets/300/Materials/531/03.lmat"],"build/53134007.lh":["Assets/300/Models/531/53134007-53134007.lm","Assets/300/Materials/531/01.lmat"],"build/53134008.lh":["Assets/300/Models/531/53134008@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/531/02.lmat","Assets/300/Models/531/53134008-53134008.lm"],"build/53134010.lh":["Assets/300/Models/531/53134010@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/531/02.lmat","Assets/300/Models/531/53134010-53134010.lm"],"build/53134011.lh":["Assets/300/Models/531/53134011@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/531/02.lmat","Assets/300/Models/531/53134011-53134011.lm"],"build/53134012.lh":["Assets/300/Models/531/53134012@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/531/02.lmat","Assets/300/Models/531/53134012-53134012.lm"],"build/53134013.lh":["Assets/300/Models/531/53134013@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/531/04.lmat","Assets/300/Models/531/53134013-53134013.lm"],"build/53134020.lh":["Assets/300/Models/531/53134020-53134020.lm","Assets/300/Materials/531/02.lmat"],"build/53134022.lh":["Assets/300/Models/531/53134022-53134022.lm","Assets/300/Materials/531/01.lmat"],"build/53134024.lh":["Assets/300/Models/531/53134024-53134024.lm","Assets/300/Materials/531/02.lmat"],"build/53134025.lh":["Assets/300/Models/531/53134025-53134025.lm","Assets/300/Materials/531/01.lmat"],"build/53134026.lh":["Assets/300/Models/531/53134026-53134026.lm","Assets/300/Materials/531/01.lmat"],"build/53134027.lh":["Assets/300/Models/531/53134027-53134027.lm","Assets/300/Materials/531/01.lmat"],"build/54734020.lh":["Assets/300/Models/547/54734020-54734020.lm","Assets/300/Materials/547/01.lmat"],"build/54734022.lh":["Assets/300/Models/547/54734022-54734022.lm","Assets/300/Materials/547/01.lmat"],"build/54734023.lh":["Assets/300/Models/547/54734023-54734023.lm","Assets/300/Materials/547/01.lmat"],"build/54734024.lh":["Assets/300/Models/547/54734024-54734024.lm","Assets/300/Materials/547/01.lmat"],"build/55134017.lh":["Assets/300/Models/551/55134017@xuanzhuan-xuanzhuan.lani","Assets/300/Materials/551/01.lmat","Assets/300/Models/551/55134017-55134017.lm"],"build/58834003.lh":["Assets/300/Models/588/58834003-58834003.lm","Assets/300/Materials/588/02.lmat"],"build/60834011.lh":["Assets/300/Models/608/60834011-60834011.lm","Assets/300/Materials/608/01.lmat"]}}(He||(He={}));class hn{constructor(){this.__useMap={},this.__useMapNum=0}particleRes(e,t){var i,s=this,a=s.__useMap[e];if(a&&a.mode)return i=s.__useMap[e].mode,s.__useMap[e].count++,void t.runWith(i.clone());if(a)a.handler[a.handler.length]=t;else{a={mode:null,scenes:null,count:0,handler:[t]},s.__useMap[e]=a;var n=s.getLoad3dRes(e),o=()=>{Laya.Sprite3D.load(e,initHandler(s,t=>{if(t){a.mode=t,s.__useMapNum++;for(i=a.handler.length,n=0;n<i;n++){(o=a.handler.shift()).runWith(t.clone())}}else{slog("particleRes加载资源失败：",e),delete s.__useMap[e];for(var i=a.handler.length,n=0;n<i;n++){var o;(o=a.handler.shift())&&o.runWith(t.clone())}}}))};n?Tn.inst.load([n],initHandler(s,o),ue.LevelD):o()}}playRoleGlobalOnceParticleRes(e,t,i=1,s){s||(s=ea.scene.mainscene);var a=Ce.res_dic[e];Tn.inst.load3d.particleRes(a,initHandler(this,e=>{e?(s.addChild(e),e.transform.localScale=new Laya.Vector3(i,i,i),e.transform.position=t.position.clone()):slog("playRoleGlobalOnceParticleRes加载出错:",a)}))}runOneTimeParticle(e,t,i,s,a){let n=this;s||(s=ea.scene.mainscene);var o=ce.d3res+Ce.res_dic[e];Tn.inst.load3d.particleRes(o,initHandler(n,e=>{if(!e)return i&&i.runWith([null]),void slog("runOneTimeParticle加载出错");a&&a.size&&(e.transform.localScale=new Laya.Vector3(a.size,a.size,a.size));var o=t.position.clone();o.y+=a.h?a.h:0,a&&a.isLocal?(e.particleSystem.addParticle(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0),a&&a.time?a.time:800),s.addChild(e)):(e.particleSystem.addParticle(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0),a&&a.time?a.time:800),ea.scene.mainscene.addChild(e)),e.transform.position=o.clone(),e.timerOnce(a&&a.time||800,n,()=>{e&&(e.removeSelf(),e.destroy())}),i&&i.runWith([e])}))}playParticleRes(e,t,i,s,a){s||(s=ea.scene.mainscene);var n=ce.d3res+Ce.res_dic[e];Tn.inst.load3d.particleRes(n,initHandler(this,e=>{if(!e)return i&&i.runWith([null]),void slog("runOneTimeParticle加载出错");a&&a.size&&(e.particleSystem.startSizeConstant=a.size);var n=t;s.addChild(e),e.transform.position=n.position.clone(),i&&i.runWith([e])}))}particlePreLoadRes(e,t,i){var s=this,a=s.__useMap[e];if(a&&a.mode)return 1==Me.loadding_log&&console.warn("已有模型："+e),void t.runWith([e]);if(a)return 1==Me.loadding_log&&console.warn("已在加载队列："+e),void t.runWith([e]);a={mode:null,scenes:[null],count:0,handler:[]},s.__useMap[e]=a;var n=s.getLoad3dRes(e),o=()=>{Laya.Sprite3D.load(e,initHandler(s,n=>{if(!n)return delete s.__useMap[e],i&&i.runWith([e]),void serror("particlePreLoadRes加载失败:"+e);a.mode=n,s.__useMapNum++,t.runWith([e])}))};n?Tn.inst.load([n],initHandler(s,o),ue.LevelD):o()}preLoad3DRes(e,t,i){var s=e;Laya.loader.create(ce.fullPath(s),initHandler(this,e=>{e?t.runWith([s]):i.runWith([s])}))}getLoad3dRes(e){var t=e.substring(e.lastIndexOf("res3D/")+6,e.lastIndexOf("/")),i=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."));switch(t){case"role":return{url:Re.res_dic[Re.res_enum[`_role_${i}_lh`]],type:me.res3d,restype:pe.res3d_group_role};case"prop_res":return{url:Pe.res_dic[Pe.res_enum[`_prop_res_${i}_lh`]],type:me.res3d,restype:pe.res3d_group_prop};case"scene":return{url:Ge.res_dic[Ge.res_enum[`_scene_${i}_lh`]],type:me.res3d,restype:pe.res3d_group_scene};case"3dmap":return{url:Be.res_dic[Be.res_enum[`_3dmap_${i}_lh`]],type:me.res3d,restype:pe.res3d_group_3dmap};case"build":return{url:He.res_dic[He.res_enum[`_build_${i}_lh`]],type:me.res3d,restype:pe.res3d_group_build}}return null}res(e,t,i=0,s,a){var n,o,r=this;o=s?e+"_"+JSON.stringify(s):e;var l=r.__useMap[o];if(l&&l.mode){1==Me.loadding_log&&console.warn("已有克隆模型："+o),n=l.mode;var h=Laya.Sprite3D.instantiate(n,t,!s||!s.texture);if(s&&s.texture){var c=h.particleRenderer?h:h.getChildByName("mode");Laya.Texture2D.load(s.texture,initHandler(r,e=>{c.particleRenderer&&(c.particleRenderer.material.texture=e)}))}return l.count++,void a.runWith(h)}if(l)return l.scenes[l.scenes.length]=t,void(l.handler[l.handler.length]=a);l={mode:null,scenes:[t],count:0,handler:[a]},r.__useMap[o]=l,1==Me.loadding_log&&console.warn("加载渲染配置："+o);var d=r.getLoad3dRes(e),u=()=>{Laya.Sprite3D.load(e,initHandler(r,t=>{if(t){var i=(n=t).transform,a=i.position;a.setValue(0,0,0),i.position=a;var c=i.localScale;c.setValue(1,1,1),i.localScale=c,l.mode=n,r.__useMapNum++;u=l.handler.length;var d=()=>{var e=l.scenes.shift(),t=Laya.Sprite3D.instantiate(n,e,!s||!s.texture);if(1==Me.loadding_log&&console.warn("返回克隆模型："+o),s&&s.texture){var i=t.particleRenderer?t:t.getChildByName("mode");Laya.Texture2D.load(s.texture,initHandler(r,e=>{i.particleRenderer&&(i.particleRenderer.material.texture=e)}))}l.handler.shift().runWith(t)};for(p=0;p<u;p++)d()}else{serror("res加载资源失败："+e);for(var u=l.handler.length,p=0;p<u;p++){var m=l.handler.shift();m&&m.runWith(h)}delete r.__useMap[o]}}))};d?Tn.inst.load([d],initHandler(r,u),ue.LevelD):u()}showres(e,t,i){var s,a=this,n=e+"_show",o=a.__useMap[n];if(o&&o.mode){1==Me.loadding_log&&console.warn("已有克隆模型："+n),s=o.mode;var r=Laya.Sprite3D.instantiate(s,t,!1);return o.count++,void i.runWith(r)}if(o)return o.scenes[o.scenes.length]=t,void(o.handler[o.handler.length]=i);o={mode:null,scenes:[t],count:0,handler:[i]},a.__useMap[n]=o,1==Me.loadding_log&&console.warn("加载渲染配置："+n);var l=a.getLoad3dRes(e),h=()=>{Laya.Sprite3D.load(e,initHandler(a,t=>{if(t){var i=(s=t).transform,r=i.position;r.setValue(0,0,0),i.position=r;var l=i.localScale;l.setValue(1,1,1),i.localScale=l,s.transform.rotation=new Laya.Quaternion(0,.7071068,0,-.7071067);var h=s.getChildByName("slm"),c=new Laya.BlinnPhongMaterial,d=h.skinnedMeshRenderer.material;c.albedoColor=d.albedoColor,c.albedoTexture=d.albedoTexture,h.skinnedMeshRenderer.material=c,o.mode=s,a.__useMapNum++;for(m=o.handler.length,g=0;g<m;g++){var u=o.scenes.shift(),p=Laya.Sprite3D.instantiate(s,u,!1);1==Me.loadding_log&&console.warn("返回克隆模型："+n),(y=o.handler.shift()).runWith(p)}}else{serror("showres加载资源失败：",e);for(var m=o.handler.length,g=0;g<m;g++){var y;(y=o.handler.shift())&&y.runWith(null)}delete a.__useMap[n]}}))};l?Tn.inst.load([l],initHandler(a,h),ue.LevelD):h()}thingRes(e,t,i,s,a,n){var o,r=this;s||(s=ue.LevelD);var l=r.__useMap[e];if(l&&l.mode){1==Me.loadding_log&&console.warn("已有克隆模型："+e),o=l.mode;var h=Laya.Sprite3D.instantiate(o,t,!1,a,n);return l.count++,void i.runWith([h])}if(l)return l.scenes[l.scenes.length]=t,void(l.handler[l.handler.length]=i);l={mode:null,scenes:[t],count:0,handler:[i]},r.__useMap[e]=l,1==Me.loadding_log&&console.warn("加载渲染配置："+e);var c=r.getLoad3dRes(e),d=()=>{Laya.Sprite3D.load(e,initHandler(r,t=>{if(t){var i=t.transform,s=i.position;s.setValue(0,0,0),i.position=s;var o=i.localScale;o.setValue(1,1,1),i.localScale=o,l.mode=t,r.__useMapNum++;for(d=l.handler.length,u=0;u<d;u++){var h=l.scenes.shift(),c=Laya.Sprite3D.instantiate(t,h,!1,a,n);1==Me.loadding_log&&console.warn("返回克隆模型："+e),(p=l.handler.shift()).runWith([c])}}else{serror("thingRes加载资源失败：",e);for(var d=l.handler.length,u=0;u<d;u++){var p;(p=l.handler.shift())&&p.runWith([null])}delete r.__useMap[e]}}))};c?Tn.inst.load([c],initHandler(r,d),s):d()}thingEditRes(e,t,i,s,a){var n,o=this,r=o.__useMap[e];if(r&&r.mode){1==Me.loadding_log&&console.warn("已有克隆模型："+e),n=r.mode;var l=Laya.Sprite3D.instantiate(n,t,!1,s,a);return r.count++,void i.runWith(l)}if(r)return r.scenes[r.scenes.length]=t,void(r.handler[r.handler.length]=i);r={mode:null,scenes:[t],count:0,handler:[i]},o.__useMap[e]=r,1==Me.loadding_log&&console.warn("加载渲染配置："+e);var h=o.getLoad3dRes(e),c=()=>{Laya.Sprite3D.load(e,initHandler(o,t=>{if(t){var i=t.transform,n=i.position;n.setValue(0,0,0),i.position=n;var l=i.localScale;l.setValue(1,1,1),i.localScale=l,r.mode=t,o.__useMapNum++;for(d=r.handler.length,u=0;u<d;u++){var h=r.scenes.shift(),c=Laya.Sprite3D.instantiate(t,h,!1,s,a);1==Me.loadding_log&&console.warn("返回克隆模型："+e),(p=r.handler.shift()).runWith(c)}}else{serror("thingEditRes加载资源失败：",e);for(var d=r.handler.length,u=0;u<d;u++){var p;(p=r.handler.shift())&&p.runWith(null)}delete o.__useMap[e]}}))};h?Tn.inst.load([h],initHandler(o,c),ue.LevelD):c()}mapThingRes(e,t,i,s,n){var o,r;switch(t){case 1:0==a.thing.getTbByConfigId(Number(i.thingId)).isdevice?(r=new sa(null,!1),o=le.type_thing):(r=new on(null,!1),o=le.type_device);break;case 2:r=new aa(null,!1),o=le.type_effect;break;case 3:var l=Math.floor(Number(i.thingId)%1e5/1e4);if(9==l||6==l)r=new on(null,!1),o=6==l?le.type_car:le.type_device;else{var h=Math.floor(Number(i.thingId)%1e4/1e3);if(6==i.type){if(1==$a.isInit)return null;r=new $a(null,!1),o=le.type_role}else 2==h?(r=new en(null,!1),o=le.type_npc):3==h?(r=new rn(null,!1),o=le.type_monster):4==h?(r=new tn(null,!1),o=le.type_carnpc):6==h&&(r=new nn(null,!1),o=le.type_wznpc)}break;case 4:r=new ln(null,!1),o=le.type_car;break;case 5:r=new on(null,!1),o=le.type_device}return r||console.log(i),n.addChild(r),r.initRes(e,o,i,s),r}desposeRes(e,t){delete this.__useMap[e+t]}}class cn{constructor(){this.__useRes={}}res(e,t){var i,s=this.__useRes[e];if(s&&s.mode&&s.isres)return 1==Me.loadding_log&&console.warn("已有克隆模型："+e),i=s.mode,s.count++,void t.runWith(i.buildArmature(0));s?s.handler[s.handler.length]=t:(s={mode:new Laya.Templet,count:0,handler:[t],isres:!1},this.__useRes[e]=s,s.mode.once(Laya.Event.COMPLETE,this,()=>{s.isres=!0;for(var e=0;e<s.handler.length;e++){s.handler[e].runWith(s.mode.buildArmature(0))}}),Laya.loader.load([ce.fullPath(e+".png"),ce.fullPath(e+".sk")],initHandler(this,()=>{s.mode.loadAni(ce.fullPath(e+".sk"))})),1==Me.loadding_log&&console.warn("加载渲染配置："+e))}desposeRes(e){delete this.__useRes[e]}}class dn{constructor(){this.__useRes={}}res(e,t,i){var s,a=this,n=a.__useRes[e];if(n&&n.modeTexture&&n.isres)return 1==Me.loadding_log&&console.warn("已有克隆模型："+e),n.count++,void(s=new Laya.Animation).loadAnimation("res/ani/"+e+".ani",initHandler(a,()=>{i.runWith(s)}));n?n.handler[n.handler.length]=i:(n={modeTexture:"res/atlas/"+t+".atlas",count:0,handler:[i],isres:!1},a.__useRes[e]=n,Laya.loader.load("res/atlas/"+t+".atlas",initHandler(a,()=>{n.isres=!0;for(var t=0;t<n.handler.length;t++){var i=n.handler[t];(s=new Laya.Animation).loadAnimation("res/ani/"+e+".ani",initHandler(a,()=>{i.runWith(s)}))}})),1==Me.loadding_log&&console.warn("加载渲染配置："+e))}xlzres(e,t){var i,s=this,a=s.__useRes[e];if(a&&a.modeTexture&&a.isres)return 1==Me.loadding_log&&console.warn("已有克隆模型："+e),a.count++,void(i=new Laya.Animation).loadAnimation("res/ani/role/"+e+".ani",initHandler(s,()=>{t.runWith(i)}));a?a.handler[a.handler.length]=t:(a={modeTexture:"res/atlas/xlz/role/"+e+".atlas",count:0,handler:[t],isres:!1},s.__useRes[e]=a,Laya.loader.load("res/atlas/xlz/role/"+e+".atlas",initHandler(s,()=>{a.isres=!0;for(var t=0;t<a.handler.length;t++){var n=a.handler[t];(i=new Laya.Animation).loadAnimation("res/ani/role/"+e+".ani",initHandler(s,()=>{n.runWith(i)}))}})),1==Me.loadding_log&&console.warn("加载渲染配置："+e))}desposeRes(e){delete this.__useRes[e]}}class un{constructor(){this.__useRes={}}res(e,t){var i=this;if(!Laya.Browser.onMiniGame)return i.__useRes[e]={},i.__useRes[e].isUpdateArea=!0,void(t&&t.run());var s=i.__useRes[e];if(s&&s.isUpdateArea)t&&t.run();else{i.__useRes[e]||(i.__useRes[e]={isUpdateArea:!1,handler:[]});var a=i.__useRes[e].handler;a[a.length]=t,Laya.loader.load(e,initHandler(i,()=>{Laya.MiniAdpter.sendAtlasToOpenDataContext(e),i.__useRes[e].isUpdateArea=!0;for(var t=a.length,s=0;s<t;s++){var n=a.shift();n&&n.run()}}))}}}class pn{constructor(){}loadZip(e,t,i){var s=Laya.loader.getRes(e+t+".json");s?i.runWith([s]):Laya.loader.load([{type:Laya.Loader.BUFFER,url:e+t+".xml"}],initHandler(this,s=>{const a=new JSZip;if(!(s=Laya.loader.getRes(e+t+".json"))){let i=Laya.loader.getRes(e+t+".xml");var n=a.load(i,{});s=JSON.parse(n.file(t+".json").asText()),Laya.loader.clearRes(e+t+".xml"),Laya.Loader.cacheRes(e+t+".json",s)}i.runWith([s])}))}preLoadMap(e,t,i){var s,n=this;try{var o=e.split("|"),r=Number(o[0]),l=Number(o[1]),h=a.mission.fetchMissionTb(l),c=a.map.getTbBymap(r),d=!1,u=!1,p=()=>d&&u;n.loadZip(ce.map_data,String(c.mapConfig),initHandler(n,e=>{d=!0,p()&&(serror("mapload 加载完成: "),t&&t.runWith([!0]))})),s=h.targetMap==c.mapId&&0!=h.missionData?String(h.missionData):String(c.defaultMissionData),n.loadZip(ce.mapdata_data,s,initHandler(n,e=>{u=!0,p()&&(serror("missionload 加载完成: "),t&&t.runWith([!0]))}))}catch(e){i&&i.runWith([e])}}desposeRes(e,t){}}class mn{load(e,t,i){Laya.loader.load(ce.fullPath(e),initHandler(this,s=>{s?t.runWith([e]):i.runWith([e])}))}static localload(e,t,i){var s=mn;Laya.loader.load(t,initHandler(s,()=>{for(var t=[],s=0;s<e.length;s++){var a=e[s];switch(a.restype){case pe.img2d_res:t.push({type:a.restype,url:a.url,res:Laya.loader.getRes(a.url)});break;case pe.scene2d_res:t.push({type:a.restype,url:a.url,res:Laya.loader.getRes(a.url)}),t.push({type:a.restype,url:a.url.replace(".scene",".json"),res:Laya.loader.getRes(a.url)});break;case pe.res2d_atlas:t.push({type:a.restype,url:a.url,res:[Laya.loader.getRes(a.url+".png"),Laya.loader.getRes(a.url+".atlas")]});break;case pe.res2d_db:t.push({type:a.restype,url:a.url,res:[Laya.loader.getRes(a.url+".png"),Laya.loader.getRes(a.url+".sk")]})}}i&&i.runWith([()=>{for(var e=0;e<t.length;e++){var i=t[e];switch(i.type){case pe.img2d_res:case pe.scene2d_res:mn.cacheRes(i.url,i.res);break;case pe.res2d_atlas:mn.cacheConfigRes([[i.url+".png",i.res[0]],[i.url+".atlas",i.res[1]]]);break;case pe.res2d_db:mn.cacheConfigRes([[i.url+".png",i.res[0]],[i.url+".sk",i.res[1]]])}}}])}))}static cacheRes(e,t){""!=i.RESURL&&Laya.Loader.cacheRes(i.RESURL+e,t)}static cacheConfigListRes(e){if(""!=i.RESURL)for(var t=0;t<e.length;t++)mn.cacheConfigRes(e[t])}static cacheConfigRes(e){""!=i.RESURL&&(Laya.Loader.cacheRes(i.RESURL+e[0][0],e[0][1]),Laya.Loader.cacheRes(i.RESURL+e[1][0],e[1][1]))}}class gn{static get_load_list(e,t){var i=Tn.inst,s=0,a=a=>{var n=i.__error_load_list.filter(t=>t.url==a&&t.type==e.type)[0];n&&(i.__error_load_list.splice(i.__error_load_list.indexOf(n),1),s+=n.errorNum);var o=t.filter(t=>t.url==e.url&&t.type==e.type)[0];if(o){if(!o.handler&&e.handler)return void(o.handler=e.handler);if(!o.handler||e.handler)return}};switch(e.restype){case pe.img2d_res:if(a(e.url),l=Laya.loader.getRes(e.url))-1==Tn.inst.__load_finish_list.indexOf(e.url)&&Tn.inst.__load_finish_list.push(e.url),e.handler&&e.handler.runWith([l]);else e.errorNum=s,t[t.length]=e;break;case pe.res2d_atlas:a(e.url+".atlas");var n=Laya.loader.getRes(e.url+".atlas");slog("Res2D_restype==>EnumLoaderResType.res2d_atlas==>",e.url+".atlas"," && !=null",null!=n);var o=t.filter(t=>t.url==e.url+".atlas")[0],r=t.indexOf(o);if(n||-1!=r||t.push({url:e.url+".atlas",errorNum:s,type:me.res2d,restype:pe.res2d_atlas}),n)-1==Tn.inst.__load_finish_list.indexOf(e.url+".atlas")&&Tn.inst.__load_finish_list.push(e.url+".atlas"),e.handler&&e.handler.runWith([n]);break;case pe.scene2d_res:if(a(e.url),l=Laya.loader.getRes(e.url))-1==Tn.inst.__load_finish_list.indexOf(e.url)&&Tn.inst.__load_finish_list.push(e.url),e.handler&&e.handler.runWith([l]);else e.errorNum=s,t[t.length]=e;break;case pe.res2d_db:a(e.url+".png"),a(e.url+".sk");var l=Laya.loader.getRes(e.url+".png");n=Laya.loader.getRes(e.url+".sk");if(l)-1==Tn.inst.__load_finish_list.indexOf(e.url+".png")&&Tn.inst.__load_finish_list.push(e.url+".png");else t[t.length]={url:e.url+".png",errorNum:s,type:me.res2d,restype:pe.res2d_atlas};if(n)-1==Tn.inst.__load_finish_list.indexOf(e.url+".sk")&&Tn.inst.__load_finish_list.push(e.url+".sk");else t[t.length]={url:e.url+".sk",errorNum:s,type:me.res2d,restype:pe.res2d_atlas};l&&n&&e.handler&&e.handler.runWith([n])}}static localload(e,t){for(var i=[],s=0;s<e.length;s++){var a=e[s];switch(a.restype){case pe.img2d_res:case pe.scene2d_res:i.push(ce.fullPath(a.url));break;case pe.res2d_atlas:i.push(ce.fullPath(a.url+".png")),i.push(ce.fullPath(a.url+".atlas"));break;case pe.res2d_db:i.push(ce.fullPath(a.url+".png")),i.push(ce.fullPath(a.url+".sk"))}}mn.localload(e,i,t)}}gn.lifetime=30;class yn{static get_load_list(e,t){var i=Tn.inst,s=0,a=i.__error_load_list.filter(t=>t.url==e.url&&t.type==e.type)[0];a&&(i.__error_load_list.splice(i.__error_load_list.indexOf(a),1),s+=a.errorNum);var n=t.filter(t=>t.url==e.url&&t.type==e.type)[0];if(n){if(!n.handler&&e.handler)return void(n.handler=e.handler);if(!n.handler||e.handler)return}var o="string"==typeof e.url?Laya.loader.getRes(e.url):null;o?e.handler&&e.handler.runWith([o]):(e.errorNum=s,t[t.length]=e)}static res(){}}yn.lifetime=0;class fn{static get_load_list(e,t){var i=Tn.inst,s=0,a=i.__error_load_list.filter(t=>t.url==e.url&&t.type==e.type)[0];a&&(i.__error_load_list.splice(i.__error_load_list.indexOf(a),1),s+=a.errorNum);var n=t.filter(t=>t.url==e.url&&t.type==e.type)[0];if(n){if(!n.handler&&e.handler)return void(n.handler=e.handler);if(!n.handler||e.handler)return}var o="string"==typeof e.url?Laya.loader.getRes(e.url):null;o?e.handler&&e.handler.runWith([o]):(e.errorNum=s,t[t.length]=e)}}fn.lifetime=30;class _n{static get_load_list(e,t){var i=Tn.inst,s=[],a=0,n=i.__error_load_list.filter(t=>t.url==e.url&&t.type==e.type)[0];switch(n&&(i.__error_load_list.splice(i.__error_load_list.indexOf(n),1),a+=n.errorNum),e.restype){case pe.res3d_group_role:_n.mateGroup(e.url,Re,s);for(var o=0;o<s.length;o++){if(!t.filter(e=>e.url==s[o].url)[0])Laya.loader.getRes(s[o].url)||(s[o].errorNum=a,t[t.length]=s[o])}break;case pe.res3d_group_prop:_n.mateGroup(e.url,Pe,s);for(o=0;o<s.length;o++){if(!t.filter(e=>e.url==s[o].url)[0])Laya.loader.getRes(s[o].url)||(s[o].errorNum=a,t[t.length]=s[o])}break;case pe.res3d_group_scene:_n.mateGroup(e.url,Ge,s);for(o=0;o<s.length;o++){if(!t.filter(e=>e.url==s[o].url)[0])Laya.loader.getRes(s[o].url)||(s[o].errorNum=a,t[t.length]=s[o])}break;case pe.res3d_group_build:_n.mateGroup(e.url,He,s);for(o=0;o<s.length;o++){if(!t.filter(e=>e.url==s[o].url)[0])Laya.loader.getRes(s[o].url)||(s[o].errorNum=a,t[t.length]=s[o])}break;case pe.res3d_group_3dmap:_n.mateGroup(e.url,Be,s);for(o=0;o<s.length;o++){if(!t.filter(e=>e.url==s[o].url)[0])Laya.loader.getRes(s[o].url)||(s[o].errorNum=a,t[t.length]=s[o])}}}static mateGroup(e,t,i){var s=[];if(e){for(var a=0;a<t.res[e].length;a++)i[i.length]={url:"res/res3D/"+t.res[e][a],clas:Laya.Texture2D,type:me.res3d},s.push("res/res3D/"+t.res[e][a]);for(a=0;a<t.config[e].length;a++)-1!=t.config[e][a].search(".lmat")&&(i[i.length]={url:"res/res3D/"+t.config[e][a],clas:Laya.MeshRenderer,type:me.res3d},s.push("res/res3D/"+t.config[e][a]));for(a=0;a<t.config[e].length;a++)-1!=t.config[e][a].search(".lani")&&(i[i.length]={url:"res/res3D/"+t.config[e][a],clas:Laya.Animator,type:me.res3d},s.push("res/res3D/"+t.config[e][a]));for(a=0;a<t.config[e].length;a++)-1!=t.config[e][a].search(".lav")&&(i[i.length]={url:"res/res3D/"+t.config[e][a],type:me.res3d},s.push("res/res3D/"+t.config[e][a]));for(a=0;a<t.config[e].length;a++)-1!=t.config[e][a].search(".lm")&&(i[i.length]={url:"res/res3D/"+t.config[e][a],clas:Laya.Sprite3D,type:me.res3d},s.push("res/res3D/"+t.config[e][a]));i[i.length]={url:"res/res3D/"+e,clas:Laya.Sprite3D,type:me.res3d,preloadlist:s}}}}_n.lifetime=30;class vn{static get_load_list(e,t){var i=Tn.inst,s=0,a=i.__error_load_list.filter(t=>t.url==e.url&&t.type==e.type)[0];a&&(i.__error_load_list.splice(i.__error_load_list.indexOf(a),1),s+=a.errorNum);var n=t.filter(t=>t.url==e.url&&t.type==e.type)[0];if(n){if(!n.handler&&e.handler)return void(n.handler=e.handler);if(!n.handler||e.handler)return}var o="string"==typeof e.url?Laya.loader.getRes(e.url):null;o?e.handler&&e.handler.runWith([o]):(e.errorNum=s,t[t.length]=e)}}vn.lifetime=0;class bn{load(e,t,i){Laya.loader.load(ce.fullPath(e),initHandler(this,s=>{s?t.runWith([e]):i.runWith([e])}))}}class wn{static get_load_list(e,t){var i=Tn.inst,s=0,a=i.__error_load_list.filter(t=>t.url==e.url&&t.type==e.type)[0];a&&(i.__error_load_list.splice(i.__error_load_list.indexOf(a),1),s+=a.errorNum);var n=t.filter(t=>t.url==e.url&&t.type==e.type)[0];if(n){if(!n.handler&&e.handler)return void(n.handler=e.handler);if(!n.handler||e.handler)return}var o="string"==typeof e.url?Laya.loader.getRes(e.url):null;o?e.handler&&e.handler.runWith([o]):(e.errorNum=s,t[t.length]=e)}static res(){}}wn.lifetime=0;class Tn{constructor(e){this.maxLoadCount=4,this.maxPreloadCount=2,this.maxErrorLoadCount=1,this.maxErrorUnLoadCount=3,this.onLineWorkCount=0;this.__map={},this.__load_finish_list=[],this.__load_list=[],this.__load_work_list=[],this.__loaded={},this.__error_load_list=[],this.__res_lib={},this.loadCfg=new bn,this.load2d=new mn,this.load3d=new hn,this.loadAni=new dn,this.loadDb=new cn,this.sound=new Oi,this.dataArea=new un,this.mapdata=new pn,this.versionHandler=e,cafe.event.on("res_load",this.res_load,this),Ye.add(1,this,this.checkResFrame)}static init(e){Tn.inst=new Tn(e)}res_load(e){this.load(e.urls,e.handler,e.priority,e.prosshandler)}getPreIsFinish(e){if(!e.preloadlist)return!0;for(var t=0;t<e.preloadlist.length;t++){if(-1==this.__load_finish_list.indexOf(e.preloadlist[t]))return!1}return!0}checkResFrame(e){if(e%4==0&&this.onLineWorkCount<this.maxLoadCount){if(this.__load_list.length>0)if(n=this.__load_list.filter(e=>e.priority<ue.LevelG)){n.sort((e,t)=>e.priority-t.priority),(o=this.maxLoadCount-this.onLineWorkCount)>n.length&&(o=n.length);for(var t=0;t<o;t++){var i=n.shift(),s=this.__load_list.indexOf(i),a=this.__load_list.splice(s,1)[0];this.load_start(a)}}else{var n=this.__load_list.filter(e=>e.priority==ue.LevelG);(o=this.maxPreloadCount-this.onLineWorkCount)>n.length&&(o=n.length);for(t=0;t<o;t++){i=n.shift(),s=this.__load_list.indexOf(i),a=this.__load_list.splice(s,1)[0];this.load_start(a)}}if(this.__error_load_list.length>0){var o;n=this.__error_load_list.filter(e=>e.priority==ue.LevelH);(o=this.maxErrorLoadCount-this.onLineWorkCount)>n.length&&(o=n.length);for(t=0;t<o;t++){i=n.shift(),s=this.__error_load_list.indexOf(i),a=this.__error_load_list.splice(s,1)[0];this.load_start(a)}}}}localload(e,t){for(var i=0,s=0,a=[],n=e=>{a.push(e),++i>=s&&t.runWith([()=>{for(var e=0;e<a.length;e++){(0,a[e])()}}])},o=0;o<e.length;o++){var r=e[o];switch(r.type){case me.rescfg:case me.reszip:break;case me.res2d:s++,gn.localload(e,initHandler(r,n));break;case me.res3d:case me.ressud:}}}load_start(e){var t=this;if(1==Me.loadding_log&&slog(`开始预加载：${e.url}`),e){if(t.onLineWorkCount++,t.__load_work_list.push(e),Laya.loader)try{if("string"==typeof e.url){var i=Laya.loader.getRes(e.url);if(i){e.url&&e&&e.loadCom?e.loadCom.runWith([e.url,e.type]):console.warn("没有返回:"+e.url),e&&e.handler&&e.handler.runWith([e.url]);var s=Math.floor((new Date).valueOf()/1e3);return t.__loaded[e.url]||(t.__loaded[e.url]={url:e.url,type:e.type,prelifetime:0}),t.__loaded[e.url].prelifetime=s,t.onLineWorkCount--,-1!=(a=t.__load_work_list.indexOf(e))&&t.__load_work_list.splice(a,1),void t.__load_finish_list.push(e.url)}if(i=Laya.loader.getRes(Laya.URL.basePath+e.url)){e.url&&e&&e.loadCom?e.loadCom.runWith([e.url,e.type]):console.warn("没有返回:"+e.url),e&&e.handler&&e.handler.runWith([e.url]);var a;s=Math.floor((new Date).valueOf()/1e3);return t.__loaded[e.url]||(t.__loaded[e.url]={url:e.url,type:e.type,prelifetime:0}),t.__loaded[e.url].prelifetime=s,t.onLineWorkCount--,-1!=(a=t.__load_work_list.indexOf(e))&&t.__load_work_list.splice(a,1),void t.__load_finish_list.push(e.url)}}}catch(t){return void serror("load_start LoadError Type"+e.type+":"+e.url)}t.preLoadRes(e.url,e.type,initHandler(t,i=>{i&&e&&e.loadCom?e.loadCom.runWith([e.url,e.type]):console.warn("没有返回:"+e.url),e&&e.handler&&e.handler.runWith([e.url]);var s=Math.floor((new Date).valueOf()/1e3);t.__loaded[e.url]||(t.__loaded[e.url]={url:e.url,type:e.type,prelifetime:0}),t.__loaded[e.url].prelifetime=s,t.onLineWorkCount--;var a=t.__load_work_list.indexOf(e);-1!=a&&t.__load_work_list.splice(a,1),t.__load_finish_list.push(e.url)}),initHandler(t,t.load_com,[e]))}}load_com(e,t){try{if("string"==typeof e.url)if(Laya.loader.getRes(e.url)){t&&e&&e.loadCom?e.loadCom.runWith([e.url,e.type]):console.warn("没有返回:"+e.url),e&&e.handler&&e.handler.runWith([e.url]);var i,s=Math.floor((new Date).valueOf()/1e3);return this.__loaded[e.url]||(this.__loaded[e.url]={url:e.url,type:e.type,prelifetime:0}),this.__loaded[e.url].prelifetime=s,this.onLineWorkCount--,-1!=(i=this.__load_work_list.indexOf(e))&&this.__load_work_list.splice(i,1),void this.__load_finish_list.push(e.url)}}catch(t){serror("load_com LoadError Type"+e.type+":"+e.url)}e.errorNum++,this.maxErrorLoadCount<=e.errorNum?(this.maxErrorUnLoadCount<=e.errorNum?t&&e&&e.loadCom&&e.loadCom.runWith([!1]):(this.__error_load_list[this.__error_load_list.length]=e,e.priority=ue.LevelH),slog(Laya.URL.basePath+e.url),serror("LoadError Type"+e.type+":"+e.url)):this.__load_list[this.__load_list.length]=e,"string"==typeof e.url&&Laya.loader.clearRes(e.url),Laya.loader.clearUnLoaded(),this.onLineWorkCount--,-1!=(i=this.__load_work_list.indexOf(e))&&this.__load_work_list.splice(i,1)}load(e,t,i,s){null==i&&(i=ue.LevelC);var a=this.get_load_list(e);if(a.length<=0)return s&&s.runWith([Number((e.length/e.length).toFixed(2))]),void(t&&t.runWith([e]));for(var n=a.length,o=0,r=[],l=new Laya.Handler(this,(e,i)=>{if(e){o++,s&&s.runWith([Number((o/n).toFixed(2))]);var l=a.filter(t=>t.url==e&&t.type==i)[0];l&&(a.splice(a.indexOf(l),1),r[r.length]={url:l.url,type:l.type}),o>=n&&t&&t.runWith([r])}else t&&t.runWith([!1])}),h=0;h<a.length;h++)a[h].loadCom=l,a[h].priority=i;switch(i){case ue.LevelA:case ue.LevelB:case ue.LevelC:this.__load_list.unshift(...a);break;case ue.LevelD:case ue.LevelE:case ue.LevelF:case ue.LevelG:case ue.LevelH:this.__load_list.push(...a)}this.__load_list.sort((e,t)=>e.priority-t.priority)}get_load_list(e){for(var t=[],i=0;i<e.length;i++)switch(e[i].type){case me.rescfg:yn.get_load_list(e[i],t);break;case me.reszip:fn.get_load_list(e[i],t);break;case me.res2d:gn.get_load_list(e[i],t);break;case me.res3d:_n.get_load_list(e[i],t);break;case me.ressud:vn.get_load_list(e[i],t);break;case me.resmap:wn.get_load_list(e[i],t)}return t}preLoadRes(e,t,i,s){switch(t){case me.res3d:this.load3d.preLoad3DRes(e,i,s);break;case me.res2d:this.load2d.load(e,i,s);break;case me.ressud:this.sound.pre(e,i,s);break;case me.resmap:this.mapdata.preLoadMap(e,i,s);break;case me.rescfg:this.loadCfg.load(e,i,s)}}setImageIcon(e,t){e&&e.stage&&t&&(this.__res_lib[t]?e.skin=t:this.load([{url:t,type:me.res2d,restype:0}],initHandler(this,i=>{e&&i&&e.stage&&(e.skin=t)})))}showRes(){for(var e in this.__map)serror(this.__map[e])}dispose(){Ye.remove(this,this.checkResFrame),cafe.event.off("res_load",this.res_load,this)}}class An extends cafe.data.BaseData{constructor(){super(An.NAME);slog("初始化：",An),this.init()}init(){this.pathmap={}}getPath(e){if(this.pathmap[e])return this.pathmap[e];var t=Laya.Loader.getRes("res/config/pathdata/"+e+".json");return this.pathmap[e]=t,t}loadNpc(e){var t=a.thing.getTbByThingId(e.routePathNpcId),i=this.getPath(e.routePathId);Tn.inst.load3d.res(ce.d3res+Pe.res_dic[Pe.res_enum[`_prop_res_${t.path}_lh`]],ea.scene.mainscene,1,{},initHandler(this,s=>{var a=i.lines[0];s.transform.position=new Laya.Vector3(a[0],0,a[1]),s.transform.localScale=new Laya.Vector3(t.scale,t.scale,t.scale),oi.singleton.buildthing.push({mode:s,tb:t}),s.addComponent(ji).initThing(e)}))}loadPath(e){if(0!=e){var t=a.route.getTbByRouteId(e);this.loadNpc(t)}}loadMission(e){for(var t=a.mission.fetchMissionTb(e).missionRouteList.split("|"),i=0;i<t.length;i++)this.loadPath(Number(t[i]))}save(){}read(){return i.readJson(An.NAME)}}An.NAME="PATH_DATA";class xn extends cafe.data.BaseData{constructor(){super(xn.NAME);this.goodsmap={},this.init()}init(){var e=this.read();e||(e={goodsmap:{}}),this.maps={};for(var t=a.goods.tb(),i=0;i<t.length;i++){var s=t[i],n={};n.goodsId=s.goodsId,n.type=s.type,n.tb=s,n.count=e.goodsmap&&e.goodsmap[s.goodsId]?e.goodsmap[s.goodsId]:0,this.maps[n.goodsId]=n}this.goodsmap=e&&e.goodsmap?e.goodsmap:{}}getGoodsList(e){var t=[];for(var i in this.maps){var s=this.maps[i];e(s)&&(t[t.length]=s)}return t}getGoodsListByType(e){var t=[];for(var i in this.maps){var s=this.maps[i];s.type==e&&(t[t.length]=s)}return t.sort((e,t)=>e.type<t.type?-1:e.type>t.type?1:e.goodsId<t.goodsId?-1:e.goodsId>t.goodsId?1:0),t}isCheckGoods(e,t){return this.maps[e].count>=t}getGoods(e){return this.maps[e]}addGoods(e,t){this.maps[e]&&(this.maps[e].count+=t),this.goodsmap[e]||(this.goodsmap[e]=0),this.goodsmap[e]++,this.save(),this.invalidate(xn.GOODS_ID_REF+"_"+e)}removeGoods(e,t){this.maps[e]&&(this.maps[e].count-=t),this.goodsmap[e]&&(this.goodsmap[e]--,this.goodsmap[e]<=0&&delete this.goodsmap[e]),this.save(),this.invalidate(xn.GOODS_ID_REF+"_"+e)}useGoods(e,t){var i=this.maps[e];if(i){switch(i.type){case 1:case 2:case 3:case 4:return!0}return!1}this.save(),this.invalidate(xn.GOODS_ID_REF+"_"+e)}save(){var e={goodsmap:this.goodsmap};i.saveJson(xn.NAME,e)}read(){return i.readJson(xn.NAME)}}xn.NAME="GOODS_DATA",xn.GOODS_ID_REF="GOODS_ID_REF";class kn extends cafe.data.BaseData{constructor(){super(kn.NAME);this.init()}init(){var e=this.read();e||(e={setup:[],finishsetups:[]}),this.setup=e.setup,this.finishsetups=e.finishsetups,this.refNewGuide(),cafe.event.on(se.CLOSE_GAME_PANEL,this.refSetup,this),cafe.event.on(ge.panel.CLOSE_PANEL,this.refSetup,this),cafe.event.on(ge.game.MAP_REPLACE_FINISH,this.refSetup,this),cafe.event.on(ge.game.GUIDE_HIDE,this.hideGuide,this)}hideGuide(){Dt.hideGuide()}refSetup(){this.invalidate()}isGuideBoolean(e){return(!this.currSetup||this.currSetup==e)&&-1!=this.setup.indexOf(e)}setGuide(e){this.currSetup=e}finishSetup(e=!0){if(this.currSetup){var t=this.currSetup;-1==this.finishsetups.indexOf(t)&&this.finishsetups.push(t),this.refNewGuide(),this.currSetup=null,e&&this.invalidate(),this.save()}}refNewGuide(){for(var e=[],t=a.guide.tb(),i=0;i<t.length;i++){for(var s=t[i],n=s.preGuides.split("|"),o=!0,r=0;r<n.length;r++){var l=Number(n[r]);if(-1!=this.finishsetups.indexOf(s.guideId)){o=!1;break}var h=this.finishsetups.indexOf(l);if(0!=l&&-1==h){o=!1;break}}o&&e.push(s.guideId)}this.setup=e}save(){var e={setup:this.setup,finishsetups:this.finishsetups};i.saveJson(kn.NAME,e)}read(){return i.readJson(kn.NAME)}}kn.NAME="GUIDE_DATA";class En extends cafe.data.BaseData{constructor(){super(En.NAME),this.isBossShow=!1,this.missNum=0;this.init()}init(){slog("初始化：LevelData"),this.mission_map={};var e=this.read(),t=a.mission.tb();if(e){this.mission_save_map=e;for(i=0;i<t.length;i++){o=t[i];(n=this.mission_save_map[o.missionType])||(n={},this.mission_save_map[o.missionType]=n,n.data={},n.data.id_list=[],n.data.skipList=[]),o.isInitDefault&&(this.missionType=o.missionType),(s={}).mission_id=o.missionId,s.tb=o,s.skip=-1!=n.data.skipList.indexOf(o.missionId),s.pass=-1!=n.data.id_list.indexOf(o.missionId),this.mission_map[s.mission_id]=s}}else{this.mission_save_map={},e={};for(var i=0;i<t.length;i++){var s,n,o=t[i];(s={}).mission_id=o.missionId,s.tb=o,s.skip=!1,s.pass=!1,this.mission_map[s.mission_id]=s,(n=this.mission_save_map[o.missionType])||(n={},this.mission_save_map[o.missionType]=n,n.data={},n.data.id_list=[],n.data.skipList=[]),o.isTypeInitDefault&&(n.maxId=o.missionId,n.selectId=o.missionId,n.currId=o.missionId,n.startId=o.missionId,n.IsLevelHard=!1),o.isInitDefault&&(this.missionType=o.missionType)}}this.save(),slog("初始化：LevelData完成")}get max_mission_id(){var e=this.missionType;return this.mission_save_map[e].maxId}get currid(){var e=this.missionType;return this.mission_save_map[e].currId}get select_id(){var e=this.missionType;return this.mission_save_map[e].selectId}get isHard(){var e=this.missionType;return this.mission_save_map[e].IsLevelHard}set isHard(e){var t=this.missionType;this.mission_save_map[t].IsLevelHard=e}setSelectId(e,t){null==t&&(t=this.missionType),this.mission_save_map[t].selectId=e,this.save()}get list(){for(var e=this.missionType,t=[],i=this.mission_save_map[e].startId,s=this.mission_map[this.mission_save_map[e].startId];s;){t.push(s);var a=s.tb.mission_next;if(i==a)break;s=this.mission_map[a]}return t}getLevelByLevelId(e){return this.mission_map[e]}getLevelBypreLevelId(e){var t=this.mission_map[e];return this.mission_map[t.tb.mission_next]}nextLevel(e){null==e&&(e=this.missionType);var t=this.mission_save_map[e],i=this.mission_map[t.currId];t.currId=i.tb.mission_next,t.selectId=i.tb.mission_next,this.save(e)}showBoss(e){if(!this.isBossShow){null==e&&(e=this.missionType);var t=this.mission_save_map[e],i=a.mission.fetchMissionTb(t.selectId);this.missNum>=i.missNum&&(this.isBossShow=!0,Et.openpanel(vt.BossTipsPanel,vt.PANEL_TOP_TIPS))}}levelNum(e){null==e&&(e=this.missionType),this.mission_save_map[e];var t=0;for(var i in this.mission_map){this.mission_map[i].pass&&t++}return t}skip_level(e){null==e&&(e=this.missionType);var t,i=this.mission_save_map[e],s=i.selectId+1;i.data.skipList.filter(e=>e==i.selectId)[0]||(i.data.skipList[i.data.skipList.length]=i.selectId),(t=this.mission_map[i.selectId])&&(t.skip=!0),i.data.skipList.filter(e=>e==s)[0]||(i.data.skipList[i.data.skipList.length]=s),(t=this.mission_map[s])&&(t.skip=!0),this.save(e,s)}skipLevelById(e,t){null==t&&(t=this.missionType);var i=this.mission_save_map[t];i.data.skipList.filter(t=>t==e)[0]||(i.data.skipList[i.data.skipList.length]=e);var s=this.mission_map[e];s&&(s.skip=!0),this.save(t,s.mission_id)}unlock_level(e){null==e&&(e=this.missionType);var t=this.mission_save_map[e],i=t.selectId+1;this.mission_map[i]||(i=t.selectId),this.save(e,i)}over_level(e){null==e&&(e=this.missionType);var t=this.mission_save_map[e],i=this.mission_map[t.selectId];i&&(i.pass=!0),t.maxId<i.mission_id&&(t.maxId=i.mission_id),t.data.id_list.push(t.selectId),this.save(e,t.selectId)}Finish(){}Clear(){this.read();var e=a.mission.tb();this.mission_save_map={};for(var t=0;t<e.length;t++){var i=e[t],s={};s.mission_id=i.missionId,s.tb=i,s.skip=!1,s.pass=!1,this.mission_map[s.mission_id]=s;var n=this.mission_save_map[i.missionType];n||(n={},this.mission_save_map[i.missionType]=n,n.data={},n.data.id_list=[],n.data.skipList=[]),i.isTypeInitDefault&&(n.maxId=i.missionId,n.selectId=i.missionId,n.currId=i.missionId,n.startId=i.missionId,n.IsLevelHard=!0),i.isInitDefault&&(this.missionType=i.missionType)}this.save()}save(e,t){null==e&&(e=this.missionType);var s=this.mission_save_map[e];null!=t&&(s.selectId=t,s.currId=t);var a=this.mission_save_map;i.saveJson(En.NAME,a)}read(){return i.readJson(En.NAME)}}En.NAME="LEVEL_DATA";class In extends cafe.data.BaseData{constructor(){super(In.NAME);this.init()}init(){this.npcmap={};var e=this.read();e||(e={equip_npc:0,npc_list:[],equip_npc_list:[]}),this.selectNpc(e&&e.equip_npc?e.equip_npc:0,!0),this.npc_list=e&&e.npc_list?e.npc_list:[],this.equip_npc_list=e&&e.equip_npc_list?e.equip_npc_list:[];for(var t=a.npc.tb(),i=0;i<t.length;i++){var s=t[i],n={},o=this.npc_list.indexOf(s.npcId);n.npcId=s.npcId,n.equip=this.equip_npc==this.equip_npc,n.isHave=-1!=o,n.npcsIsFollow=-1!=this.equip_npc_list.indexOf(s.npcId),n.tb=s,this.npcmap[s.npcId]=n}this.save()}getListByNpcId(e){for(var t=[],i=a.npc.tb(),s=0;s<i.length;s++){var n=a.npc.getTbByNpcId(i[s].npcId);n.returnNpc==e&&t.push(this.npcmap[n.npcId])}return t}getNpcList(){var e=[];for(var t in this.npcmap){var i=this.npcmap[t];e[e.length]=i}return e}getNpcListIndex(){var e=[];for(var t in this.npcmap){var i=this.npcmap[t];i.npcId,this.equip_npc,e[e.length]=i}}isNpc(e){return!!this.npcmap[e]}isHasNpc(e){return-1!=this.npc_list.indexOf(e)}haveNpc(e,t=!0){this.npc_list||(this.npc_list=[]),-1==this.npc_list.indexOf(e)&&(this.npc_list[this.npc_list.length]=e);var i={},s=a.npc.getTbByNpcId(e);this.equip_npc=e,i.npcId=s.npcId,i.equip=this.equip_npc==e,i.isHave=!0,i.tb=s,this.npcmap[e]=i,this.refnpcmap(),t&&this.selectNpc(e,!0),this.save(),this.invalidate()}refnpcmap(){for(var e in this.npcmap){var t=this.npcmap[e];t.equip=t.npcId==this.equip_npc}}tempNpc(e){this.equip_npc=e,this.refnpcmap(),this.save(),cafe.event.dispatch(Z.EQUIP_NPC,e),this.equip_npc_list||(this.equip_npc_list=[]),-1==this.equip_npc_list.indexOf(e)&&(this.equip_npc_list[this.equip_npc_list.length]=e),this.invalidate()}selectNpc(e,t=!1){this.equip_npc=e,this.refnpcmap(),t||this.save(),cafe.event.dispatch(Z.EQUIP_NPC,e),this.invalidate()}save(){var e={equip_npc:this.equip_npc,npc_list:this.npc_list,equip_npc_list:this.equip_npc_list};i.saveJson(In.NAME,e)}read(){return i.readJson(In.NAME)}getCurrNpc(){return this.npcmap[this.equip_npc]}}In.NAME="NPC_DATA";class Cn extends cafe.data.BaseData{constructor(){super(Cn.NAME);this.goodsmap={},this.init()}init(){var e=this.read();e||(e={goodsmap:{}}),this.maps={};for(var t=a.goods.tb(),i=0;i<t.length;i++){var s=t[i],n={};n.goodsId=s.goodsId,n.type=s.type,n.tb=s,n.count=e.goodsmap&&e.goodsmap[s.goodsId]?e.goodsmap[s.goodsId]:0,this.maps[n.goodsId]=n}this.goodsmap=e&&e.goodsmap?e.goodsmap:{}}getPackList(e){var t=[];for(var i in this.maps){var s=this.maps[i];e(s)&&(t[t.length]=s)}return t}getPackListByType(e=0){var t=[];for(var i in this.maps){var s=this.maps[i];s.type!=e&&0!=e||(t[t.length]=s)}return t.sort((e,t)=>e.type<t.type?-1:e.type>t.type?1:e.goodsId<t.goodsId?-1:e.goodsId>t.goodsId?1:0),t}getGoods(e){return this.maps[e]}addGoods(e,t){this.maps[e]&&(this.maps[e].count+=t),this.save(),this.invalidate(Cn.PACK_ID_REF+"_"+e)}removeGoods(e,t){this.maps[e]&&(this.maps[e].count-=t),this.save(),this.invalidate(Cn.PACK_ID_REF+"_"+e)}useGoods(e,t){Ve.goods.useGoods(e,t)?(this.save(),this.invalidate(Cn.PACK_ID_REF+"_"+e)):Ue.show("道具使用失败,ID为："+e)}save(){var e={goodsmap:this.goodsmap};i.saveJson(Cn.NAME,e)}read(){return i.readJson(Cn.NAME)}}Cn.NAME="PACK_DATA",Cn.PACK_ID_REF="PACK_ID_REF";class Ln{}Ln.AdvertTestPanel="res/modules/advert/AdvertTestPanel.scene",Ln.CurrencyBar="res/modules/common/CurrencyBar.scene",Ln.MoneyTipsView="res/modules/common/MoneyTipsView.scene",Ln.MoneyView="res/modules/common/MoneyView.scene",Ln.GameStrengthView="res/modules/common/GameStrengthView.scene",Ln.TipsView="res/modules/common/TipsView.scene",Ln.DrawItemView="res/modules/draw/DrawItemView.scene",Ln.DrawPanel="res/modules/draw/DrawPanel.scene",Ln.DrawShowPanel="res/modules/draw/DrawShowPanel.scene",Ln.FuseComposePanel="res/modules/fuse/FuseComposePanel.scene",Ln.FusePanel="res/modules/fuse/FusePanel.scene",Ln.GameScene="res/modules/game/GameScene.scene",Ln.SteeringWheel="res/modules/game/item/SteeringWheel.scene",Ln.TaskItem="res/modules/game/item/TaskItem.scene",Ln.TaskProgress="res/modules/game/item/TaskProgress.scene",Ln.Timer="res/modules/game/item/Timer.scene",Ln.BuffItemView="res/modules/game/view/BuffItemView.scene",Ln.Die_CountdownView="res/modules/game/view/Die_CountdownView.scene",Ln.FightHeroInfoView="res/modules/game/view/FightHeroInfoView.scene",Ln.GameFinishView="res/modules/game/view/GameFinishView.scene",Ln.HeroItemView="res/modules/game/view/HeroItemView.scene",Ln.DataItemView="res/modules/game/view/item/DataItemView.scene",Ln.JackBtnDirView="res/modules/game/view/JackBtnDirView.scene",Ln.JackCarFuncBtnView="res/modules/game/view/JackCarFuncBtnView.scene",Ln.JackCarSpeedFuncBtnView="res/modules/game/view/JackCarSpeedFuncBtnView.scene",Ln.JackCarUpBtnDirView="res/modules/game/view/JackCarUpBtnDirView.scene",Ln.JackDirView="res/modules/game/view/JackDirView.scene",Ln.JackView1="res/modules/game/view/JackView1.scene",Ln.JackView2="res/modules/game/view/JackView2.scene",Ln.RankingItem="res/modules/game/view/RankingItem.scene",Ln.RemoteUi="res/modules/game/view/RemoteUi.scene",Ln.GameEasyTaskPanel="res/modules/gameend/GameEasyTaskPanel.scene",Ln.GameFinish2Panel="res/modules/gameend/GameFinish2Panel.scene",Ln.GameFinishPanel="res/modules/gameend/GameFinishPanel.scene",Ln.GameLostPanel="res/modules/gameend/GameLostPanel.scene",Ln.GameNoActionPanel="res/modules/gameend/GameNoActionPanel.scene",Ln.GamePausePanel="res/modules/gameend/GamePausePanel.scene",Ln.GameTaskFinishPanel="res/modules/gameend/GameTaskFinishPanel.scene",Ln.GameTaskPanel="res/modules/gameend/GameTaskPanel.scene",Ln.GameTimeOut2Panel="res/modules/gameend/GameTimeOut2Panel.scene",Ln.GameTimeOutPanel="res/modules/gameend/GameTimeOutPanel.scene",Ln.GameWin2Panel="res/modules/gameend/GameWin2Panel.scene",Ln.GameWinPanel="res/modules/gameend/GameWinPanel.scene",Ln.TaskRoleItem="res/modules/gameend/item/TaskRoleItem.scene",Ln.GuideImgPanel="res/modules/guide/GuideImgPanel.scene",Ln.HallScene="res/modules/hall/HallScene.scene",Ln.LevelItemView="res/modules/level/LevelItemView.scene",Ln.LevelPanel="res/modules/level/LevelPanel.scene",Ln.loadding="res/modules/loadding/loadding.scene",Ln.LoginScene="res/modules/login/LoginScene.scene",Ln.SettingPanel="res/modules/setting/SettingPanel.scene",Ln.SettingView="res/modules/setting/SettingView.scene",Ln.Jili2Panel="res/modules/shop/Jili2Panel.scene",Ln.JiliItem="res/modules/shop/JiliItem.scene",Ln.JiliPanel="res/modules/shop/JiliPanel.scene",Ln.ShopBtnItemView="res/modules/shop/ShopBtnItemView.scene",Ln.ShopItemView="res/modules/shop/ShopItemView.scene",Ln.ShopPanel="res/modules/shop/ShopPanel.scene",Ln.UnlockShopPanel="res/modules/shop/UnlockShopPanel.scene",Ln.SignInItem="res/modules/signIn/SignInItem.scene",Ln.SignInItem2="res/modules/signIn/SignInItem2.scene",Ln.SignInPanel="res/modules/signIn/SignInPanel.scene",Ln.TestSocket="res/modules/test/TestSocket.scene",Ln.AlertActionTipPanel="res/modules/tips/AlertActionTipPanel.scene",Ln.AlertSystemPanel="res/modules/tips/AlertSystemPanel.scene",Ln.AlertTipPanel="res/modules/tips/AlertTipPanel.scene",Ln.CloseNetTipPanel="res/modules/tips/CloseNetTipPanel.scene",Ln.DisposeTipPanel="res/modules/tips/DisposeTipPanel.scene",Ln.GetContinueTestSkinPanel="res/modules/tips/GetContinueTestSkinPanel.scene",Ln.GetRewardPanel="res/modules/tips/GetRewardPanel.scene",Ln.GetTestSkinPanel="res/modules/tips/GetTestSkinPanel.scene",Ln.UnlockPanel="res/modules/tips/UnlockPanel.scene";class Mn extends cafe.data.BaseData{constructor(){super(Mn.NAME);this.init()}init(){this.rolemap={};var e=a.shop.getTbByType(3),t=this.read();t||(t={equip_role:e[0].targetId,role_list:[e[0].targetId],role_die_count:0}),this.role_die_count=t&&t.role_die_count?t.role_die_count:0,this.equip_role=t&&t.equip_role?t.equip_role:e[0].targetId,this.selectRole(t&&t.equip_role?t.equip_role:0,!0),this.role_list=t&&t.role_list?t.role_list:[];for(var i=a.role.tb(),s=0;s<i.length;s++){var n=i[s],o={},r=this.role_list.indexOf(n.roleId);o.roleId=n.roleId,o.equip=this.equip_role==n.roleId,o.isHave=-1!=r,o.tb=n,this.rolemap[n.roleId]=o}cafe.event.dispatch(Z.EQUIP_ROLE,this.equip_role),this.save()}getInfoByRoleId(e){return this.rolemap[e]}getTestRole(){var e,t=[],i=[];for(var s in this.rolemap){var a=this.rolemap[s];i.push(a),a.isHave||t.push(a)}if(1==t.length)e=t[0].roleId;else if(t.length>1){e=t[Math.round(Math.random()*(t.length-1))].roleId}else{e=i[Math.round(Math.random()*(i.length-1))].roleId}return e}getCurrRole(){return this.rolemap[this.test_role?this.test_role:this.equip_role]}getListByRoleId(e){for(var t=[],i=a.role.tb(),s=0;s<i.length;s++){var n=a.role.getTbByRoleId(i[s].roleId);n.returnRole==e&&t.push(this.rolemap[n.roleId])}return t}getRoleList(){var e=[];for(var t in this.rolemap){var i=this.rolemap[t];e[e.length]=i}return e}getRoleListIndex(){var e=[];for(var t in this.rolemap){var i=this.rolemap[t];i.roleId,this.equip_role,e[e.length]=i}}getOneRoleList(){var e=[];for(var t in this.rolemap){var i=this.rolemap[t];i.roleId==i.tb.returnRole&&(e[e.length]=i)}return e}getOneMinLevelRole(){var e=null;for(var t in this.rolemap){var i=this.rolemap[t];i.roleId==i.tb.returnRole&&(e||i.isHave?e&&e.roleId>=i.roleId&&(e=i):e=i)}return e}isRole(e){return!!this.rolemap[e]}isHasRole(e){return-1!=this.role_list.indexOf(e)}haveRole(e,t=!0){this.role_list||(this.role_list=[]),-1==this.role_list.indexOf(e)&&(this.role_list[this.role_list.length]=e);var i={},s=a.role.getTbByRoleId(e);this.equip_role=e,i.roleId=s.roleId,i.equip=this.equip_role==e,i.isHave=!0,i.tb=s,this.rolemap[e]=i,Tn.inst.sound.play(s.changeSound),this.refRoleMap(),t&&this.selectRole(e,!0),this.save(),this.invalidate()}compose(e){this.role_list||(this.role_list=[]),-1==this.role_list.indexOf(e)&&(this.role_list[this.role_list.length]=e);var t={},i=a.role.getTbByRoleId(e);this.equip_role=e,t.roleId=i.roleId,t.equip=this.equip_role==e,t.isHave=!0,t.tb=i,this.rolemap[e]=t,this.refRoleMap(),be.openTopTipPanel(Ln.FuseComposePanel,{info:t}),this.selectRole(e,!0),this.save(),this.invalidate()}refRoleMap(){for(var e in this.rolemap){var t=this.rolemap[e];t.equip=t.roleId==this.equip_role}}selectRole(e,t=!1){this.equip_role=e,this.refRoleMap(),t||this.save(),cafe.event.dispatch(Z.EQUIP_ROLE,e),this.invalidate()}save(){this.role_die_count;var e={equip_role:this.equip_role,role_list:this.role_list,role_die_count:this.role_die_count};i.saveJson(Mn.NAME,e)}read(){return i.readJson(Mn.NAME)}}Mn.NAME="ROLE_DATA";class Sn extends cafe.data.BaseData{constructor(){super(Sn.NAME);this.init()}init(){this.equipmap={};var e=this.read();e||(e={equip_npc:0,npc_list:[],equip_npc_list:[]}),this.selectNpc(e&&e.equip_npc?e.equip_npc:0,!0),this.equip_list=e&&e.npc_list?e.npc_list:[],this.equip_npc_list=e&&e.equip_npc_list?e.equip_npc_list:[];for(var t=a.equip.tb(),i=0;i<t.length;i++){var s=t[i],n={},o=this.equip_list.indexOf(s.equipId);n.equipId=s.equipId,n.isequip=this.equipID==this.equipID,n.isHave=-1!=o,n.tb=s,this.equipmap[s.equipId]=n}this.save()}getEquipList(){var e=[];for(var t in this.equipmap){var i=this.equipmap[t];e[e.length]=i}return e}getEquipListIndex(){var e=[];for(var t in this.equipmap){var i=this.equipmap[t];i.equipId,this.equipID,e[e.length]=i}}isNpc(e){return!!this.equipmap[e]}isHasEquip(e){return-1!=this.equip_list.indexOf(e)}haveEquip(e,t=!0){this.equip_list||(this.equip_list=[]),-1==this.equip_list.indexOf(e)&&(this.equip_list[this.equip_list.length]=e);var i={},s=a.equip.getTbByEquipId(e);this.equipID=e,i.equipId=s.equipId,i.isequip=this.equipID==e,i.isHave=!0,i.tb=s,this.equipmap[e]=i,this.refnpcmap(),t&&this.selectNpc(e,!0),this.save(),this.invalidate()}refnpcmap(){for(var e in this.equipmap){var t=this.equipmap[e];t.isequip=t.equipId==this.equipID}}selectNpc(e,t=!1){this.equipID=e,this.refnpcmap(),t||this.save(),cafe.event.dispatch(Z.EQUIP_NPC,e),this.invalidate()}GetnpcEquipAttack(){for(var e=Ve.shop.npc_equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.npc_equip_weapon[i]).attack;return t}GetnpcEquipSpeed(){for(var e=Ve.shop.npc_equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.npc_equip_weapon[i]).speed;return t}GetnpcEquipHp(){for(var e=Ve.shop.npc_equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.npc_equip_weapon[i]).hp;return t}GetEquipAttack(){for(var e=Ve.shop.equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.equip_weapon[i]).attack;return t}GetEquipSpeed(){for(var e=Ve.shop.equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.equip_weapon[i]).speed;return t}GetEquipHp(){for(var e=Ve.shop.equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.equip_weapon[i]).hp;return t}GetEquipDefense(){for(var e=Ve.shop.equip_weapon.length,t=0,i=0;i<e;i++)t+=a.equip.getTbByEquipId(Ve.shop.equip_weapon[i]).defense;return t}save(){var e={equip_npc:this.equipID,npc_list:this.equip_list,equip_npc_list:this.equip_npc_list};i.saveJson(Sn.NAME,e)}read(){return i.readJson(Sn.NAME)}}Sn.NAME="Equip_DATA",function(e){e["躲猫猫"]="躲猫猫",e["跑酷"]="跑酷"}(Oe||(Oe={}));class Pn extends cafe.data.BaseData{constructor(){super(Pn.NAME),this.shopPetsLlist=[],this.shopTuoWeiLlist=[],this.GameShopType=Oe.跑酷;this.shopmap={},this.init()}init(){var e=this.read();e||(e={shopmap:{},equip_weapon:[],npc_equip_weapon:[],equip_car:0,equip_type:[],npc_equip_type:[],equip_tuowei:0}),e&&(this.equip_tuowei=e.equip_tuowei),this.equip_weapon=[],this.npc_equip_weapon=[],this.equip_car=e.equip_car,this.equip_type=[],this.npc_equip_type=[],this.maps={};for(var t=a.shop.tb(),i=0;i<t.length;i++){var s=t[i],n={};n.shopId=s.shopId,n.type=s.shopType,1==n.type||11==n.type||8==n.type?-1!=this.equip_weapon.indexOf(s.shopId)?n.equip=!0:n.equip=!1:2==n.type&&(n.equip=this.equip_car==s.shopId),3!=n.type&&7!=n.type||(n.equip=!1),n.tb=s,n.count=e.shopmap&&e.shopmap[s.shopId]?e.shopmap[s.shopId]:0,n.have=n.count>0,n.isShow=1==s.shopShow,this.maps[n.shopId]=n}this.shopmap=e&&e.shopmap?e.shopmap:{}}get ShopPanel(){return this.GameShopType==Oe.躲猫猫?we.ShopPanel2:we.ShopPanel}seleTuoWei(e){this.equip_tuowei=e,this.useEquip(e,12),this.save()}getcurTuoWei(){return this.equip_tuowei}getShopList(e){var t=[];for(var i in this.maps){var s=this.maps[i];e(s)&&(t[t.length]=s)}return t}getHaveCarLength(){var e=0;for(var t in this.maps){var i=this.maps[t];2==i.type&&i.have&&e++}return e}getShopListByType(e){var t=[];for(var i in this.maps){var s=this.maps[i];s.type==e&&(3!=s.type&&7!=s.type||("1"==s.tb.price&&(this.maps[i].have=!0),s.tb.targetId==Ve.role.getCurrRole().roleId&&(this.maps[i].equip=!0)),t[t.length]=s)}return t.sort((e,t)=>e.type<t.type?-1:e.type>t.type?1:e.shopId<t.shopId?-1:e.shopId>t.shopId?1:0),t}getShopTypeList(){var e=[];for(var t in this.maps){var i=this.maps[t];e[e.length]=i}return e.sort((e,t)=>e.type<t.type?-1:e.type>t.type?1:e.shopId<t.shopId?-1:e.shopId>t.shopId?1:0),e}useRoleShop(e){for(var t in this.maps){var i=this.maps[t];3!=i.type&&7!=i.type||(i.tb.targetId==e?this.maps[t].equip=!0:this.maps[t].equip=!1)}}buyShop(e,t){var i=this.maps[e];Ve.user.isCheck(i.tb.price)?(Tn.inst.sound.play(Ie.id.金币),Ve.user.removeMoney(i.tb.price),this.shopmap[e]||(this.shopmap[e]=0),this.shopmap[e]++,this.maps[e].count++,this.maps[e].have=!0,this.save(),this.invalidate(Pn.SHOP_ID_REF+"_"+e),t&&t.run()):be.openpanel(we.GoldPanel)}noMoneyBuyShop(e){this.maps[e];this.shopmap[e]||(this.shopmap[e]=0),this.shopmap[e]++,this.maps[e].count++,this.maps[e].have=!0,this.save(),this.invalidate(Pn.SHOP_ID_REF+"_"+e)}getOneShop(e){this.shopmap[e]||(this.shopmap[e]=0),this.shopmap[e]++,this.maps[e].count++,this.maps[e].have=!0,this.save(),this.invalidate(Pn.SHOP_ID_REF+"_"+e)}getShop(e){return this.maps[e]}useShop(e,t){this.equip_weapon,this.equip_car&&(this.maps[this.equip_car].equip=!1,this.invalidate(Pn.SHOP_ID_REF+"_"+this.equip_car),this.equip_car=0,e||(this.equip_car=e,cafe.event.dispatch(se.GAME_CAR_EQUIP,e)));var i=this.maps[e];i&&(1==t||2==t&&e!=this.equip_car&&(i.equip=!0,this.equip_car=e,cafe.event.dispatch(se.GAME_CAR_EQUIP,e))),this.save(),e&&this.invalidate(Pn.SHOP_ID_REF+"_"+e)}useEquip(e,t){if(10!=t&&12!=t){if(this.equip_weapon){var i=a.shop.getTbByShopId(e);-1==this.equip_type.indexOf(i.addValue)?(this.equip_type.push(i.addValue),this.equip_weapon.push(e)):this.equip_weapon[this.equip_type.indexOf(i.addValue)]==e?(this.equip_weapon.splice(this.equip_type.indexOf(i.addValue),1),this.equip_type.splice(this.equip_type.indexOf(i.addValue),1)):this.equip_weapon[this.equip_type.indexOf(i.addValue)]=e;var s=Ve.shop.getShopListByType(9);for(r=0;r<s.length;r++)this.maps[s[r].shopId].equip=!1,this.invalidate(Pn.SHOP_ID_REF+"_"+s[r].shopId);var n=Ve.shop.getShopListByType(5);for(r=0;r<n.length;r++)this.maps[n[r].shopId].equip=!1,this.invalidate(Pn.SHOP_ID_REF+"_"+n[r].shopId);for(r=0;r<this.equip_weapon.length;r++)this.maps[this.equip_weapon[r]].equip=!0,this.invalidate(Pn.SHOP_ID_REF+"_"+this.equip_weapon[r]);e||cafe.event.dispatch(se.GAME_WEAPON_EQUIP,e)}this.equip_car&&(this.maps[this.equip_car].equip=!1,this.invalidate(Pn.SHOP_ID_REF+"_"+this.equip_car),this.equip_car=0,e||(this.equip_car=e,cafe.event.dispatch(se.GAME_CAR_EQUIP,e)));for(this.maps[e],r=0;r<s.length;r++)this.invalidate(Pn.SHOP_ID_REF+"_"+s[r].shopId);for(r=0;r<n.length;r++)this.invalidate(Pn.SHOP_ID_REF+"_"+n[r].shopId);this.save()}else{for(var o=Ve.shop.getShopListByType(t),r=0;r<o.length;r++)this.maps[o[r].shopId].equip=!1,o[r].tb.targetId==e&&(this.maps[o[r].shopId].equip=!0),this.invalidate(Pn.SHOP_ID_REF+"_"+o[r].shopId);this.save()}}npcEquip(e,t){if(this.npc_equip_weapon){var i=a.shop.getTbByShopId(e);-1==this.npc_equip_type.indexOf(i.addValue)?(this.npc_equip_type.push(i.addValue),this.npc_equip_weapon.push(e)):this.npc_equip_weapon[this.npc_equip_type.indexOf(i.addValue)]==e?(this.npc_equip_weapon.splice(this.npc_equip_type.indexOf(i.addValue),1),this.npc_equip_type.splice(this.npc_equip_type.indexOf(i.addValue),1)):this.npc_equip_weapon[this.npc_equip_type.indexOf(i.addValue)]=e;for(var s=Ve.shop.getShopListByType(10),n=0;n<s.length;n++)this.maps[s[n].shopId].equip=!1,this.invalidate(Pn.SHOP_ID_REF+"_"+s[n].shopId);for(n=0;n<this.npc_equip_weapon.length;n++)this.maps[this.npc_equip_weapon[n]].equip=!0,this.invalidate(Pn.SHOP_ID_REF+"_"+this.npc_equip_weapon[n])}for(n=0;n<s.length;n++)this.invalidate(Pn.SHOP_ID_REF+"_"+s[n].shopId);this.save()}save(){var e={shopmap:this.shopmap,equip_weapon:this.equip_weapon,npc_equip_weapon:this.npc_equip_weapon,equip_car:this.equip_car,equip_type:this.equip_type,npc_equip_type:this.npc_equip_type,equip_tuowei:this.equip_tuowei};i.saveJson(Pn.NAME,e)}read(){return i.readJson(Pn.NAME)}}Pn.NAME="SHOP_DATA",Pn.SHOP_ID_REF="SHOP_ID_REF";class Rn{constructor(){this.isdispose=!1,this.map={}}addCom(e,t,i){var s=new i(t);return s.taskType=e,this.map[e]=s,s}getCom(e){return this.map[e]}removeCom(e){delete this.map[e.taskType]}dispose(){for(var e in this.map)this.removeCom(this.map[e]);this.isdispose=!0}}class Dn{static encode(e){var t,i,s,a,n,o,r,l="",h=0;for(e=Dn._utf8_encode(e);h<e.length;)a=(t=e.charCodeAt(h++))>>2,n=(3&t)<<4|(i=e.charCodeAt(h++))>>4,o=(15&i)<<2|(s=e.charCodeAt(h++))>>6,r=63&s,isNaN(i)?o=r=64:isNaN(s)&&(r=64),l=l+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return l}static decode(e){var t,i,s,a,n,o,r="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(a=this._keyStr.indexOf(e.charAt(l++)))>>4,i=(15&a)<<4|(n=this._keyStr.indexOf(e.charAt(l++)))>>2,s=(3&n)<<6|(o=this._keyStr.indexOf(e.charAt(l++))),r+=String.fromCharCode(t),64!=n&&(r+=String.fromCharCode(i)),64!=o&&(r+=String.fromCharCode(s));return r=Dn._utf8_decode(r)}static _utf8_encode(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}static _utf8_decode(e){for(var t,i,s="",a=0,n=t=0;a<e.length;)(n=e.charCodeAt(a))<128?(s+=String.fromCharCode(n),a++):n>191&&n<224?(t=e.charCodeAt(a+1),s+=String.fromCharCode((31&n)<<6|63&t),a+=2):(t=e.charCodeAt(a+1),i=e.charCodeAt(a+2),s+=String.fromCharCode((15&n)<<12|(63&t)<<6|63&i),a+=3);return s}}Dn._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";class Nn extends he{constructor(e){super(e)}initCurrentTask(e){}initNoCurrentTask(e){}ref(e){}accept(e,t){}finish(e,t){}createInfo(e){return null}taskFinish(e,t){switch(ea.scene.GamePause=!1,ea.scene.isOpenTask=!1,e.tb.taskType){case jt.ACCEPT_TASK:case jt.ACCEPTLEVEL_TASK:case jt.NOPANEL_ACCEPT_TASK:case jt.ARRIVE_DESTINATION:case jt.HAVE_A_BATH:case jt.ACCEPT_ENTRUST:case jt.ARRIVE_DESTINATION2:break;case jt.NOPANEL_ARRIVE:1!=e.tb.taskIndex&&Ue.show("存档点已激活"),e.tb.taskrewardHG>0&&Ve.game.setRoleHaoGanByNPCID(e.tb.taskTargetNpcId,e.tb.taskrewardHG)}138001==e.tb.taskId&&cafe.event.dispatch(se.ISFOLLOW,41812023),this.TaskCamAction(e.tb.taskId),10023==e.tb.taskId&&mi.device.rideTargetDevice(),132005!=e.tb.taskId&&138004!=e.tb.taskId&&101003!=e.tb.taskId&&48004!=e.tb.taskId||mi.device.unDevice(),92001==e.tb.taskId&&ea.car.localride(70061);var i=oi.singleton.mptData.fetchTaskTrigger(e);Ve.map.mptData.clearTaskTigger(i),Ve.task.finish(e.taskId),Ve.task.invalidate(),t.run()}TaskCamAction(e){var t=this,i=2,s=new Laya.Vector3(0,1,0),a=new Laya.Vector3(0,-3,4),n=0,o=0,r=!1;53001==e||131001==e||155001==e||158001==e||161101==e||119001==e||129001==e||1701==e||138001==e||166001==e||168001==e||135001==e||48001==e||170001==e?(r=!0,o=6):13101==e||152001==e||153001==e||154001==e||105001==e||151001==e||86001==e||101001==e||159001==e||160001==e||2001==e||165001==e||117001==e||171001==e?(r=!0,s=new Laya.Vector3(0,-2,0),a=new Laya.Vector3(0,-4,-4),n=180,o=-6):130001==e||134001==e||55001==e||2601==e?(r=!0,s=new Laya.Vector3(0,1,0),a=new Laya.Vector3(4,-3,0),n=90):123101==e||104001==e||122001==e||132001==e||136001==e||164001==e||3301==e||156001==e?(r=!0,s=new Laya.Vector3(0,0,0),a=new Laya.Vector3(-4,-4,0),n=270):162001==e?(r=!0,i=5,s=new Laya.Vector3(0,0,0),a=new Laya.Vector3(0,50,0),n=180):163001==e?(r=!0,i=3,s=new Laya.Vector3(0,0,0),a=new Laya.Vector3(0,0,-35),n=180):167001==e&&(r=!0,i=4,s=new Laya.Vector3(-4,-4,0),a=new Laya.Vector3(17,12,0),n=270),r&&(cafe.event.dispatch(se.NPCPOS,40812100),Es.startLoadCam7(n,0,s,a,i,initHandler(t,()=>{null!=Ve.game.npcPos?(a=new Laya.Vector3(Ve.game.npcPos.x,Ve.game.npcPos.y-4,Ve.game.npcPos.z+o),Es.startLoadCam9(n,0,a,a,0,initHandler(t,()=>{Ve.game.npcPos=null,5==Ve.map.map.gamePkType?Es.SplitCamAni(initHandler(t,()=>{ea.scene.ui.showDaojishi2()})):ea.scene.ui.showDaojishi2()}))):5==Ve.map.map.gamePkType?Es.SplitCamAni(initHandler(t,()=>{ea.scene.ui.showDaojishi2()})):167001==e?Es.startLoadCam7(n,0,a,s,i,initHandler(t,()=>{ea.scene.ui.showDaojishi2()})):ea.scene.ui.showDaojishi2()})))}isTaskCondition(e){switch(e.tb.taskType){case jt.ACCEPT_TASK:case jt.ACCEPTLEVEL_TASK:case jt.ARRIVE_DESTINATION:return Ve.map.mptData.verifyTaskMarker(e);case jt.SWITCH_MAP:return Ve.map.mapId==Number(e.tb.taskTargetId);case jt.KILL_MONSTER_NOPANEL:case jt.KILL_MONSTER_SHOWBOSS:case jt.KILL_BOSS:case jt.KILL_MONSTER:case jt.Destroy_Build:case jt.Destroy_Device:case jt.Ride_Funning_Num:return e.count>=e.tb.taskCount;case jt.GO_HOME:return 2==Math.floor(Ve.map.mapId/1e3);case jt.UPGRADE_HOME:case jt.TAKE_TRANSPORTATION:return mi.device.currentMountGear&&mi.device.currentMountGear.tbId==Number(e.tb.taskTargetId);case jt.HAVE_A_BATH:return Ve.bath.gold>=e.tb.taskCount;case jt.ACCEPT_ENTRUST:var t=Ve.map.mptData.getRenders(le.type_npc,Number(e.tb.taskTargetId))[0];if(!t)return!1;var i=ta.getPos(t.mode?t.mode:t.m.tr),s=ea.scene.player.owner.transform.localPosition.clone();return getDistance({x:s.x,y:s.z},{x:i.x,y:i.z})<=5;case jt.ARRIVE_DESTINATION2:return Ve.map.mptData.check3TaskPoint(e);case jt.HAVE_MONEY:return Ve.user.gold-Ve.game.hadgold>=e.tb.taskCount&&ea.scene.ui.img_jindou.visible;case jt.NOPANEL_ACCEPT_TASK:return Ve.map.mptData.verifyTaskMarker(e);case jt.UNLOCK_NEW_ROLE:return Ve.role.role_list.length-1>=e.tb.taskCount;case jt.USE_SKILL:case jt.LOOK_VIDEO:return e.count>=e.tb.taskCount;case jt.GET_CAR:return Ve.shop.getHaveCarLength()>=e.tb.taskCount;case jt.UP_FURNITURE:case jt.ROLE_DIE:return Ve.role.role_die_count>e.tb.taskCount;case jt.NOPANEL_ARRIVE:return Ve.map.mptData.verifyTaskMarker(e);case jt.UNLOCK_NEW_EQUIP:return Ve.shop.equip_weapon.length-1>=e.tb.taskCount;case jt.FINDSOMETHING:case jt.GET_BALLNUM:return e.count>=e.tb.taskCount;case jt.UNLOCK_NEW_NPC:return Ve.npc.npc_list.length>=e.tb.taskCount}}TaskCondition(e,t){Ve.map.mptData.mptModel[J.TASK].taskTiggerList.filter(t=>t.info==e)[0];switch(e.tb.taskType){case jt.ACCEPTLEVEL_TASK:Et.openpanel(vt.TaskAcceptLevelPanel,vt.PANEL_TOP_TIPS,{info:e,handler:t});break;case jt.ACCEPT_TASK:Et.openpanel(vt.TaskAcceptPanel,vt.PANEL_TOP_TIPS,{info:e,handler:t});break;case jt.NOPANEL_ARRIVE:case jt.KILL_MONSTER_NOPANEL:t.run();break;case jt.KILL_MONSTER_SHOWBOSS:Et.openpanel(vt.BossTipsPanel,vt.PANEL_TOP_TIPS,{task:e,handler:t});break;case jt.KILL_BOSS:Ve.level.isHard?Et.openpanel(vt.EndUpPanel,vt.PANEL_TOP_TIPS,{task:e,handler:t}):Et.openpanel(vt.GetWinRewardPanel,vt.PANEL_TOP_TIPS,{task:e,handler:t});break;case jt.ARRIVE_DESTINATION:case jt.SWITCH_MAP:case jt.KILL_MONSTER:case jt.Destroy_Build:case jt.Destroy_Device:case jt.Ride_Funning_Num:case jt.GO_HOME:case jt.UPGRADE_HOME:case jt.TAKE_TRANSPORTATION:case jt.HAVE_A_BATH:case jt.ACCEPT_ENTRUST:case jt.ARRIVE_DESTINATION2:case jt.HAVE_MONEY:0==e.type?Et.openpanel(vt.TaskFinishPanel,vt.PANEL_DEFAULT,{task:e,handler:t}):Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t});break;case jt.UNLOCK_NEW_ROLE:case jt.USE_SKILL:case jt.LOOK_VIDEO:case jt.GET_CAR:case jt.UP_FURNITURE:case jt.ROLE_DIE:case jt.UNLOCK_NEW_EQUIP:case jt.FINDSOMETHING:case jt.GET_BALLNUM:case jt.UNLOCK_NEW_NPC:case jt.NOPANEL_ACCEPT_TASK:0==e.type?Et.openpanel(vt.TaskFinishPanel,vt.PANEL_DEFAULT,{task:e,handler:t}):5==e.type?Ve.level.isHard?Et.openpanel(vt.EndUpPanel,vt.PANEL_TOP_TIPS,{task:e,handler:t}):Et.openpanel(vt.GetWinRewardPanel,vt.PANEL_TOP_TIPS,{task:e,handler:t}):132007==e.tb.taskId||130006==e.tb.taskId||131005==e.tb.taskId||154004==e.tb.taskId||104006==e.tb.taskId||105006==e.tb.taskId||158006==e.tb.taskId||129006==e.tb.taskId||1704==e.tb.taskId||162009==e.tb.taskId||163005==e.tb.taskId||166002==e.tb.taskId||3308==e.tb.taskId||48014==e.tb.taskId||135006==e.tb.taskId||117006==e.tb.taskId||170002==e.tb.taskId?(Es.startLoadCam8(0,20,new Laya.Vector3(0,-3,0),new Laya.Vector3(0,-5,2),4),setTimeout(()=>{Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})},5e3)):127007==e.tb.taskId||138006==e.tb.taskId||152004==e.tb.taskId||155005==e.tb.taskId||151005==e.tb.taskId||122008==e.tb.taskId||101006==e.tb.taskId||160005==e.tb.taskId||119005==e.tb.taskId||164006==e.tb.taskId||168002==e.tb.taskId?(Es.startLoadCam8(90,20,new Laya.Vector3(0,-3,0),new Laya.Vector3(2,-5,0),4),setTimeout(()=>{Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})},5e3)):129009==e.tb.taskId||136009==e.tb.taskId||153005==e.tb.taskId||2005==e.tb.taskId?(Es.startLoadCam8(180,20,new Laya.Vector3(0,-2,0),new Laya.Vector3(0,-4,-2),4),setTimeout(()=>{Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})},5e3)):134007==e.tb.taskId||2404==e.tb.taskId||156006==e.tb.taskId||86022==e.tb.taskId||167005==e.tb.taskId?(Es.startLoadCam8(270,20,new Laya.Vector3(2,-2,0),new Laya.Vector3(-2,-4,0),4),setTimeout(()=>{Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})},5e3)):2606==e.tb.taskId||3412==e.tb.taskId?(Es.startLoadCam8(-60,20,new Laya.Vector3(0,-2,1),new Laya.Vector3(-2,-4,1),4),setTimeout(()=>{Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})},5e3)):Et.openpanel(vt.EndWinPanel,vt.PANEL_DEFAULT,{task:e,handler:t})}}}class jn extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskGroup]=t,console.log("AcceptLevelTask==>initCurrentTask",e)}createInfo(e){var t=a.task.getTbByTaskId(e),i={};return i.taskId=t.taskId,i.tb=t,i.count=0,i.type=t.type,i.state=0,i}initNoCurrentTask(e){if(!this.owner.taskmap[e.taskGroup]){var t,i=a.task.getTbByTaskId(e.taskId);if(10==i.taskGroup)(t=this.owner.finishtask_list.filter(e=>20!=Math.floor(e[0]/100))[0])&&(i=a.task.getTbByTaskId(t[0]));else(t=this.owner.finishtask_list.filter(e=>Math.floor(e[0]/100)==i.taskGroup)[0])&&(i=a.task.getTbByTaskId(t[0]));var s={};s.taskId=i.taskId,s.tb=i,s.count=0,s.type=e.type,s.state=t?2:0,this.owner.taskmap[i.taskGroup]=s}}ref(e){}accept(e,t){if(e.taskGroup==t.tb.taskGroup){e=a.task.getTbByTaskId(t.tb.nextTask);if(t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,10==e.taskGroup){if(this.owner.task_list.filter(e=>20!=Math.floor(e/100))[0]){var i=this.owner.task_list.indexOf(e.taskId);this.owner.task_list.splice(i,1)}}else if(this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0]){i=this.owner.task_list.indexOf(e.taskId);this.owner.task_list.splice(i,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}finish(e,t){if(e.taskGroup==t.tb.taskGroup)if(0==t.tb.nextTask){t.state=2;var i=this.owner.finishtask_list.filter(e=>e[0]==t.tb.taskId)[0];if(i?(i[2]++,i[3]=(new Date).valueOf()):this.owner.finishtask_list[this.owner.finishtask_list.length]=[t.tb.taskId,t.tb.type,1,(new Date).valueOf()],n=this.owner.task_list.filter(e=>Math.floor(e/100)==t.tb.taskGroup)[0]){var s=this.owner.task_list.indexOf(n);this.owner.task_list.splice(s,1)}}else{var n;e=a.task.getTbByTaskId(t.tb.nextTask);if(t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,10==e.taskGroup){if(n=this.owner.task_list.filter(e=>20!=Math.floor(e/100))[0]){s=this.owner.task_list.indexOf(e.taskId);this.owner.task_list.splice(s,1)}}else if(n=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0]){s=this.owner.task_list.indexOf(e.taskId);this.owner.task_list.splice(s,1)}console.log("AcceptLevelTask==>finish",e),this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}}class Gn extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskId]=t}createInfo(e){var t=a.task.getTbByTaskId(e),i={};return i.taskId=t.taskId,i.tb=t,i.count=0,i.type=t.type,i.state=0,i}initNoCurrentTask(e){if(null==this.owner.task_list.filter(t=>t==e.taskId)[0]){var t=this.owner.finishtask_list.filter(t=>t[0]==e.taskId)[0],i={};i.taskId=e.taskId,i.tb=e,i.count=0,i.type=e.type,i.state=t?2:0,this.owner.taskmap[e.taskId]=i}}ref(e){}accept(e,t){t||(t={}),t.taskId=e.taskId,t.tb=e,t.count=0,t.type=e.type,t.state=1,this.owner.taskmap[e.taskId]=t,Ve.map.mptData.createTiggerTask(t)}finish(e,t){e.taskId==t.tb.taskId&&(t.state=2,delete this.owner.taskmap[t.taskId],0!=t.tb.nextTask&&this.owner.accept(t.tb.nextTask))}}class Bn extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskGroup]=t}initNoCurrentTask(e){if(!this.owner.taskmap[e.taskGroup]){var t=a.task.getTbByTaskId(100*e.taskGroup+1),i=this.owner.finishtask_list.filter(e=>Math.floor(e[0]/100)==t.taskGroup)[0];i&&(t=a.task.getTbByTaskId(i[0]));var s={};s.taskId=t.taskId,s.tb=t,s.count=0,s.type=e.type,s.state=i?2:0,this.owner.taskmap[t.taskGroup]=s}}ref(e){}accept(e,t){if(e.taskGroup==t.tb.taskGroup){e=a.task.getTbByTaskId(t.tb.nextTask);t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1;var i=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0];if(i){var s=this.owner.task_list.indexOf(i);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}finish(e,t){if(e.taskGroup==t.tb.taskGroup)if(0==t.tb.nextTask){t.state=2;var i=this.owner.finishtask_list.filter(e=>e[0]==t.tb.taskId)[0];if(i?(i[2]++,i[3]=(new Date).valueOf()):this.owner.finishtask_list[this.owner.finishtask_list.length]=[t.tb.taskId,t.tb.type,1,(new Date).valueOf()],n=this.owner.task_list.filter(e=>Math.floor(e/100)==t.tb.taskGroup)[0]){var s=this.owner.task_list.indexOf(n);this.owner.task_list.splice(s,1)}}else{var n;e=a.task.getTbByTaskId(t.tb.nextTask);if(t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,n=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0]){s=this.owner.task_list.indexOf(n);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}}class Hn extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskId]=t}initNoCurrentTask(e){if(!this.owner.taskmap[e.taskGroup]){var t=a.task.getTbByTaskId(100*e.taskGroup+1),i=this.owner.finishtask_list.filter(e=>Math.floor(e[0]/100)==t.taskGroup)[0];i&&(t=a.task.getTbByTaskId(i[0]));var s={};s.taskId=t.taskId,s.tb=t,s.count=0,s.type=e.type,i&&ls.isCurrDayTime(i[3])?s.state=2:s.state=0,this.owner.taskmap[t.taskGroup]=s}}ref(e){}accept(e,t){if(e.taskGroup==t.tb.taskGroup){e=a.task.getTbByTaskId(t.tb.nextTask);t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1;var i=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0];if(i){var s=this.owner.task_list.indexOf(i);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}finish(e,t){if(e.taskId==t.tb.taskId){t.state=2;var i=this.owner.finishtask_list.filter(e=>e[0]==t.tb.taskId)[0];i?(i[2]++,i[3]=(new Date).valueOf()):this.owner.finishtask_list[this.owner.finishtask_list.length]=[t.tb.taskId,t.tb.type,1,(new Date).valueOf()];var s=this.owner.task_list.filter(e=>e==t.tb.taskId)[0];if(s){var a=this.owner.task_list.indexOf(s);this.owner.task_list.splice(a,1)}}}}class On extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskGroup]=t}initNoCurrentTask(e){if(!this.owner.taskmap[e.taskGroup]){var t=a.task.getTbByTaskId(100*e.taskGroup+1),i=this.owner.finishtask_list.filter(e=>Math.floor(e[0]/100)==t.taskGroup)[0];i&&(t=a.task.getTbByTaskId(i[0]));var s={};s.taskId=t.taskId,s.tb=t,s.count=0,s.type=e.type,s.state=i?2:0,this.owner.taskmap[t.taskGroup]=s}}ref(e){}accept(e,t){if(e.taskGroup==t.tb.taskGroup){e=a.task.getTbByTaskId(t.tb.nextTask);t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1;var i=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0];if(i){var s=this.owner.task_list.indexOf(i);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}finish(e,t){if(e.taskGroup==t.tb.taskGroup)if(0==t.tb.nextTask){t.state=2;var i=this.owner.finishtask_list.filter(e=>e[0]==t.tb.taskId)[0];if(i?(i[2]++,i[3]=(new Date).valueOf()):this.owner.finishtask_list[this.owner.finishtask_list.length]=[t.tb.taskId,t.tb.type,1,(new Date).valueOf()],n=this.owner.task_list.filter(e=>Math.floor(e/100)==t.tb.taskGroup)[0]){var s=this.owner.task_list.indexOf(n);this.owner.task_list.splice(s,1)}}else{var n;e=a.task.getTbByTaskId(t.tb.nextTask);if(t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,n=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0]){s=this.owner.task_list.indexOf(n);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}}class zn extends Nn{initCurrentTask(e){var t={};t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1,t.type=e.type,this.owner.taskmap[e.taskId]=t}initNoCurrentTask(e){if(null==this.owner.task_list.filter(t=>t==e.taskId)[0]){var t=this.owner.finishtask_list.filter(t=>t[0]==e.taskId)[0],i={};i.taskId=e.taskId,i.tb=e,i.count=0,i.type=e.type,t?i.state=2:(i.state=1,this.owner.task_list[this.owner.task_list.length]=e.taskId),this.owner.taskmap[e.taskId]=i}}ref(e){}accept(e,t){if(e.taskGroup==t.tb.taskGroup){e=a.task.getTbByTaskId(t.tb.nextTask);t.taskId=e.taskId,t.tb=e,t.count=0,t.state=1;var i=this.owner.task_list.filter(t=>Math.floor(t/100)==e.taskGroup)[0];if(i){var s=this.owner.task_list.indexOf(i);this.owner.task_list.splice(s,1)}this.owner.task_list[this.owner.task_list.length]=e.taskId,Ve.map.mptData.createTiggerTask(t)}}finish(e,t){if(e.taskId==t.tb.taskId){t.state=2;var i=this.owner.finishtask_list.filter(e=>e[0]==t.tb.taskId)[0];i?(i[2]++,i[3]=(new Date).valueOf()):this.owner.finishtask_list[this.owner.finishtask_list.length]=[t.tb.taskId,t.tb.type,1,(new Date).valueOf()];var s=this.owner.task_list.filter(e=>e==t.tb.taskId)[0];if(s){var a=this.owner.task_list.indexOf(s);this.owner.task_list.splice(a,1)}}}}class Vn{}Vn.SUCCESS_TASK=0,Vn.MAIN_TASK=1,Vn.BRANCH_TASK=2,Vn.EVERYDAY_TASK=3,Vn.ACCEPTORDER_TASK=4,Vn.ACCEPTLEVEL_TASK=5;class Fn extends cafe.data.BaseData{constructor(){super(Fn.NAME),this.num=100;this.logic=new Rn,this.init()}init(){this.logic.addCom(Vn.SUCCESS_TASK,this,zn),this.logic.addCom(Vn.MAIN_TASK,this,On),this.logic.addCom(Vn.BRANCH_TASK,this,Bn),this.logic.addCom(Vn.EVERYDAY_TASK,this,Hn),this.logic.addCom(Vn.ACCEPTORDER_TASK,this,Gn),this.logic.addCom(Vn.ACCEPTLEVEL_TASK,this,jn),this.taskmap={};var e=this.read();e||(e={finishtask_list:[],task_list:[]}),this.task_list=e&&e.task_list?e.task_list:[],this.finishtask_list=e&&e.finishtask_list?e.finishtask_list:[],this.initCurrTask(),this.initNoCurrTask(),this.save(),this.invalidate()}initCurrTask(){for(var e=0;e<this.task_list.length;e++){var t=this.task_list[e],i=a.task.getTbByTaskId(t);this.logic.getCom(i.type).initCurrentTask(i)}}initCurrLevelTask(e){for(var t=0;t<this.task_list.length;t++){var i=this.task_list[t];if(a.task.getTbByTaskId(i).type==Vn.ACCEPTLEVEL_TASK){this.task_list[t]=e;var s=a.task.getTbByTaskId(e);this.logic.getCom(s.type).initCurrentTask(s)}}this.save()}Clear(){this.initCurrTask()}initNoCurrTask(){for(var e=a.task.tb(),t=0;t<e.length;t++){var i=e[t];this.logic.getCom(i.type).initNoCurrentTask(i)}}showOrder(e){}accept(e){var t=a.task.getTbByTaskId(e),i=this.taskmap[t.taskId];this.logic.getCom(t.type).accept(t,i),this.save(),this.invalidate()}getMainLineTask(){return Ve.task.getTaskList().filter(e=>1==e.state&&1==e.type)[0]}isTaskCondition(e){return this.logic.getCom(e.tb.type).isTaskCondition(e)}taskFinish(e,t){this.logic.getCom(e.tb.type).taskFinish(e,t)}getTaskCondition(e){var t=this;for(var i in t.taskmap){var s=t.taskmap[i];if(2!=s.state&&t.isTaskCondition(s)){if(s.tb.taskTargetNpcHG&&s.tb.taskTargetNpcId)if(Ve.game.curroleHaoGan=s.tb.taskTargetNpcId-14037,Ve.game.getRoleHaoGan()<s.tb.taskTargetNpcHG){this.num++,this.num>100&&(Ue.show("NPC好感度不足，无法接取任务"),this.num=0);continue}if(2==t.task_list.length&&-1==t.task_list.indexOf(s.taskId)){this.num++,this.num>100&&(Ue.show("最多接取两个支线任务"),this.num=0);continue}return void mi.task.onRunTaskPlot(s,{runHandler:initHandler(t,e=>{t.TaskCondition(s,e)}),endHandler:initHandler(t,()=>{t.taskFinish(s,e),this.num=30})})}}e.run()}TaskCondition(e,t){this.logic.getCom(e.type).TaskCondition(e,t)}isTaskTarget(e){for(var t=this.getTaskList(),i=0;i<t.length;i++)for(var s=t[i].tb.taskTargetId.split("|"),n=0;n<s.length;n++){var o=a.thing.getTbByThingId(Number(s[n]));if(o&&e==o.thingId)return!0}return!1}isCurrTask(e){return-1!=this.task_list.indexOf(e)}getTaskLength(){var e=0;for(var t in this.taskmap){1==this.taskmap[t].state&&e++}return e}finish(e){var t=a.task.getTbByTaskId(e);if(!(t.taskGroup>=1610&&t.taskGroup<=1615)&&1650!=t.taskGroup&&1710!=t.taskGroup){for(var i in this.taskmap){var s=this.taskmap[i];this.logic.getCom(t.type).finish(t,s)}cafe.event.dispatch(ge.task.TASK_FINISH,{taskId:e}),this.save(),this.invalidate()}}getTaskList(){var e=[];for(var t in this.taskmap){var i=this.taskmap[t];2!=i.state&&(e[e.length]=i)}return e.sort((e,t)=>2==e.type&&2!=t.type?-1:2!=e.type&&2==t.type?1:4==e.type&&4!=t.type?-1:4!=e.type&&4==t.type?1:1==e.type&&1!=t.type?-1:1!=e.type&&1==t.type?1:0),e}getTaskListByStateAndTargetId(e,t){var i=[];for(var s in this.taskmap){var a=this.taskmap[s];2!=a.state&&a.tb.taskType==e&&a.tb.taskTargetId==t.toString()&&(i[i.length]=a)}return i.sort((e,t)=>2==e.type&&2!=t.type?-1:2!=e.type&&2==t.type?1:4==e.type&&4!=t.type?-1:4!=e.type&&4==t.type?1:1==e.type&&1!=t.type?-1:1!=e.type&&1==t.type?1:0),i}getTask2List(){var e=[];for(var t in this.taskmap){var i=this.taskmap[t];0==i.type&&(e[e.length]=i)}return e}gmlog(){GMs.push("task",this.taskmap),GMs.log("task")}gmendtask(){var e=this,t=e.getTaskList()[0];mi.task.onRunTaskPlot(t,{runHandler:initHandler(e,i=>{e.TaskCondition(t,i)}),endHandler:initHandler(e,()=>{e.taskFinish(t,initHandler(e,()=>{}))})})}save(){this.finishtask_list,this.task_list}read(){return i.readJson(Fn.NAME)}}Fn.NAME="TASK_DATA";class Un extends Ee.res.modules.common.MoneyTipsViewUI{constructor(e,t){super();if(e<10)this.img_icon.skin="res/icon/money/"+Ve.user.moneyMap[e].tb.moneyIcon+".png",t&&(this.text=t);else if(e>=41){var i=t.split(":"),s=a.goods.fetchGoodsTb(Number(i[0])),n=i.length>1?Number(i[1]):1;this.img_icon.skin="res/icon/goods/"+s.icon+".png",this.text=n.toString()}}static show(e,t){_e.getLayer(10).addChild(new Un(e,t))}set text(e){this.txt_content.text=e,this.box_view.width=this.box_content.width+40,this.box_view.height=this.box_content.height+20}get text(){return this.txt_content.text}onEnable(){var e=this;super.onEnable(),e.scaleX=fe.minScale,e.scaleY=fe.minScale,e.centerY=-70,e.alpha=0,Laya.Tween.to(e,{centerY:-70,alpha:1},300,null,initHandler(e,()=>{Laya.Tween.to(e,{},1e3,null,initHandler(e,()=>{Laya.Tween.to(e,{centerY:-80,alpha:0},300,null,initHandler(e,()=>{Laya.Tween.clearTween(e),e.removeSelf()}))}))}))}onDisable(){super.onDisable()}}class qn extends cafe.data.BaseData{constructor(){super(qn.NAME),this.hf_action=5,this.gq_action=5,this.sp_addaction=5,this.hf_action_time=420,this.actionId=1,this.goldId=2,this.ybId=3,this.dhjId=4}init(){this.moneyMap={};var e=this.read(),t=e?e.gold:null;if(!e){e={moneys:[],upCount:3,pre_action_time:0};for(var i=a.money.tb(),s=0;s<i.length;s++){var n=i[s];(o={}).moneyId=n.moneyId,o.count=n.moneyInitCount,e.moneys.push(o)}}if(null!=t){if(!e.moneys){e.moneys=[];for(i=a.money.tb(),s=0;s<i.length;s++){var o;n=i[s];(o={}).moneyId=n.moneyId,o.count=n.moneyInitCount,e.moneys.push(o)}}(r=e.moneys.filter(e=>e.moneyId==Ke.GOLD)[0])&&(r.count=t)}this.moneys=e.moneys;for(s=0;s<this.moneys.length;s++){var r=this.moneys[s];n=a.money.getTbByMoneyId(r.moneyId);this.moneyMap[r.moneyId]={count:r.count,tb:n}}this.upCount=e&&null!=e.upCount?e.upCount:3,this.pre_action_time=e&&null!=e.pre_action_time?e.pre_action_time:0}get gold(){return this.moneyMap[Ke.GOLD].count}get action(){return this.moneyMap[Ke.ACTION].count}get dhj(){return this.moneyMap[Ke.DHJ].count}get yb(){return this.moneyMap[Ke.YB].count}get goldtb(){return this.moneyMap[Ke.GOLD].tb}get actiontb(){return this.moneyMap[Ke.ACTION].tb}get ybtb(){return this.moneyMap[Ke.YB].tb}get dhjtb(){return this.moneyMap[Ke.DHJ].tb}get max_action(){return this.moneyMap[Ke.ACTION].tb.moneyTotal}login(e){i.save("user",e),ze.logininit()}setGold(e){this.moneyMap[this.goldId].count=Math.round(e),this.invalidate(qn.RESOURCE_RES),this.save()}isMaxAction(){var e=this.moneyMap[this.actionId];return e.count>=e.tb.moneyTotal}getActionTime(){var e=Math.floor((new Date).valueOf()/1e3);return 0!=this.pre_action_time?this.pre_action_time-e:0}refActionTime(){var e=Math.floor((new Date).valueOf()/1e3),t=this.moneyMap[this.actionId];if(0!=this.pre_action_time){var i=e-this.pre_action_time;if(i>=this.hf_action_time){var s=Math.floor(i/this.hf_action_time);return e-=i%this.hf_action_time,void this.setAction(t.count+this.hf_action*s)}}t.tb.moneyTotal<=t.count?(this.pre_action_time=0,cafe.event.dispatch(se.GAME_ACTION_CD_TIME_STOP)):t.count<t.tb.moneyTotal&&(0==this.pre_action_time||e>=this.pre_action_time)&&(this.pre_action_time=e+this.hf_action_time),this.invalidate(qn.RESOURCE_RES),this.save()}setAction(e){var t=this.moneyMap[this.actionId];t.count,t.count=Math.round(e),t.count>=t.tb.moneyTotal&&(t.count=t.tb.moneyTotal);var i=Math.floor((new Date).valueOf()/1e3);t.count>=t.tb.moneyTotal?(this.pre_action_time=0,cafe.event.dispatch(se.GAME_ACTION_CD_TIME_STOP),t.count=t.tb.moneyTotal):t.count<t.tb.moneyTotal&&(0==this.pre_action_time||i>=this.pre_action_time)&&(this.pre_action_time=i+this.hf_action_time),this.invalidate(qn.RESOURCE_RES),this.save()}setDHJ(e){this.moneyMap[this.dhjId].count=e,this.invalidate(qn.RESOURCE_RES),this.save()}setYB(e){this.moneyMap[this.ybId].count=e,this.invalidate(qn.RESOURCE_RES),this.save()}setMoney(e,t){switch(e){case 1:this.setAction(t);break;case 2:this.setGold(t);break;case 3:this.setYB(t);break;case 4:this.setDHJ(t)}}isUseAction(e){return this.action>=e}isGold(e){return this.gold>=e}isYB(e){return this.yb>=e}isDHJ(e){return this.dhj>=e}isCheck(e){var t="string"==typeof e?ea.money.strToInfo(e):e;switch(t.type){case 1:return this.isUseAction(t.count);case 2:return this.isGold(t.count);case 3:return this.isYB(t.count);case 4:return this.isDHJ(t.count)}return!1}getNoMoneyTips(e){switch(("string"==typeof e?ea.money.strToInfo(e):e).type){case 1:return"体力不足";case 2:return"金币不足";case 3:return"元宝不足";case 4:return"兑换劵不足";case 41:return"道具不足"}}addAction(e,t,i,s){Je.create(e,this.moneyMap[Ke.ACTION].tb,t,i,s)}addGold(e,t,i,s){Je.create(e,this.moneyMap[Ke.GOLD].tb,t,i,s)}addYB(e,t,i,s){Je.create(e,this.moneyMap[Ke.YB].tb,t,i,s)}addDHJ(e,t,i,s){Je.create(e,this.moneyMap[Ke.DHJ].tb,t,i,s)}addMoney(e,t,i,s){var a="string"==typeof e?ea.money.strToInfo(e):e;Je.create(a.count,this.moneyMap[a.type].tb,t,i,s)}addUpCount(){this.upCount+=1,this.invalidate(qn.RESOURCE_RES),this.save()}removeAction(e){this.setAction(this.moneyMap[this.actionId].count-e),Un.show(this.actionId,"-"+e),Tn.inst.sound.play(Ie.id.金币)}removeGold(e){this.setGold(this.moneyMap[this.goldId].count-e),Un.show(this.goldId,"-"+e),Tn.inst.sound.play(Ie.id.金币)}removeYB(e){this.setYB(this.moneyMap[this.ybId].count-e),Un.show(this.ybId,"-"+e),Tn.inst.sound.play(Ie.id.金币)}removeDHJ(e){this.setDHJ(this.moneyMap[this.dhjId].count-e),Un.show(this.dhjId,"-"+e),Tn.inst.sound.play(Ie.id.金币)}removeMoney(e){var t="string"==typeof e?ea.money.strToInfo(e):e;this.setMoney(t.type,this.moneyMap[t.type].count-t.count),Tn.inst.sound.play(Ie.id.金币)}save(){for(var e=0;e<this.moneys.length;e++){var t=this.moneys[e],s=this.moneyMap[t.moneyId];t.count=s.count}var a={moneys:this.moneys,upCount:this.upCount,pre_action_time:this.pre_action_time};i.saveJson(qn.NAME,a)}read(){return i.readJson(qn.NAME)}}qn.NAME="USER_DATA",qn.SELECT_BALL="SELECT_BALL",qn.RESOURCE_RES="RESOURCE_RES";class Yn extends cafe.data.BaseData{constructor(){super(Yn.NAME),this.isUpLevel=!1;this.finishTaskFunc,this.init()}init(){var e=this.read();this.curBlood=e&&e.curBlood?e.curBlood:0,this.curBloodExp=e&&e.curBloodExp?e.curBloodExp:0,this.level=e&&e.level?e.level:1,this.levelTb=a.roleLevel.getTbByLevel(this.level)}upLevel(){var e;(this.level++,this.levelTb=a.roleLevel.getTbByLevel(this.level),this.levelTb?Lt.reportLevelRefresh(this.level):(this.level--,this.levelTb=a.roleLevel.getTbByLevel(this.level)),ea.scene.player.action.isInstall(Ei.MoveAction))?(e=Ve.role.getOneMinLevelRole())&&(this.isUpLevel=!0):(e=Ve.role.getOneMinLevelRole())&&(Ve.role.haveRole(e.roleId),this.isUpLevel=!1);this.save()}onRefreshState(){if(this.isUpLevel){var e=Ve.role.getOneMinLevelRole();e&&(Ve.role.haveRole(e.roleId),this.isUpLevel=!1)}if(this.finishTaskFunc){var t=this.finishTaskFunc;this.finishTaskFunc=null,t()}}SpawnHealth(e){var t=this;slog("COREDATA.SpawnHealth===>",e),t.curBlood+=e,t.curBlood>=t.levelTb.maxblood?(mi.core.stopBlood(),t.curBlood-=t.levelTb.maxblood,mi.core.bloodflash(t.levelTb.maxblood,100,initHandler(t,()=>{cafe.event.dispatch(se.GAME_ATT_FORCE_STOP),mi.core.bloodflash(t.curBlood,500),t.SpawnHealthExp()}))):(mi.core.bloodflash(t.curBlood),t.save())}SpawnHealthExp(){var e=this,t=e.levelTb.oneBloodExp;e.curBloodExp+=t,e.curBloodExp>=e.levelTb.maxBloodExp?(e.curBloodExp-=e.levelTb.maxBloodExp,mi.core.bloodExpflash(e.levelTb.maxBloodExp,500,initHandler(e,()=>{mi.core.bloodExpflash(e.curBloodExp,50)})),e.upLevel()):(mi.core.bloodExpflash(e.curBloodExp,500),e.save())}save(){var e={curBlood:this.curBlood,curBloodExp:this.curBloodExp,level:this.level};i.saveJson(Yn.NAME,e)}read(){return i.readJson(Yn.NAME)}}Yn.NAME="CORE_DATA";class Wn{constructor(){this.map=new Map}add(e,t){this.map.has(e)||this.map.set(e,[]),this.map.get(e).push(t)}get(e){return this.map.get(e)||[]}remove(e,t){if(this.map.has(e)){const i=this.map.get(e),s=i.indexOf(t);if(s>=0)return i.splice(s,1),0===i.length&&this.map.delete(e),!0}return!1}hasKey(e){return this.map.has(e)}clear(){this.map.clear()}forEach(e){this.map.forEach((t,i)=>{e(i,t)})}}class Xn extends cafe.data.BaseData{constructor(){super(Xn.NAME),this.carmove_camera=!0,this.isFinish=!1,this.musicData=0,this.fuhuoTime=0,this.ponponchan=null,this.RiseTime=5,this.monsterStop=!0,this.npcPos=null,this.equipNpc=null,this.ZaiHaiScoure=0,this.isZaiHai=!1,this.MonsterLevel=0,this.isRidePonpon=!1,this.ZuoqiState=1,this.isRideZuoqi=!1,this.isSaiChe=!1,this.isPaoKu=!1,this.isfirest=!0,this.isUnLockQiMa=!1,this.isUnLockCar=!1,this.selectDoor=null,this.isBaoQi=!1,this.wawaHeight=!1,this.wawaJump=!1,this.FuhuoPoiList={},this.curFuhuoPoi=null,this.isjiansu=!1,this.isjiasu=!1,this.isbig=!1,this.issmall=!1,this.playerHp=0,this.doors=[],this.isOpenDoor=!1,this.isCannon=!1,this.GuangquanOwner=[],this.allSuoQuanBuildThing=new Wn,this.allSuoQuanNpcThing=new Wn,this.allSuoQuanMonsterThing=new Wn,this.suoQuanId=0,this.attNum=0,this.banyunowner=null,this.juzheowner=null,this.isTaskProgress=!1,this.isPauseGame=!1,this.isUp=!1,this.isStartGame=!0,this.ChuShiPos=new Laya.Vector3(0,0,0),this.isPisa=!1,this.isYinliao=!1,this.haveKey=0,this.getKey=0,this.isshibietiao=!1,this.isTrampoline=!1,this.TrampolineAniSwitch=!1,this.DontDelCar=!1,this.npcHaoGanDu=[],this.shopWeaponLlist=[],this.showFYbuff=!1,this.showFYnum=0,this.FengYinLevel=0,this.DuoMaoMaoModel={},this.DuoMaoMaoNpc={},this.DuoMaoMaoId=[],this.npcNum=0,this.GuideModel=null,this.TipsNpc=null,this.MaoMaoGameType=0,this.curSaveNpc=null,this.initTime=0,this.roleRoadPoi=[],this.addSpeedBuff=!1,this.MonsterStop=!1,this.gravitySop=!1,this.isShowMap=!1,this.zhuanpanNum=1,this.curTimeToTal=0,this.startX=0,this.locklv=[],this.fraction=0,this.firstSelectMap=[3,1,5],this.savetppoi=null,this.thisshop=0,this.getrole=0,this.currole=0,this.changeridelock=!1,this.yanjiangwin=!1,this.diedelay=!1,this.npcTalk=["看我飘逸的走位","他看起来有点憨","不要一直追我就行","你会不会玩","不会看见我了吧","肯定找不到我","我藏好了","这个位置够隐秘","大笨蛋快来追我呀","嘻嘻，差点被发现了","坚持一下，时间不多了"],this.BaoxiangTingWeight=[45,45,10],this._roleid=10100;cafe.event.on(Z.EQUIP_ROLE,this.onEquipRole,this),this.init()}SpliceAllLockMap(){Ve.game.locklv=[],Ve.game.saveLevelData()}saveLevelData(){i.saveJson("lv",this.locklv)}getLevelData(){var e=i.readJson("lv");e&&(this.locklv=e)}setPlayerFuHuo(){var e;if(!(e=this.curFuhuoPoi?this.FuhuoPoiList[this.curFuhuoPoi]:this.FuhuoPoiList[0])){var t=ea.scene.player.owner.transform.position.clone();ea.scene.player.owner.transform.position=new Laya.Vector3(t.x,t.y+.5,t.z)}ea.scene.player.owner.transform.localPositionY=e[3];var i=e[1];ta.MainRoleRay(new Laya.Vector3(e[0],e[1]+20,e[2]),new Laya.Vector3(e[0],e[1]-5,e[2]),e=>{i<e.point.y&&(ea.scene.hitResultNode=e.collider.owner.main),i=Math.max(i,e.point.y)},()=>{ea.scene.player.landY=i,ea.scene.player.owner.transform.position=new Laya.Vector3(e[0],ea.scene.player.landY,e[2])})}DependBaoxiang(){this.BaoxiangHandler=null;var e=Math.random(),t=[];for(let e=0;e<this.BaoxiangTingWeight.length;e++)t.push(this.BaoxiangTingWeight[e]);var i=t[0]+t[1]+t[2],s=[];for(let e=0;e<t.length;e++)s.push(t[e]/i);if(e<s[0])this.BaoxiangIcon=null,this.BaoxiangHandler=initHandler(this,()=>{var e=Xe.getBody(ea.scene.player.owner,"30023");e&&(e.active=!0);var t=Xe.getBody(ea.scene.player.owner,"30022");t&&(t.active=!1),Ve.game.isjiansu=!1,Ve.game.isjiasu=!0,Ue.show("移速提高"),Tn.inst.sound.play(15045),Ve.game.issmall||Ve.game.isbig||ea.scene.ui.DaojuJinDu(10),Laya.timer.once(1e4,Tt.thisobj,()=>{Ve.game.isjiasu=!1;var e=Xe.getBody(ea.scene.player.owner,"30023");e&&(e.active=!1)})});else if(e<s[0]+s[1]&&e>=s[0]){var a=(n=Ve.shop.getShopListByType(5))[Math.floor(n.length*e)].shopId;this.BaoxiangIcon=n[Math.floor(n.length*e)].tb,this.BaoxiangHandler=initHandler(this,()=>{Ve.game.showeffect(),Ue.show("恭喜获得装扮"),Tn.inst.sound.play(15043),Ve.shop.useEquip(a,0),ea.weapon.equipWeapon(Ve.shop.equip_weapon)})}else if(e>=s[0]+s[1]){var n,o=(n=Ve.shop.getShopListByType(3))[Math.floor(n.length*e)].tb;this.BaoxiangIcon=o,this.BaoxiangHandler=initHandler(this,()=>{Ue.show("恭喜获得角色"),Ve.shop.noMoneyBuyShop(o.shopId),Ve.shop.useRoleShop(o.targetId),Ve.role.equip_role=o.targetId,cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF)})}return this.BaoxiangHandler}showeffect(){var e=Xe.getBody(ea.scene.player.owner,"80002");e?(e.active=!1,e.active=!0):Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_80002_lh],ea.scene.player.owner,1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0)}))}DuoMaoMaoInt(){var e=this,t=i.read("firest"),s=Ve.map.mptData.mptModel[J.ROLE].things,a=0,n=initHandler(e,i=>{t||2!=Ve.map.map.pointType&&(i[1]=1);var a=0;for(let o=0;o<s.length;o++){var n=s[o].getComponent(fs);n?(n&&(n.maomaoModel=e.DuoMaoMaoModel[e.DuoMaoMaoId[i[o-a]]].owner,n.maomaoModel.using=!0),t||1!=i[o-a]||1!=Ve.game.MaoMaoGameType||(e.GuideModel=n.maomaoModel,ri.showModel())):a++}});for(let t=0;t<=s.length-1;t++){s[t].getComponent(fs)&&a++,t==s.length-1&&(e.npcNum=a,e.RandomNumber(0,e.DuoMaoMaoId.length-1,a,n))}}maomaoLVint(){this.DuoMaoMaoId=[],this.DuoMaoMaoModel={},this.DuoMaoMaoNpc={},this.isfirest=!0,this.monsterStop=!0,this.initTime=0,ea.scene.ui&&ea.scene.ui.cancelNpcqp()}RandomNumber(e,t,s,a){var n=[],o=i.read("firest");for(let i=0;i<1e3;i++){var r=Math.floor(Math.random()*(t-e+1))+e;if(-1==n.indexOf(r)&&((o||1!=Ve.map.map.pointType||1!=r)&&(n.push(r),n.length==s)))return a&&a.method(n),n}}pkLvInt(){Ve.game.attNum=0,Ve.shop.save(),Ve.game.savetppoi=null,Ve.task.taskmap={},Ve.task.task_list=[],Ve.task.initCurrTask(),Ve.task.initNoCurrTask(),Ve.game.doors=[],Ve.game.GuangquanOwner=[],ea.scene.npcGamePause=!0,Ve.game.juzheowner=null,Ve.game.banyunowner=null,Ve.game.gravitySop=!1,this.getKey=0,this.wawaJump=!1,this.wawaHeight=!1,this.RiseTime=5,this.RisePoi=null,this.RiseModel=null,this.isshibietiao=!1,this.isbig=!1,this.issmall=!1,this.isjiansu=!1,this.isjiasu=!1,this.FengYinLevel=0,this.showFYbuff=!1,this.showFYnum=0,Laya.timer.clearAll(ea.scene.ui),Laya.timer.clearAll(Tt.thisobj),mi.device&&mi.device.unDevice(),cafe.event.dispatch(se.NOFOLLOW),ea.scene.ui&&ea.scene.ui.CancelDevide(),ea.scene.cameraCode&&(ea.scene.cameraCode.iszhendong=!1)}getRoleHaoGan(){var e=i.readJson("npcHaoGanDu");return e&&(this.npcHaoGanDu=e),this.npcHaoGanDu.length<1||null==this.npcHaoGanDu[this.curroleHaoGan]?0:this.npcHaoGanDu[this.curroleHaoGan]}setRoleHaoGan(e){if(this.npcHaoGanDu[this.curroleHaoGan]||(this.npcHaoGanDu[this.curroleHaoGan]=0),this.npcHaoGanDu[this.curroleHaoGan]<100){var t=this.npcHaoGanDu[this.curroleHaoGan]+e;t>100&&(t=100),this.npcHaoGanDu[this.curroleHaoGan]=t;var s=Xe.getBody(this.curNpc,"xinqing");Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30009_lh],s,1,null,initHandler(this,t=>{t.transform.localPosition=new Laya.Vector3(0,0,0),Ue.show("好感度增加"+e.toString()),setTimeout(()=>{t.removeSelf(),t.destroy()},1e3)}))}i.saveJson("npcHaoGanDu",this.npcHaoGanDu)}setRoleHaoGanByNPCID(e,t){e-=14037;if(this.npcHaoGanDu[e]||(this.npcHaoGanDu[e]=0),this.npcHaoGanDu[e]<100){var s=this.npcHaoGanDu[e]+t;s>100&&(s=100),this.npcHaoGanDu[e]=s;var a=Xe.getBody(this.curNpc,"xinqing");Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_30009_lh],a,1,null,initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),Ue.show("好感度增加"+t.toString()),setTimeout(()=>{e.removeSelf(),e.destroy()},1e3)}))}i.saveJson("npcHaoGanDu",this.npcHaoGanDu)}checkCurRoleHaoGan(e){return this.getRoleHaoGan()>=e||(Ue.show("好感度需要达到"+e),!1)}get mission_id(){return 0!=this.testMission?this.testMission:this._mission_id}set mission_id(e){this._mission_id=e,this.mission=a.mission.fetchMissionTb(e)}nextMission(e=!1){e?(Ve.level.over_level(),Ve.level.unlock_level()):Ve.level.skip_level(),Ve.level.invalidate()}setTestMission(e){this.testMission=e,Laya.LocalStorage.setItem(i.game_tag+"_"+i.game_id+"_mission",String(e))}getTestMission(){return Number(Laya.LocalStorage.getItem(i.game_tag+"_"+i.game_id+"_mission"))}init(){var e=this.read();this.fristTest=(e&&e.fristTest,1),this.testlist=e&&e.testlist?e.testlist:[],this.testMission=Number(this.getTestMission()),this._mission_id=Ve.level.select_id,this.mission=a.mission.fetchMissionTb(this._mission_id),window.setTestMission=this.setTestMission,this.initLevel()}initLevel(){var e=i.readJson("lv");if(e)this.locklv=e;else{var t=a.map.getTbByDefaultlock(1);for(let e=0;e<t.length;e++)-1==this.locklv.indexOf(t[e].mapId)&&this.locklv.push(t[e].mapId)}this.saveLevelData()}getCharm(){var e=Laya.LocalStorage.getItem("charm");return this.charmValue=e?Number(e):0,this.charmValue+this.getequipCharm()}setCharm(e){this.charmValue+=e,Ue.show("魅力值+"+e),this.changeCharm(),Laya.LocalStorage.setItem("charm",this.charmValue.toString())}changeCharm(){}getequipCharm(){var e=0;if(Ve.shop.equip_weapon.length>0)for(let t=0;t<Ve.shop.equip_weapon.length;t++)e+=a.equip.getTbByEquipId(Ve.shop.equip_weapon[t]).charm;return e}onEquipRole(e){this.roleid=e}set roleid(e){this._roleid=e,this.role=a.role.getTbByRoleId(e)}get roleid(){return this._roleid}save(){var e={fristTest:this.fristTest,testlist:this.testlist};i.saveJson(Xn.NAME,e)}read(){return i.readJson(Xn.NAME)}readMapFile(e){return Laya.LocalStorage.getJSON(e)}}Xn.NAME="GAME_DATA";class Kn extends cafe.data.BaseData{constructor(){super(Kn.NAME),this.currAddGold=10;this.init()}init(){var e=this.read();e||(e={gold:0}),this.gold=e.gold}addGold(){var e=this;Ve.user.addGold(e.currAddGold,ea.scene.moneypos,null,()=>{e.gold+=e.currAddGold}),e.save()}save(){var e={gold:this.gold};i.saveJson(Kn.NAME,e)}read(){return i.readJson(Kn.NAME)}}Kn.NAME="BATH_DATA";class Jn extends cafe.data.BaseData{constructor(){super(Jn.NAME),this.carLibIndex=0;this.init()}init(){}initmap(){this.carLibIndex=0}haveCar(e){return Ve.shop.getShopListByType(2).filter(t=>t.shopId==e&&t.have)[0]}getCar(e){return Ve.shop.getShopListByType(2).filter(t=>t.shopId==e)[0]}getLastCar(){for(var e=Ve.shop.getShopListByType(2),t=[],i=0;i<e.length;i++){var s=e[i];s.have&&t.push(s)}var a=this.carLibIndex;return this.carLibIndex++,t[t.length-1-a]}save(){}read(){return i.readJson(Jn.NAME)}}Jn.NAME="CARLIB_DATA";class Zn extends cafe.data.BaseData{constructor(){super(Zn.NAME);this.init()}init(){this.devicemap={};var e=this.read();e||(e={equip_device:10100,device_list:[10100],device_die_count:0}),this.device_die_count=e&&e.device_die_count?e.device_die_count:0,this.equip_device=e&&e.equip_device?e.equip_device:10100,this.selectDevice(e&&e.equip_device?e.equip_device:0,!0),this.device_list=e&&e.device_list?e.device_list:[];for(var t=a.device.tb(),i=0;i<t.length;i++){var s=t[i],n={},o=this.device_list.indexOf(s.deviceId);n.deviceId=s.deviceId,n.equip=this.equip_device==s.deviceId,n.isHave=-1!=o,n.tb=s,this.devicemap[s.deviceId]=n}cafe.event.dispatch(Z.EQUIP_DEVICE,this.equip_device),this.save()}getInfoByDeviceId(e){return this.devicemap[e]}getCurrDevice(){return this.devicemap[this.equip_device]}getListByDeviceId(e){for(var t=[],i=a.device.tb(),s=0;s<i.length;s++){var n=a.device.getTbByDeviceId(i[s].deviceId);t.push(this.devicemap[n.deviceId])}return t}getDeviceList(){var e=[];for(var t in this.devicemap){var i=this.devicemap[t];e[e.length]=i}return e}getDeviceListIndex(){var e=[];for(var t in this.devicemap){var i=this.devicemap[t];e[e.length]=i}}getOneDeviceList(){var e=[];for(var t in this.devicemap){var i=this.devicemap[t];e[e.length]=i}return e}getOneMinLevelRole(){var e=null;for(var t in this.devicemap){var i=this.devicemap[t];e||i.isHave?e&&e.deviceId>=i.deviceId&&(e=i):e=i}return e}unDevice(){this.equip_device=null,cafe.event.dispatch(Z.EQUIP_DEVICE,this.equip_device)}isDevice(e){return!!this.devicemap[e]}isHasDevice(e){return-1!=this.device_list.indexOf(e)}haveDevice(e,t=!0){this.device_list||(this.device_list=[]),-1==this.device_list.indexOf(e)&&(this.device_list[this.device_list.length]=e);var i={},s=a.device.getTbByDeviceId(e);this.equip_device=e,i.deviceId=s.deviceId,i.equip=this.equip_device==e,i.isHave=!0,i.tb=s,this.devicemap[e]=i,this.refDeviceMap(),t&&this.selectDevice(e,!0),this.save(),this.invalidate()}compose(e){this.device_list||(this.device_list=[]),-1==this.device_list.indexOf(e)&&(this.device_list[this.device_list.length]=e);var t={},i=a.device.getTbByDeviceId(e);this.equip_device=e,t.deviceId=i.deviceId,t.equip=this.equip_device==e,t.isHave=!0,t.tb=i,this.devicemap[e]=t,this.refDeviceMap(),be.openTopTipPanel(Ln.FuseComposePanel,{info:t}),this.selectDevice(e,!0),this.save(),this.invalidate()}refDeviceMap(){for(var e in this.devicemap){var t=this.devicemap[e];t.equip=t.deviceId==this.equip_device}}selectDevice(e,t=!1){this.equip_device=e,this.refDeviceMap(),t||this.save(),cafe.event.dispatch(Z.EQUIP_ROLE,e),this.invalidate()}save(){this.device_die_count;var e={equip_device:this.equip_device,device_list:this.device_list,device_die_count:this.device_die_count};i.saveJson(Zn.NAME,e)}read(){return i.readJson(Zn.NAME)}}Zn.NAME="DEVICE_DATA";class Qn extends cafe.data.BaseData{constructor(){super(Qn.NAME)}getComposeRole(e,t){return a.fuse.getTbByCondition(i=>i.zoonShopId==e&&i.carShopId==t).composeTargetId}compose(e,t){var i=this.getComposeRole(e,t);Ve.role.compose(i),this.invalidate()}}Qn.NAME="FUSE_DATA";class $n extends cafe.data.BaseData{constructor(){super($n.NAME);this.init()}init(){slog("初始化：HouseData");var e=this.read();e||(e={haveHouseIds:[]}),this.haveHouseIds=e.haveHouseIds?e.haveHouseIds:[]}getList(){var e=[];for(var t in this.houseDic){var i=this.houseDic[t];e.push(i)}return e}buyHouse(e,t=!0){var i=this.houseDic[e];return i.have=!0,-1==this.haveHouseIds.indexOf(i.houseId)&&this.haveHouseIds.push(i.houseId),t&&this.save(),this.invalidate($n.HOUSE_ID_REF+"_"+i.houseId),!0}haveHouse(e){var t=this.houseDic[e];return-1!=this.haveHouseIds.indexOf(t.houseId)}sellHouse(e,t=!0){var i=this.houseDic[e],s=this.haveHouseIds.indexOf(i.houseId);return-1!=s&&(this.haveHouseIds.splice(s,1),i.have=!1,t&&this.save(),this.invalidate($n.HOUSE_ID_REF+"_"+i.houseId),!0)}save(){var e={haveHouseIds:this.haveHouseIds};i.saveJson($n.NAME,e)}read(){return i.readJson($n.NAME)}}$n.NAME="HOUSE_DATA",$n.HOUSE_ID_REF="HOUSE_ID_REF";class eo extends cafe.data.BaseData{constructor(){super(eo.NAME),this.is_signin=!1,this.isOneOpen=!0;this.init()}init(){var e=this.read();this.signin_day=e&&e.curday?e.curday:0,this.signin_time=e&&e.sign_in_time?e.sign_in_time:0,this.is_signin=this.judge_time(this.signin_time,Math.floor((new Date).valueOf()/1e3)),this.signin_day>=7&&!this.is_signin&&(this.signin_day=0,this.signin_time=0),this.invalidate()}sync_signIn(e){var t=a.signin.getTbByDay(this.signin_day+1);if(0==e)for(var i=t.baseCount.split("|"),s=0;s<i.length;s++){var n=i[s].split("_");switch(Number(n[0])){case 2:var o=Number(n[1]);Ve.user.addGold(o,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)});break;case 3:var r=n[1].split(":");if(5==(h=a.shop.getTbByShopId(Number(r[0]))).shopType)Ve.game.thisshop=5,Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.maps[h.shopId].have&&Ve.shop.useEquip(h.shopId,h.shopType);else if(3==h.shopType){if((c=Ve.role.rolemap[h.targetId]).isHave){Ue.show("已拥有角色,自动转化为等价金币");var l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.role.haveRole(c.roleId,!1),Ve.role.selectRole(c.roleId)}else if(2==h.shopType){if(Ve.carlib.getCar(h.shopId).have){l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.shop.noMoneyBuyShop(h.shopId),ea.car.localride(Ve.shop.equip_car)}else if(10==h.shopType)Ve.game.thisshop=10,Ve.shop.noMoneyBuyShop(h.shopId),Ve.npc.selectNpc(h.targetId);else if(12==h.shopType)Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.seleTuoWei(h.targetId);else if(Ve.shop.maps[h.shopId].have){l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.useEquip(h.shopId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon)}}else for(i=t.baseCount.split("|"),s=0;s<i.length;s++){n=i[s].split("_");switch(Number(n[0])){case 2:o=Number(n[1]);Ve.user.addGold(o*t.videoBs,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)});break;case 3:r=n[1].split(":");var h=a.shop.getTbByShopId(Number(r[0]));if(cafe.event.dispatch(se.updateEquipButton,h.shopType),5==h.shopType)Ve.game.thisshop=5,Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.maps[h.shopId].have&&Ve.shop.useEquip(h.shopId,h.shopType);else if(3==h.shopType){var c;if((c=Ve.role.getInfoByRoleId(h.targetId)).isHave){Ue.show("已拥有角色,自动转化为双倍等价金币");l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count*t.videoBs,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.role.haveRole(c.roleId,!1),Ve.role.selectRole(c.roleId),Ve.shop.noMoneyBuyShop(h.shopId)}else if(2==h.shopType){if(Ve.carlib.getCar(h.shopId).have){l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count*t.videoBs,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.shop.noMoneyBuyShop(h.shopId),ea.car.localride(Ve.shop.equip_car)}else if(10==h.shopType)Ve.game.thisshop=10,Ve.shop.noMoneyBuyShop(h.shopId),Ve.npc.selectNpc(h.targetId);else if(12==h.shopType)Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.seleTuoWei(h.targetId);else if(Ve.shop.maps[h.shopId].have){l=ea.money.strToInfo(h.price);Ve.user.addGold(l.count*t.videoBs,ea.scene.moneypos,null,()=>{be.closepanel(we.SignInPanel)})}else be.closepanel(we.SignInPanel),Ve.shop.noMoneyBuyShop(h.shopId),Ve.shop.useEquip(h.shopId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon)}}this.returnToLogin(this.signin_day+1)}returnToLogin(e){this.signin_day=e,this.signin_time=Math.floor((new Date).valueOf()/1e3),this.is_signin=!0,this.save(),this.invalidate(eo.STAGE_RES)}backToDefaultSignIn(){this.signin_day+=1,this.signin_time=Math.floor((new Date).valueOf()/1e3),this.is_signin=!0,this.save(),this.invalidate(eo.STAGE_RES)}judge_time(e,t){var i=new Date(1e3*e),s=new Date(1e3*t);return i.getFullYear()==s.getFullYear()&&i.getMonth()==s.getMonth()&&i.getDate()==s.getDate()}save(){var e={curday:this.signin_day,sign_in_time:this.signin_time};i.saveJson(eo.NAME,e)}read(){return i.readJson(eo.NAME)}}eo.NAME="SIGNIN_DATA",eo.STAGE_RES="STAGE_RES";class to extends cafe.data.BaseData{constructor(){super(to.NAME);this.init()}init(){this.skillmap={};var e=this.read();e||(e={skill_list:[]}),this.skill_list=e&&e.skill_list?e.skill_list:[];for(var t=a.skill.tb(),i=0;i<t.length;i++){var s=t[i],n={},o=this.skill_list.indexOf(s.skillId);n.skillId=s.skillId,n.isHave="0"==s.openCondition||-1!=o,n.tb=s,this.skillmap[s.skillId]=n}cafe.event.dispatch(ge.game.SKILL_DATA_INIT_FINISH),this.save()}getInfoBySkillId(e){return this.skillmap[e]}getSkillListByMods(e){this.currRoleSkillMod={};for(var t={infomap:{}},i=e.split("|"),s=0;s<i.length;s++){var n=Number(i[s]),o=a.skillMod.getTbBySkillModId(n),r={};r.skillModId=n,r.tb=o,r.skillmap={},0!=o.equipSkillPos1&&(r.skillmap[o.equipSkillPos1]=this.skillmap[o.equipSkillPos1]),0!=o.equipSkillPos2&&(r.skillmap[o.equipSkillPos2]=this.skillmap[o.equipSkillPos2]),0!=o.equipSkillPos3&&(r.skillmap[o.equipSkillPos3]=this.skillmap[o.equipSkillPos3]),0!=o.equipSkillPos4&&(r.skillmap[o.equipSkillPos4]=this.skillmap[o.equipSkillPos4]),0!=o.equipSkillPos5&&(r.skillmap[o.equipSkillPos5]=this.skillmap[o.equipSkillPos5]),0!=o.equipSkillPos6&&(r.skillmap[o.equipSkillPos6]=this.skillmap[o.equipSkillPos6]),t.infomap[o.skillModId]=r}return this.currRoleSkillMod=t,this.currRoleSkillMod}isSkill(e){return!!this.skillmap[e]}isHasSkill(e){return-1!=this.skill_list.indexOf(e)}haveSkill(e){this.skill_list||(this.skill_list=[]),-1==this.skill_list.indexOf(e)&&(this.skill_list[this.skill_list.length]=e);var t={},i=a.skill.getTbBySkillId(e);t.skillId=i.skillId,t.isHave=!0,t.tb=i,this.skillmap[e]=t,this.save(),this.invalidate()}save(){var e={skill_list:this.skill_list};i.saveJson(to.NAME,e)}read(){return i.readJson(to.NAME)}}to.NAME="SKILL_DATA",function(e){function logininit(){Ve.user.init(),Ve.path=cafe.data.reg(new An),Ve.goods=cafe.data.reg(new xn),Ve.guide=cafe.data.reg(new kn),Ve.level=cafe.data.reg(new En),Ve.npc=cafe.data.reg(new In),Ve.pack=cafe.data.reg(new Cn),Ve.role=cafe.data.reg(new Mn),Ve.setting=cafe.data.reg(new mt),Ve.equip=cafe.data.reg(new Sn),Ve.shop=cafe.data.reg(new Pn),Ve.task=cafe.data.reg(new Fn),Ve.core=cafe.data.reg(new Yn),Ve.game=cafe.data.reg(new Xn),Ve.bath=cafe.data.reg(new Kn),Ve.carlib=cafe.data.reg(new Jn),Ve.device=cafe.data.reg(new Zn),Ve.fuse=cafe.data.reg(new Qn),Ve.map=cafe.data.reg(new oi),Ve.house=cafe.data.reg(new $n),Ve.signin=cafe.data.reg(new eo),Ve.skill=cafe.data.reg(new to)}e.init=function(){Ve.user=cafe.data.reg(new qn),logininit()},e.logininit=logininit}(ze||(ze={})),Ve||(Ve={});class io{constructor(){this.video_num=0,this.platform="Weixin",this.m_lastBannerTime=new Date("1999-01-01"),this.m_lastShowVideoTime=new Date("1999-01-01")}static getInstance(){return null==io.m_inst&&(io.m_inst=new io),io.m_inst}onInitPF(){io.wechatSdkBridge.onInit(null)}IsPF(){return!1}displayOpeningPrompt(){io.wechatSdkBridge.onInit(null)}ShowBaoXiang(){setTimeout(()=>{console.log("宝箱======"+this.showTresBox()),0==io.getInstance().video_num&&1==this.showTresBox()?(io.getInstance().video_num+=1,Laya.loader.load("JY/QTEPanel.prefab",Laya.Handler.create(this,e=>{let t=e.create();Laya.stage.addChild(t)}))):this.showCustomAd()},1e3)}OnReward(){Ve.user.addGold(5e3,ea.scene.moneypos)}showTresBox(){switch(so.BoxGGType){case 0:return console.log("在特点时间内======================="),!1;case 1:return console.log("打开开关======================="),!0}}showCustomAd(){yt.getInstance().showCustomAd(5)}hideCustomAd(){}displayIncentivizedAd(e,t){io.wechatSdkBridge.showVideo(e,t)}}io.m_inst=null,io.wechatSdkBridge=new c,io.lastNativeAd_Func=null;var so={HKT_PKG:io.getInstance().HKT_PKG_str,Changle1:io.getInstance().VIVOH5_BX,Changle2:io.getInstance().VIVOH5_CP,Changle3:io.getInstance().OPPOH5_CP,BoxGGType:0,AdGGType:0,OPPO_AdGGType:0,ipAdressUrl:"",onLoad(){console.log("------------"),window.htn=this},dealTakeNum(){if(!this.HKT_PKG.startsWith("com."))return console.log("HTN还没填"),this.BoxGGType=0,this.AdGGType=1,void(this.OPPO_AdGGType=1);let e=this;if("vivo"==io.getInstance().platform){if(""==this.Changle2)this.AdGGType=1;else{let t=`${this.ipAdressUrl}/index/params?pkm=${this.HKT_PKG}&canshu=${this.Changle2}&url=new&yys=yd`;this.makeRequest(t,function(t){e.AdGGType=e.dealMessage(t),console.log("Ad",e.AdGGType)})}let t=`${this.ipAdressUrl}/index/params?pkm=${this.HKT_PKG}&canshu=${this.Changle1}&url=new&yys=yd`;this.makeRequest(t,function(t){e.BoxGGType=e.dealMessage(t),console.log("Box",e.BoxGGType)})}else if("oppo"==io.getInstance().platform){let t=`${this.ipAdressUrl}/index/params?pkm=${this.HKT_PKG}&canshu=${io.getInstance().OPPOH5_CP}&url=new&yys=yd`;this.makeRequest(t,function(t){e.OPPO_AdGGType=e.dealMessage(t),console.log("OPPOH5",e.OPPO_AdGGType)})}},makeRequest(e,t){let i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<400?t(i.responseText):console.error("Request failed: "+i.status))},i.open("GET",e,!0),i.send()},dealMessage(e){console.log(e);let t=e.indexOf("GG");if(-1!=t){return parseInt(e.substring(t+2,t+3))}return 0},isBoxOn(){return 1==this.BoxGGType},isAdOn(){return 1==this.AdGGType}};so.onLoad();class ao{}ao.loadding_img_width=1027,ao.smallloadding_img_width=300,ao.isstart=!0;class no extends Ee.localui.loaddingUI{constructor(){super(),this._value=.1,this.T=["场景中有可以帮助快速过关的怪兽，试着驾驭它吧！","点击加速按钮，无论是跑步，开车，还是飞行都能进行加速。","要多多要注意脚底和指示箭头。"],this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;if(e.txt_loading){var t=e.txt_loading.parent;e.txt_title=t.getChildAt(1)}ao.isstart||(e.img_mb.visible=!0),ao.isstart&&(ao.isstart=!1);var i=Math.floor(Math.random()*this.T.length);e.tipText.text=this.T[i],Tn.inst.loadDb.res("localdb/loaddingflash2/loaddingflash2",initHandler(e,t=>{e.stage?(e&&e.box_db2&&e.box_db2.addChild(t),t.play("loop",!0),t.x=0,t.y=-8,e._loaddingdb2=t):t.destroy()})),e.value=0}setTitle(e){this.txt_title.text=e?e+"资源加载中...":"加载中...",this.txt_loading.x=this.txt_title.x+this.txt_title.width}get value(){return this._value}set value(e){this._value=e,this.txt_loading&&(Math.floor(e)>1&&(e=.97),this.txt_loading.text=String(Math.floor(100*e))+"%",this.img_bar.width=Math.round(ao.loadding_img_width*e),this.box_db1.x=Math.round(ao.loadding_img_width*e),this.box_db2.x=Math.round(ao.loadding_img_width*e))}onDisable(){super.onDisable();this._loaddingdb1&&(this._loaddingdb1.removeSelf(),this._loaddingdb1.destroy(),this._loaddingdb1=null),this._loaddingdb2&&(this._loaddingdb2.removeSelf(),this._loaddingdb2.destroy(),this._loaddingdb2=null),1==Ve.game.isShowMap&&(Ve.game.isShowMap=!1)}}class oo extends Laya.Script{constructor(){super(),this.rzxx=null}onAwake(){this.rzxx=this.owner,window.appName="dsada",this.rzxx.text=""+io.getInstance().rzxx,console.log("window==="+window.appName),window.appName&&(this.rzxx.text="")}onEnable(){}onDisable(){}}class ro extends Ee.localui.smallloaddingUI{constructor(){super(),this._value=.1,this.addCom(this,fe)}onEnable(){super.onEnable();this.value=0}setTitle(e){this.txt_title.text=e?e+"资源加载中...":"加载中...",this.txt_loading.x=this.txt_title.x+this.txt_title.width}get value(){return this._value}set value(e){this._value=e,this.txt_loading&&(this.txt_loading.text=String(Math.floor(100*e))+"%",this.img_bar.width=Math.round(ao.smallloadding_img_width*e))}onDisable(){super.onDisable()}}class lo extends Ee.res.modules.common.GameStrengthViewUI{onEnable(){super.onEnable();this.addClick(this.btn_addGold),this.bin(qn.NAME,this.onUserDataChange,qn.RESOURCE_RES)}onUserDataChange(){this.txt_action.text=Ve.user.action.toString()+" / "+Ve.user.max_action.toString()}onClickHandler(e){switch(e.target){case this.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭),be.openTopTipPanel(we.AlertActionTipPanel)}}onDestroy(){super.onDestroy()}}class ho extends Ee.res.modules.common.MoneyBuyViewUI{onEnable(){super.onEnable()}initData(e){var t;"string"==typeof e&&ea.money.isMoneyPrice(e)?(t=ea.money.strToInfo(e),this.type=1):"string"==typeof e&&ea.goods.isGoodCount(e)?(t=ea.goods.strToInfo(e),this.type=2):(t=e,this.type=1),t&&0!=t.type?(this.visible=!0,this.info=t,1==this.type?Tn.inst.setImageIcon(this.img_icon,"res/icon/money/"+Ve.user.moneyMap[this.info.type].tb.moneyIcon+".png"):Tn.inst.setImageIcon(this.img_icon,"res/icon/goods/"+t.tb.icon+".png"),this.txt_count.text=t.count+(t.unit?t.unit:"")):this.visible=!1}isBuy(){if(1==this.type&&this.info&&0!=this.info.type&&!Ve.user.isCheck(this.info)){switch(this.info.type){case 2:ea.scene.GamePause=!0;var e=a.drop.getTbByDropId(10003);be.openTopTipPanel(we.DropBuffPanel,{info:e,isClick:!0,handler:initHandler(this,e=>{ea.scene.GamePause=!1})})}return!1}if(2==this.type&&this.info&&0!=this.info.type&&!Ve.goods.isCheckGoods(this.info.goodsId,this.info.count))return ea.scene.GamePause=!0,!1;if(1==this.type&&this.info)switch(this.info.type){case 2:Ve.user.removeGold(this.info.count)}else 2==this.type&&Ve.goods.removeGoods(this.info.goodsId,this.info.count);return!0}onDestroy(){super.onDestroy()}}class co extends Ee.res.modules.drop.DropAdiPanelUI{constructor(){super(),this.isClick=!1,this.isAniAction=!0,this.anitime=0,this.openprice=null,this.baodi=9;this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;ea.scene.GamePause=!0,Ve.game.haveKey>3&&(Ve.game.haveKey=3),Ve.game.haveKey<=0?e.VideoAction(!0):e.VideoAction(!1),e._param=Ve.game.DependBaoxiang(),e.addClick(e.btn_fuse),e.addClick(e.btn_jili),e.addClick(e.btn_home),e.addClick(e.btn_shuoming);e.lab_shuoming.text="宝箱奖励概率公示：\n-瞩目装备\n 初始概率：10 %\n 开启5次未获得后提升至40%\n 获得后本轮不再出现\n-金币：根据上述概率动态调整（90%~100%）\n",e.priceGroup=[e.btn_price1,e.btn_price2,e.btn_price3,e.btn_price4,e.btn_price5,e.btn_price6,e.btn_price7,e.btn_price8,e.btn_price9],Laya.timer.once(1e3,e,()=>{for(let t=0;t<e.priceGroup.length;t++)e.addClick(e.priceGroup[t])}),Ye.add(1,e,e.onframe),e.KeyAni(),e.zhumushop=e.zhumuShop(),Laya.timer.frameLoop(5,e.zhumuShop,()=>{e.zhumushop&&(e.img_zhumu.skin="res/icon/equip/"+e.zhumushop.shopIcon+".png",Laya.timer.clearAll(e.zhumuShop))}),e.keynumber.text="X"+Ve.game.haveKey.toString()}zhumuShop(){var e=Ve.shop.getShopListByType(5),t=[];for(let i=0;i<e.length;i++)e[i].have||t.push(e[i].tb);if(t.length>0)return t[cs.RandomInt(0,t.length-1)]||void this.zhumuShop();var i=e[cs.RandomInt(0,e.length-1)];return i?i.tb:void this.zhumuShop()}VideoAction(e){this.btn_price1.getChildAt(0).visible=e,this.btn_price2.getChildAt(0).visible=e,this.btn_price3.getChildAt(0).visible=e,this.btn_price4.getChildAt(0).visible=e,this.btn_price5.getChildAt(0).visible=e,this.btn_price6.getChildAt(0).visible=e,this.btn_price7.getChildAt(0).visible=e,this.btn_price8.getChildAt(0).visible=e,this.btn_price9.getChildAt(0).visible=e}onframe(){var e=this;e.key_ani1.visible||(e.img_light.rotation+=5,e.anitime<90?e.anitime++:(e.anitime=90)&&(e.anitime=0,e.PriceAni()),e.bg_ani1.centerY>-270&&(e.bg_ani1.centerY-=.5,e.bg_ani2.centerY+=.5,e.bg_ani1.alpha-=.005,e.bg_ani2.alpha-=.005,0!=e.bg_ani1.alpha?(e.key_ani1.visible=!1,e.key_ani2.visible=!1,e.key_ani3.visible=!1,e.isAniAction=!1):0==e.bg_ani1.alpha&&(e.isAniAction=!0,Laya.timer.once(2e3,e,()=>{e.btn_home.visible=!0}))),e.openprice&&e.openprice.alpha>0&&(e.isAniAction=!1,e.openprice.alpha-=.02,e.openprice.scaleX+=.002,e.openprice.scaleY+=.002,0==e.openprice.alpha&&(e.isAniAction=!0,e.openprice.visible=!1,e.openprice=null)))}KeyAni(){var e=this;if(Ve.game.haveKey>0)Laya.timer.frameLoop(1,e.KeyAni,()=>{var t=e.key_ani1.getChildAt(0);if(t.scaleX+=.02,t.scaleY+=.02,t.scaleX>=1)if(t.scaleX,t.scaleY,Laya.timer.clearAll(e.KeyAni),Ve.game.haveKey>1)Laya.timer.frameLoop(1,e.KeyAni,()=>{var t=e.key_ani2.getChildAt(0);if(t.scaleX+=.02,t.scaleY+=.02,t.scaleX>=1)if(t.scaleX,t.scaleY,Laya.timer.clearAll(e.KeyAni),Ve.game.haveKey>2)Laya.timer.frameLoop(1,e.KeyAni,()=>{var t=e.key_ani3.getChildAt(0);if(t.scaleX+=.02,t.scaleY+=.02,t.scaleX>=1){t.scaleX,t.scaleY,Laya.timer.clearAll(e.KeyAni);for(let t=1;t<4;t++){var i=e["key_ani"+t.toString()];e.KeyMoveAni(i)}}});else for(let t=1;t<4;t++){var i=e["key_ani"+t.toString()];e.KeyMoveAni(i)}});else for(let t=1;t<4;t++){var i=e["key_ani"+t.toString()];e.KeyMoveAni(i)}});else for(let i=1;i<4;i++){var t=e["key_ani"+i.toString()];e.KeyMoveAni(t)}}KeyMoveAni(e){var t=this,i=Math.abs(t.sp_maodian.x-e.x),s=Math.abs(t.sp_maodian.y-e.y);Laya.timer.frameLoop(1,t.KeyMoveAni,()=>{e.x-=i/30,e.y+=s/30,e.alpha-=1/32,e.alpha<=0&&(e.alpha=0,e.visible=!1,Laya.timer.clearAll(t.KeyMoveAni))})}PriceAni(){var e=this;for(let t=0;t<e.priceGroup.length;t++)e.priceGroup[t].rotation=10,Laya.timer.frameOnce(5,e,()=>{e.priceGroup[t].rotation=-10,Laya.timer.frameOnce(5,e,()=>{e.priceGroup[t].rotation=0})})}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}DependAttentionPrice(){}chouka(){if(null==this.baodi)return 0;if(0==this.baodi)return 1;if(this.baodi<0)return 0;var e=this.baodi>5?.1:.4;return Math.random()<e?1:0}onClickHandler(e){var t=this;switch(e.target){case t.btn_shuoming:t.box_shuoming.visible=!t.box_shuoming.visible;break;case t.btn_price1:var i=t.img_price1;break;case t.btn_price2:i=t.img_price2;break;case t.btn_price3:i=t.img_price3;break;case t.btn_price4:i=t.img_price4;break;case t.btn_price5:i=t.img_price5;break;case t.btn_price6:i=t.img_price6;break;case t.btn_price7:i=t.img_price7;break;case t.btn_price8:i=t.img_price8;break;case t.btn_price9:i=t.img_price9}switch(e.target){case t.btn_home:if(ea.scene.GamePause=!1,be.closepanel(t.name),t.IsGameLobby())return void Js.map.runWith([2001,1001]);var s=initHandler(t,()=>{Js.map.runWith([2001,1001])});be.openpanel(we.ShopPanel,{handler:s});break;case t.btn_fuse:be.closepanel(t.name),ea.scene.GamePause=!1,t._param&&t._param.run();break;case t.btn_price1:case t.btn_price2:case t.btn_price3:case t.btn_price4:case t.btn_price5:case t.btn_price6:case t.btn_price7:case t.btn_price8:case t.btn_price9:if(0==t.isAniAction)return;if(Ve.game.haveKey<=0)return void yt.getInstance().showVideo(null,null,()=>{Ve.game.haveKey+=3,t.keynumber.text="X"+Ve.game.haveKey.toString(),t.VideoAction(!1)});t.baodi--,Ve.game.haveKey--,Ve.game.haveKey<=0&&t.VideoAction(!0),t.keynumber.text="X"+Ve.game.haveKey.toString(),t.openprice=e.target;var a=t.chouka();1==a?(t.baodi=-1,i.skin="res/icon/equip/"+t.zhumushop.shopIcon+".png",Ve.shop.noMoneyBuyShop(t.zhumushop.shopId),Ve.shop.useEquip(t.zhumushop.shopId,0)):0==a&&(i.skin="res/common/jb.png",Ve.user.addGold(100,new Laya.Point(2400,50)));break;case t.btn_jili:if(0==t.isAniAction)return;yt.getInstance().showVideo(null,null,()=>{Ve.game.haveKey+=3,t.keynumber.text="X"+Ve.game.haveKey.toString(),t.VideoAction(!1)})}}IsGameLobby(){return 0!=a.map.getTbByGamePkType(2).length}onDisable(){Laya.timer.clearAll(this),Laya.timer.clearAll(this.KeyAni),Laya.timer.clearAll(this.KeyMoveAni),super.onDisable()}}class uo extends it{constructor(){super(),this.moneytype=null,this.moneys=null,this.isPanels=null,this.isShowAddClicks=null,this.money=5e3,this.isPanel=!1,this.isShowAddClick=!0}onEnable(){super.onEnable(),this.addClick(this.owner.btn_addGold),this.index=2,this.moneys||(this.moneys="5000,5000,5000,5000"),this.isPanels||(this.isPanels="false,false,true,false"),this.isShowAddClicks||(this.isShowAddClicks="true,true,true,true");var e=this.isShowAddClicks.split(","),t=this.moneys.split(","),i=this.isPanels.split(",");this.isShowAddClick="true"==e[this.index],this.money=Number(t[this.index]),this.isPanel="true"==i[this.index],this.isShowAddClick?(this.owner.btn_addGold.visible=!0,this.owner.img_addGold.visible=!0):(this.owner.btn_addGold.visible=!1,this.owner.img_addGold.visible=!1);var s=this.owner.btn_addGold.getChildAt(0);this.isPanel?s.visible=!1:s.visible=!0,this.bin(qn.NAME,this.onUserDataChange,qn.RESOURCE_RES),this.monitor(Laya.Event.RESIZE,this.onResize),this.onResize()}onResize(){this.moneypos=this.owner?this.owner.img_gold.parent.localToGlobal(new Laya.Point(this.owner.img_gold.x,this.owner.img_gold.y)):new Laya.Point(0,0)}onClickHandler(e){var t=this;switch(e.target){case t.owner.btn_addGold:if(Tn.inst.sound.play(Ie.id.点击按扭),t.isPanel){var i=a.drop.getTbByDropId(10003);be.openTopTipPanel(we.DropBuffPanel,{info:i,isClick:!0,handler:initHandler(t,e=>{ea.scene.GamePause=!1})})}else switch(t.moneytype){case Ke.GOLD:yt.getInstance().showVideo(null,null,()=>{Ve.user.addGold(t.money,t.moneypos),console.log("moneyBar")});break;case Ke.ACTION:Ve.user.addAction(t.money,t.moneypos);break;case Ke.DHJ:Ve.user.addDHJ(t.money,t.moneypos)}}}onUserDataChange(){if(this.owner.txt_gold)switch(this.moneytype){case Ke.GOLD:this.owner.txt_gold.text=Ve.user.gold.toString();break;case Ke.ACTION:this.owner.txt_gold.text=Ve.user.action.toString();break;case Ke.DHJ:this.owner.txt_gold.text=Ve.user.dhj.toString()}}onDisable(){super.onDisable()}}class po extends Ee.res.modules.drop.DropBuffPanelUI{constructor(){super(),this.isClick=!1,this.panelapi=ea.drop.dropbuff,this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;if(ea.scene.GamePause=!0,e._param){e.info=e._param.info,e.isClick=e._param.isClick,e.handler=e._param.handler,yt.getInstance().showInsertAd(),delete e._param.handler,e.platbox=ni.getBox(e),ni.initPanelNodeNames(e,e.platbox,["btn_fuse","btn_close","btn_close2","img_icon","img_titletxt","txt_desc","txt_count"]),e.addClick(e.btn_fuse),e.btn_close&&e.addClick(e.btn_close),e.btn_close2&&e.addClick(e.btn_close2),e.img_icon.skin="res/icon/skill/"+e.info.resId+".png",e.txt_desc.text=e.info.desc,e.txt_name.text=e.info.btnlabel;var t=new Laya.Tween,i=s=>{t.clear(),t.to(s,{scaleX:1,scaleY:1},1e3,null,initHandler(e,()=>{t.to(s,{scaleX:.8,scaleY:.8},1e3,null,initHandler(e,i,[s]))}))};i(e.img_icon)}else be.closepanel(e.name)}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}onClickHandler(e){var t=this;switch(e.target){case t.btn_close:case t.btn_close2:be.closepanel(t.name),ea.scene.GamePause=!1,t.handler&&t.handler.runWith([-1]);break;case t.btn_fuse:yt.getInstance().showVideo(null,null,()=>{ea.drop.dropbuff.onRunHandler(t.handler)})}}onDisable(){super.onDisable()}}class mo extends Ee.res.modules.drop.DropDependPanelUI{constructor(){super(),this.isClick=!1,this.panelapi=ea.drop.dropbuff,this.addCom(this,fe)}onEnable(){super.onEnable();ea.scene.GamePause=!0,this._param=Ve.game.DependBaoxiang(),yt.getInstance().showInsertAd(),delete this._param.handler,this.platbox=ni.getBox(this),ni.initPanelNodeNames(this,this.platbox,["btn_fuse","btn_close","btn_close2","img_icon","img_titletxt","txt_desc","txt_count"]),this.addClick(this.btn_fuse),this.btn_close&&this.addClick(this.btn_close),this.btn_close2&&this.addClick(this.btn_close2),null==Ve.game.BaoxiangIcon?(this.img_icon.skin="res/icon/equip/101.png",this.txt_desc.text="中奖啦！免费获得奖品",this.txt_name.text="加速道具"):Ve.game.BaoxiangIcon&&(this.img_icon.skin="res/icon/equip/"+Ve.game.BaoxiangIcon.shopIcon+".png",this.txt_desc.text="中奖啦！免费获得奖品",this.txt_name.text=Ve.game.BaoxiangIcon.shopName)}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}onClickHandler(e){switch(e.target){case this.btn_close:case this.btn_close2:be.closepanel(this.name),ea.scene.GamePause=!1;break;case this.btn_fuse:be.closepanel(this.name),ea.scene.GamePause=!1,this._param&&this._param.run()}}onDisable(){super.onDisable()}}class go extends Ee.res.modules.drop.DropEquipPanelUI{constructor(){super(),this.isClick=!1,this.clickLock=!1,this.panelapi=ea.drop.dropequip,this.addCom(this,fe),this.panelapi.bin(this)}onEnable(){super.onEnable();var e=this;if(ea.scene.GamePause=!0,this._param){e.info=this._param.info,e.isClick=e._param.isClick,e.handler=this._param.handler,yt.getInstance().showInsertAd(),delete e._param.handler,e.platbox=ni.getBox(e),ni.initPanelNodeNames(e,e.platbox,["btn_action","btn_close","btn_close2","img_icon","txt_desc"]),e.addClick(e.btn_action),e.addCom(e.btn_action,li).playhuxi(),e.btn_close&&e.addClick(e.btn_close),e.btn_close2&&e.addClick(e.btn_close2),Tn.inst.setImageIcon(e.img_icon,"res/icon/equip/"+e.info.shopIcon+".png");var t=new Laya.Tween,i=s=>{t.clear(),t.to(s,{centerY:-20},1e3,null,initHandler(e,()=>{t.to(s,{centerY:0},1e3,null,initHandler(e,i,[s]))}))};i(e.img_icon),e.txt_name.text=e.info.shopName,e.txt_desc.text=e.info.shopDesc}}onClickHandler(e){var t=this;switch(e.target){case t.btn_close:case t.btn_close2:be.closepanel(t.name),ea.scene.GamePause=!1,3!=this.info.shopType&&t.handler&&t.handler.runWith([-1]);break;case t.btn_action:if(1==t.clickLock)return;t.clickLock=!0,yt.getInstance().showVideo(null,null,()=>{var e=t.info;be.closepanel(we.DropEquipPanel),3==e.shopType?t.handler&&t.handler.run():ea.drop.dropequip.onRunHandler(e,t.handler)},()=>{t.clickLock=!1},()=>{t.clickLock=!1})}}onDisable(){super.onDisable()}}class yo extends Ee.res.modules.drop.DropRewardPanelUI{constructor(){super(),this.isClick=!1,this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;if(ea.scene.GamePause=!0,this._param){e.info=this._param.info,e.isClick=e._param.isClick,e.handler=this._param.handler,delete e._param.handler,e.addClick(e.btn_action),e.btn_close&&e.addClick(e.btn_close),e.btn_close2&&e.addClick(e.btn_close2),Tn.inst.setImageIcon(e.img_icon,"res/icon/equip/"+e.info.shopIcon+".png");var t=new Laya.Tween,i=s=>{t.clear(),t.to(s,{centerY:-55},1e3,null,initHandler(e,()=>{t.to(s,{centerY:-30},1e3,null,initHandler(e,i,[s]))}))};i(e.img_icon)}}onClickHandler(e){switch(e.target){case this.btn_close:case this.btn_close2:be.closepanel(this.name),ea.scene.GamePause=!1;break;case this.btn_action:be.closepanel(this.name),ea.scene.GamePause=!1,Ve.role.haveRole(10300,!0),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),cafe.event.dispatch(Z.EQUIP_ROLE)}}onDisable(){super.onDisable()}}class fo extends Ee.res.modules.end.EndLostPanelUI{constructor(){super(),this.isdispose=!1;this.addCom(this,fe)}onEnable(){var e=this;super.onEnable(),setTimeout(()=>{io.getInstance().showCustomAd()},300),Tn.inst.sound.play(Ie.id.角色死亡),ea.scene.GamePause=!0,e.platbox=ni.getBox(e),ni.initPanelNodeNames(e,e.platbox,["btn_continue","btn_backhome","btn_close"]),e.addClick(e.btn_continue),e.addClick(e.btn_backhome),e.addClick(e.btn_close),mi.device.currentMountGear&&mi.device.unDevice(),cafe.event.dispatch(se.ClOSEPANELHANDLE),cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0),yt.getInstance().showInsertAd(),Tn.inst.loadDb.res("res/dbres/sb/sb",initHandler(e,t=>{e.stage?(e&&e.box_db2&&e.box_db2.addChild(t),t.x=0,t.y=0,t.play(0,!1)):t.destroy()})),pt.SpringAni(e.btn_continue,600,0,1,1.2,initHandler(this,()=>{pt.BreathEffect(this.btn_continue)})),pt.SpringAni(e.btn_backhome,600),e.islock=!1}onClickHandler(e){var t=this;switch(e.target){case t.btn_close:break;case t.btn_backhome:if(t.islock)return;t.islock=!0,Tn.inst.sound.play(Ie.id.点击按扭),t.BackHome();break;case t.btn_continue:if(t.islock)return;t.islock=!0,setTimeout(()=>{t.islock=!1},700),yt.getInstance().showVideo(null,null,()=>{cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),cafe.event.dispatch(se.CANCELSKILL),be.closepanel(we.EndLostPanel),Ue.show("复活成功"),ea.scene.ui.RevertBlood(),Ve.game.fuhuoTime=(new Date).getTime(),ea.scene.player.info.attribute.revive(),1==Ve.game.MaoMaoGameType&&(ea.scene.ui.getComponent(hs).start(120),ea.scene.ui.ClearShowHurtUIByTween()),ea.scene.GamePause=!1,cafe.event.dispatch(se.RESTARTHAILANG)})}}BackHome(){if(Lt.stopRecord(),Ve.game.maomaoLVint(),Ve.game.pkLvInt(),Ve.map.map=a.map.getTbBymap(2001),Ve.game.MaoMaoGameType=Ve.map.map.gametype,be.closepanel(this.name),We.closescene(we.GameScene),this.IsGameLobby())Js.map.runWith([2001,1001]);else{Js.map.runWith([2001,1001]);var e=initHandler(this,()=>{Js.map.runWith([2001,1001])});be.openpanel(Ve.shop.ShopPanel,{handler:e})}}IsGameLobby(){return 0!=a.map.getTbByGamePkType(2).length}onDisable(){Ve.game.selectDoor&&(Ve.game.selectDoor.removeSelf(),Ve.game.selectDoor.destroy()),super.onDisable()}}class _o extends Ee.res.modules.end.EndTimeOutPanelUI{constructor(){super(),this.isdispose=!1,this.isClick=!1;this.islock=!1,this.addCom(this,fe)}onEnable(){super.onEnable(),ea.scene.GamePause=!0,this.addClick(this.btn_continue),this.addClick(this.btn_backhome),cafe.event.dispatch(se.ClOSEPANELHANDLE),ea.scene.player.moveTrigger.ClearTrigger()}onClickHandler(e){if(!this.isClick)switch(e.target){case this.btn_continue:yt.getInstance().showVideo(null,null,()=>{mi.device.rideDevice(),be.closepanel(we.EndTimeOutPanel),ea.scene.GamePause=!1});break;case this.btn_backhome:be.closepanel(we.EndTimeOutPanel),mi.device.curpanel=!0,ea.scene.GamePause=!1}}onDisable(){super.onDisable()}}class vo extends Ee.res.modules.end.EndUpPanelUI{constructor(){super(),this.isdispose=!1;this.islock=!1,this.panelapi=ea.end.endUp,this.addCom(this,fe)}onEnable(){super.onEnable(),setTimeout(()=>{io.getInstance().showCustomAd()},300),Tn.inst.sound.play(Ie.id.任务完成),ea.scene.GamePause=!0,this.platbox=ni.getBox(this),ni.initPanelNodeNames(this,this.platbox,["btn_continue","btn_backhome","btn_close"]),this.addClick(this.btn_continue),this.addClick(this.btn_backhome),this.addClick(this.btn_close),this.lab_des.text="恭喜抓到了调皮的玩家:"+this._param+"，继续加油！",this.showBtn()}showBtn(){}onClickHandler(e){var t=this;switch(e.target){case t.btn_close:case t.btn_backhome:if(t.islock)return;t.islock=!0,Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(t.name),ea.scene.GamePause=!1;break;case t.btn_continue:if(t.islock)return;t.islock=!0,cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!1),Ve.user.addGold(3*t.task.tb.taskGold,null,null,()=>{be.closepanel(t.name),ea.scene.GamePause=!1,100002==t.task.taskId&&Ve.level.Clear();for(var e=Ve.task.getTaskList(),i=0;i<e.length;i++)e[i].count=0;0!=t.task.tb.taskRewardShopId&&Ve.shop.noMoneyBuyShop(t.task.tb.taskRewardShopId),We.closescene(we.GameScene),We.openscene(we.HallScene).start()})}}onDisable(){this.clearTimer(this,this.showBtn),super.onDisable()}}class bo extends Ee.res.modules.end.EndUpPanel1UI{constructor(){super(),this.isdispose=!1;this.islock=!1,this.panelapi=ea.end.endUp,this.addCom(this,fe)}onEnable(){var e=this;super.onEnable(),setTimeout(()=>{io.getInstance().showCustomAd()},300),Tn.inst.sound.play(Ie.id.任务完成),ea.scene.GamePause=!0,e.addClick(e.btn_continue),e.lab_des.text="恭喜抓到了调皮的玩家:"+this._param+"，继续加油！",setTimeout(()=>{e.btn_continue.visible=!0},2e3),e.showBtn()}showBtn(){}onClickHandler(e){switch(e.target){case this.btn_continue:if(this.islock)return;this.islock=!0,Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(this.name),ea.scene.GamePause=!1}}onDisable(){this.clearTimer(this,this.showBtn),super.onDisable()}}class wo extends Ee.res.modules.end.EndUpPanel3UI{constructor(){super(),this.isdispose=!1;this.islock=!1,this.panelapi=ea.end.endUp,this.addCom(this,fe)}onEnable(){var e=this;super.onEnable(),setTimeout(()=>{io.getInstance().showCustomAd()},300),Tn.inst.sound.play(Ie.id.任务完成),ea.scene.GamePause=!0,e.addClick(e.btn_continue),e.lab_des.text="恭喜抓到了调皮的玩家:"+this._param+"，继续加油！",setTimeout(()=>{e.btn_continue.visible=!0},1e3),e.showBtn()}showBtn(){}onClickHandler(e){switch(e.target){case this.btn_continue:if(this.islock)return;this.islock=!0,Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(this.name),ea.scene.GamePause=!1}}onDisable(){this.clearTimer(this,this.showBtn),super.onDisable()}}class To extends Ee.res.modules.end.EndWinPanelUI{constructor(){super(),this.isdispose=!1,this._money=0;this.islock=!1,this.addCom(this,fe)}onEnable(){var e=this;super.onEnable(),setTimeout(()=>{io.getInstance().showCustomAd()},300),Lt.stopRecord(),ea.scene.GamePause=!0,cafe.event.dispatch(se.GAME_NPC_CH),Tn.inst.sound.play(0),Tn.inst.sound.play(Ie.id.任务完成),e.btn_addd&&(e.btn_addd.visible=!1),e.btn_addd&&e.addClick(e.btn_addd),e.addClick(e.btn_action),e.addClick(e.btn_continue),e.addClick(e.btn_shouxia),e.addClick(e.btn_shouxiaVideo),yt.getInstance().showInsertAd(),Ve.game.isShowMap=!0,e.showBtn(),e.binGuide(),ea.end.endWin.init(e),Tn.inst.loadDb.res("res/dbres/sl/sl",initHandler(e,t=>{e.stage?(e&&e.box_db2&&e.box_db2.addChild(t),t.x=0,t.y=0,t.play(0,!1)):t.destroy()})),pt.BreathEffect(this.btn_shouxiaVideo),pt.SpringAni(e.img_jinbi,600),pt.SpringAni(e.btn_continue,600),pt.SpringAni(e.btn_action,600,0,1,1.2,initHandler(this,()=>{pt.BreathEffect(this.btn_action)})),0==Ve.game.MaoMaoGameType&&e._param&&"hall"!=e._param.task.tb.taskTargetId&&(e.group_panel.visible=!0,e.group_center.visible=!1),Ve.game.curJieSuolv=Ve.map.map.mapId+1}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0),this.actionpos=this.ui_action?this.ui_action.img_gold.parent.localToGlobal(new Laya.Point(this.ui_action.img_gold.x,this.ui_action.img_gold.y)):new Laya.Point(0,0)}get money(){return this._money}set money(e){Math.round(this._money)!=Math.round(e)&&Tn.inst.sound.play(Ie.id.结算金币滚动效果),this._money=e}showBtn(){this.btn_continue.visible=!0}clickButtonHandler(){if(!Ve.user.isUseAction(Ve.user.gq_action))return be.closepanel(this.name),We.closescene(we.GameScene),void We.openscene(we.HallScene).start()}onClickHandler(e){var t=this;switch(e.target){case t.btn_shouxia:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1,Ve.user.addGold(1e3);var i=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(i.music),t._param&&(be.closepanel(we.EndWinPanel),t._param.handler&&t._param.handler.run());break;case t.btn_shouxiaVideo:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1;i=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(i.music),yt.getInstance().showVideo(null,null,()=>{Ve.user.addGold(3e3)}),t._param&&(be.closepanel(we.EndWinPanel),t._param.handler&&t._param.handler.run());break;case t.btn_addd:Tn.inst.sound.play(Ie.id.点击按扭);break;case t.btn_action:if(Tn.inst.sound.play(Ie.id.点击按扭),t.islock)return;t.islock=!0,setTimeout(()=>{t.islock=!1},700),Lt.logStageLoad(1);i=a.map.getTbBymap(Ve.map.mapId);if(Tn.inst.sound.play(i.music),yt.getInstance().showVideo(null,null,()=>{t.Hallhandler&&t.Hallhandler.run(),ea.scene.GamePause=!1,Ve.user.addGold(3e3)}),0==Ve.game.MaoMaoGameType)return Ve.game.maomaoLVint(),void t.BackHome();1==Ve.game.MaoMaoGameType?(Ve.game.maomaoLVint(),t.BackHome()):3==Ve.game.MaoMaoGameType?(Ve.game.maomaoLVint(),t.BackHome()):(Ve.game.maomaoLVint(),Ve.game.pkLvInt(),We.closescene(we.GameScene),We.openscene(we.HallScene).start());break;case t.btn_continue:if(Tn.inst.sound.play(Ie.id.点击按扭),t.islock)return;t.islock=!0,setTimeout(()=>{t.islock=!1},700),Lt.logStageLoad(1);i=a.map.getTbBymap(Ve.map.mapId);if(Tn.inst.sound.play(i.music),t.Hallhandler&&t.Hallhandler.run(),ea.scene.GamePause=!1,Ve.user.addGold(1e3),0==Ve.game.MaoMaoGameType)return Ve.game.maomaoLVint(),void t.BackHome();1==Ve.game.MaoMaoGameType?(Ve.game.maomaoLVint(),t.BackHome()):3==Ve.game.MaoMaoGameType?(Ve.game.maomaoLVint(),t.BackHome()):(Ve.game.maomaoLVint(),Ve.game.pkLvInt(),We.closescene(we.GameScene),We.openscene(we.HallScene).start());break;case t.btn_backhome:Tn.inst.sound.play(Ie.id.点击按扭),Lt.stopRecord(),Lt.logStageLoad(1),Lt.reportTask(t.task.taskId,1),Ve.user.addGold(t.task.tb.taskGold,t.moneypos,null,()=>{Ve.game.maomaoLVint(),Ve.game.pkLvInt(),be.closepanel(t.name),We.closescene(we.GameScene),We.openscene(we.HallScene).start(),Ve.game.RiseTime=5})}}BackHome(){Ve.game.pkLvInt(),Ve.map.map=a.map.getTbBymap(2001),Ve.game.MaoMaoGameType=Ve.map.map.gametype,be.closepanel(we.EndWinPanel),We.closescene(we.GameScene);var e=initHandler(this,()=>{Js.map.runWith([2001,1001])});be.openpanel(we.DropAdiPanel,{handler:e})}onDisable(){this.clearTimer(this,this.showBtn),Laya.Tween.clearTween(this),super.onDisable()}handleGuideTransition(){}}class Ao extends it{constructor(){super(),this.isDown=!1,this.isCd=!1}install(e,t,i){this.pos=e,this.info=t,this.role=i,this.isCd=!1,t?(this.owner.visible=!0,53007==this.info.skillId&&(t.isHave=!1),t&&t.isHave?(this.initShow(),this.owner.img_shadow.visible=!1):(this.owner.img_lock.visible=!0,this.owner.box_progress.visible=!1,this.owner.img_shadow.visible=!0),Tn.inst.setImageIcon(this.owner.img_icon,"res/icon/skill/"+this.info.tb.skillIcon+".png"),42810008==Ve.game.currole&&48001==this.info.skillId&&Tn.inst.setImageIcon(this.owner.img_icon,"res/icon/skill/48001_2.png"),this.monitor(se.KEY_BOARD_LISTENER+`_run_${this.info.tb.keybroad}`,this.onKeyBoardHandler),this.monitor(se.KEY_BOARD_UP_LISTENER+`_run_${this.info.tb.keybroad}`,this.onKeyBoardHandler),Ye.add(1,this,this.onFrameRun)):this.owner.visible=!1}initShow(){var e=this.info.tb;switch(this.owner.img_lock.visible=!1,e.showType){case 0:case 5:this.owner.box_progress.visible=!1;break;case 1:this.owner.box_progress.visible=!0;break;case 2:this.owner.box_progress.visible=!0;var t=(e=this.info.tb).powerOrTime/1e3;this.totalcount=Math.ceil(60*t*100)/100,this.count=this.totalcount,this.addcount=Math.ceil(e.powerOrTime/e.cdtime);break;case 3:this.owner.box_progress.visible=!0;t=(e=this.info.tb).cdtime/1e3;this.totalcount=Math.ceil(60*t*100)/100,this.count=this.totalcount,this.addcount=1;break;case 4:this.owner.box_progress.visible=!0;t=(e=this.info.tb).powerOrTime/1e3;this.totalcount=Math.ceil(60*t*100)/100,this.count=this.totalcount,this.addcount=Math.ceil(e.powerOrTime/e.cdtime);break;case 6:this.owner.box_progress.visible=!0;t=(e=this.info.tb).cdtime/1e3;this.totalcount=Math.ceil(60*t*100)/100,this.count=this.totalcount,this.addcount=1}}get pross(){return this._pross}set pross(e){this._pross=e,this.info&&(3==this.info.tb.showType?this.draw(e):6==this.info.tb.showType&&this.drawCd(e))}draw(e){if(this.owner&&this.owner.sp_mask){this.owner.sp_mask.graphics.clear();var t=80+Math.round(e/100*310);this.owner.sp_mask.graphics.drawPie(0,0,88,80,t,"#00ffff")}}drawCd(e){if(this.owner&&this.owner.sp_mask){this.owner.sp_mask.graphics.clear();var t=0+Math.round(e/100*360);this.owner.sp_mask.graphics.drawPie(0,0,88,t-90,-90,"#00ffff")}}enterSkill(){var e=this;if(!e.info||e.info.isHave){if(!e.isCd)switch(e.isDown=!0,e.info.tb.showType){case 0:e.enterNoProgressCD();break;case 2:e.enterProgressCD2();break;case 3:e.enterProgressCD3();break;case 4:e.enterProgressCD4();break;case 5:e.startProgressTimer5();break;case 6:e.enterProgressCD6()}}else yt.getInstance().showVideo(null,null,()=>{console.log("enterSkill"),Ve.skill.haveSkill(e.info.skillId),e.initShow(),e.owner.img_shadow.visible=!1,e.info.isHave=!0,ea.scene.GamePause=!1,cafe.event.dispatch(se.GAME_TASK_COUNT_REF,{taskType:jt.LOOK_VIDEO,count:1})})}enterProgressCD3(){this.isCd=!0,this.value=this.info.tb.value/this.totalcount,this.owner.img_shadow.visible=!0,this.count=0;var e=this.count/this.totalcount;this.pross=Math.round(100*e),this.isDown=!1,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:!0,value:this.value})}enterProgressCD6(){this.isCd=!0,this.value=this.info.tb.value/this.totalcount,this.owner.img_shadow.visible=!0,this.owner.box_progress.visible=!0,this.count=0;var e=this.count/this.totalcount;this.pross=Math.round(100*e),this.isDown=!1,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:!0,value:this.value})}enterProgressCD4(){this.isCd=!0,this.value=this.info.tb.value/this.totalcount,this.owner.img_shadow.visible=!0,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value})}startProgressTimer5(){this.value=this.info.tb.value,this.owner.img_shadow.visible=!0,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value})}exitProgressCD5(){this.isDown=!1,this.owner.img_shadow.visible=!1,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value})}enterProgressCD2(){this.isCd=!0,this.owner.img_shadow.visible=!0,this.owner.box_progress.visible=!0,this.value=this.info.tb.value/this.totalcount,slog("ENTER  levent.game.ROLE_USE_SKILL : ",ge.game.ROLE_USE_SKILL+"_"+this.pos),cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value})}exitProgressCD2(){this.isDown=!1,slog("END   levent.game.ROLE_USE_SKILL : ",ge.game.ROLE_USE_SKILL+"_"+this.pos),cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value})}onFrameRun(e){if(this.info)if(this.isDown){if(90011==this.info.skillId&&this.enterSkill(),this.count>0)switch(this.info.tb.showType){case 2:this.count--;var t=this.count/this.totalcount;this.pross=Math.round(100*t),cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.value}),this.pross<=0&&(this.owner.img_shadow.visible=!0,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:!1,value:this.value}));break;case 3:this.count--;t=this.count/this.totalcount;this.pross=Math.round(100*t),this.pross<=0&&(53006==this.info.skillId?cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.info.tb.value}):cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:!1,value:this.value}));break;case 4:this.count--;t=this.count/this.totalcount;this.pross=Math.round(100*t),this.pross<=0&&(this.isDown=!1,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:!1,value:this.value}))}}else if(this.count==this.totalcount){if(!this.info||!ea.scene.player)return;switch(this.info.tb.showType){case 2:if(ea.scene.player.ani.state==ie.idle||ea.scene.player.ani.state==ie.run||ea.scene.player.ani.state==ie.paidle||ea.scene.player.ani.state==ie.pa){t=1;this.pross=Math.round(100*t),this.isCd=!1,this.owner.img_shadow.visible=!1}}}else if(this.count<this.totalcount)switch(this.info.tb.showType){case 2:if(ea.scene.player.ani.state==ie.idle||ea.scene.player.ani.state==ie.run||ea.scene.player.ani.state==ie.paidle||ea.scene.player.ani.state==ie.pa)this.count+=this.addcount,(t=this.count/this.totalcount)>=1&&(t=1),this.pross=Math.round(100*t),this.isCd=!1,this.owner.img_shadow.visible=!1;break;case 3:case 4:this.count+=this.addcount,(t=this.count/this.totalcount)>=1&&(t=1),this.pross=Math.round(100*t),t>=1&&(this.isCd=!1,this.owner.img_shadow.visible=!1);break;case 6:this.count+=this.addcount,(t=this.count/this.totalcount)>=1&&(t=1),this.pross=Math.round(100*t),t>=1&&(this.isCd=!1,this.owner.img_shadow.visible=!1,this.owner.box_progress.visible=!1)}}exitSkill(){switch(this.info.tb.showType){case 0:this.isDown=!1;break;case 2:this.isDown=!1,this.exitProgressCD2();break;case 5:this.isDown=!1,this.exitProgressCD5()}}enterNoProgressCD(){this.isCd=!0,this.owner.img_shadow.visible=!0,cafe.event.dispatch(ge.game.ROLE_USE_SKILL+"_"+this.pos,{skill:this.info,isDown:this.isDown,value:this.info.tb.value}),this.owner.timerOnce(this.info.tb.cdtime,this,this.onEnterNoProgressCD)}onEnterNoProgressCD(){this.owner.clearTimer(this,this.onEnterNoProgressCD),this.owner.img_shadow.visible=!1,this.isCd=!1}onEnable(){super.onEnable();this.layaMonitor(Laya.Event.MOUSE_DOWN,this.onMouseHandler,this.owner.btn_click),this.layaMonitor(Laya.Event.MOUSE_UP,this.onMouseHandler,this.owner.btn_click),this.layaMonitor(Laya.Event.MOUSE_OUT,this.onMouseHandler,this.owner.btn_click),this.pross=100}onDistanceMouseHandler(e){if(this.info&&this.info.tb)switch(e.type){case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:this.exitSkill()}}onKeyBoardHandler(e){var t=this;if(t.info&&t.info.tb)if(ea.scene.player.ani.state!=ie.jump1){if(ea.scene.player.ani.state!=ie.hit&&ea.scene.player.ani.state!=ie.jump1&&ea.scene.player.ani.state!=ie.jump4&&ea.scene.player.ani.state!=ie.zhuiluoqishen)switch(e.key){case"run"+t.info.tb.keybroad:"keydown"==e.type?t.enterSkill():t.exitSkill()}}else setTimeout(()=>{t.exitSkill()},200)}onMouseHandler(e){var t=this;if(!ea.scene.GamePause&&ea.scene.player&&(slog("onMouseHandler : ",0),t.info&&t.info.tb)){if(slog("onMouseHandler : ",1),!e)return t.enterSkill(),void setTimeout(()=>{t.exitSkill()},800);ea.scene.player.ani.state!=ie.jump1?ea.scene.player.ani.state!=ie.hit&&ea.scene.player.ani.state!=ie.jump1&&ea.scene.player.ani.state!=ie.jump4&&ea.scene.player.ani.state!=ie.zhuiluoqishen&&(e.type==Laya.Event.MOUSE_UP||e.type==Laya.Event.MOUSE_OUT?t.exitSkill():e.type==Laya.Event.MOUSE_DOWN&&t.enterSkill()):setTimeout(()=>{t.exitSkill()},200)}}onDestroy(){super.onDestroy();Ye.remove(this,this.onFrameRun),this.owner.clearTimer(this,this.onEnterNoProgressCD)}}class xo extends it{constructor(){super(...arguments),this.speed=0,this.addspeed=0,this.maxspeed=0,this.total=50}onEnable(){super.onEnable(),this.run()}run(){this.life=2500,this.Startlife=this.life,this.speed=0,this.addspeed=.05,this.maxspeed=.3,this.active=!0}onUpdate(){var e=this;let t=e.speed;var i=e.owner;if(!i)return;let s=i.transform;var a=new Laya.Vector3(s.position.x,s.position.y,s.position.z),n=new Laya.Vector3(s.position.x,-1,s.position.z),o=new Laya.HitResult;if(ea.scene.mainscene.physicsSimulation.raycastFromTo(a,n,o))if(o.succeeded&&Math.abs(o.point.y-s.position.y)<.3){if(i.getChildByName("san")){var r=e.owner;mi.drop.addDropWeapon(70008,r.transform.position),i.getChildByName("san").removeSelf();var l=e.owner.getChildByName("xiangzi"),h=l.getComponent(Laya.Animator);h.play("zhankai"),h.speed=3;var c=2e4+(Math.floor(9*Math.random())+1);Tn.inst.load3d.thingRes(ce.getPropEffectUrl(c.toString()+".lh"),ea.scene.mainscene,initHandler(e,t=>{if(t){e.owner.addChild(t);t.transform.localPosition=new Laya.Vector3(0,1,0)}else serror("mapThingRes加载资源失败：")})),Laya.timer.once(5e3,e,()=>{l.removeSelf()})}}else s.position.y>0&&i.getChildByName("san")&&s.translate(new Laya.Vector3(0,-t,0),!0);e.life<=1500&&i.getChildByName("san")&&(e.owner.removeSelf(),e.owner.destroy(),e.owner=null),e.life--,e.life<=0&&(e.owner.removeSelf(),e.owner.destroy(),e.owner=null),e.speed<e.maxspeed&&(e.speed+=e.addspeed,e.speed>=e.maxspeed&&(e.speed=e.maxspeed))}onDestroy(){super.onDestroy()}}class ko extends Ee.res.modules.role.NpcListItemView1UI{constructor(){super()}onEnable(){super.onEnable();this.monitor(se.NPCXURUO,this.xuruo),this.monitor(se.NPCQP,this.showqp),this.monitor(se.NPCTAOTAI,this.taotai)}setDataChange(e){this.info=e,this.txt_name.text=this.info.npcName,this.img_qp.visible=!1}xuruo(e){this.info&&e.id==this.info.npcId&&(this.img_xuruo.visible=e.state)}taotai(e){this.info&&e==this.info.npcId&&(this.img_taotai.visible=!0,this.txt_name.alpha=.4,this.img_qp.visible=!1,this.clearMonitor(),Laya.timer.clearAll(this))}showqp(e){if(this.info){var t=e.split("|");Number(t[0])==this.info.npcId&&(this.lab_npctalk.text=t[1],this.img_qp.visible=!0,Laya.timer.once(3e3,this,this.closeqp))}}closeqp(){this.img_qp.visible=!1,this.lab_npctalk.text=""}onDestroy(){Laya.timer.clearAll(this),super.onDestroy()}}class Eo extends Ee.res.modules.game.MainUiViewUI{constructor(){super(),this.koutouCD=5,this.weaponTime=0,this.weaponId=0,this.doorIndex=1,this.musicBoxSound=null,this.gameNpclist=[],this.maomaoint=!1,this.isTalk=!1,this.uiTweenStateDir={},this.uiTweenPoiDir={},this.isLoopShowHurt=!1,this.tweenTime=400,this.changeSeleModelList=["11230323|气球","11230321|花盆","11180453|宝箱","11180412|背包","11180410|橄榄球","11180351|铃铛"],this.curChangeSeleModelList=[],this.videochangenum=0,this.moneyRandSeleModelnum=0,this.DJnum=0,this.FuTime=0,this.selModelJDTime=0,this.isgo=!1,this.startX=0,this.curTimeToTal=0,this.deviceTime=0,this.huatipoi=null,this.GuideLevel=1,this.taskWidth=541,this.taskProgressCurNumber=0,this.taskProgressNumber=0,this.yinghuaTaskPosX=0,this.correctIndex=-1,this.isPress=!1,this.imageIndexs=[],this.bloodMaxNumber=3,this.curbloodNumber=3,this.invincible=!1;this.addCom(this,fe)}onEnable(){super.onEnable(),Lt.reportEnter(6),Tn.inst.sound.play(Ve.map.map.music),cafe.event.dispatch(Laya.Event.RESIZE),this.box_task_content.removeChildren(),this.addCom(this,hs),this.AddClick(),this.binGuide(),this.MonitorEvent(),this.onRoleInitFinishHandler(),this.showTimeUIByGameType(),this.PkBloodInit(),pt.BreathEffect(this.btn_jiliz.getChildByName("shopicon"),1e3,1.05),pt.BreathEffect(this.btn_jilij.getChildByName("shopicon"),1e3,1.05),Number(i.read("xyhGuide"))>=2&&(this.firestRange.visible=!1),"1"==i.read("firstSelectMusic")?this.firstSelectMusic.visible=!1:this.firstSelectMusic.visible=!0,this.MapText.text="开始游戏→模式选择→"+Ve.map.map.mapName,Ve.game.hadgold=Ve.user.gold,ea.scene.GamePause=!0}MonitorEvent(){this.monitor(ge.game.ROLE_REPLACE_FINISH,this.onRoleInitFinishHandler),this.monitor(se.GETBUFF,this.onGetBuff),this.monitor(ge.game.ROLE_MOD_REPLACE_FINISH,this.onRoleReplaceHandler),this.monitor(ge.game.DEVICE_MOD_REPLACE_FINISH,this.onDeviceReplaceHandler),this.monitor(ge.game.UNDEVICE_MOD_REPLACE_FINISH,this.onUnDeviceReplaceHandler),this.monitor(ge.game.DOOR,this.Door),this.monitor(ge.game.Tips_SHOW_UI,this.TipsTween)}AddClick(){this.addClick(this.btn_prase),this.addClick(this.btn_jiashi),this.addClick(this.btn_changeCam),this.addClick(this.btn_task1),this.addClick(this.btn_task2),this.addClick(this.taskShow),this.addClick(this.btn_pon),this.addClick(this.btn_leaveMiniGame),this.addClick(this.btn_hall),this.addClick(this.btn_huati),this.addClick(this.btn_music),this.addClick(this.btn_firestran),this.addClick(this.btn_guidesteering),this.addClick(this.btn_tipNpc),this.addClick(this.btn_selModel1),this.addClick(this.btn_selModel2),this.addClick(this.btn_selModel3),this.addClick(this.btn_selMoChange),this.addClick(this.btn_moneyChangeModel),this.addClick(this.btn_fengyin),this.addClick(this.btn_jilij),this.addClick(this.btn_jiliz),this.addClick(this.btn_openMap),this.addClick(this.btn_shopItemView),this.addClick(this.btn_xiufu),this.addClick(this.img_zhuaBuTip),this.addClick(this.btn_music1),this.addClick(this.btn_music2),this.addClick(this.btn_music3),this.addClick(this.btn_music4),this.addClick(this.btn_RevertBlood)}showTimeUIByGameType(){4==Ve.game.MaoMaoGameType||0==Ve.game.MaoMaoGameType?(this.getComponent(hs).initend(),Laya.timer.clearAll(this),this.box_seleModel.visible=!1,this.img_npczhuangtai.visible=!1,this.btn_tipNpc.visible=!1,this.sk_daojishi.visible=!1,this.box_jingyan.parent.visible=!1,this.igm_timegame.visible=!1,this.img_timezhuibei.visible=!1,this.lab_daojishi.visible=!1,this.img_timebg.visible=!1,this.btn_xiufu.visible=!0,this.box_taskProgress.visible=!0,this.InitTaskProgress()):3!=Ve.game.MaoMaoGameType&&1!=Ve.game.MaoMaoGameType||(this.box_jingyan.parent.visible=!0,this.ui_skill6.visible=!1,this.box_jingyan.visible=!1,this.btn_changeCam.visible=!1,this.lab_daojishi.visible=!0,this.img_timezhuibei.visible=!1,this.btn_xiufu.visible=!1,this.img_timebg.visible=!0,this.box_pkBlood.visible=!1,this.btn_RevertBlood.visible=!1),2!=Ve.map.map.gamePkType&&(this.btn_openMap.visible=!1,this.btn_shopItemView.visible=!1),2==Ve.map.map.gamePkType&&(this.lab_daojishi.visible=!0,this.img_timebg.visible=!0,this.box_pkBlood.visible=!1,this.btn_RevertBlood.visible=!1),1!=Ve.game.MaoMaoGameType&&(this.tips_hurt.visible=!1,this.img_zhuaBuTip.visible=!1),0==Ve.game.MaoMaoGameType&&2!=Ve.map.map.gamePkType&&3!=Ve.map.map.gamePkType&&6!=Ve.map.map.gamePkType||(ea.scene.isOpenTask=!1,this.box_taskProgress.visible=!1)}showDaojishi(){var e=this;e.sk_daojishi.visible||(e.sk_daojishi.visible=!0,e.sk_daojishi.play(0,!1),2==Ve.game.MaoMaoGameType&&(Ve.game.isfirest=!1),3==Ve.game.MaoMaoGameType&&Laya.timer.once(3e3,e,()=>{Tn.inst.sound.play(15055)}),Laya.timer.once(3800,e,()=>{e.sk_daojishi.visible=!1,1==Ve.game.MaoMaoGameType?(200269==Ve.map.map.mapConfig||200210==Ve.map.map.mapConfig?(ea.scene.player.owner.transform.localRotationEulerY+=180,ea.scene.player.owner.transform.localPositionX+=3,ea.scene.player.owner.transform.localPositionZ-=3):666018==Ve.map.map.mapConfig||615001==Ve.map.map.mapConfig?(ea.scene.player.owner.transform.localRotationEulerY+=180,ea.scene.player.owner.transform.localPositionX+=3):400057==Ve.map.map.mapConfig?(ea.scene.player.owner.transform.localRotationEulerY+=180,ea.scene.player.owner.transform.localPositionZ-=3):620001==Ve.map.map.mapConfig?ea.scene.player.owner.transform.localRotationEulerY+=180:666005==Ve.map.map.mapConfig&&(ea.scene.player.owner.transform.localRotationEulerY-=90,ea.scene.player.owner.transform.localPositionZ+=3),cafe.event.dispatch(ge.game.MAP_REPLACE_FINISH),Ve.game.isfirest=!1,e.getComponent(hs).start(120)):3==Ve.game.MaoMaoGameType?cafe.event.dispatch(se.MONSTERSTARTSHOW):cafe.event.dispatch(se.MONSTERSTARTSHOW2),be.IsOpen(Ve.shop.ShopPanel)||be.openpanel(we.RoleTrialPanel),1==Number(i.read("GuideGame"))&&(e.firestRange.visible=!0,e.firestSteer.visible=!0)}))}showDaojishi2(){var e=this;e.sk_daojishi2.visible||(cafe.event.dispatch(ge.game.Tips_SHOW_UI),ea.scene.GamePause=!0,e.sk_daojishi2.visible=!0,e.this_bg.visible=!0,e.sk_daojishi2.play(0,!1),Laya.timer.once(6800,e,()=>{e.sk_daojishi2.visible=!1,e.this_bg.visible=!1,ea.scene.GamePause=!1,ea.scene.npcGamePause=!1,6==Ve.map.map.gamePkType&&(e.img_suoQuan.visible=!0),be.IsOpen(Ve.shop.ShopPanel)||be.openpanel(we.RoleTrialPanel)}))}intNpcZhuangTai(){if(!this.maomaoint){this.maomaoint||(this.maomaoint=!0),this.img_npczhuangtai.visible=!0;var e=Ve.map.mptData.mptModel[J.ROLE].things,t=[];for(let s=0;s<e.length;s++){if(e[s]&&-1!=e[s].name.indexOf("npc")){var i=e[s];t.push(i.tb),this.gameNpclist.push(i.getComponent(fs))}s==e.length-1&&(this.list_zhuangtai.itemRender=ko,this.list_zhuangtai.renderHandler=new Laya.Handler(this,this.updateItem),this.list_zhuangtai.array=t,this.img_npczhuangtai.height=40*t.length+15)}1==Ve.game.MaoMaoGameType&&(this.btn_tipNpc.visible=!0)}}upDateList(){for(let e=0;e<this.gameNpclist.length;e++)null==this.gameNpclist[e].owner&&(this.gameNpclist.splice(e,1),0==this.gameNpclist.length&&be.openpanel(we.EndWinPanel,{type:1}))}ShowNpcqpAction(e,t=30){var i=this;if(!i.isTalk){var s=1e3*(e/t+2);i.isTalk=!0,Laya.timer.once(s,i,()=>{i.showNpcqp(),i.isTalk=!1,Laya.timer.clear(i,i.showNpcqp)})}}showNpcqp(){var e=this.gameNpclist,t=this.gameNpclist.length,i=Math.floor(Math.random()*(t-0+1))+0;if(e[i]&&!e[i].isDie&&e[i].owner.tb.npcId){var s=e[i].owner.tb.npcId,a=Ve.game.npcTalk.length-1,n=Math.floor(Math.random()*(a-0+1))+0;8!=Ve.map.map.gamePkType&&e[i].ai.showqp(s.toString()+"|"+Ve.game.npcTalk[n]),cafe.event.dispatch(se.NPCQP,s.toString()+"|"+Ve.game.npcTalk[n])}}cancelNpcqp(){Laya.timer.clear(this,this.showNpcqp)}showFengYinUi(){Ue.show("获得符咒"),this.box_fengyin.getChildAt(Ve.game.FengYinLevel).getChildAt(0).visible=!0,Ve.game.FengYinLevel++,this.fuMode&&(this.fuMode.removeSelf(),this.fuMode.destroy(),this.fuMode=null),3==Ve.game.FengYinLevel&&(this.box_fengyin.visible=!1,this.btn_fengyin.visible=!0,this.tips_btnfengyingimg.visible=!0,this.tips_btnfengyingsk.visible=!0),this.lab_fengyin.text="封印"+Ve.game.FengYinLevel.toString()+"/3",be.openpanel(we.EndUpPanel3)}showSceneUItween(e){if(null==this.uiTweenStateDir[e.name]){var t=e.x;this.uiTweenPoiDir[e.name]=t}else if(1==this.uiTweenStateDir[e.name]||e.visible)return;this.uiTweenStateDir[e.name]=!0,Laya.Tween.clearAll(e),e.x=this.uiTweenPoiDir[e.name]-150;var i=new Laya.Tween;e.visible=!0,i.to(e,{x:this.uiTweenPoiDir[e.name]},350,Laya.Ease.backInOut)}hideSceneUI(e){if(null==this.uiTweenStateDir[e.name]){var t=e.x;this.uiTweenPoiDir[e.name]=t}else if(1==this.uiTweenStateDir[e])this.uiTweenStateDir[e.name]=!1;else if(0==this.uiTweenStateDir[e.name])return;this.uiTweenStateDir[e.name]=!1,e.visible=!1,Laya.Tween.clearAll(e)}LoopShowHurtUIByTween(){this.isLoopShowHurt||(this.isLoopShowHurt=!0,Laya.timer.loop(2*this.tweenTime,this,this.showHurtUIByTween))}ClearShowHurtUIByTween(){this.isLoopShowHurt&&(this.isLoopShowHurt=!1,Laya.timer.clear(this,this.showHurtUIByTween),Laya.Tween.to(this.tips_hurt,{alpha:0},this.tweenTime,null,null))}showHurtUIByTween(){var e=this;Laya.Tween.to(e.tips_hurt,{alpha:1},e.tweenTime,null,initHandler(e,()=>{Laya.Tween.to(e.tips_hurt,{alpha:0},e.tweenTime,null,null)}))}showNpctaotaiUI(e){Laya.timer.clear(this,this.hideNpctaotaiUI),this.showSceneUItween(this.tips_taotai),this.lab_taotainame.text=e,Laya.timer.once(1500,this,this.hideNpctaotaiUI)}hideNpctaotaiUI(){this.hideSceneUI(this.tips_taotai)}showSeleModelBoxHan(){this.box_seleModel.visible=!0,this.curChangeSeleModelList=[];var e=Ve.game.RandomNumber(0,this.changeSeleModelList.length-1,3);this.seleModelJinDu(10);for(let s=0;s<e.length;s++){var t=this.changeSeleModelList[e[s]],i=t.split("|");this.curChangeSeleModelList.push(t),0==s&&(Ve.game.curChangeModel=i[0]),this["icon_selModel"+(s+1).toString()].skin="res/icon/equip/"+i[0]+".png",this["lab_selModel"+(s+1).toString()].text=i[1]}Laya.timer.once(400,this,this.showSeleModeltween2)}showSeleModeltween2(){var e=this,t=[],i=initHandler(e,()=>{Laya.Tween.to(t[2],{width:1},200,null,initHandler(e,()=>{Laya.timer.clearAll(t[2])})),Laya.Tween.to(t[1],{width:1},200,null,initHandler(e,()=>{Laya.timer.clearAll(t[1])})),Laya.Tween.to(t[0],{width:1},200,null,initHandler(e,()=>{Laya.timer.clearAll(t[0])}))});for(let a=0;a<3;a++){var s=e["btn_selModel"+(a+1).toString()].getChildByName("btnmask");t.push(s),2==a&&i&&i.run()}}showSeleModelBox(){var e=this,t=[];Tn.inst.sound.play(15056);var i=initHandler(e,()=>{Laya.timer.clearAll(t[0]),Laya.Tween.to(t[0],{width:114},200,null,initHandler(e,()=>{Laya.timer.clearAll(t[1])})),Laya.Tween.to(t[1],{width:114},200,null,initHandler(e,()=>{Laya.timer.clearAll(t[2])})),Laya.Tween.to(t[2],{width:114},200,null,initHandler(e,()=>{e.showSeleModelBoxHan()}))});for(let a=0;a<3;a++){var s=e["btn_selModel"+(a+1).toString()].getChildByName("btnmask");t.push(s),2==a&&i&&i.run()}}showKeyAni(){this.box_key.visible=!0;var e=this["sk_key"+Ve.game.getKey.toString()];e.visible=!0,e.play(0,!1),Laya.timer.once(2e3,this,()=>{e.visible=!1})}moneyRandSeleModel(){var e=this,t=initHandler(e,()=>{for(let a=0;a<e.changeSeleModelList.length;a++){var t=e.changeSeleModelList[e.moneyRandSeleModelnum];if(t!=Ve.game.curChangeModel){Ve.game.curChangeModel=t;var i=t.split("|"),s=1;i[2]&&(s=Number(i[2])),cafe.event.dispatch(se.LOADTHING,{Id:i[0],isrole:!1,scale:s});break}e.moneyRandSeleModelnum++,e.moneyRandSeleModelnum==e.changeSeleModelList.length&&(e.moneyRandSeleModelnum=0)}});e.videochangenum>=2?yt.getInstance().showVideo(null,null,()=>{t&&t.run()}):t&&t.run(),e.videochangenum++,e.videochangenum>=2&&(e.video_btnbian.visible=!0)}updateItem(e,t){e.setDataChange(e.dataSource)}Door(e){this.doorIndex=e}onGetBuff(e){switch(e){case"1001":console.log("加速buff"),Ve.game.addSpeedBuff=!0,setTimeout(()=>{Ve.game.addSpeedBuff=!1},6e3)}}onRoleInitFinishHandler(){var e={tb:Ve.map.map};this.skillmod=Ve.skill.getSkillListByMods(e.tb.equipSkillMods);var t=this.skillmod.infomap[e.tb.defaultEquipSkillMod];cafe.event.dispatch(ge.game.ROLE_INSTALL_MOVE,t),cafe.event.dispatch(ge.game.ROLE_INSTALL_ACTION,t);for(var i=1;i<=6;i++){var s=t.skillmap[t.tb[`equipSkillPos${i}`]],a=this[`ui_skill${i}`],n=this.getCom(a,Ao);n||(n=this.addCom(a,Ao)),n.install(i,s,e),cafe.event.dispatch(ge.game.ROLE_INSTALL_SKILL,{pos:i,info:s})}3==Ve.game.MaoMaoGameType&&(ea.scene.player&&ea.scene.player.owner&&(1==ea.scene.player.owner.isthing||ea.scene.player.owner.isthing),Ve.game.monsterStop&&(this.ui_skill6.visible=!1))}onRoleReplaceHandler(e){ea.scene.player.action.clear(),ea.scene.player.skill.clear();var t={tb:Ve.map.map};if(this.skillmod=Ve.skill.getSkillListByMods(t.tb.equipSkillMods),this.skillmod&&this.skillmod.infomap){var i=t.tb.equipSkillMods.split("|"),s=this.skillmod.infomap[Number(i[e])];cafe.event.dispatch(ge.game.ROLE_INSTALL_MOVE,s),cafe.event.dispatch(ge.game.ROLE_INSTALL_ACTION,s);for(var a=1;a<=6;a++){var n=s.skillmap[s.tb[`equipSkillPos${a}`]],o=this[`ui_skill${a}`],r=this.getCom(o,Ao);r||(r=this.addCom(o,Ao)),r.install(a,n,t),cafe.event.dispatch(ge.game.ROLE_INSTALL_SKILL,{pos:a,info:n})}}}onUnDeviceReplaceHandler(){this.onRoleReplaceHandler(0),Ve.game.ZuoqiState=0,Ve.game.isRideZuoqi=!1}onDeviceReplaceHandler(e){ea.scene.player.action.clear(),ea.scene.player.skill.clear();var t=Ve.role.getCurrRole(),i=a.device.getTbByDeviceId(e);this.skillmod=Ve.skill.getSkillListByMods(i.equipSkillMods);var s=i.equipSkillMods.split("|"),n=this.skillmod.infomap[Number(s[0])];cafe.event.dispatch(ge.game.ROLE_INSTALL_MOVE,n),cafe.event.dispatch(ge.game.ROLE_INSTALL_ACTION,n);for(var o=1;o<=6;o++){var r=n.skillmap[n.tb[`equipSkillPos${o}`]],l=this[`ui_skill${o}`],h=this.getCom(l,Ao);h||(h=this.addCom(l,Ao)),h.install(o,r,t),cafe.event.dispatch(ge.game.ROLE_INSTALL_SKILL,{pos:o,info:r})}}overTask(){mi.mission.overTask()}timeEffectFlash(){}gameStartFlash(){var e=this;ea.scene.gameState=ea.scene.FUNC_NOACTIVE_STATE;e.btn_prase.visible=!0,ea.scene.isSceneGuide=!0,Ve.guide.refSetup(),cafe.event.dispatch(Ii.GAME_START_FOG_START),e.group_taskContent.alpha=0,e.group_taskContent.visible=!1,Laya.Tween.clearTween(e.group_taskContent),Laya.Tween.to(e.group_taskContent,{alpha:1},1e3,null,initHandler(e,()=>{Laya.Tween.clearTween(e.group_taskContent),cafe.event.dispatch(se.GAME_START_REF)}))}gameEndFlash(){var e=this;Laya.Tween.clearTween(e.group_taskContent),Laya.Tween.to(e.group_taskContent,{alpha:0},360,null,initHandler(e,()=>{Laya.Tween.clearTween(e.group_taskContent)}))}UpdareZaiHaiScoure(){}ShowZaiHaiLevel(){}AddWeapon(){ea.scene.player.owner&&ea.scene.player.owner.transform||Ue.show("请稍后再试！");var e=100*Math.random()-50,t=100*Math.random()-50,i=e+ea.scene.player.owner.transform.position.x,s=t+ea.scene.player.owner.transform.position.z;i>500&&(i=500),i<30&&(i=30),s>500&&(s=500),s<30&&(s=30),Tn.inst.load3d.thingRes(ce.getPropUrl("20070001.lh"),ea.scene.mainscene,initHandler(this,e=>{if(e){ea.scene.mainscene.addChild(e);e.transform.localScale=new Laya.Vector3(1,1,1),e.transform.position=new Laya.Vector3(i,100,s),e.transform.rotationEuler=new Laya.Vector3(0,0,0),e.addComponent(xo)}else serror("mapThingRes加载资源失败：")}))}CancelDJ(){Laya.timer.clear(this,this.frameDaojuJD),this.box_daoju.visible=!1,this.DJnum=0}DaojuJinDu(e,t){Laya.timer.clear(this,this.frameDaojuJD),this.DJFinHandler&&this.DJFinHandler.run(),this.DJFinHandler=t,this.box_daoju.visible=!1,this.DJnum=0;var i=60*e/5;this.DJnum=400/i,this.box_daoju.visible=!0,this.img_daoju.width=400,Laya.timer.frameLoop(5,this,this.frameDaojuJD)}ExcavateJinDu(e,t){Laya.timer.clear(this,this.frameDaojuJD),this.DJFinHandler&&this.DJFinHandler.run(),this.DJFinHandler=t,this.box_daoju.visible=!1,this.DJnum=0;var i=60*e/5;this.DJnum=400/i,this.box_daoju.visible=!0,this.text_dapju.visible=!1,this.img_daoju.width=400,Laya.timer.frameLoop(5,this,this.frameDaojuJD)}frameDaojuJD(){this.img_daoju.width>0?this.img_daoju.width-=this.DJnum:(Laya.timer.clear(this,this.frameDaojuJD),this.box_daoju.visible=!1,this.DJnum=0,this.DJFinHandler&&this.DJFinHandler.run(),this.DJFinHandler=null)}getFUJinDu(e,t){if(!this.tips_box_fengyingjindu.visible){this.tips_box_fengyingjindu.visible=!0,Laya.timer.clear(this,this.frameFUJD);var i=60*e/5;this.fuMode=t,this.FuTime=this.var_selMoTime.width/i,this.img_fengyingjindumask.width=.1,Laya.timer.frameLoop(5,this,this.frameFUJD)}}frameFUJD(){be.IsOpenPanel()||(this.img_fengyingjindumask.width<189?this.img_fengyingjindumask.width+=this.FuTime:(Laya.timer.clear(this,this.frameFUJD),this.showFengYinUi(),this.tips_box_fengyingjindu.visible=!1,this.FuTime=0))}CancelFUDJ(){Laya.timer.clear(this,this.frameFUJD),this.tips_box_fengyingjindu.visible=!1,this.FuTime=0,this.fuMode=null}seleModelJinDu(e){Laya.timer.clear(this,this.frameSelModelJD2);var t=60*e/5;this.selModelJDTime=this.var_selMoTime.width/t,this.var_selMoTimeMask.visible=!0,this.var_selMoTimeMask.width=this.var_selMoTime.width,this.isgo=!0,this.curTimeToTal=e,Laya.timer.frameLoop(5,this,this.frameSelModelJD2)}frameSelModelJD2(){this.isgo&&!ea.scene.GamePause&&(this.startX+=5,this.startX%5==0&&(this.startX>=60&&(this.startX=0,this.curTimeToTal--),this.curTimeToTal<=0&&(Laya.timer.clear(this,this.frameSelModelJD2),ea.scene.player.owner.isthing||this.selModHandler(0,!1),this.selModelJDTime=0,this.box_seleModel.visible=!1),this.var_selMoTimeMask.width-=this.selModelJDTime,this.lab_selMoTimeLab.text="变身选择中"+ls.getTime(this.curTimeToTal)))}CancelFraSelModel(){Laya.timer.clear(this,this.frameSelModelJD2),this.selModelJDTime=0}deviceJinDu(e){Laya.timer.clear(this,this.frameDeviceJD),this.deviceTime=0;var t=60*e/5;this.deviceTime=this.ponponBox.width/t,this.ponponBox.visible=!0,this.ponponImg.width=0,ea.scene.player.isSaving=!0,0==Ve.game.MaoMaoGameType?this.lab_ponpon.text="驾驶中...":2==Ve.game.MaoMaoGameType&&(this.lab_ponpon.text="救援中..."),Laya.timer.frameLoop(5,this,this.frameDeviceJD)}frameDeviceJD(){be.IsOpenPanel()||(this.ponponImg.width<this.ponponBox.width?this.ponponImg.width+=this.deviceTime:(Laya.timer.clear(this,this.frameDeviceJD),this.ponponBox.visible=!1,2==Ve.game.MaoMaoGameType?Ve.game.curSaveNpc&&(cafe.event.dispatch(se.NPCXURUO,{id:Ve.game.curSaveNpc.owner.tbId,state:!1}),be.openpanel(we.EndUpPanel1),Ve.game.curSaveNpc.isDie=!1,Ve.game.curSaveNpc.ai.dikuang.visible=!1):(mi.device.unDevice(),Ve.role.selectRole(Ve.role.equip_role),cafe.event.dispatch(se.CANCELSKILL)),this.deviceTime=0))}CancelDevide(){Laya.timer.clear(this,this.frameDeviceJD),this.ponponBox.visible=!1,2==Ve.game.MaoMaoGameType?ea.scene.player.isSaving=!1:cafe.event.dispatch(se.CANCELSKILL),this.deviceTime=0}huatiFram(){ea.scene.player.ani.play(ie.ride),ea.scene.cameraCode.playXGroup.transform.rotationEuler=ea.scene.player.owner.transform.rotationEuler}recHandler(){this.clearTimer(this,this.recHandler),Lt.stopRecord(),be.openpanel(we.SharePanel)}btn_jiashi_videoHandle(){var e=this.btn_jiashi.getChildByName("img_video");e&&e.visible?yt.getInstance().showVideo(null,null,()=>{mi.device.rideDevice(),e.visible=!1;var t=i.read("DeviceNoTime");t?t+=mi.device.curRide.tb.deviceId.toString():t=mi.device.curRide.tb.deviceId.toString(),i.save("DeviceNoTime",t)}):mi.device.rideDevice()}selModHandler(e,t){var i=this,s=initHandler(i,()=>{Ve.game.curChangeModel=i.curChangeSeleModelList[e];var t=i.curChangeSeleModelList[e].split("|"),s=1;t[2]&&(s=Number(t[2])),cafe.event.dispatch(se.LOADTHING,{Id:t[0],isrole:!1,scale:s})});t?yt.getInstance().showVideo(null,null,()=>{s&&s.run()}):s&&s.run()}ondisappear(e){(new Laya.Tween).to(e,{alpha:0},2e3,null,initHandler(this,()=>{e.visible=!1}))}XiuFuAction(){var e=Ve.game.savetppoi.clone();ea.scene.player.owner.transform.position=new Laya.Vector3(e.x,e.y+.1,e.z),ea.scene.player.EndTp(),cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION)}onClickHandler(e){super.onClickHandler(e);var t=this;switch(e.target){case t.btn_RevertBlood:if(ea.scene.GamePause||Es.specialCam)return;if(Tn.inst.sound.play(Ie.id.点击按扭),pt.SpringAni(t.btn_RevertBlood,200,.9,1,1.1),this.curbloodNumber>=this.bloodMaxNumber){Ue.show("当前血量已满");break}yt.getInstance().showVideo(null,null,()=>{this.RevertBlood()});break;case t.btn_music1:if(ea.scene.GamePause||this.correctIndex<0)return;Tn.inst.sound.play(Ie.id.点击按扭),this.CheckMusicCorrect(this.btn_music1,0);break;case t.btn_music2:if(ea.scene.GamePause||this.correctIndex<0)return;Tn.inst.sound.play(Ie.id.点击按扭),this.CheckMusicCorrect(this.btn_music2,1);break;case t.btn_music3:if(ea.scene.GamePause||this.correctIndex<0)return;Tn.inst.sound.play(Ie.id.点击按扭),this.CheckMusicCorrect(this.btn_music3,2);break;case t.btn_music4:if(ea.scene.GamePause||this.correctIndex<0)return;Tn.inst.sound.play(Ie.id.点击按扭),this.CheckMusicCorrect(this.btn_music4,3);break;case t.img_zhuaBuTip:t.img_zhuaBuTip.visible&&(t.img_zhuaBuTip.visible=!1,t.group_content.mouseEnabled=!1);break;case t.btn_banqi:if(!Ve.game.banyunowner)return;ea.scene.GamePause=!0,t.btn_banqi.visible=!1,ea.scene.ui.ui_skill4.visible=!1,Laya.timer.once(550,t,()=>{ea.scene.GamePause=!1}),ie.run="ju_run",ie.idle="ju_idle";var s=ea.scene.player.owner;ea.scene.player.playAni("ju"),Laya.timer.once(534,t,()=>{ea.scene.player.playAni("ju_idle")}),Laya.timer.once(533,t,()=>{Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(t,e=>{e.transform.position=new Laya.Vector3(Ve.game.banyunowner.transform.position.x,Ve.game.banyunowner.transform.position.y+1,Ve.game.banyunowner.transform.position.z)})),Ve.game.juzheowner=Ve.game.banyunowner;var e=s.transform.localPosition;Ve.game.juzheowner.transform.position=new Laya.Vector3(e.x,e.y,e.z),Ve.game.banyunowner=null,Laya.timer.once(100,t,()=>{t.btn_fangxia.visible=!0})});break;case t.btn_fangxia:ea.scene.GamePause=!0,t.btn_fangxia.visible=!1,Laya.timer.once(550,t,()=>{ea.scene.GamePause=!1}),ie.run="run",ie.idle="idle",ea.scene.player.playAni("fangxia"),Laya.timer.once(534,t,()=>{ea.scene.player.playAni("idle")});s=ea.scene.player.owner;var n=Xe.getBody(ea.scene.player.owner,"banyun_sprite").transform.position.clone();Laya.timer.once(533,t,()=>{Tn.inst.load3d.res(ce.d3res+Ce.res_dic[Ce.res_enum._prop_effect_33006_lh],ea.scene.mainscene.getChildByName("map"),1,null,initHandler(t,e=>{e.transform.position=new Laya.Vector3(n.x,n.y+1,n.z)})),Ve.game.juzheowner.transform.localRotationEuler=s.transform.localRotationEuler,Ve.game.juzheowner.transform.position=new Laya.Vector3(n.x,n.y,n.z),Ve.game.juzheowner=null}),Laya.timer.once(650,t,()=>{null==Ve.game.juzheowner&&(ea.scene.ui.ui_skill4.visible=!0)});break;case t.btn_xiufu:if(ea.scene.GamePause||Es.specialCam)return;if(pt.SpringAni(t.btn_xiufu,200,.9,1,1.1),!Ve.game.savetppoi)return cafe.event.dispatch(ge.game.STOP_GRAVITY_ACTION),cafe.event.dispatch(se.CANCELSKILL),void ta.toTrBy9G(ea.scene.player.owner,Ve.map.mptData.initPoint);if(mi.device.currentMountGear)return mi.device.unDevice(),void Laya.timer.once(200,t,()=>{t.XiuFuAction()});t.XiuFuAction();break;case t.btn_shopItemView:Tn.inst.sound.play(Ie.id.点击按扭),Ve.game.shopdelaytime=ea.scene.ui.lab_gameTime.text,ea.scene.player.ClearTrigger(),ea.scene.GamePause=!0,Ve.map.map=a.map.getTbBymap(2001),Ve.game.MaoMaoGameType=Ve.map.map.gametype;var o=initHandler(t,()=>{Js.map.runWith([2001,1001])});be.openpanel(Ve.shop.ShopPanel,{handler:o});break;case t.btn_openMap:Tn.inst.sound.play(Ie.id.点击按扭),t.btn_openMap.disabled=!0,mi.device.unDevice(),ea.scene.GamePause=!0,ea.scene.ui.lab_daojishi.visible=!1,be.openpanel(Ve.shop.ShopPanel);break;case t.btn_jilij:if(ea.scene.GamePause||Es.specialCam)return;if(mi.device.currentMountGear)return void Ue.show("当前状态无法执行此操作");yt.getInstance().showVideo(null,null,()=>{Ve.shop.noMoneyBuyShop(10003),Ve.shop.useRoleShop(10300),Ve.role.equip_role=10300,cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),t.ondisappear(t.btn_jilij),ea.scene.GamePause=!1},()=>{ea.scene.GamePause=!1,t.btn_jilij.disabled=!1});break;case t.btn_jiliz:if(ea.scene.GamePause||Es.specialCam)return;if(mi.device.currentMountGear)return void Ue.show("当前状态无法执行此操作");yt.getInstance().showVideo(null,null,()=>{var e=Ve.shop.getShopListByType(5);ea.drop.dropequip.onRunHandler(e[2].tb,null),t.ondisappear(t.btn_jiliz),ea.scene.GamePause=!1},()=>{ea.scene.GamePause=!1});break;case t.btn_fengyin:if(Ve.game.monsterStop)return;Ve.game.monsterStop=!0;var r=Ve.map.mptData.mptModel[J.ROLE].things;for(let e=0;e<r.length;e++){if(r[e].getComponent(ks)){cafe.event.dispatch(se.MONSTERFENGYING);break}}break;case t.btn_moneyChangeModel:t.moneyRandSeleModel();break;case t.btn_selMoChange:t.CancelFraSelModel(),t.showSeleModelBox(),t.btn_selMoChange.visible=!1;break;case t.btn_selModel1:t.selModHandler(0,!1);break;case t.btn_selModel2:t.selModHandler(1,!0);break;case t.btn_selModel3:t.selModHandler(2,!0);break;case t.btn_changeCam:var l=t.btn_changeCam.getChildAt(0),h=t.btn_changeCam.getChildAt(1);l.visible?(t.ui_skill6.visible=!1,t.btn_moneyChangeModel.visible=!1,cafe.event.dispatch(se.CHANGECAMERA)):(ea.scene.player&&ea.scene.player.owner&&8!=Ve.map.map.gamePkType&&(1==ea.scene.player.owner.isthing?t.ui_skill6.visible=!0:0==ea.scene.player.owner.isthing&&(t.ui_skill6.visible=!0)),t.btn_moneyChangeModel.visible=!0,ea.scene.cameraCode.lockTarget=ea.scene.player.owner,ea.scene.cameraCode.initOnePlay2()),l.visible=!l.visible,h.visible=!h.visible;break;case t.btn_firestran:t.firestRange.visible=!1;break;case t.btn_guidesteering:t.firestSteer.visible=!1;break;case t.btn_pon:"1"!=i.read("firstPon")&&(i.save("firstPon","1"),t.firstPon.visible=!1),Tn.inst.sound.play(Ie.id.点击按扭),ea.car.localridepopoc(70039),cafe.event.dispatch(se.PONPONCHE,!0),t.ponponBox.visible=!0,t.ponponImg.width=200;break;case t.taskShow:break;case t.btn_prase:if(Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.isGameEnd)return;if(ea.scene.GamePause||Es.specialCam)return;be.openpanel(we.PausePanel);break;case t.btn_huati:var c=ea.scene.player;if(c&&c.moveTrigger&&c.moveTrigger.isTrigger&&c.moveTrigger.kinematics[0]){var d=c.moveTrigger.kinematics[0];if("huati"==d.name){ea.scene.player.ani.play(ie.ride),ea.scene.GamePause=!0,ea.scene.ui.btn_huati.visible=!1;var u=Xe.getBody(d.main,"huatinode"),p=Xe.getBody(d.main,"bodypoi");p&&(t.huatipoi=p),Ye.add(1,t,t.huatiFram),p.addChild(ea.scene.player.owner),ea.scene.player.owner.transform.localPosition=new Laya.Vector3(0,0,0),ea.scene.player.owner.transform.localRotationEuler=new Laya.Vector3(0,0,0);var m=u.getComponent(Laya.Animator);m&&(setTimeout(()=>{m.play("hua")},900),setTimeout(()=>{Ye.remove(t,t.huatiFram),ea.scene.mainscene.getChildByName("map").addChild(ea.scene.player.owner),ea.scene.player.owner.transform.position=p.transform.position.clone(),t.huatipoi=null,cafe.event.dispatch(ge.game.ROLE_MOD_REPLACE_FINISH,0),ea.scene.GamePause=!1},2e3))}}break;case t.btn_music:if(0==Ve.game.musicData)return;i.read("firstSelectMusic")||(i.save("firstSelectMusic","1"),this.firstSelectMusic.visible=!1),null!=this.musicBoxSound&&this.musicBoxSound.stop(),this.musicBoxSound=Tn.inst.sound.play(Ve.game.musicData);break;case t.btn_tipNpc:if(Tn.inst.sound.play(Ie.id.点击按扭),Ve.game.GuideModel)return void Ue.show("请先完成新手教程");yt.getInstance().showVideo(null,null,()=>{var e=Ve.map.mptData.mptModel[J.ROLE].things,t=[];for(let n=0;n<e.length;n++){var i=e[n].getComponent(fs);if(i||n==e.length-1){if(i){var s=i.bianshenmodel;if(s&&null==s.parent){console.log(i);continue}t.push(e[n])}if(n==e.length-1&&t.length>0){var a=t[Math.floor(Math.random()*t.length)];Ve.game.TipsNpc=a,ri.showModel()}}else 0}});break;case t.btn_hall:We.openscene(we.HallScene).start();break;case t.btn_jiashi:Tn.inst.sound.play(Ie.id.点击按扭);t.btn_jiashi.getChildByName("ui_moneybar"),t.btn_jiashi.getChildByName("img_video");mi.device.currentMountGear?mi.device.unDevice():t.btn_jiashi_videoHandle();break;case t.btn_task2:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.TaskSuccessPanel);break;case t.btn_leaveMiniGame:Tn.inst.sound.play(Ie.id.点击按扭),Ve.game.isSaiChe&&(mi.device.currentMountGear&&!Ve.game.DontDelCar?mi.device.unDevice():(Ve.game.isSaiChe=!1,mi.device.currentMountGear.transform.position=Ve.game.ChuShiPos.clone(),Ve.game.DontDelCar=!1),ea.scene.ui.getComponent(hs).end()),Ve.game.isPaoKu&&(ea.scene.player.owner.transform.position=Ve.game.ChuShiPos.clone(),Ve.game.isPaoKu=!1,ea.scene.ui.getComponent(hs).end(),ea.scene.ui.btn_leaveMiniGame.visible=!1),t.btn_leaveMiniGame.visible=!1}}onResize(){ea.scene.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}handleGuideTransition(){var e=this;mi.plot.isplotwork||ea.scene.player&&(1!=e.GuideLevel||be.IsOpenPanel()?2!=e.GuideLevel||be.IsOpenPanel()?3==e.GuideLevel&&be.IsOpenPanel():Dt.showGuide({setup:2,target:e.ui_skill1,handler:initHandler(e,()=>{Tn.inst.sound.play(Ie.id.点击按扭),e.GuideLevel++,e.handleGuideTransition()})}):Dt.showGuide({setup:1,target:e.v_steering.box_group,handler:initHandler(e,()=>{Tn.inst.sound.play(Ie.id.点击按扭),e.GuideLevel++,e.handleGuideTransition()})}))}InitTaskProgress(){this.taskProgressCurNumber=0,this.img_taskProgress.width=1,this.yinghuaTaskPosX=this.yinghuaTask.x}addTaskProgress(){var e=this;e.taskProgressCurNumber++,e.taskProgressCurNumber>e.taskProgressNumber&&(e.taskProgressCurNumber=e.taskProgressNumber);var t=Math.ceil(e.taskWidth/e.taskProgressNumber)*e.taskProgressCurNumber,i=e.yinghuaTaskPosX+t;Laya.Tween.clearAll(e.img_taskProgress),Laya.Tween.to(e.img_taskProgress,{width:t},2e3,Laya.Ease.strongOut,initHandler(e,()=>{Laya.Tween.clearAll(e.img_taskProgress)})),Laya.Tween.clearAll(e.yinghuaTask),Laya.Tween.to(e.yinghuaTask,{x:i},2e3,Laya.Ease.strongOut,initHandler(e,()=>{Laya.Tween.clearAll(e.yinghuaTask)}))}TipsTween(){var e=this;Laya.Tween.clearAll(e.img_Tips),e.img_Tips.visible=!0,e.text_Tips1.text=Ve.map.map.mapName,5==Ve.map.map.gamePkType?e.text_Tips2.text="左边是你的视角哦！":e.text_Tips2.text=Ve.map.map.mapTips,Laya.Tween.to(e.img_Tips,{x:0},1e3,Laya.Ease.backInOut,initHandler(e,()=>{Laya.timer.once(5e3,this,()=>{e.img_Tips.x=-100650}),Laya.Tween.clearAll(e.img_Tips)}))}SuoQuanMusicPlay(e){this.box_music.visible=!0,this.isPress=!1,this.correctIndex=cs.RandomInt(0,3),this.imageIndexs=cs.GetUniqueRandomNumbersBeyValue(16002,16016,3,e),console.log("随机数："+this.correctIndex),console.log("初始数组："+this.imageIndexs),this.imageIndexs.splice(this.correctIndex,0,e),console.log("改变后数组："+this.imageIndexs),this.SetMusicImage(),this.sk_djs.visible=!0,pt.SpringAni(this.box_music,200,0,1,1.2,initHandler(this,()=>{this._music=Tn.inst.sound.play(e,1,new Laya.Handler(this,()=>{this.sk_djs.visible=!1}))}))}ZhengQueAni(){this.img_zq.visible=!0,Tn.inst.sound.play(Ie.id.回答正确音效),pt.SpringAni(this.img_zq,200,0,1,1.1,initHandler(this,()=>{Laya.timer.once(1e3,this,()=>{pt.SpringAni(this.img_zq,200,1,0,1.1,initHandler(this,()=>{this.img_zq.visible=!1}))})}))}CuoWuAni(){this.img_cw.visible=!0,Tn.inst.sound.play(Ie.id.回答错误音效),pt.SpringAni(this.img_cw,200,0,1,1.1,initHandler(this,()=>{Laya.timer.once(1e3,this,()=>{pt.SpringAni(this.img_cw,200,1,0,1.1,initHandler(this,()=>{this.img_cw.visible=!1}))})}))}FailureAnim(){this.img_sb.visible=!0,Tn.inst.sound.play(Ie.id.回答错误音效),pt.SpringAni(this.img_sb,200,0,1,1.1,initHandler(this,()=>{Laya.timer.once(1e3,this,()=>{pt.SpringAni(this.img_sb,200,1,0,1.1,initHandler(this,()=>{this.img_sb.visible=!1}))})}))}CheckMusicCorrect(e,t){this.isPress||(this.isPress=!0,pt.SpringAni(e,200,.9,1,1.1,initHandler(this,()=>{this.correctIndex==t?(this.ZhengQueAni(),cafe.event.dispatch(se.SUOQUAN_MUSIC_QUESTION,!0)):(this.CuoWuAni(),cafe.event.dispatch(se.SUOQUAN_MUSIC_QUESTION,!1)),this.SuoQuanMusicStop()})))}SetMusicImage(){this.imageIndexs.length<4||(this.btn_music1.skin="res/icon/music/"+this.imageIndexs[0]+".png",this.btn_music2.skin="res/icon/music/"+this.imageIndexs[1]+".png",this.btn_music3.skin="res/icon/music/"+this.imageIndexs[2]+".png",this.btn_music4.skin="res/icon/music/"+this.imageIndexs[3]+".png")}SuoQuanMusicStop(){this.correctIndex=-1,this.imageIndexs=[],this.sk_djs.visible=!1,this._music&&this._music.stop(),pt.SpringAni(this.box_music,200,1,0,1.2,initHandler(this,()=>{this.box_music.visible=!1}))}PkBloodInit(){this.bloodMaxNumber=3,this.curbloodNumber=this.bloodMaxNumber,this.UpdataBloodUI()}UpdataBloodUI(){for(let e=0;e<this.bloodMaxNumber;e++){this.box_pkBlood.getChildByName("box_blood").getChildAt(e).getChildByName("blood").visible=e<this.curbloodNumber}}SetBlood(e){this.curbloodNumber=cs.Ranege(0,this.bloodMaxNumber,e),this.UpdataBloodUI()}GetBlood(){return this.curbloodNumber}SpawnHealth(e=1){var t=this.curbloodNumber+e,i=this.curbloodNumber;this.SetBlood(t);for(let e=this.curbloodNumber;e>i;e--){let t=this.box_pkBlood.getChildByName("box_blood").getChildAt(e-1).getChildByName("blood");t.alpha=1,pt.SpringAni(t,200,.8,1,1.2)}}SubtractBlood(e=1){if(!this.invincible){Tn.inst.sound.play(Ie.id.回答错误音效),Ue.show("血量减少");var t=this.curbloodNumber-e,i=this.curbloodNumber;this.SetBlood(t),this.CheckBloodZero();for(let e=this.curbloodNumber;e<i;e++){let t=this.box_pkBlood.getChildByName("box_blood").getChildAt(e).getChildByName("blood");t.visible=!0,pt.FlickerEffect(t,500,2,Laya.Handler.create(this,()=>{t.visible=!1}))}this.invincible=!0,setTimeout(()=>{this.invincible=!1},500)}}CheckBloodZero(){this.curbloodNumber<=0&&(ea.scene.GamePause=!0,ea.scene.ui.FailureAnim(),setTimeout(()=>{be.openpanel(we.EndLostPanel)},1500))}RevertBlood(){this.SpawnHealth(this.bloodMaxNumber)}onDisable(){super.onDisable()}onDestroy(){Laya.timer.clearAll(this)}}class Io extends Ee.res.modules.game.GameSceneUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable(),ea.scene.install(this),this.monitor(ge.game.LOAD_END_SHOW_UI,this.onShowUi)}onShowUi(){this.mainui=new Eo,this.addChild(this.mainui),ea.scene.installUi(this.mainui)}onDisable(){ea.scene.dispose(),super.onDisable()}}class Co extends Ee.res.modules.game.panel.GoldPanelUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable(),this.addClick(this.addGold),this.addClick(this.btn_close),ea.scene.GamePause=!0,this.addGold.disabled=!1,pt.SpringAni(this.btn_close,200),pt.SpringAni(this.img_gold,200),pt.SpringAni(this.addGold,200,0,1,1.2,initHandler(this,()=>{pt.BreathEffect(this.addGold)}))}onClickHandler(e){switch(e.target){case this.addGold:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1,this.addGold.disabled=!0,yt.getInstance().showVideo(null,null,()=>{Ve.user.addGold(5e3)}),be.closepanel(we.GoldPanel);break;case this.btn_close:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1,this.addGold.disabled=!0,be.closepanel(we.GoldPanel)}}onDisable(){super.onDisable()}}class Lo extends Ee.res.modules.game.panel.RoleTrialPanelUI{constructor(){super(),this._translate=new Laya.Vector3(0,.1,0),this._translate2=new Laya.Vector3(0,1,1),this._rotation=new Laya.Vector3(0,0,0),this.id=0;this.addCom(this,fe)}onEnable(){super.onEnable(),this.createMapScene(),this.addClick(this.btn_startGame),this.addClick(this.btn_shiyong),ea.scene.GamePause=!0,pt.BreathEffect(this.btn_shiyong)}createMapScene(){let e=this;var t,i,s=cs.RandomInt(0,1);if(console.log("随机数："+s),t=Ve.shop.getShopListByType(3),e.selectRoleId=t[t.length-1].tb.targetId,0==s&&(e.selectRoleId=t[t.length-2].tb.targetId),0!=Ve.game.getrole&&(e.id=Ve.game.getrole),console.log("初始化场景"),0==_e.getLayer(14).numChildren){i=new Laya.Scene3D,_e.getLayer(14).addChild(i),i.ambientMode=Laya.AmbientMode.SolidColor,i.ambientColor=new Laya.Vector3(.6,.6,.6);var n=i.addChild(new Laya.DirectionLight);n.color=new Laya.Vector3(.6,.6,.6),n.transform.worldMatrix.setForward(new Laya.Vector3(0,0,-1)),n.intensity=1,window.conchConfig&&-1!=window.conchConfig.getOS().indexOf("android")&&(i.ambientColor=new Laya.Vector3(1,1,1)),Laya.Scene3D.octreeCulling=!0;var o=i.addChild(new Laya.Camera(0,.1,1e3));o.transform.rotate(e._rotation,!1,!1),o.transform.translate(e._translate2),o.orthographic=!0,o.clearFlag=Laya.CameraClearFlags.SolidColor,Laya.Material.load("res/res3D/Assets/Mesh/BG/Sky2.lmat",initHandler(this,function(e){e.textureCube&&(i.customReflection=e.textureCube)})),o.clearColor=new Laya.Vector4(0,0,0,0),e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),o.renderTarget=e.cameraTexture,o.orthographicVerticalSize=Ve.role.getCurrRole().tb.cameraScale}else{if(i=_e.getLayer(14).getChildAt(0),0!=Ve.game.getrole){console.log("dts.game.getrole2 "+Ve.game.getrole);var r=i.getChildByName(Ve.game.getrole.toString());r&&(r.active=!1),Ve.game.getrole=0}i.active=!0;var l=Ve.role.getInfoByRoleId(e.selectRoleId).tb.roleMod,h=i.getChildByName(l);if(Ve.game.getrole=Number(l),Ve.game.currole=Ve.game.getrole,e.maincamera=i.getChildAt(1),e.maincamera.orthographicVerticalSize=Ve.role.getCurrRole().tb.cameraScale,e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),e.maincamera.renderTarget=e.cameraTexture,null!=h){h.active=!0,e._layaMonkey=h,e._layaMonkey&&(e._layaMonkey.active=!0);var c=a.shop.getTbByTargetId(e.selectRoleId);return e.lab_juesename.text=c.shopName,e.qualityListShow(c.quality),e.starListShow(c.quality),void(e.rolerenderNode.source=new Laya.Texture(e.cameraTexture))}slog["找不到_layaMonkey节点"]}l=Ve.role.getInfoByRoleId(e.selectRoleId).tb.roleMod;Ve.game.getrole=Number(l),Ve.game.currole=Ve.game.getrole;c=a.shop.getTbByTargetId(e.selectRoleId);e.lab_juesename.text=c.shopName,e.qualityListShow(c.quality),e.starListShow(c.quality),e._layaMonkey&&(e._layaMonkey.active=!1),Tn.inst.load3d.thingRes("res/res3D/role/"+l+".lh",i,Laya.Handler.create(e,function(t){i.addChild(t),e._layaMonkey=t;var s=t.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate,a.setValue(1,1,1),s.localScale=a,n.setValue(0,0,0),s.rotationEuler=n,e.rolerenderNode.source=new Laya.Texture(e.cameraTexture)}))}onClickHandler(e){var t=this;switch(e.target){case t.btn_startGame:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1,0!=t.id&&(Ve.game.currole=t.id),_e.getLayer(14).getChildAt(0).active=!1,be.closepanel(we.RoleTrialPanel);break;case t.btn_shiyong:Tn.inst.sound.play(Ie.id.点击按扭),ea.scene.GamePause=!1,_e.getLayer(14).getChildAt(0).active=!1,yt.getInstance().showVideo(null,null,()=>{Ve.role.equip_role=t.selectRoleId,be.closepanel(we.RoleTrialPanel),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF)})}}qualityListShow(e){for(var t=0;t<this.qualityBox.numChildren;t++){var i=this.qualityBox.getChildAt(t);i.visible=!1,t+1==e&&(i.visible=!0)}}starListShow(e){for(var t=0;t<this.starBox.numChildren;t++){var i=this.starBox.getChildAt(t);i.visible=!0,t+1>e&&(i.visible=!1)}}onDisable(){this.cameraTexture.destroy(),super.onDisable()}}class Mo extends Ee.res.modules.game.view.TaskArrowViewUI{constructor(){super(...arguments),this.thingHeight=.02}static show(e){var t=new Mo;t.info=e,_e.getLayer(1).addChild(t),Mo.map[e.taskId]=t}static hideAll(){for(var e in Mo.map){var t=Mo.map[e];t.removeSelf(),t.destroy(),t=null}Mo.map={}}static hide(e){var t=Mo.map[e.taskId];t&&(t.removeSelf(),t.destroy()),delete Mo.map[e.taskId]}onEnable(){super.onEnable(),this.frameLoop(1,this,this.onFrame)}onFrame(){if(ea.scene.camera&&ea.scene.mainscene&&oi.singleton.mptData&&ea.scene.player&&ea.scene.player.owner){this.tigger||(this.tigger=oi.singleton.mptData.fetchTaskTrigger(this.info));var e,t,i=ea.scene.player.owner.transform.position;if(this.tigger&&this.tigger.transform)e=this.tigger.transform.position.clone();else{for(var s,a=this.info.tb.taskTargetId.split("|"),n=0;n<a.length;n++)for(var o=ia.getThingListById(Number(a[n]),J.ROLE,le.type_wznpc),r=0;r<o.length;r++){var l=o[r];if(l&&l.transform){var h=l.transform.position.clone(),c=getDistance({x:i.x,y:i.z},{x:h.x,y:h.z});s?c==(s=Math.min(s,c))&&(t=l):(s=c,t=l)}}if(!t)return;e=t.transform.position.clone()}this.p=getATBNextDistance({x:i.x,y:i.z},{x:e.x,y:e.z},.2);var d=getDistance({x:i.x,y:i.z},{x:e.x,y:e.z}),u=calcPosAngle({x:i.x,y:i.z},{x:e.x,y:e.z},!0);this.txt_d.text=Math.round(d)+"米",this.img_arrow.rotation=ea.scene.camera.transform.rotationEuler.y+u;let p=new Laya.Vector3(this.p.x,i.y,this.p.y);p.y+=this.thingHeight;let m=new Laya.Vector4(0,0,0,0);ea.scene.camera.viewport.project(p,ea.scene.camera.projectionViewMatrix,m),m.w>=0?(this.visible=!0,this.pos(m.x/Laya.stage.clientScaleX-100,m.y/Laya.stage.clientScaleY)):this.visible=!1}}onDestroy(){super.onDestroy()}}Mo.map={};class So extends it{constructor(){super()}onEnable(){ea.scene.isGuide=!0,this.owner._param&&(this.handler=this.owner._param.handler);this.owner.img_icon;this.addClick(this.owner),this.addCom(this.owner.txt_click,li).playhuxi()}onClickHandler(){be.closepanel(this.owner.name),ea.scene.isGuide=!1,this.handler&&this.handler.run()}onDestroy(){super.onDestroy()}}class Po extends it{constructor(){super(),this.setup=0}onEnable(){Lt.reportEnter(6),ea.scene.isGuide=!0,this.owner._param&&(this.handler=this.owner._param.handler),this.owner["setup_"+this.setup].visible=!0,this.addClick(this.owner),this.addCom(this.owner.txt_click,li).playhuxi()}nextSetup(){this.owner["setup_"+this.setup].visible=!1,this.setup++,this.owner["setup_"+this.setup]?this.owner["setup_"+this.setup].visible=!0:(be.closepanel(this.owner.name),ea.scene.isGuide=!1,this.handler&&this.handler.run())}onClickHandler(){this.nextSetup()}onDestroy(){super.onDestroy()}}class Ro extends Ee.res.modules.hall.hallListItemViewUI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this.box_hall)}onClickHandler(e){var t=this;t.info&&(t.img_suo.visible?yt.getInstance().showVideo(null,null,()=>{t.img_suo.visible=!1,Ve.game.locklv.push(t.info.levelId),Ve.game.saveLevelData()}):t.enterGame())}enterGame(){this.info&&(Ve.game.curlv||(Ve.game.curlv=this.info.levelId),Ve.game.MaoMaoGameType=this.info.gametype,Ve.map.map=a.map.getTbBymap(this.info.mapId),Js.map.runWith([this.info.mapId,1001]),Ve.role.selectRole(this.info.selerole))}setDataChange(e){if(this.info=e,Tn.inst.setImageIcon(this.img_icon,"localImg/"+this.info.iconId+".png"),-1!=Ve.game.locklv.indexOf(this.info.levelId)||0==this.info.defaultlock?this.img_suo.visible=!1:this.img_suo.visible=!0,Ve.game.locklv.length>0&&Ve.game.locklv.length!=a.map.getTbByType(2).length){var t=Ve.game.locklv[Ve.game.locklv.length-1];this.finger.visible=t==this.info.levelId}}onDestroy(){super.onDestroy()}}class Do extends Ee.res.modules.hall.HallSceneUI{constructor(){super(),this.isdispose=!1,this.m_curLv=0;this.addCom(this,fe)}onEnable(){super.onEnable(),ea.hall.scene=this,Lt.reportEnter(2),Js.init(this),this.bin(qn.NAME,this.onUserDataChange,qn.RESOURCE_RES),this.bin(En.NAME,this.onLevelDataChange),this.bin(eo.NAME,this.onSignInDataChange,eo.STAGE_RES),be.hideloadding(),Ve.game.mission_id=Ve.level.select_id,this.binGuide(),this.onResize(),this.AddClick(),this.GameLobbyActon(),Tn.inst.sound.play(11003)}AddClick(){this.addClick(this.btn_addGold),this.addClick(this.btn_startGame)}GameLobbyActon(){this.m_curLv=0;var e=a.map.getTbByGamePkType(2);0!=e.length?this.m_curLv=e[0].mapId:be.openpanel(Ve.shop.ShopPanel)}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}onLevelDataChange(){}onSignInDataChange(){}onUserDataChange(){}onClickHandler(e){switch(e.target){case this.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.GoldPanel);break;case this.btn_startGame:Ve.map.map=a.map.getTbBymap(this.m_curLv),Ve.game.MaoMaoGameType=Ve.map.map.gametype,Ve.role.selectRole(Ve.map.map.selerole),be.closepanel(we.HallScene),Js.map.runWith([this.m_curLv,1001])}}onDisable(){this.isdispose||(this.isdispose=!0,Laya.Tween.clearAll(this),ea.hall.scene=null,super.onDisable())}}class No extends Ee.res.modules.login.LoginSceneUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable(),_e.dispose(),_e.setStage(Laya.stage,[1,2,4,9,7,8]),this.addClick(this.btn_login),this.addClick(this.btn_deldb),this.addClick(this.btn_getdb);var e=i.read("user");null!=e&&""!=e&&(this.inp_userid.text=e)}onClickHandler(e){if(super.onClickHandler(e),!this.isLock){switch(e.target){case this.btn_login:var t=this.inp_userid.text;if(t=t.replace(/\ /g,""),""==this.inp_userid.text)return void Ue.show("用户名不能为空");Ve.user.login(this.inp_userid.text),We.openscene(we.HallScene).then(e=>{}).start();break;case this.btn_deldb:case this.btn_getdb:}}}onDisable(){super.onDisable()}}class jo extends it{constructor(){super()}onEnable(){super.onEnable();this.owner.btn_close&&this.addClick(this.owner.btn_close)}onClickHandler(e){switch(e.target){case this.owner.btn_close:Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(this.owner.name)}}onDestroy(){super.onDestroy()}}class Go{}Go.TAB_SELECT="TAB_SELECT",Go.TAB_SELECT_LABEL="TAB_SELECT_LABEL";class Bo extends it{constructor(){super();this._index=0}onEnable(){super.onEnable();for(var e=this.tab.numChildren,t=0;t<e;t++){var i=this.tab.getChildAt(t);this.addClick(i)}this.index=0}set index(e){for(var t=0;t<this.tab.numChildren;t++){(i=this.tab.getChildAt(t)).selected=e==t}this._index=e,this.owner.event(Go.TAB_SELECT,this._index);var i=this.tab.getChildAt(this._index);this.owner.event(Go.TAB_SELECT_LABEL,i.name)}get index(){return this._index}onClickHandler(e){var t=this.tab.getChildIndex(e.target);this.index=t}onDestroy(){super.onDestroy();this.tab&&(this.tab=null),this.content&&(this.content=null)}}class Ho extends Ee.res.modules.main.MainPanelUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable(),this.addCom(this,jo),this.tab=this.getComponent(Bo),this.layaMonitor(Go.TAB_SELECT,this.onSelectHandler,this),this.layaMonitor(Go.TAB_SELECT_LABEL,this.onSelectHandler,this)}onSelectHandler(e){slog("onSelectHandler:",e)}onSelectLabelHandler(e){slog("onSelectLabelHandler:",e)}onDisable(){super.onDisable()}}class Oo extends Ee.res.modules.pause.PausePanelUI{constructor(){super(),this.isClick=!1;this.addCom(this,fe)}onEnable(){super.onEnable(),setTimeout(()=>{yt.getInstance().showCustomAd(5)},300),ea.scene.GamePause=!0,cafe.event.dispatch(se.GAME_PRASE_SOUND,0),Tn.inst.sound.play(0),Tn.inst.sound.play(Ie.id.暂停),cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!0),this.addClick(this.btn_continue),this.addClick(this.btn_close),this.addClick(this.btn_home),this.addClick(this.btn_sound),this.soundSelected(1==Ve.setting.isSound),yt.getInstance().showInsertAd()}soundSelected(e){this.soundKey=e,this.btn_sound.getChildAt(0).visible=!e,this.btn_sound.getChildAt(1).visible=e}onClickHandler(e){switch(e.target){case this.btn_continue:Tn.inst.sound.play(Ie.id.点击按扭),this.isClick=!0,ea.scene.GamePause=!1,be.closepanel(this.name),cafe.event.dispatch(se.GAME_PRASE_SOUND,1),cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!1),cafe.event.dispatch(se.GAME_TASK_REF);var t=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(t.music);break;case this.btn_home:Tn.inst.sound.play(Ie.id.点击按扭),this.BackHome();break;case this.btn_close:Tn.inst.sound.play(Ie.id.点击按扭),this.isClick=!0,ea.scene.GamePause=!1,be.closepanel(this.name),cafe.event.dispatch(se.GAME_PRASE_SOUND,1),cafe.event.dispatch(se.GAME_CD_TIMER_PRASE,!1),cafe.event.dispatch(se.GAME_TASK_REF);t=a.map.getTbBymap(Ve.map.mapId);Tn.inst.sound.play(t.music);break;case this.btn_sound:Tn.inst.sound.play(Ie.id.点击按扭),this.soundKey=!this.soundKey,this.soundSelected(this.soundKey),Ve.setting.switchSound(this.soundKey)}}BackHome(){if(Ve.game.maomaoLVint(),cafe.event.dispatch(se.GAME_PRASE_SOUND,1),Ve.game.pkLvInt(),be.closepanel(we.PausePanel),We.closescene(we.GameScene),Ve.map.map=a.map.getTbBymap(2001),Ve.game.MaoMaoGameType=Ve.map.map.gametype,this.IsGameLobby())Js.map.runWith([2002,1001]);else{var e=initHandler(this,()=>{Js.map.runWith([2001,1001])});be.openpanel(Ve.shop.ShopPanel,{handler:e})}}IsGameLobby(){return 0!=a.map.getTbByGamePkType(2).length}onDisable(){ea.scene.GamePause=!1,super.onDisable()}}class zo extends Ee.res.modules.plot.TalkViewUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable();var e;if(this._param&&(this.info=this._param.info,this.handler=this._param.handler),this.box_1.visible=1==this.info.dir,this.box_2.visible=2==this.info.dir,null!=this.info.rewardCharm){var t=this.info.rewardCharm.split("|");t[0]&&(this.reward1=Number(t[0])),t[1]&&(this.reward2=Number(t[1])),t[2]&&(this.reward3=Number(t[2]))}switch(this.currbox=this["box_"+this.info.dir],this.txt_name=this.currbox.getChildByName("box_name").getChildByName("txt_name"),this.txt_name.text=this.info.name,this.img_head=this.currbox.getChildByName("img_icon"),Math.floor(this.info.resId%1e4/1e3)){case 4:default:e=this.info.resId.toString()}99999==this.info.resId?this.img_head.visible=!1:this.img_head.visible=!0,Tn.inst.setImageIcon(this.img_head,"res/icon/head/"+e+".png"),this.txt_content=this.currbox.getChildByName("txt_content");var i=this.info.txt.split("|"),s=this.info.selectTxt.split("|");if(2==this.info.dir)return i.length>1&&Ve.game.curSelectNum>=0?this.txt_content.text=i[Ve.game.curSelectNum]:this.txt_content.text=this.info.txt,this.addClick(this),void this.addClick(this.group_bottom);i.length>1&&Ve.game.curSelectNum>=0?this.txt_content.text=i[Ve.game.curSelectNum]:this.txt_content.text=this.info.txt,s.length>1&&""!=s[0]?this.btn_action.getChildAt(0).text=s[0]:this.btn_action.visible=!1,s.length>1&&""!=s[1]?this.btn_fuse.getChildAt(0).text=s[1]:this.btn_fuse.visible=!1,s.length>1&&""!=s[2]?this.btn_tiaojian.getChildAt(0).text=s[2]:this.btn_tiaojian.visible=!1,Ve.game.getCharm()<this.info.needCharm?(this.img_lock.visible=!0,this.lab_requestCharm.text=this.info.needCharm.toString()):(this.img_lock.visible=!1,this.btn_tiaojian.getChildAt(0).getChildAt(1).visible=!1),this.addClick(this.btn_action),this.addClick(this.btn_fuse),this.addClick(this.btn_tiaojian),ea.scene.GamePause=!0}onClickHandler(e){switch(e.target){case this:case this.group_bottom:Rt.closeview(this.name),this.handler&&this.handler.run(),this.info.txt.split("|").length<2&&(Ve.game.curSelectNum=-1);break;case this.btn_action:if(Rt.closeview(this.name),Ve.game.curSelectNum=0,this.handler&&this.handler.run(),this.reward1&&this.reward1>0){var t=a.task.getTbByTaskPlot(this.info.plotGroup.toString());Ve.game.setRoleHaoGanByNPCID(t.taskTargetNpcId,this.reward1),this.reward1=0}break;case this.btn_fuse:if(Rt.closeview(this.name),Ve.game.curSelectNum=1,this.handler&&this.handler.run(),this.reward2&&this.reward2>0){t=a.task.getTbByTaskPlot(this.info.plotGroup.toString());Ve.game.setRoleHaoGanByNPCID(t.taskTargetNpcId,this.reward2),this.reward2=0}break;case this.btn_tiaojian:if(1==this.img_lock.visible){if(Ve.game.curSelectNum=2,Rt.closeview(this.name),this.reward3&&this.reward3>0){t=a.task.getTbByTaskPlot(this.info.plotGroup.toString());Ve.game.setRoleHaoGanByNPCID(t.taskTargetNpcId,this.reward3),this.reward3=0}this.handler&&this.handler.run()}else{if(Ve.game.curSelectNum=2,this.reward3&&this.reward3>0){t=a.task.getTbByTaskPlot(this.info.plotGroup.toString());Ve.game.setRoleHaoGanByNPCID(t.taskTargetNpcId,this.reward3),this.reward3=0}Rt.closeview(this.name),this.handler&&this.handler.run()}}}onDisable(){super.onDisable();ea.scene.GamePause=!1}}class Vo extends Ee.res.modules.role.GetRolePanelUI{constructor(){super(),this.panelapi=ea.role.get,this.addCom(this,fe)}onEnable(){super.onEnable();Tn.inst.sound.play(Ie.id.解锁新角色),this._param?(this.info=this._param.info,this.handler=this._param.handler,delete this._param.handler,this.platbox=ni.getBox(this),ni.initPanelNodeNames(this,this.platbox,["btn_video","btn_continue"]),this.addClick(this.btn_video),this.addClick(this.btn_close),this.btn_continue&&this.addClick(this.btn_continue),this.img_icon.skin="res/icon/role/"+this.info.tb.roleMod+".png",this.playflash()):be.closepanel(this.name)}onClickHandler(e){switch(e.target){case this.btn_continue:case this.btn_close:be.closepanel(this.name),this.handler&&this.handler.runWith([-1]);break;case this.btn_video:ea.role.get.onGetHandler(this.handler)}}onDisable(){super.onDisable()}}class Fo extends Ee.res.modules.role.GetRoleTestPanelUI{constructor(){super();this.panelapi=ea.role.test,this.addCom(this,fe)}onEnable(){super.onEnable();ea.scene.GamePause=!0,Tn.inst.sound.play(Ie.id.解锁新角色),this._param?(this.info=this._param.info,this.handler=this._param.handler,delete this._param.handler,this.play(),yt.getInstance().showInsertAd(),this.img_icon.skin="res/icon/role2/"+this.info.tb.roleMod+".png",this.intY=this.img_icon.y,this.addClick(this.btn_continue),this.addClick(this.btn_close),this.addClick(this.btn_video),this.playflash(),this.fudong()):be.closepanel(this.name)}Compet(e,t,i){this.mArmature=this.tem.buildArmature(1),this.mArmature.x=0,this.mArmature.y=0,this.mArmature.scale(1,1),this.mArmature.on(Laya.Event.STOPPED,this,this.completeHandler),this.play()}completeHandler(){this.play()}fudong(){var e=this;Laya.Tween.clearAll(e.img_icon),Laya.Tween.to(e.img_icon,{y:e.intY-7},1500,null,initHandler(e,()=>{Laya.Tween.to(e.img_icon,{y:e.intY+7},1500,null,initHandler(e,()=>{e.fudong()}))}))}play(){10200==this.info.roleId?"1"==i.read("testcaoren")?(this.btn_continue.visible=!1,this.btn_video.visible=!0):(this.btn_continue.visible=!0,this.btn_video.visible=!1):10200==this.info.roleId&&("1"==i.read("testmei")?(this.btn_continue.visible=!1,this.btn_video.visible=!0):(this.btn_continue.visible=!0,this.btn_video.visible=!1))}onClickHandler(e){var t=this;switch(e.target){case t.btn_continue:10200==t.info.roleId?i.save("testcaoren","1"):i.save("testmei","1"),be.closepanel(t.name),t.handler&&t.handler.runWith([1]);var s=Ve.role.rolemap[t.info.roleId];Ve.role.test_role=t.info.roleId,cafe.event.dispatch(Z.EQUIP_ROLE,Ve.role.test_role),setTimeout(()=>{be.openTopTipPanel(we.GetRoleTestPanel,{info:s,isClick:!0,handler:initHandler(t,e=>{ea.scene.GamePause=!1,1==e?(i.save("localrole","1"),Ve.role.test_role=null,Ve.role.haveRole(s.roleId)):(Ve.role.test_role=null,cafe.event.dispatch(Z.EQUIP_ROLE,Ve.role.equip_role))})})},6e4);break;case t.btn_close:be.closepanel(t.name),Ve.role.test_role=null,cafe.event.dispatch(Z.EQUIP_ROLE,Ve.role.equip_role),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF);break;case t.btn_video:yt.getInstance().showVideo(null,null,()=>{be.closepanel(we.GetRoleTestPanel),Ve.role.test_role=null,Ve.role.haveRole(t.info.roleId),t.info.roleId,t.info.roleId,t.handler&&t.handler.runWith([1])})}}onDisable(){ea.scene.GamePause=!1,super.onDisable()}}class Uo extends Ee.res.modules.role.NpcListItemViewUI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this)}onClickHandler(e){this.info&&(this.info.isHave?(Ve.npc.selectNpc(this.info.npcId,!0),this.enterGame()):(Ve.npc.haveNpc(this.info.npcId),this.img_video.visible=!this.info.isHave,this.enterGame()))}enterGame(){cafe.event.dispatch(se.NPCSHOP)}setDataChange(e){this.info=e,this.img_icon.skin="res/icon/npc/"+this.info.tb.configId+".png",this.img_video.visible=!e.isHave,this.txt_name.text=this.info.tb.npcName;var t=this.info.npcId==Ve.npc.equip_npc;this.db_select.visible=!!t}onDestroy(){super.onDestroy()}}class qo extends Ee.res.modules.role.NpcListPanelUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable(),this.addClick(this.btn_close),ea.scene.GamePause=!0,this.m_list.itemRender=Uo,this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.bin(In.NAME,this.onRoleDataChange),this.monitor(Z.EQUIP_NPC,this.onEquipRoleChange)}onEquipRoleChange(e){this.m_list.array=Ve.npc.getListByNpcId(1)}onRoleDataChange(){this.m_list.array=Ve.npc.getListByNpcId(1),this.binGuide()}onClickHandler(e){switch(Tn.inst.sound.play(Ie.id.点击按扭),e.target){case this.btn_close:be.closepanel(this.name),ea.scene.GamePause=!1}}updateItem(e){e.setDataChange(e.dataSource)}onDisable(){super.onDisable(),this._param=null}handleGuideTransition(){}}class Yo extends Ee.res.modules.role.RoleListItemViewUI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this)}onClickHandler(e){var t=this;if(t.info)return Ve.signin.isOneOpen?(be.closepanel(we.RoleListPanel),void(t.info.isHave?ea.role.list.onSelect3Handler(t):ea.role.list.onSelect2Handler(t))):void(t.info.isHave?t.enterGame():yt.getInstance().showVideo(null,null,()=>{console.log("rolelisritem"),t.img_video.visible=!t.info.isHave,t.enterGame()}))}enterGame(){Ve.game.roleid=this.info.roleId,this.info.roleId,this.info.roleId,Ve.role.haveRole(this.info.roleId,!0),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),cafe.event.dispatch(se.ROLESHOP),Ve.signin.isOneOpen&&(Ve.signin.isOneOpen=!1)}setDataChange(e){this.info=e,this.img_icon.skin="res/icon/role/"+this.info.tb.roleMod+".png",this.img_video.visible=!e.isHave,this.txt_name.text=this.info.tb.roleName;var t=this.info.roleId==Ve.role.getCurrRole().roleId;this.db_select.visible=!!t}onDestroy(){super.onDestroy()}}class Wo extends Ee.res.modules.role.RoleListItemView2UI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this)}onClickHandler(e){var t=this;t.info&&(t.info.isHave?t.enterGame():t.img_video.visible?yt.getInstance().showVideo(null,null,()=>{t.img_video.visible=!t.info.isHave,t.enterGame(),console.log("rolelisritem___2")}):t.img_buyL.visible&&(1==Ve.user.isGold(t.info.tb.price)?(Ve.user.removeGold(t.info.tb.price),t.img_buyL.visible,t.enterGame()):Ue.show("金币不足")))}enterGame(){Ve.game.roleid=this.info.roleId,this.info.roleId,Ve.role.haveRole(this.info.roleId,!0),cafe.event.dispatch(se.GAME_PLAYER_ACTION_REF),cafe.event.dispatch(se.ROLESHOP),Ve.signin.isOneOpen&&(Ve.signin.isOneOpen=!1),ea.scene.GamePause=!1,ea.role.list.onCloseHandler()}setDataChange(e){this.info=e,this.img_icon.skin="res/icon/role2/"+this.info.tb.roleMod+".png",1==e.tb.unlockType?(this.img_video.visible=!1,this.img_buyL.visible=!e.isHave,this.txt_count1.text=e.tb.price.toString()):(this.img_buyL.visible=!1,this.img_video.visible=!e.isHave),this.txt_name.text=this.info.tb.roleName;var t=this.info.roleId==Ve.role.getCurrRole().roleId;this.db_select.visible=!!t}onDestroy(){super.onDestroy()}}class Xo extends Ee.res.modules.role.RoleListPanelUI{constructor(){super();this.panelapi=ea.role.list,this.addCom(this,fe)}onEnable(){super.onEnable(),this.addClick(this.btn_close),ea.scene.GamePause=!0,this.m_list.itemRender=Wo,this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.bin(Mn.NAME,this.onRoleDataChange),this.monitor(Z.EQUIP_ROLE,this.onEquipRoleChange),yt.getInstance().showInsertAd()}onEquipRoleChange(e){this.m_list.array=Ve.role.getOneRoleList()}onRoleDataChange(){this.m_list.array=Ve.role.getOneRoleList(),this.binGuide()}onClickHandler(e){switch(Tn.inst.sound.play(Ie.id.点击按扭),e.target){case this.btn_close:ea.scene.GamePause=!1,ea.role.list.onCloseHandler()}}updateItem(e){e.setDataChange(e.dataSource)}onDisable(){super.onDisable(),this._param=null,ea.scene.GamePause=!1}handleGuideTransition(){}}class Ko extends Ee.res.modules.share.SharePanelUI{constructor(){super(),this.addCom(this,fe)}onEnable(){super.onEnable();Lt.stopRecord(),ea.scene.GamePause=!0,this.addClick(this.btn_close),this.addClick(this.btn_close2),this.addClick(this.btn_share),this.addClick(this.btn_share2),this.addCom(this.btn_share2,li).playhuxi(500)}onClickHandler(e){switch(e.target){case this.btn_share2:case this.btn_share:slog("SharePanel.分享");break;case this.btn_close:case this.btn_close2:if(be.closepanel(this.name),this._param)this._param.handler.run()}}onDisable(){this._param=null,ea.scene.GamePause=!1,super.onDisable()}}class Jo extends Ee.res.modules.shop.GetEquipTestPanelUI{constructor(){super(),this.addCom(this,fe)}onEnable(){super.onEnable();ea.scene.GamePause=!0,this.addClick(this.btn_continue),this.addClick(this.btn_close),this.addClick(this.btn_video),"1"==i.read("testEquip")?(this.linqu.visible=!0,this.shiyon.visible=!1):(this.shiyon.visible=!0,this.linqu.visible=!1),this.playflash()}onClickHandler(e){switch(e.target){case this.btn_continue:i.save("testEquip","1"),be.closepanel(this.name),this.handler&&this.handler.runWith([1]),Ve.shop.useEquip(80006,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon),ea.scene.GamePause=!1,setTimeout(()=>{if(0==Ve.shop.maps[80006].have){Ve.shop.useEquip(80006,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon);a.shop.getTbByShopId(80006);be.openTopTipPanel(we.GetEquipTestPanel)}},3e4);break;case this.btn_close:be.closepanel(this.name),ea.scene.GamePause=!1,this.handler&&this.handler.runWith([-1]);break;case this.btn_video:Ve.shop.noMoneyBuyShop(80006),-1==Ve.shop.equip_weapon.indexOf(80006)&&Ve.shop.useEquip(80006,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon),be.closepanel(this.name),ea.scene.GamePause=!1,this.handler&&this.handler.runWith([1])}}onDisable(){super.onDisable()}}class Zo extends Ee.res.modules.shop.GetWinRewardPanelUI{constructor(){super();this.addCom(this,fe)}onEnable(){super.onEnable();if(this._param){this.task=this._param,this.handler=this._param.handler,Tn.inst.sound.play(Ie.id.解锁新角色),delete this._param.handler,ea.scene.GamePause=!0;var e=a.shop.getTbByShopId(this.task.tb.taskRewardNpcId);this.img_icon.skin="res/icon/equip/"+e.shopMode+".png",this.nowTaskID=e.shopId,this.addClick(this.btn_continue),this.addClick(this.btn_close)}else be.closepanel(this.name)}onClickHandler(e){switch(e.target){case this.btn_close:case this.btn_continue:be.closepanel(this.name),ea.scene.GamePause=!1,80011!=this.nowTaskID&&-1==Ve.shop.equip_weapon.indexOf(this.nowTaskID)?(Ve.shop.useEquip(this.nowTaskID,2),ea.weapon.equipWeapon(Ve.shop.equip_weapon)):80011==this.nowTaskID&&-1==Ve.shop.npc_equip_weapon.indexOf(80011)&&(Ve.shop.npcEquip(this.nowTaskID,2),ea.weapon.npcequipWeapon(Ve.shop.npc_equip_weapon))}}onDisable(){super.onDisable()}}class Qo extends Ee.res.modules.shop.NdRewardItemUI{constructor(){super()}onEnable(){super.onEnable()}onInfoChangeHandler(){this.img_icon=this.leftBox.getChildByName("bk").getChildByName("img_icon"),Tn.inst.setImageIcon(this.img_icon,`res/icon/equip/${this.nddata.NDIconId}.png`),this.leftBox.getChildByName("bk").getChildByName("txt_name").text=this.nddata.NiuDaDesc+"x"+this.nddata.NDrewardNum}setDataChange(e){this.nddata=e,this.onInfoChangeHandler()}onDestroy(){super.onDestroy()}}class $o extends Ee.res.modules.shop.NiuDanPanelUI{constructor(){super(),this.rospeed=0,this.rotime=0,this.isgo=!1,this.randomlist=[],this.targetRo=0,this.tblist=[],this._rotation=new Laya.Vector3(0,0,0),this._translate=new Laya.Vector3(0,.1,0),this._translate2=new Laya.Vector3(0,1,1),this.startX=0,this.curTimeToTal=0,this.videoTime=120,this.goldCount=0,this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;yt.getInstance().showInsertAd(),ea.scene.GamePause=!0,e.addClick(e.btn_addGold),e.addClick(e.btn_continue),e.addClick(e.btn_continueTen),e.addClick(e.btn_Back),e.addClick(e.btn_reward),e.addClick(e.btn_shuoming),e.tblist=a.niudan.tb();var t="";for(let s=0;s<this.tblist.length;s++){var i=e.tblist[s];t=t+i.NiuDaDesc+" 概率"+i.NDPossibility+"%\n"}e.lab_shuoming.text=t,Tn.inst.loadDb.res("res/dbres/ndj/ndj",initHandler(e,t=>{e.stage?(e&&e.box_db2&&e.box_db2.addChild(t),t.x=0,t.y=0,t.play("daiji",!0),e.ndjsk=t):t.destroy()})),e.NiudanSpriteShow()}NiudanSpriteShow(){for(var e=0;e<this.sprite_List.numChildren;e++){var t=this.sprite_List.getChildAt(e).getChildByName("roleIcon");Tn.inst.setImageIcon(t,"res/icon/equip/"+this.tblist[e].NDIconId+".png"),this.sprite_List.getChildAt(e).getChildByName("name").text=this.tblist[e].NiuDaDesc,this.sprite_List.getChildAt(e).getChildByName("zhuanshu").visible="0"!=this.tblist[e].NDrewardId}}updateItem(e){e.setDataChange(e.dataSource)}createMap(){let e=this;var t;if(0!=_e.getLayer(15).numChildren){(t=_e.getLayer(15).getChildAt(0)).active=!0;var i=t.getChildAt(1);return i.orthographicVerticalSize=Ve.role.getCurrRole().tb.cameraScale,e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),i.renderTarget=e.cameraTexture,void(e.rolerenderNode.source=new Laya.Texture(e.cameraTexture))}t=new Laya.Scene3D,_e.getLayer(15).addChild(t),t.ambientMode=Laya.AmbientMode.SolidColor,t.ambientColor=new Laya.Vector3(.8,.8,.8);var s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(.6,.6,.6),s.transform.worldMatrix.setForward(new Laya.Vector3(0,0,-1)),s.intensity=.3,window.conchConfig&&-1!=window.conchConfig.getOS().indexOf("android")&&(t.ambientColor=new Laya.Vector3(1,1,1)),Laya.Scene3D.octreeCulling=!0;var a=t.addChild(new Laya.Camera(0,.1,1e3));a.transform.rotate(e._rotation,!1,!1),a.transform.translate(e._translate2),a.orthographic=!0,a.clearFlag=Laya.CameraClearFlags.SolidColor,a.clearColor=new Laya.Vector4(0,0,0,0),e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),a.renderTarget=e.cameraTexture,a.orthographicVerticalSize=2,Tn.inst.load3d.thingRes("res/res3D/role/40810202.lh",t,Laya.Handler.create(e,function(i){t.addChild(i),e._layaMonkey=i;var s=i.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate,a.setValue(1,1,1),s.localScale=a,n.setValue(0,0,0),s.rotationEuler=n,e.rolerenderNode.source=new Laya.Texture(e.cameraTexture)}))}reTime(){this.curTimeToTal=this.videoTime}showRewardUI(){var e=this.box_one;if(this.randomlist.length>1)e=this.box_ten,this.m_list.itemRender=Qo,this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.m_list.array=this.randomlist;else{var t=this.randomlist[0];Tn.inst.setImageIcon(this.img_oneicon,"res/icon/equip/"+t.NDIconId+".png"),this.lab_onename.text=t.NiuDaDesc+t.NDrewardNum}this.box_one.visible=!1,this.box_ten.visible=!1,e.visible=!0,this.group_content.visible=!0}rewardFunction(){for(let r=0;r<this.randomlist.length;r++){var e=this.randomlist[r];switch(e.NiuDanType){case 2:var t=e.NDrewardNum;this.goldCount+=t;break;case 3:var i=e.NDrewardId.split(":"),s=a.shop.getTbByShopId(Number(i[0]));if(cafe.event.dispatch(se.updateEquipButton,s.shopType),5==s.shopType)Ve.game.thisshop=5,Ve.shop.noMoneyBuyShop(s.shopId),Ve.shop.maps[s.shopId].have&&Ve.shop.useEquip(s.shopId,s.shopType);else if(3==s.shopType){var n=Ve.role.rolemap[s.targetId];if(n.isHave){Ue.show("已拥有角色,自动转化为等价金币");var o=ea.money.strToInfo(s.price);this.goldCount+=o.count?o.count:5e3}else Ve.shop.noMoneyBuyShop(s.shopId),Ve.role.haveRole(n.roleId,!1),Ve.role.selectRole(n.roleId)}else if(2==s.shopType){if(Ve.carlib.getCar(s.shopId).have){o=ea.money.strToInfo(s.price);this.goldCount+=o.count?o.count:3e3}else Ve.shop.noMoneyBuyShop(s.shopId),ea.car.localride(Ve.shop.equip_car)}else if(10==s.shopType)Ve.game.thisshop=10,Ve.shop.noMoneyBuyShop(s.shopId),Ve.npc.selectNpc(s.targetId);else if(12==s.shopType)Ve.shop.noMoneyBuyShop(s.shopId),Ve.shop.seleTuoWei(s.targetId);else if(Ve.shop.maps[s.shopId].have){o=ea.money.strToInfo(s.price);this.goldCount+=o.count?o.count:2e3}else Ve.shop.noMoneyBuyShop(s.shopId),Ve.shop.useEquip(s.shopId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon)}r==this.randomlist.length-1&&(this.randomlist=[])}}onClickHandler(e){var t=this;switch(e.target){case t.btn_shuoming:t.box_shuoming.visible=!t.box_shuoming.visible;break;case t.btn_reward:t.rewardFunction(),Ve.user.addGold(t.goldCount,ea.scene.moneypos,null,()=>{t.goldCount=0}),t.group_content.visible=!1;break;case t.btn_Back:if(t.isgo)return;Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(we.NiuDanPanel);break;case t.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.GoldPanel);break;case t.btn_continue:if(t.isgo)return;if(Tn.inst.sound.play(Ie.id.点击按扭),!Ve.user.isGold(500))return void Ue.show("金币不足");Ve.user.removeGold(500),t.ndjsk.play("lanse",!1),t.isgo=!0,Laya.timer.once(2500,t,()=>{t.getRandNum(1),t.ndjsk.play("daiji",!1),t.isgo=!1});break;case t.btn_continueTen:if(t.isgo)return;yt.getInstance().showVideo(null,null,()=>{t.isgo=!0,t.ndjsk.play("zise",!1),Laya.timer.once(2500,t,()=>{t.getRandNum(10),t.ndjsk.play("daiji",!1),t.isgo=!1})})}}getRandNum(e){for(let s=0;s<e;s++){var t=this.randomRange(1,100),i=0;for(let a=0;a<this.tblist.length;a++){if((i+=this.tblist[a].NDPossibility)>=t){this.randomlist.push(this.tblist[a]),s==e-1&&this.showRewardUI();break}}}}randomRange(e,t){return Math.floor(Math.random()*(t-e))+e}onDisable(){ea.scene.GamePause=!1,cafe.event.dispatch(se.updateEquip),super.onDisable()}}class er extends Ee.res.modules.shop.npcShopItemViewUI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this.btn_buyL),this.addClick(this.btn_selectL),this.addClick(this.btn_equipL),this.addClick(this.btn_videoL)}onShopInfoChangeHandler(){this.box=this.leftBox,this.bk=this.box.getChildByName("bk"),this.img_icon=this.box.getChildByName("bk").getChildByName("img_icon"),this.txt_name=this.box.getChildByName("bk").getChildByName("txt_name");var e=ea.money.strToInfo(this.shopInfo.tb.price);this.txt_count1.text=e.count+"",this.img_icon.skin=`res/icon/equip/${this.shopInfo.tb.shopIcon}.png`,this.btn_buyL.visible=!this.shopInfo.have&&e.count>0,this.btn_videoL.visible=!this.shopInfo.have&&"0"==this.shopInfo.tb.price,this.btn_equipL.visible=this.shopInfo.have&&this.shopInfo.equip,this.btn_selectL.visible=this.shopInfo.have&&!this.shopInfo.equip,this.txt_name.text=this.shopInfo.tb.shopName}isCanSelect(){if(2!=Ve.shop.equip_weapon.length)switch(Ve.shop.equip_weapon[0]){case 80001:case 80002:this.btn_unselect.visible=!1;break;case 80003:case 80004:80007==this.shopInfo.tb.shopId||80009==this.shopInfo.tb.shopId?this.btn_unselect.visible=!0:this.btn_unselect.visible=!1;break;case 80005:this.btn_unselect.visible=!1;break;case 80006:80007==this.shopInfo.tb.shopId||80008==this.shopInfo.tb.shopId||80009==this.shopInfo.tb.shopId?this.btn_unselect.visible=!0:this.btn_unselect.visible=!1;break;case 80007:80003==this.shopInfo.tb.shopId||80004==this.shopInfo.tb.shopId||80006==this.shopInfo.tb.shopId?this.btn_unselect.visible=!0:this.btn_unselect.visible=!1;break;case 80008:80006==this.shopInfo.tb.shopId?this.btn_unselect.visible=!0:this.btn_unselect.visible=!1;break;case 80009:80003==this.shopInfo.tb.shopId||80004==this.shopInfo.tb.shopId||80006==this.shopInfo.tb.shopId?this.btn_unselect.visible=!0:this.btn_unselect.visible=!1}else Ve.shop.equip_weapon[0]==this.shopInfo.tb.shopId||this.shopInfo.tb.shopId==Ve.shop.equip_weapon[1]?this.btn_unselect.visible=!1:this.btn_unselect.visible=!0}onClickHandler(e){switch(e.target){case this.btn_videoL:Ve.shop.noMoneyBuyShop(this.shopInfo.shopId),Ve.shop.npcEquip(this.shopInfo.shopId,this.shopInfo.type);break;case this.btn_buyL:Ve.shop.buyShop(this.shopInfo.shopId),Ve.shop.npcEquip(this.shopInfo.shopId,this.shopInfo.type);break;case this.btn_equipL:case this.btn_selectL:this.shopInfo&&2!=this.shopInfo.type?Ve.shop.npcEquip(this.shopInfo.shopId,this.shopInfo.type):this.shopInfo2&&11==this.shopInfo2.type&&Ve.shop.npcEquip(this.shopInfo2.shopId,this.shopInfo2.type)}}setDataChange(e,t){this.shopInfo&&cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId),this.shopInfo=e,cafe.data.on(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}onDestroy(){super.onDestroy();cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}}class tr extends Ee.res.modules.shop.npcShopPanelUI{constructor(){super(),this.addCom(this,fe)}onEnable(){super.onEnable();this.select_id=10001,ea.scene.GamePause=!0,this.m_list.itemRender=er,this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.list=Ve.shop.getShopListByType(7),this.m_list.array=this.list,this.m_list2.itemRender=Uo,this.m_list2.renderHandler=new Laya.Handler(this,this.updateItem2),this.bin(In.NAME,this.onRoleDataChange),this.monitor(Z.EQUIP_NPC,this.onEquipRoleChange),this.monitor(se.NPCSHOP,this.showIcon),this.showIcon(),this.addClick(this.btn_addGold),this.addClick(this.btn_close),this.addClick(this.btn_go)}onEquipRoleChange(e){this.m_list2.array=Ve.npc.getListByNpcId(1)}onRoleDataChange(){this.m_list2.array=Ve.npc.getListByNpcId(1),this.binGuide()}showIcon(){14026==Ve.npc.equip_npc?(this.lu.visible=!0,this.yan.visible=!1):14027==Ve.npc.equip_npc&&(this.lu.visible=!1,this.yan.visible=!0)}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}updateItem(e,t){e.setDataChange(e.dataSource,this.select_id)}updateItem2(e){e.setDataChange(e.dataSource)}onUserDataChange(){this.ui_money.txt_gold&&(this.ui_money.txt_gold.text=Ve.user.gold.toString())}onClickHandler(e){switch(e.target){case this.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭);var t=a.drop.getTbByDropId(10003);be.openTopTipPanel(we.DropBuffPanel,{info:t,isClick:!0,handler:initHandler(this,e=>{ea.scene.GamePause=!1})});break;case this.btn_close:case this.btn_go:Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(this.name),ea.scene.GamePause=!1,ea.weapon.npcequipWeapon(Ve.shop.npc_equip_weapon)}}onDisable(){super.onDisable()}}class ir extends Ee.res.modules.shop.ShopItemViewUI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this.btn_buyL),this.addClick(this.btn_selectL),this.addClick(this.btn_equipL),this.addClick(this.btn_videoL)}onShopInfoChangeHandler(){this.box=this.leftBox,this.bk=this.box.getChildByName("bk"),this.img_icon=this.box.getChildByName("bk").getChildByName("img_icon"),Tn.inst.setImageIcon(this.img_icon,`res/icon/equip/${this.shopInfo.tb.shopIcon}.png`),this.txt_name=this.img_name.getChildByName("txt_name");var e=ea.money.strToInfo(this.shopInfo.tb.price);this.txt_count1.text=e.count+"",this.btn_buyL.visible=!this.shopInfo.have&&e.count>0,this.btn_videoL.visible=!this.shopInfo.have&&"0"==this.shopInfo.tb.price,this.box_nd.visible=!this.shopInfo.have&&"3"==this.shopInfo.tb.price,this.box_secondSign.visible=!this.shopInfo.have&&"4"==this.shopInfo.tb.price,this.btn_equipL.visible=this.shopInfo.equip,this.btn_selectL.visible=!this.shopInfo.equip,this.btn_unselectL.visible=!this.btn_equipL.visible,this.sprite_equipL.visible=this.btn_equipL.visible,this.txt_name.text=this.shopInfo.tb.shopName,0!=Ve.game.getrole&&this.shopInfo.tb.shopId==Ve.game.getrole&&(Ve.game.thisshop=3,Ve.role.selectRole(this.shopInfo.tb.targetId),this.MainView&&this.MainView.ChangeRole(),Ve.game.getrole=0);var t=this.shopInfo.tb.shopId%1e4;t=t%6+1,this.SelectSkin(t),this.SelectBoxChange()}SelectBoxChange(){var e=this;e.sprite_equipL.visible?(pt.SpringAni(e.leftBox,200,.7,.9,1,initHandler(e,()=>{pt.SpringAni(e.leftBox,200,.9,.9,.95,null)})),e.leftBox.rotation=-5):1!=e.leftBox.scaleX&&(pt.SpringAni(e.leftBox,200,.7,1,1.2),e.leftBox.rotation=0)}SelectSkin(e){this.btn_unselectLDi.skin="res/icon/shop/t"+e+"di.png",this.btn_selectL.skin="res/icon/shop/t"+e+"di.png",this.btn_equipL.skin="res/icon/shop/t"+e+"di.png"}onClickHandler(e){var t=this;switch(e.target){case t.btn_videoL:5==t.shopInfo.tb.shopType?yt.getInstance().showVideo(null,null,()=>{Ve.shop.noMoneyBuyShop(t.shopInfo.shopId),Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon)}):3==t.shopInfo.tb.shopType||7==t.shopInfo.tb.shopType?(Ve.game.thisshop=3,yt.getInstance().showVideo(null,null,()=>{Ve.role.selectRole(t.shopInfo.tb.targetId),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId),t.MainView&&t.MainView.ChangeRole(),Ve.shop.GameShopType==Oe.躲猫猫&&(t.MainView&&3==t.shopInfo.tb.shopType&&t.MainView.onRoleDataChange(),t.MainView&&7==t.shopInfo.tb.shopType&&t.MainView.onEquipChange())})):10==t.shopInfo.tb.shopType?(Ve.game.thisshop=10,yt.getInstance().showVideo(null,null,()=>{Ve.npc.selectNpc(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangePet(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId)})):12==t.shopInfo.tb.shopType&&yt.getInstance().showVideo(null,null,()=>{Ve.shop.seleTuoWei(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangTuoWei(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId)});break;case t.btn_buyL:5==t.shopInfo.tb.shopType?(Ve.game.thisshop=5,Ve.shop.buyShop(t.shopInfo.shopId),Ve.shop.maps[t.shopInfo.shopId].have&&(Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon))):3==t.shopInfo.tb.shopType||7==t.shopInfo.tb.shopType?(Ve.game.thisshop=3,Ve.shop.buyShop(t.shopInfo.shopId),Ve.shop.maps[t.shopInfo.shopId].have&&(Ve.role.selectRole(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangeRole())):10==t.shopInfo.tb.shopType?(Ve.game.thisshop=10,Ve.shop.buyShop(t.shopInfo.shopId,initHandler(t,()=>{Ve.npc.selectNpc(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangePet()}))):12==t.shopInfo.tb.shopType&&(Ve.game.thisshop=12,Ve.shop.buyShop(t.shopInfo.shopId,initHandler(t,()=>{Ve.shop.seleTuoWei(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangTuoWei()})));break;case t.btn_equipL:if(5==t.shopInfo.tb.shopType)Ve.game.thisshop=5,Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon);else if(3==t.shopInfo.tb.shopType||7==t.shopInfo.tb.shopType)Ve.game.thisshop=3,Ve.role.selectRole(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangeRole(),Ve.shop.GameShopType==Oe.躲猫猫&&(t.MainView&&3==t.shopInfo.tb.shopType&&t.MainView.onRoleDataChange(),t.MainView&&7==t.shopInfo.tb.shopType&&t.MainView.onEquipChange());else if(10==t.shopInfo.tb.shopType){if(Ve.game.thisshop=10,t.shopInfo.tb.targetId==Ve.npc.equip_npc)return Ve.npc.equip_npc=null,void(t.MainView&&t.MainView.ChangePet());Ve.npc.selectNpc(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangePet(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId)}else if(12==t.shopInfo.tb.shopType){if(t.shopInfo.tb.targetId==Ve.shop.getcurTuoWei())return Ve.shop.seleTuoWei(null),void(t.MainView&&t.MainView.ChangTuoWei());Ve.shop.seleTuoWei(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangTuoWei(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId)}break;case t.btn_selectL:5==t.shopInfo.tb.shopType?(Ve.game.thisshop=5,Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon)):3==t.shopInfo.tb.shopType||7==t.shopInfo.tb.shopType?(Ve.game.thisshop=3,Ve.role.selectRole(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangeRole(),Ve.shop.GameShopType==Oe.躲猫猫&&(t.MainView&&3==t.shopInfo.tb.shopType&&t.MainView.onRoleDataChange(),t.MainView&&7==t.shopInfo.tb.shopType&&t.MainView.onEquipChange())):10==t.shopInfo.tb.shopType?(Ve.game.thisshop=10,Ve.npc.selectNpc(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangePet(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId)):12==t.shopInfo.tb.shopType&&(Ve.shop.seleTuoWei(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangTuoWei(),Ve.shop.noMoneyBuyShop(t.shopInfo.shopId))}}setDataChange(e,t){this.shopInfo&&cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId),this.shopInfo=e,this.MainView=t,cafe.data.on(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}onDestroy(){super.onDestroy();cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}}class sr extends Ee.res.modules.shop.ShopItemView2UI{constructor(){super()}onEnable(){super.onEnable();this.addClick(this.btn_buyL),this.addClick(this.btn_unselectL),this.addClick(this.btn_videoL)}onShopInfoChangeHandler(){this.box=this.leftBox,this.bk=this.box.getChildByName("bk"),this.img_icon=this.box.getChildByName("bk").getChildByName("img_icon"),Tn.inst.setImageIcon(this.img_icon,`res/icon/shop/${this.shopInfo.tb.shopIcon}.png`),this.txt_name=this.img_name.getChildByName("txt_name");var e=ea.money.strToInfo(this.shopInfo.tb.price);this.txt_count1.text=e.count+"",this.btn_buyL.visible=!this.shopInfo.have&&e.count>0,this.btn_videoL.visible=!this.shopInfo.have&&"0"==this.shopInfo.tb.price,this.btn_selectL.visible=this.shopInfo.have&&this.shopInfo.equip,this.btn_unselectL.visible=!this.btn_equipL.visible,this.txt_name.text=this.shopInfo.tb.shopName,this.img_name.visible=!this.btn_buyL.visible}onClickHandler(e){var t=this;switch(e.target){case t.btn_videoL:yt.getInstance().showVideo(null,null,()=>{5==t.shopInfo.tb.shopType?(Ve.shop.noMoneyBuyShop(t.shopInfo.shopId),Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon)):3!=t.shopInfo.tb.shopType&&7!=t.shopInfo.tb.shopType||(Ve.shop.noMoneyBuyShop(t.shopInfo.shopId),Ve.role.selectRole(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangeRole(),Ve.shop.GameShopType==Oe.躲猫猫&&(t.MainView&&3==t.shopInfo.tb.shopType&&t.MainView.onRoleDataChange(),t.MainView&&7==t.shopInfo.tb.shopType&&t.MainView.onEquipChange()))});break;case t.btn_buyL:5==t.shopInfo.tb.shopType?Ve.shop.buyShop(t.shopInfo.shopId):3!=t.shopInfo.tb.shopType&&7!=t.shopInfo.tb.shopType||Ve.shop.buyShop(t.shopInfo.shopId);break;case t.btn_unselectL:5==t.shopInfo.tb.shopType?(Ve.shop.useEquip(t.shopInfo.shopId,t.shopInfo.type),t.MainView&&t.MainView.equipRole(Ve.shop.equip_weapon)):3!=t.shopInfo.tb.shopType&&7!=t.shopInfo.tb.shopType||(Ve.role.selectRole(t.shopInfo.tb.targetId),t.MainView&&t.MainView.ChangeRole(),Ve.shop.GameShopType==Oe.躲猫猫&&(t.MainView&&3==t.shopInfo.tb.shopType&&t.MainView.onRoleDataChange(),t.MainView&&7==t.shopInfo.tb.shopType&&t.MainView.onEquipChange()))}}setDataChange(e,t){this.shopInfo&&cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId),this.shopInfo=e,this.MainView=t,cafe.data.on(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}onDestroy(){super.onDestroy();cafe.data.off(Pn.NAME,this.onShopInfoChangeHandler,this,Pn.SHOP_ID_REF+"_"+this.shopInfo.shopId)}}class ar extends Ee.res.modules.shop.ShopPanelUI{constructor(){super(),this.curRole=0,this.curNpc=0,this.mapStartIndex=2001,this.TimeEnd=!1,this._translate=new Laya.Vector3(0,.1,-.2),this._translate2=new Laya.Vector3(0,1,1),this._translate3=new Laya.Vector3(-.35,.4,-.2),this._translate4=new Laya.Vector3(0,0,0),this._rotation=new Laya.Vector3(0,0,0),this.mapId=0,this.addCom(this,fe)}onEnable(){super.onEnable();this.createMapScene(),yt.getInstance().showInsertAd(),Ve.level.isBossShow=!1,ea.scene.GamePause=!0,this.m_list.itemRender=ir,this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.bin(Mn.NAME,this.onRoleDataChange),this.monitor(Z.EQUIP_ROLE,this.onEquipChange),this.monitor(Z.EQUIP_NPC,this.onPetDataChange),this.monitor(se.SIGNUICHANGE,this.changeSignUi),this.monitor(se.updateEquip,this.updataEquip),this.monitor(se.updateEquipButton,this.updateEquipButton),this.m_renderMap.hScrollBar.on(Laya.Event.CHANGE,this,this.onScrollChange),this.AddClick(),this.SelectButtonAction(this.btn_juese,!0),this._param&&(this.btn_continue.visible=!0),Ve.signin.is_signin?this.btn_sign.getChildAt(0).visible=!1:this.btn_sign.getChildAt(0).visible=!0,Ve.npc.equip_npc&&this.ChangePet(),Ve.shop.getcurTuoWei()&&this.ChangTuoWei(),Ye.add(1,this,this.onframe),this.GameLobbyActon(),this.ScrollMap(),this.onActionCdTimeEndHandler(),this.TimeEnd=!0,"1"==i.read("firstSelectMap")?this.firstSelectMap.visible=!1:this.firstSelectMap.visible=!0,pt.BreathEffect(this.btn_showMap1),pt.BreathEffect(this.btn_showMap2),Tn.inst.sound.play(11003)}AddClick(){this.addClick(this.btn_addGold),this.addClick(this.btn_juese),this.addClick(this.btn_shop),this.addClick(this.btn_pet),this.addClick(this.btn_tuowei),this.addClick(this.btn_continue),this.addClick(this.btn_close),this.addClick(this.btn_showMap1),this.addClick(this.btn_showMap2),this.addClick(this.btn_map1),this.addClick(this.btn_map2),this.addClick(this.btn_map3),this.addClick(this.btn_map4),this.addClick(this.btn_map5),this.addClick(this.btn_map6),this.addClick(this.btn_map7),this.addClick(this.btn_map8),this.addClick(this.btn_map9),this.addClick(this.btn_Back),this.addClick(this.img_lockClick),this.addClick(this.btn_zp),this.addClick(this.btn_sign),this.addClick(this.btn_nd)}onScrollChange(){0!=this.m_renderMap.hScrollBar.value&&(this.firstScrollBar.visible=!1)}GameLobbyActon(){if(0==a.map.getTbByGamePkType(2).length)return this.btn_close.visible=!1,this.btn_continue.visible=!0,void(this.mapStartIndex=2001);if(this.mapStartIndex=2002,this.btn_continue.visible=!1,this.btn_close.visible=!0,ea.scene.ui){var e=ea.scene.ui.btn_openMap.disabled;this.roleShowBox.visible=!e,this.roleBox.visible=!e,this.btn_Back.visible=!e,this.this_bg.visible=!e,this.mapBox.visible=e}}ScrollMap(){for(var e=0;e<this.m_renderMap.numChildren;e++)if(e>=a.map.getTbByMapID().length)this.m_renderMap.getChildAt(e).visible=!1;else{var t=this.mapStartIndex+e,i=-1!=Ve.game.locklv.indexOf(t);this.m_renderMap.getChildAt(e).skin="res/modules/shop/g"+(e+1)+".png",this.m_renderMap.getChildAt(e).x=360*e+40,this.m_renderMap.getChildAt(e).getChildAt(0).visible=i,this.m_renderMap.getChildAt(e).getChildByName("box_action").getChildByName("actionValue").text="x"+a.map.getTbBymap(t).actionValue.toString(),this.m_renderMap.getChildAt(e).getChildByName("mapName").text=a.map.getTbBymap(t).mapName,this.m_renderMap.getChildAt(e).getChildByName("img_gameTypeName").skin="res/modules/shop/"+a.map.getTbBymap(t).gameTypeName+".png",""!=a.map.getTbBymap(t).gameTip?this.m_renderMap.getChildAt(e).getChildByName("img_gameTip").skin="res/modules/shop/"+a.map.getTbBymap(t).gameTip+".png":this.m_renderMap.getChildAt(e).getChildByName("img_gameTip").skin=""}this.btn_showMap1.getChildByName("video").visible=-1!=Ve.game.locklv.indexOf(this.mapStartIndex),this.btn_showMap2.getChildByName("video").visible=-1!=Ve.game.locklv.indexOf(this.mapStartIndex+1)}onActionCdTimeEndHandler(){if(Ve.user.refActionTime(),!Ve.user.isMaxAction()){var e=Ve.user.pre_action_time-Math.floor((new Date).valueOf()/1e3);cafe.event.dispatch(se.GAME_ACTION_CD_TIME_START,0!=Ve.user.pre_action_time?e:0)}}updataEquip(){this.ChangTuoWei(),this.ChangePet(),this.ChangeRole(),this.equipRole(Ve.shop.equip_weapon),this.sk_niudan.visible=!1,Ve.user.isGold(500)&&(this.sk_niudan.visible=!0),this.sk_zp.visible=!1,Ve.game.zhuanpanNum>0&&(this.sk_zp.visible=!0)}changeSignUi(){this.lab_sign.visible=!1}onframe(){Ve.user.getActionTime()<=0&&this.TimeEnd&&(Ve.user.setAction(Ve.user.action+Ve.user.hf_action),this.onActionCdTimeEndHandler())}onEquipChange(){this.list=Ve.shop.getShopListByType(5),this.m_list.array=this.list}onRoleDataChange(){this.list=Ve.shop.getShopListByType(3),this.m_list.array=this.list}onPetDataChange(){this.list=Ve.shop.getShopListByType(10),this.m_list.array=this.list}onTuoWeiDataChange(){this.list=Ve.shop.getShopListByType(12),this.m_list.array=this.list}createMapScene(){let e=this;var t;if(console.log("初始化场景"),0==_e.getLayer(14).numChildren){t=new Laya.Scene3D,_e.getLayer(14).addChild(t),t.ambientMode=Laya.AmbientMode.SolidColor,t.ambientColor=new Laya.Vector3(.8,.8,.8),window.conchConfig&&-1!=window.conchConfig.getOS().indexOf("android")&&(t.ambientColor=new Laya.Vector3(1,1,1));var i=t.addChild(new Laya.DirectionLight);i.color=new Laya.Vector3(.6,.6,.6),i.transform.worldMatrix.setForward(new Laya.Vector3(0,0,-1)),i.intensity=1,Laya.Scene3D.octreeCulling=!0;var s=t.addChild(new Laya.Camera(0,.1,1e3));s.transform.rotate(e._rotation,!1,!1),s.transform.translate(e._translate2),s.orthographic=!0,s.clearFlag=Laya.CameraClearFlags.SolidColor,Laya.Material.load("res/res3D/Assets/Mesh/BG/Sky2.lmat",initHandler(this,function(e){e.textureCube&&(t.customReflection=e.textureCube)})),s.clearColor=new Laya.Vector4(0,0,0,0),e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),s.renderTarget=e.cameraTexture,s.orthographicVerticalSize=Ve.role.getCurrRole().tb.cameraScale}else{if(t=_e.getLayer(14).getChildAt(0),0!=Ve.game.getrole){console.log("dts.game.getrole2"+Ve.game.getrole);var n=t.getChildByName(Ve.game.getrole.toString());n&&(n.active=!1),Ve.game.getrole=0}t.active=!0;for(var o=Ve.role.getRoleList(),r=0;r<o.length;r++){var l=(o[r].tb.roleId-1e4)/100+1e4;!Ve.shop.getShop((Ve.role.getCurrRole().tb.roleId-1e4)/100+1e4).have&&Ve.shop.getShop(l).have&&(Ve.role.equip_role=10100)}var h=Ve.role.getCurrRole().tb.roleMod,c=t.getChildByName(h);if(e.maincamera=t.getChildAt(1),e.maincamera.orthographicVerticalSize=Ve.role.getCurrRole().tb.cameraScale,e.cameraTexture=new Laya.RenderTexture(1024,1024,Laya.RenderTextureFormat.R8G8B8A8,Laya.RenderTextureDepthFormat.DEPTHSTENCIL_24_8),e.maincamera.renderTarget=e.cameraTexture,null!=c){c.active=!0,e._layaMonkey=c,e._layaMonkey&&(e._layaMonkey.active=!0);var d=a.shop.getTbByTargetId(Ve.role.getCurrRole().tb.roleId);return e.lab_juesename.text=d.shopName,e.qualityListShow(d.quality),e.starListShow(d.quality),e.roleNameTween(),void(e.rolerenderNode.source=new Laya.Texture(e.cameraTexture))}slog["找不到_layaMonkey节点"]}for(o=Ve.role.getRoleList(),r=0;r<o.length;r++){l=(o[r].tb.roleId-1e4)/100+1e4;!Ve.shop.getShop((Ve.role.getCurrRole().tb.roleId-1e4)/100+1e4).have&&Ve.shop.getShop(l).have&&(Ve.role.equip_role=10100)}h=Ve.role.getCurrRole().tb.roleMod,d=a.shop.getTbByTargetId(Ve.role.getCurrRole().tb.roleId);e.lab_juesename.text=d.shopName,e.qualityListShow(d.quality),e.starListShow(d.quality),e.curRole=Ve.role.getCurrRole().tb.roleId,e._layaMonkey&&(e._layaMonkey.active=!1),Tn.inst.load3d.thingRes("res/res3D/role/"+h+".lh",t,Laya.Handler.create(e,function(i){t.addChild(i),e._layaMonkey=i;var s=i.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate,a.setValue(1,1,1),s.localScale=a,n.setValue(0,0,0),s.rotationEuler=n,e.rolerenderNode.source=new Laya.Texture(e.cameraTexture),e.equipRole(Ve.shop.equip_weapon)}))}equipRole(e){if(this._layaMonkey){var t=this._layaMonkey,i=Ve.game.shopWeaponLlist;if(i.length>0){for(var s=0;s<i.length;s++){var n=Xe.getBody(t,i[s]);n&&(n.removeSelf(),n.destroy())}Ve.game.shopWeaponLlist=[]}for(var o=0;o<e.length;o++)for(var r=a.equip.getTbByEquipId(e[o]),l=r.weaponEquipName.split("-"),h=0;h<l.length;h++)for(var c=Xe.getBodys(t,l[h]),d=0;d<c.length;d++){var u=r.equipMod;Tn.inst.load3d.thingRes(ce.getPropUrl(u+".lh"),c[d],initHandler(this,e=>{e.transform.localPosition=new Laya.Vector3(0,0,0),e.transform.localRotationEuler=new Laya.Vector3(0,0,0),Ve.game.shopWeaponLlist.push(e.name)}))}}}ChangTuoWei(){var e=this,t=_e.getLayer(14).getChildAt(0);for(let e=0;e<Ve.shop.shopTuoWeiLlist.length;e++){var i=t.getChildByName(Ve.shop.shopTuoWeiLlist[e]);i&&(i.active=!1)}var s=Ve.shop.getcurTuoWei();if(s){if(null!=t.getChildByName(s.toString()))return e._layaTuoWei&&(e._layaTuoWei.active=!1),e._layaTuoWei=t.getChildByName(s.toString()),void(e._layaTuoWei.active=!0);e._layaTuoWei&&(e._layaTuoWei.active=!1),Tn.inst.load3d.thingRes("res/res3D/prop_effect/"+s+".lh",t,Laya.Handler.create(e,function(i){t.addChild(i),e._layaTuoWei=i,Ve.shop.shopTuoWeiLlist.push(i.name);var s=i.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate4,a.setValue(1,1,1),s.localScale=a,n.setValue(-90,0,0),s.rotationEuler=n,i.active=!0}))}}ChangePet(){var e=this,t=_e.getLayer(14).getChildAt(0);for(let e=0;e<Ve.shop.shopPetsLlist.length;e++){var i=t.getChildByName(Ve.shop.shopPetsLlist[e]);i&&(i.active=!1)}if(Ve.shop.useEquip(Ve.npc.equip_npc,10),Ve.npc.getCurrNpc()){var s=Ve.npc.getCurrNpc().tb.configId,a=t.getChildByName(s.toString());if(e.curNpc=Ve.npc.getCurrNpc().tb.npcId,a&&1==a.active)a.active=!1;else{if(null!=a)return e._layaPet&&(e._layaPet.active=!1),e._layaPet=t.getChildByName(s.toString()),void(e._layaPet.active=!0);e._layaPet&&(e._layaPet.active=!1),Tn.inst.load3d.thingRes("res/res3D/role/"+s+".lh",t,Laya.Handler.create(e,function(i){t.addChild(i),e._layaPet=i,Ve.shop.shopPetsLlist.push(i.name);var s=i.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate3,a.setValue(.6,.6,.6),s.localScale=a,n.setValue(0,0,0),s.rotationEuler=n}))}}}ChangeRole(){var e=this;if(e._layaMonkey&&Ve.role.getCurrRole()){e.unequipRole2();var t=_e.getLayer(14).getChildAt(0),i=Ve.role.getCurrRole().tb.roleMod,s=t.getChildByName(i);e.curRole=Ve.role.getCurrRole().tb.roleId,Ve.shop.useRoleShop(Ve.role.getCurrRole().tb.roleId);for(var a=Ve.shop.getShopListByType(3),n=0;n<a.length;n++)if(a[n].tb.targetId==Ve.role.getCurrRole().tb.roleId){e.lab_juesename.text=a[n].tb.shopName,e.qualityListShow(a[n].tb.quality),e.starListShow(a[n].tb.quality);break}if(e.roleNameTween(),null!=s)return e._layaMonkey.active=!1,e._layaMonkey!=s&&(e._layaMonkey=t.getChildByName(i.toString())),e._layaMonkey.active=!0,void e.equipRole(Ve.shop.equip_weapon);e._layaMonkey.active=!1,Tn.inst.load3d.thingRes("res/res3D/role/"+i+".lh",t,Laya.Handler.create(e,function(i){t.addChild(i),e._layaMonkey=i;var s=i.transform,a=s.localScale,n=s.rotationEuler;s.position=e._translate,a.setValue(1,1,1),s.localScale=a,n.setValue(0,0,0),s.rotationEuler=n,e.equipRole(Ve.shop.equip_weapon)}))}}qualityListShow(e){for(var t=0;t<this.qualityBox.numChildren;t++){var i=this.qualityBox.getChildAt(t);i.visible=!1,t+1==e&&(i.visible=!0)}}starListShow(e){for(var t=0;t<this.starBox.numChildren;t++){var i=this.starBox.getChildAt(t);i.visible=!0,t+1>e&&(i.visible=!1)}}roleNameTween(){var e=this;Laya.Tween.clearAll(e.img_bgrolename),e.img_bgrolename.y=-247,Laya.Tween.to(e.img_bgrolename,{y:10},600,Laya.Ease.backInOut,initHandler(e,()=>{Laya.Tween.clearAll(e.img_bgrolename)}))}unequipRole(){if(this._layaMonkey){var e=this._layaMonkey,t=Ve.game.shopWeaponLlist;if(t.length>0)for(var i=0;i<t.length;i++){var s=Xe.getBody(e,t[i]);s&&(s.removeSelf(),s.destroy())}this._layaMonkey=null}}unequipRole2(){if(this._layaMonkey){var e=this._layaMonkey,t=Ve.game.shopWeaponLlist;if(t.length>0)for(var i=0;i<t.length;i++){var s=Xe.getBody(e,t[i]);s&&(s.removeSelf(),s.destroy())}}}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}updateItem(e,t){e.setDataChange(e.dataSource,this)}updateItem2(e){e.setDataChange(e.dataSource)}onUserDataChange(){this.ui_money.txt_gold&&(this.ui_money.txt_gold.text=Ve.user.gold.toString())}chageCharm(){}onClickHandler(e){var t=this;switch(t.m_list.renderHandler=new Laya.Handler(t,t.updateItem),e.target){case t.btn_showMap1:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex);break;case t.btn_showMap2:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+1),i.read("firstSelectMap")||i.save("firstSelectMap","1");break;case t.btn_close:Tn.inst.sound.play(Ie.id.点击按扭),t.BtnContinueAction();break;case t.btn_nd:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.NiuDanPanel);break;case t.btn_zp:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.ZhuanPanPanel);break;case t.btn_sign:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.SignInPanel);break;case t.btn_Back:Tn.inst.sound.play(Ie.id.点击按扭),t.roleBox.visible=!0,t.roleShowBox.visible=!0,t.mapBox.visible=!1,t.this_bg2.visible=!1;break;case t.btn_map1:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex),i.read("firstSelectMap")||i.save("firstSelectMap","1");break;case t.btn_map2:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+1);break;case t.btn_map3:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+2);break;case t.btn_map4:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+3);break;case t.btn_map5:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+4);break;case t.btn_map6:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+5);break;case t.btn_map7:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+6);break;case t.btn_map8:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+7);break;case t.btn_map9:Tn.inst.sound.play(Ie.id.点击按扭),t.MapLockAction(t.mapStartIndex+8);break;case t.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.GoldPanel);break;case t.btn_juese:Tn.inst.sound.play(Ie.id.点击按扭),t.updateEquipButton(3);break;case t.btn_shop:Tn.inst.sound.play(Ie.id.点击按扭),t.updateEquipButton(5);break;case t.btn_pet:Tn.inst.sound.play(Ie.id.点击按扭),t.updateEquipButton(10);break;case t.btn_tuowei:Tn.inst.sound.play(Ie.id.点击按扭),t.updateEquipButton(12);break;case t.btn_continue:Tn.inst.sound.play(Ie.id.点击按扭),t.roleBox.visible=!1,t.roleShowBox.visible=!1,t.mapBox.visible=!0,t.this_bg2.visible=!0,this.firstScrollBar.visible=!0,pt.SpringAni(t.mapBox,200,0,1,1.2,initHandler(t,()=>{t.MapJieSuoAction(Ve.game.curJieSuolv)}))}}updateEquipButton(e){if(e)switch(e){case 3:this.onRoleDataChange(),this.SelectButtonAction(this.btn_juese,!0);break;case 5:this.onEquipChange(),this.SelectButtonAction(this.btn_shop,!0);break;case 10:this.onPetDataChange(),this.SelectButtonAction(this.btn_pet,!0);break;case 12:this.onTuoWeiDataChange(),this.SelectButtonAction(this.btn_tuowei,!0)}}SelectButtonAction(e,t){this.btn_juese.gray=t,this.btn_shop.gray=t,this.btn_pet.gray=t,this.btn_tuowei.gray=t,e.gray=!t,pt.SpringAni(this.btn_juese,100,.5,.5,.5),pt.SpringAni(this.btn_shop,100,.5,.5,.5),pt.SpringAni(this.btn_pet,100,.5,.5,.5),pt.SpringAni(this.btn_tuowei,100,.5,.5,.5),pt.SpringAni(e,100,.45,.55,.65),e!=this.btn_juese&&(this.m_list.scrollBar.value=0)}MapLockAction(e){var t=this;e-2001>0&&-1!=Ve.game.locklv.indexOf(e)?yt.getInstance().showVideo(null,null,()=>{console.log("视频播放成功"),Ve.game.locklv.splice(Ve.game.locklv.indexOf(e),1),Ve.game.saveLevelData(),t.ScrollMap(),t.GameStrengthAction(e)&&t.SelectMapAction(e)}):t.GameStrengthAction(e)&&t.SelectMapAction(e)}GameStrengthAction(e){var t=a.map.getTbBymap(e).actionValue;return t>Ve.user.action?(Ue.show("体力不足"),be.openTopTipPanel(we.AlertActionTipPanel),!1):(Ve.user.removeAction(t),!0)}MapJieSuoAction(e){var t=this;-1!=Ve.game.locklv.indexOf(e)&&(t.img_lockClick.visible=!0,t.m_renderMap.hScrollBar.value=200*(e-2001),t.m_renderMap.getChildAt(e-2001).getChildByName("sk_jiesuo").visible=!0,t.m_renderMap.getChildAt(e-2001).getChildByName("sk_jiesuo").play(0,!1),Laya.timer.once(2500,null,()=>{Ve.game.locklv.splice(Ve.game.locklv.indexOf(e),1),Ve.game.saveLevelData(),t.img_lockClick.visible=!1,t.m_renderMap.getChildAt(e-2001).getChildAt(0).visible=!1,t.m_renderMap.getChildAt(e-2001).getChildByName("sk_jiesuo").visible=!1}))}BtnContinueAction(){this.unequipRole(),_e.getLayer(14).getChildAt(0).active=!1,ea.scene.GamePause=!1,ea.scene.ui&&(ea.scene.ui.btn_openMap.disabled=!1),be.closepanel(we.ShopPanel),Ve.role.selectRole(Ve.role.equip_role),Ve.game.getrole=Number(Ve.role.getCurrRole().tb.roleMod),Ve.game.currole=Ve.game.getrole,ea.weapon.equipWeapon(Ve.shop.equip_weapon),cafe.event.dispatch(se.ClOSEPANELHANDLE)}SelectMapAction(e){(Tn.inst.sound.play(Ie.id.点击按扭),Ve.shop.getShop((Ve.role.getCurrRole().tb.roleId-1e4)/100+1e4).have)?(this.unequipRole(),_e.getLayer(14).getChildAt(0).active=!1,be.closepanel(we.ShopPanel),ea.scene.GamePause=!1,Ve.role.selectRole(Ve.role.equip_role),Ve.game.getrole=Number(Ve.role.getCurrRole().tb.roleMod),Ve.game.currole=Ve.game.getrole,ea.weapon.equipWeapon(Ve.shop.equip_weapon),Ve.game.maomaoLVint(),Ve.game.pkLvInt(),Ve.map.map=a.map.getTbBymap(e),Ve.game.MaoMaoGameType=Ve.map.map.gametype,We.closescene(we.GameScene),Js.map.runWith([e,1001])):Ue.show("未拥有该角色")}MapAction(){var e=this,t=[],i=0;for(let i=0;i<e.mapPanel.numChildren;i++){let s=e.mapPanel.getChildAt(i);s.y=242*i,t.push(s)}Ve.game.firstSelectMap.length>0?(e.mapId=Ve.game.firstSelectMap[0],Ve.game.firstSelectMap.splice(0,1)):e.mapId=e.randomRange(0,t.length),console.log("随机地图索引："+e.mapId),Laya.timer.clearAll(e.mapPanel),Laya.timer.frameLoop(1,e.mapPanel,()=>{for(let s=0;s<t.length;s++){t[s].y+=10,t[s].y>=242*(t.length-1)&&(t[s].y=-232,i++),e.MapSelect(t[s].y,s,0,242);let a=.5*e.mapPanel.height-121;i>=10&&t[e.mapId].y>=a&&t[e.mapId].y<=a+10&&(Laya.timer.clearAll(e.mapPanel),Laya.timer.once(1e3,e,()=>{e.SelectMapAction(e.mapId+2001),Laya.timer.clearAll(e),Laya.Tween.clearAll(e.btn_continue),Laya.Tween.clearAll(e.btn_juese),Laya.Tween.clearAll(e.btn_shop)}))}})}randomRange(e,t){return Math.floor(Math.random()*(t-e))+e}MapSelect(e,t,i,s){let a=this.mapSelectPanel.getChildAt(t);a&&(a.visible=e>=i&&e<=s)}ScaleTween(e,t,i,s,a=null){var n=new Laya.Tween;n.to(e,{scaleX:t,scaleY:i},s,null,initHandler(this,()=>{n.clear(),a&&a.run()}))}onDisable(){Laya.timer.clearAll(this),Ye.remove(this,this.onframe),this.cameraTexture.destroy(),super.onDisable()}}class nr extends Ee.res.modules.shop.ZhuanPanPanelUI{constructor(){super(),this.rospeed=0,this.rotime=0,this.isgo=!1,this.randomNum=0,this.targetRo=0,this.tblist=[],this.videoTime=1200,this.lastTime=0,this.addCom(this,fe)}onEnable(){super.onEnable();var e=this;ea.scene.GamePause=!0;var t=Laya.LocalStorage.getItem("ZhuanPanData");if(t)try{void 0!==(r=JSON.parse(t)).zhuanpanNum&&(Ve.game.zhuanpanNum=r.zhuanpanNum),void 0!==r.curTimeToTal&&(Ve.game.curTimeToTal=r.curTimeToTal),void 0!==r.lastTimeStamp&&(e.lastTimeStamp=r.lastTimeStamp)}catch(e){console.error("Parse ZhuanPanData error:",e)}if(e.lastTimeStamp&&Ve.game.curTimeToTal>0){var i=(new Date).getTime(),s=Math.floor((i-e.lastTimeStamp)/1e3);Ve.game.curTimeToTal=Math.max(0,Ve.game.curTimeToTal-s)}e.img_video.visible=Ve.game.zhuanpanNum<=0,e.img_video.visible&&(e.lab_videoTime.text=ls.getTime(Ve.game.curTimeToTal)+"后免费",e.lastTime=(new Date).getTime()),e.addClick(e.btn_addGold),e.addClick(e.btn_continue),e.addClick(e.btn_Back),e.addClick(e.btn_reward),e.addClick(e.btn_shuoming);var n=a.zhuanpan.tb(),o="";for(let e=0;e<n.length;e++){var r;o=o+(r=n[e]).zhuanpanDesc+" 概率"+r.Possibility+"%\n"}e.lab_shuoming.text=o;new Laya.Tween;e.tblist=a.zhuanpan.tb();for(let t=0;t<e.img_zp.numChildren;t++){var l=e.img_zp.getChildAt(t).getChildByName("icon");Tn.inst.setImageIcon(l,"res/icon/equip/"+e.tblist[t].IconId+".png"),e.img_zp.getChildAt(t).getChildAt(1).text=e.tblist[t].zhuanpanDesc+e.tblist[t].rewardNum}Ye.add(1,e,e.onframe),Ve.game.curTimeToTal<=0&&(e.reTime(),Ve.game.zhuanpanNum<=0&&(Ve.game.zhuanpanNum++,e.img_video.visible=!1))}reTime(){Ve.game.curTimeToTal=this.videoTime}onframe(){if(this.img_video.visible){var e=(new Date).getTime();0===this.lastTime&&(this.lastTime=e);var t=e-this.lastTime;if(t>=1e3){var i=Math.floor(t/1e3);Ve.game.curTimeToTal=Math.max(0,Ve.game.curTimeToTal-i),this.lastTime=e,Ve.game.curTimeToTal<=0&&(Ve.game.zhuanpanNum++,this.img_video.visible=!1,this.reTime()),this.lab_videoTime.text=ls.getTime(Ve.game.curTimeToTal)+"后免费"}}if(this.isgo){var s=(new Date).getTime();if(0!=this.rotime){var a=s-this.rotime;if(a<=2e3)this.rospeed+=.08;else if(a>=4e3&&this.rospeed>=1)this.rospeed-=.04;else if(this.rospeed<=1){var n=this.img_zp.rotation%360;if(n>=this.targetRo-10&&n<=this.targetRo+10&&this.rospeed>=1&&(this.rospeed-=.01),n>=this.targetRo-.5&&n<=this.targetRo+.5)return this.isgo=!1,this.rotime=0,void this.showRewardUI()}this.img_zp.rotation+=this.rospeed}else this.rotime=s}}showRewardUI(){var e=this,t=e.tblist[e.randomNum];Tn.inst.setImageIcon(e.img_rewardicon,"res/icon/equip/"+t.IconId+".png"),e.lab_rewarddes.text=t.zhuanpanDesc+t.rewardNum,e.btn_reward.visible=!1,Laya.Tween.clearAll(e.img_rewardicon),Laya.Tween.to(e.img_rewardicon,{scaleX:3,scaleY:3},800,null,initHandler(e,()=>{Laya.Tween.to(e.img_rewardicon,{scaleX:3.01,scaleY:3.01},1200,null,initHandler(e,()=>{Laya.Tween.to(e.img_rewardicon,{scaleX:1,scaleY:1},800,null,initHandler(e,()=>{Laya.Tween.clearAll(e.img_rewardicon),e.btn_reward.visible=!0}))}))})),e.group_content.visible=!0}rewardFunction(){var e=this.tblist[this.randomNum];switch(e.zhuanpanType){case 1:var t=e.rewardNum;if(Ve.user.isMaxAction())return void Ue.show("体力已满无法获得更多体力");Ve.user.addAction(t);break;case 2:t=e.rewardNum;Ve.user.addGold(t,ea.scene.moneypos,null);break;case 3:var i=e.rewardId.split(":"),s=81006==Number(i[0])?80014:Number(i[0]);console.log(s);var n=a.shop.getTbByShopId(s);if(console.log(n),cafe.event.dispatch(se.updateEquipButton,n.shopType),5==n.shopType)Ve.game.thisshop=5,Ve.shop.noMoneyBuyShop(n.shopId),Ve.shop.maps[n.shopId].have&&Ve.shop.useEquip(n.shopId,n.shopType);else if(3==n.shopType){var o=Ve.role.rolemap[n.targetId];if(o.isHave){Ue.show("已拥有角色,自动转化为等价金币");var r=ea.money.strToInfo(n.price);Ve.user.addGold(r.count,ea.scene.moneypos,null)}else Ve.shop.noMoneyBuyShop(n.shopId),Ve.role.haveRole(o.roleId,!1),Ve.role.selectRole(o.roleId)}else if(2==n.shopType){if(Ve.carlib.getCar(n.shopId).have){r=ea.money.strToInfo(n.price);Ve.user.addGold(r.count,ea.scene.moneypos,null)}else Ve.shop.noMoneyBuyShop(n.shopId),ea.car.localride(Ve.shop.equip_car)}else if(10==n.shopType)Ve.game.thisshop=10,Ve.shop.noMoneyBuyShop(n.shopId),Ve.npc.selectNpc(n.targetId);else if(12==n.shopType)Ve.shop.noMoneyBuyShop(n.shopId),Ve.shop.seleTuoWei(n.targetId);else if(Ve.shop.maps[n.shopId].have){r=ea.money.strToInfo(n.price);Ve.user.addGold(r.count,ea.scene.moneypos,null)}else Ve.shop.noMoneyBuyShop(n.shopId),Ve.shop.useEquip(n.shopId,1),ea.weapon.equipWeapon(Ve.shop.equip_weapon)}}onClickHandler(e){var t=this;switch(e.target){case t.btn_shuoming:t.box_shuoming.visible=!t.box_shuoming.visible;break;case t.btn_reward:t.rewardFunction(),t.group_content.visible=!1;break;case t.btn_Back:if(Tn.inst.sound.play(Ie.id.点击按扭),t.isgo)return;be.closepanel(we.ZhuanPanPanel);break;case t.btn_addGold:Tn.inst.sound.play(Ie.id.点击按扭),be.openpanel(we.GoldPanel);break;case t.btn_continue:if(Tn.inst.sound.play(Ie.id.点击按扭),t.isgo)return;var i=initHandler(t,()=>{t.randomNum=t.randomRange(1,100);var e=0;for(let i=0;i<t.tblist.length;i++){if((e+=t.tblist[i].Possibility)>=t.randomNum){t.randomNum=i,t.targetRo=t.randomRange(60*(t.randomNum+1),60*(t.randomNum+1)-60),Ve.game.zhuanpanNum--,Ve.game.zhuanpanNum<=0&&(Ve.game.zhuanpanNum=0,t.img_video.visible=!0,t.lastTime=(new Date).getTime()),t.isgo=!0;break}}});t.img_video.visible?yt.getInstance().showVideo(null,null,()=>{Ve.game.zhuanpanNum++,t.reTime(),i&&i.run()}):i&&i.run()}}randomRange(e,t){return Math.floor(Math.random()*(t-e))+e}onDisable(){ea.scene.GamePause=!1,cafe.event.dispatch(se.updateEquip),Ye.remove(this,this.onframe);var e={zhuanpanNum:Ve.game.zhuanpanNum,curTimeToTal:Ve.game.curTimeToTal,lastTimeStamp:(new Date).getTime()};Laya.LocalStorage.setItem("ZhuanPanData",JSON.stringify(e)),super.onDisable()}}class or extends it{constructor(){super()}onEnable(){super.onEnable()}setDay(e){this.day=e;for(var t=(o=a.signin.getTbByDay(this.day)).baseCount.split("|"),i=0;i<1;i++){var s=t[i].split("_"),n=Number(s[1]),o=a.signin.getTbByDay(this.day);this.owner.img_icon.skin=`res/icon/signIn/${7==this.day?"big":"small"}/${o.icon}.png`,this.owner.txt_selectReward.text=`x${n}`,"x无数"==this.owner.txt_selectReward.text&&(this.owner.txt_selectReward.text=""),"2"!=s[0]&&(this.owner.txt_selectReward.text=o.rewardname)}}signIn_state(e){a.signin.getTbByDay(this.day);e==this.day?Ve.signin.is_signin?(this.owner.img_select.visible=!0,this.owner.img_signin.visible=!0):(this.owner.img_select.visible=!0,this.owner.img_signin.visible=!1):(this.owner.img_select.visible=!1,this.owner.img_signin.visible=e>this.day)}onDestroy(){super.onDestroy()}}class rr extends Laya.Script{constructor(){super()}onEnable(){this.owner.on(Laya.Event.MOUSE_DOWN,this,this.handleMouseEvent),this.owner.on(Laya.Event.MOUSE_UP,this,this.handleMouseEvent),this.owner.on(Laya.Event.MOUSE_OUT,this,this.handleMouseEvent),this.sourceScale=this.owner.scaleX,this.sourceW=this.owner.width,this.sourceH=this.owner.height,this.sourceX=this.owner.x,this.sourceY=this.owner.y}handleMouseEvent(e){switch(e.type){case Laya.Event.MOUSE_DOWN:this.owner.scale(1.1*this.sourceScale,1.1*this.sourceScale),this.owner.x=this.sourceX-.05*this.sourceW,this.owner.y=this.sourceY-.05*this.sourceH;break;case Laya.Event.MOUSE_UP:case Laya.Event.MOUSE_OUT:this.owner.scale(this.sourceScale,this.sourceScale),this.owner.x=this.sourceX,this.owner.y=this.sourceY}}onDestroy(){this.owner.off(Laya.Event.MOUSE_DOWN,this,this.handleMouseEvent),this.owner.off(Laya.Event.MOUSE_UP,this,this.handleMouseEvent),this.owner.off(Laya.Event.MOUSE_OUT,this,this.handleMouseEvent),super.onDestroy()}}class lr extends Ee.res.modules.signIn.SignInPanelUI{constructor(){super(),this.isopen=!1,this.panelapi=ea.signin,this.addCom(this,fe)}onEnable(){super.onEnable();setTimeout(()=>{yt.getInstance().showCustomAd(5)},300),Lt.reportSignIn(1),ea.scene.GamePause=!0,this._param&&(this._param.handler&&(this.handler=this._param.handler),this._param.isopen&&(this.isopen=this._param.isopen)),this.ui_signInItem1=this.addCom(this.ui_item1,or),this.ui_signInItem2=this.addCom(this.ui_item2,or),this.ui_signInItem3=this.addCom(this.ui_item3,or),this.ui_signInItem4=this.addCom(this.ui_item4,or),this.ui_signInItem5=this.addCom(this.ui_item5,or),this.ui_signInItem6=this.addCom(this.ui_item6,or),this.ui_signInItem7=this.addCom(this.ui_item7,or),this.ui_signInItem1.setDay(1),this.ui_signInItem2.setDay(2),this.ui_signInItem3.setDay(3),this.ui_signInItem4.setDay(4),this.ui_signInItem5.setDay(5),this.ui_signInItem6.setDay(6),this.ui_signInItem7.setDay(7),this.addCom(this.btn_normal,rr),this.addCom(this.btn_addCount,rr),this.addCom(this.btn_addCount,li).playhuxi(600),this.bin(eo.NAME,this.onSignInDataChange,eo.STAGE_RES),this.btn_normal.visible=!0;for(var e=a.signin.getTbByDay(Ve.signin.signin_day+1).baseCount.split("|"),t=0;t<e.length;t++){var i=e[t].split("_");Number(i[0])}this.addClick(this.btn_addCount),this.addClick(this.btn_normal),this.addClick(this.btn_close)}onClickHandler(e){var t=this;switch(e.target){case t.btn_addCount:Tn.inst.sound.play(Ie.id.点击按扭),Lt.reportSignIn(2),yt.getInstance().showVideo(null,null,()=>{console.log("signin"),ea.signin.onRunHandler(t.handler),Ve.user.addGold(1e3,ea.scene.moneypos),cafe.event.dispatch(se.SIGNUICHANGE),cafe.event.dispatch(se.updateEquip)});break;case t.btn_normal:Tn.inst.sound.play(Ie.id.点击按扭),t.handler&&t.handler.run(),Ve.user.addGold(1e3,ea.scene.moneypos,null,()=>{Ve.signin.backToDefaultSignIn(),Ve.signin.isOneOpen=!1,be.closepanel(we.SignInPanel),cafe.event.dispatch(se.SIGNUICHANGE)});break;case t.btn_close:var i=t.handler;Tn.inst.sound.play(Ie.id.点击按扭),be.closepanel(we.SignInPanel),Ve.signin.isOneOpen=!1,i&&i.run()}}onSignInDataChange(e){this.box_signin.visible=!Ve.signin.is_signin;var t=Ve.signin.signin_day;Ve.signin.is_signin||(t+=1);for(var i=0;i<7;i++)this["ui_signInItem"+(i+1)].signIn_state(t)}onDisable(){ea.hall.enter(),ea.scene.GamePause=!1,super.onDisable()}}class hr extends Ee.res.modules.skill.SkillUnlockPanelUI{constructor(){super(),this.panelapi=ea.skill.unlock,this.addCom(this,fe)}onEnable(){super.onEnable();ea.scene.GamePause=!0,this._param&&(this.info=this._param.info),this._param?(this.handler=this._param.handler,this.platbox=ni.getBox(this,"group_panel"),ni.initPanelNodeNames(this,this.platbox,["btn_fuse","btn_video","btn_close","btn_close2"]),this.btn_video&&this.addClick(this.btn_video),this.addClick(this.btn_fuse),this.btn_close&&this.addClick(this.btn_close),this.btn_close2&&this.addClick(this.btn_close2)):be.closepanel(this.name)}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}onClickHandler(e){switch(e.target){case this.btn_close:case this.btn_close2:be.closepanel(this.name),ea.scene.GamePause=!1,this.handler&&this.handler.runWith([-1]);break;case this.btn_fuse:ea.skill.unlock.onBuyHandler(this.handler);break;case this.btn_video:ea.skill.unlock.onRunHandler(this.handler)}}onDisable(){super.onDisable()}}class cr extends Ee.res.modules.task.TaskFinishPanelUI{constructor(){super(),this.isdispose=!1,this._money=0;this.islock=!1,this.panelapi=ea.task.finish,this.addCom(this,fe)}onEnable(){var e=this;super.onEnable(),Lt.report({params:{type:"gameSuccess",data:{level:Ve.game.mission_id}}}),Lt.stopRecord(),ea.scene.GamePause=!0,cafe.event.dispatch(se.GAME_NPC_CH),Tn.inst.sound.play(0),Tn.inst.sound.play(Ie.id.任务完成),e.platbox=ni.getBox(e),ni.initPanelNodeNames(e,e.platbox,["btn_action","btn_continue"]),e.btn_continue&&(e.btn_continue.visible=!1),e.btn_action&&e.addClick(e.btn_action),e.btn_continue&&e.addClick(e.btn_continue),e._param&&(e.task=e._param.task),e.showBtn(),Laya.Tween.clearTween(e),Laya.Tween.to(e,{money:e.task.tb.taskGold},1e3,null,initHandler(e,()=>{Laya.Tween.clearTween(e)})),e.txt_title.text=e.task.tb.taskName,e.binGuide()}onResize(){this.moneypos=this.ui_money?this.ui_money.img_gold.parent.localToGlobal(new Laya.Point(this.ui_money.img_gold.x,this.ui_money.img_gold.y)):new Laya.Point(0,0)}get money(){return this._money}set money(e){Math.round(this._money)!=Math.round(e)&&(Tn.inst.sound.play(Ie.id.结算金币滚动效果),this.txt_money.text=Math.round(e).toString()),this._money=e}showBtn(){var e=this;e.btn_continue&&(e.btn_continue.visible=!0,e.addCom(e.btn_continue,li).playTDSizeFlash(null,1.1,180,500)),e.btn_action&&e.addCom(e.btn_action,li).playTDSizeFlash(initHandler(e,()=>{e.addCom(e.btn_action,li).playhuxi(500)}),1.2,500,180)}onClickHandler(e){switch(e.target){case this.btn_action:Tn.inst.sound.play(Ie.id.点击按扭),console.log("点击下一关_1"),console.log("通往下一关"),Lt.report({params:{type:"gameWin10BLevel",data:{level:Ve.game.mission_id}}}),ea.task.finish.onRunNBRewardHandler(this._param.handler);break;case this.btn_continue:Tn.inst.sound.play(Ie.id.点击按扭),ea.task.finish.onRunRewardHandler(this._param.handler)}}onDisable(){this.clearTimer(this,this.showBtn),Laya.Tween.clearTween(this),super.onDisable()}handleGuideTransition(){}}class dr extends Ee.res.modules.task.TaskSuccessItemViewUI{constructor(){super()}onEnable(){super.onEnable()}onClickHandler(e){switch(e.target){case this.img_noSelected:Ve.level.getLevelBypreLevelId(this.mission_id)}}setDataChange(e,t){this._data=e,this.txt_title.text=this._data.tb.taskName,this.txt_rewardcount.text="x"+this._data.tb.taskReward;var i=Math.floor(this._data.count/this._data.tb.taskCount*100)/100;this.img_finish.visible=2==this._data.state;var s=this.img_finish.visible?292:0==i?0:292*i;s<1&&(s=1),this.img_exp.width=s,this.txt_count.text=this.img_finish.visible?this._data.tb.taskCount+"/"+this._data.tb.taskCount:this._data.count+"/"+this._data.tb.taskCount}selectItem(e){this.img_noSelected.visible=this.mission_id!=e}onDestroy(){super.onDestroy()}}class ur extends Ee.res.modules.task.TaskSuccessPanelUI{constructor(){super();this.panelapi=ea.task.success,this.addCom(this,fe)}onEnable(){super.onEnable(),this.addCom(this,jo),this.m_list.itemRender=dr,this.m_list.selectHandler=new Laya.Handler(this,this.onSelect),this.m_list.renderHandler=new Laya.Handler(this,this.updateItem),this.list=Ve.task.getTask2List(),this.list.sort((e,t)=>2==e.state&&2!=t.state?1:2!=e.state&&2==t.state?-1:0),this.m_list.array=this.list}onClickHandler(e){Tn.inst.sound.play(Ie.id.点击按扭),ea.task.success.onRunHandler()}updateItem(e,t){e.setDataChange(e.dataSource,Ve.level.select_id)}onSelect(e){this.list[e]}onDisable(){super.onDisable()}}class pr extends Ee.res.modules.tips.AlertActionTipPanelUI{constructor(){super(),this.addCom(this,fe)}onEnable(){super.onEnable();pt.SpringAni(this.box_alert,200),Lt.reportActionPanel(1),this.addClick(this.btn_yes),this.addClick(this.btn_close),this.bin(qn.NAME,this.onUserDataChange,qn.RESOURCE_RES),Ye.add(1,this,this.onframe)}onUserDataChange(){this.actionCount.text="当前体力："+Ve.user.action.toString()}onframe(){this.actionTime.text=ls.getTime(Ve.user.getActionTime())}onClickHandler(e){var t=this;switch(e.target){case t.btn_close:Tn.inst.sound.play(Ie.id.点击按扭),Lt.reportActionPanel(3),be.closepanel(t.name);break;case t.btn_yes:if(Tn.inst.sound.play(Ie.id.点击按扭),Lt.reportActionPanel(2),Ve.user.isMaxAction())return void Ue.show("体力已满无法获得更多体力");yt.getInstance().showVideo(null,null,()=>{console.log("视频播放成功"),Lt.reportActionPanel(5),Ve.user.addAction(10),be.closepanel(t.name)})}}onDisable(){Ye.remove(this,this.onframe),super.onDisable()}}class mr extends Laya.Script{constructor(){super()}onEnable(){this.owner.y=Laya.stage.height/2,this.startTween()}onDisable(){Laya.Tween.clearAll(this.owner)}startTween(){Laya.Tween.to(this.owner,{y:Laya.stage.height/2-200},1e3,null,Laya.Handler.create(this,()=>{this.owner.removeSelf(),this.destroy()}))}}class gr extends Laya.Script{constructor(){super(...arguments),this.getBtn=null,this.closeBtn=null,this.video=null,this.effect=null,this.progressBar=null,this.data=null,this.openBox=null,this.m_lastShowVideoTime=new Date("1999-01-01"),this.showVideo=!1,this.hasShowVideo=!1}onAwake(){this.getBtn=this.owner.getChildByName("getBtn"),this.video=this.getBtn.getChildByName("video"),this.closeBtn=this.owner.getChildByName("center").getChildByName("closeBtn"),this.effect=this.owner.getChildByName("center").getChildByName("effect"),this.progressBar=this.owner.getChildByName("center").getChildByName("progressBar"),this.hasShowVideo=!1,Laya.Browser.height>1.3*Laya.Browser.width&&(this.getBtn.centerX=0);let e=this.owner._aniList;for(let t=0;t<e.length;t++){let i=e[t];if("openBox"==i._animationData.name){this.openBox=i;break}}Laya.SoundManager.playSound("ad/GetCoin.ogg",1,null,null,1)}onEnable(){this.breath(this.getBtn,500,1.3)}onStart(){let e=this.owner.getChildByName("center").getChildByName("diamond");this.getBtn.on(Laya.Event.CLICK,this,()=>{this.progressBar.value+=.12}),this.getBtn.on(Laya.Event.MOUSE_DOWN,this,()=>{e.visible=!1,this.openBox.play(0,!1)}),this.rotateImg(),this.video.visible=!1,this.closeBtn.on(Laya.Event.CLICK,this,()=>{this.onHide()}),Laya.timer.loop(5,this,()=>{this.progressBar.value>0&&(this.progressBar.value-=.003)})}onUpdate(){this.progressBar.value>.6&&this.Throttling()&&this.onVideo()}getData(e){this.data=e}rotateImg(){Laya.Tween.to(this.effect,{rotation:this.effect.rotation+360},2e3,null,Laya.Handler.create(this,function(){this.rotateImg()}))}Throttling(){let e=new Date;return!(e.getTime()-this.m_lastShowVideoTime.getTime()<3e3)&&(this.m_lastShowVideoTime=e,!0)}onVideo(){this.hasShowVideo||(this.hasShowVideo=!0,io.getInstance().displayIncentivizedAd(()=>{this.Reward()},()=>{this.Reward()}))}Reward(){this.EnterGame()}EnterGame(){this.onHide(),io.getInstance().OnReward()}onHide(){this.progressBar.value=0,this.hasShowVideo=!1,this.owner.destroy()}breath(e,t,i){e.scale(1,1);let s=1,a=function(){s=1==s?i:1,Laya.Tween.to(e,{scaleX:s,scaleY:s},t)};Laya.timer.loop(t,this,a),a()}}class yr extends Laya.Script{constructor(){super()}onEnable(){if(console.log("=======rkyj"),this.rkyj=this.owner,"toutiao"==io.getInstance().platform&&"true"==localStorage.getItem("ttSideBar"))if(localStorage.getItem("ttLastRewardTime")){let e=(new Date).getTime()-parseInt(localStorage.getItem("ttLastRewardTime"));e>144e4?this.rkyj.visible=!0:console.log("上次获取奖励经过: "+e/1e3)}else this.rkyj.visible=!0;this.rkyj.on(Laya.Event.CLICK,this,this.Rkyj)}Rkyj(){Laya.loader.load("JY/rkyjPanel.json",Laya.Handler.create(this,e=>{let t=new Laya.Prefab;t.json=e;var i=Laya.Pool.getItemByCreateFun("rkyjPanel",t.create,t);Laya.stage.addChild(i)}))}}class fr extends Laya.Script{constructor(){super()}onEnable(){let e=this.owner;if(e.height>Laya.stage.height){let t=Laya.stage.height/e.height*.95;e.scaleX=e.scaleY=t}this.goBtn=this.owner.getChildByName("goBtn"),this.rewardBtn=this.owner.getChildByName("rewardBtn"),this.close=this.owner.getChildByName("close"),console.log("非真机"),this.rewardBtn.visible=!0,this.goBtn.on(Laya.Event.CLICK,this,this.GoToSideBar),this.rewardBtn.on(Laya.Event.CLICK,this,this.GetReward),this.close.on(Laya.Event.CLICK,this,this.ClosePanel),this.showAni()}showAni(){this.roleAni=new Laya.Animation,this.roleAni.interval=300,this.roleAni.loadAtlas("res/atlas/res/gif.atlas",Laya.Handler.create(this,this.onLoadedAni))}onLoadedAni(){this.owner.getChildByName("aniPos").addChild(this.roleAni),this.roleAni.play()}GoToSideBar(){window.tt.navigateToScene({scene:"sidebar",success:e=>{console.log("navigate to scene success")},fail:t=>{console.log("navigate to scene fail: ",t),e.GetInstance().ShowTips("自动跳转失败，可主动从侧边栏访问本游戏后领奖")}}),setTimeout(()=>{e.GetInstance().ShowTips("若点击按钮无反应，可主动从侧边栏访问本游戏后领奖")},2e3),this.ClosePanel()}GetReward(){localStorage.setItem("ttLastRewardTime",(new Date).getTime().toString()),null!=Laya.stage.getChildByName("rkyj")&&Laya.stage.getChildByName("rkyj").removeSelf(),this.ClosePanel()}ClosePanel(){null!=Laya.stage.getChildByName("rkyjPanel")&&Laya.stage.getChildByName("rkyjPanel").removeSelf()}}class _r{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("uishell/modules/loadding/LoaddingPanel.ts",no),e("AdScript/rzxx.ts",oo),e("uishell/modules/loadding/SmallLoaddingPanel.ts",ro),e("uishell/modules/common/GameStrengthView.ts",lo),e("uishell/modules/common/MoneyBuyView.ts",ho),e("uishell/modules/tips_ui/MoneyTipsView.ts",Un),e("uishell/modules/tips_ui/TipsView.ts",Ue),e("uishell/modules/drop/DropAdiPanel.ts",co),e("script/MoneyBarParams.ts",uo),e("uishell/modules/drop/DropBuffPanel.ts",po),e("uishell/modules/drop/DropDependPanel.ts",mo),e("uishell/modules/drop/DropEquipPanel.ts",go),e("uishell/modules/drop/DropRewardPanel.ts",yo),e("uishell/modules/end/EndLostPanel.ts",fo),e("uishell/modules/end/EndTimeOutPanel.ts",_o),e("uishell/modules/end/EndUpPanel.ts",vo),e("uishell/modules/end/EndUpPanel1.ts",bo),e("uishell/modules/end/EndUpPanel3.ts",wo),e("uishell/modules/end/EndWinPanel.ts",To),e("shell/modules/game/GameScene.ts",Io),e("uishell/modules/game/MainUiTaskItem.ts",ci),e("uishell/modules/game/MainUiView.ts",Eo),e("uishell/modules/role/NpcListItemView1.ts",ko),e("uishell/modules/game/GoldPanel.ts",Co),e("uishell/modules/game/RoleTrialPanel.ts",Lo),e("shell/modules/game/thing/ui/BuffItemView.ts",et),e("shell/modules/game/thing/ui/HeroInfoView.ts",tt),e("shell/modules/game/view/TaskArrowView.ts",Mo),e("framework/script/MateUiSize.ts",fe),e("script/GuideImgClick.ts",So),e("uishell/modules/guide/GuidePanel.ts",Dt),e("script/GuidePPTClick.ts",Po),e("uishell/modules/hall/hallListItemView.ts",Ro),e("uishell/modules/hall/HallScene.ts",Do),e("shell/modules/login/LoginScene.ts",No),e("uishell/modules/main/MainPanel.ts",Ho),e("shell/modules/common/TabBoxScript.ts",Bo),e("uishell/modules/pause/PausePanel.ts",Oo),e("shell/modules/plot/TalkView.ts",zo),e("uishell/modules/role/GetRolePanel.ts",Vo),e("uishell/modules/role/GetRoleTestPanel.ts",Fo),e("uishell/modules/role/NpcListItemView.ts",Uo),e("uishell/modules/role/NpcListPanel.ts",qo),e("uishell/modules/role/RoleListItemView.ts",Yo),e("uishell/modules/role/RoleListItemView2.ts",Wo),e("uishell/modules/role/RoleListPanel.ts",Xo),e("uishell/modules/share/SharePanel.ts",Ko),e("uishell/modules/shop/GetEquipTestPanel.ts",Jo),e("uishell/modules/shop/GetWinRewardPanel.ts",Zo),e("uishell/modules/shop/NdRewardItem.ts",Qo),e("uishell/modules/shop/NiuDanPanel.ts",$o),e("uishell/modules/shop/npcShopItemView.ts",er),e("uishell/modules/shop/npcShopPanel.ts",tr),e("uishell/modules/shop/ShopItemView.ts",ir),e("uishell/modules/shop/ShopItemView2.ts",sr),e("uishell/modules/shop/ShopPanel.ts",ar),e("uishell/modules/shop/ZhuanPanPanel.ts",nr),e("uishell/modules/signin/SignInPanel.ts",lr),e("uishell/modules/skill/SkillUnlockPanel.ts",hr),e("uishell/modules/task/TaskFinishPanel.ts",cr),e("uishell/modules/task/TaskSuccessItem.ts",dr),e("uishell/modules/task/TaskSuccessPanel.ts",ur),e("uishell/modules/tips_ui/AlertActionTipPanel.ts",pr),e("AdScript/TipsEffect.ts",mr),e("AdScript/QTEPanel_Ctrl.ts",gr),e("AdScript/rkyjBtn.ts",yr),e("AdScript/rkyjPanel.ts",fr)}}_r.width=1336,_r.height=540,_r.scaleMode="noscale",_r.screenMode="horizontal",_r.alignV="middle",_r.alignH="center",_r.startScene="res/modules/hall/HallScene.scene",_r.sceneRoot="",_r.debug=!1,_r.stat=!1,_r.physicsDebug=!1,_r.exportSceneToJson=!0,_r.init();class vr{static init(){var e=vr;e._ltid=1,e.timer=0,e._timerMap={},Laya.stage.timerLoop(1e3,e,e.onTimer)}static onTimer(){var e=vr;e.timer++;var t=e.timer;for(var i in e._timerMap){e._timerMap[i].runWith([t])}}static getLtid(e){var t=vr;return e._ltid?e._ltid:(e._ltid=t._ltid,t._ltid++,e._ltid)}static ishash(e){var t=vr,i=t.getLtid(e);return t._timerMap[i]}static add(e,t){var i=vr,s=i.getLtid(e);i._timerMap[s]=new Laya.Handler(e,t)}static remove(e,t){var i=vr,s=i.getLtid(e);delete i._timerMap[s]}static dispose(){var e=vr;e._ltid=1,e.timer=0,e._timerMap={}}}class br{static initEngine(e,t,i,s,a){var n=br;n.GlobalGame=s,window.GameApp=n,window.Laya3D?Laya3D.init(_r.width,_r.height):Laya.init(_r.width,_r.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=_r.scaleMode,Laya.stage.screenMode=_r.screenMode,Laya.URL.exportSceneToJson=_r.exportSceneToJson,(_r.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),_r.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),slog("初始化GameApp.initEngine"),fe.initSize(t,i),Ye.init(),vr.init(),n.GlobalGame.setup_1(a)}static switch_stat_state(e){"1"==e?Laya.Stat.show():Laya.Stat.hide(),localSave("Laya_Stat_State",e)}static initSystem(e){var t=br;slog("初始化完成"),t.GlobalGame.initSystem(),ve.init(Laya.loader.getRes("uires.json")),_e.init(),Rt.init(),be.init(),_e.setStage(Laya.stage,[0,1,2,4,6,8,7,10,9,14,15]),slog("cafe.table完成")}}br.thisobj={};class wr extends Laya.Material{constructor(){super(),this.setShaderName(xi.GLOW)}get diffuseTexture(){return this._shaderValues.getTexture(wr.DIFFUSETEXTURE)}set diffuseTexture(e){this._shaderValues.setTexture(wr.DIFFUSETEXTURE,e)}set marginalColor(e){this._shaderValues.setVector3(wr.MARGINALCOLOR,e)}static initShader(){var e={a_Position:Laya.VertexMesh.MESH_POSITION0,a_Normal:Laya.VertexMesh.MESH_NORMAL0,a_Texcoord:Laya.VertexMesh.MESH_TEXTURECOORDINATE0,a_BoneWeights:Laya.VertexMesh.MESH_BLENDWEIGHT0,a_BoneIndices:Laya.VertexMesh.MESH_BLENDINDICES0},t={u_Bones:Laya.Shader3D.PERIOD_CUSTOM,u_CameraPos:Laya.Shader3D.PERIOD_CAMERA,u_MvpMatrix:Laya.Shader3D.PERIOD_SPRITE,u_WorldMat:Laya.Shader3D.PERIOD_SPRITE,u_texture:Laya.Shader3D.PERIOD_MATERIAL,u_marginalColor:Laya.Shader3D.PERIOD_MATERIAL,"u_SunLight.color":Laya.Shader3D.PERIOD_SCENE},i=Laya.Shader3D.add(xi.GLOW),s=new Laya.SubShader(e,t);i.addSubShader(s),s.addShaderPass('\n        #include "Lighting.glsl";\n        attribute vec4 a_Position;\n        attribute vec2 a_Texcoord;\n        attribute vec3 a_Normal;\n        uniform mat4 u_MvpMatrix;\n        uniform mat4 u_WorldMat;\n        varying vec2 v_Texcoord;\n        varying vec3 v_Normal;\n        #ifdef BONE\n        attribute vec4 a_BoneIndices;\n        attribute vec4 a_BoneWeights;\n        const int c_MaxBoneCount = 24;\n        uniform mat4 u_Bones[c_MaxBoneCount];\n        #endif\n        #if defined(DIRECTIONLIGHT)\n        varying vec3 v_PositionWorld;\n        #endif\n        void main()\n        {\n        #ifdef BONE\n        mat4 skinTransform=mat4(0.0);\n        skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n        skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n        skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n        skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n        vec4 position = skinTransform * a_Position;\n        gl_Position=u_MvpMatrix * position;\n        mat3 worldMat=mat3(u_WorldMat * skinTransform);\n        #else\n        gl_Position=u_MvpMatrix * a_Position;\n        mat3 worldMat=mat3(u_WorldMat);\n        #endif\n        v_Texcoord=a_Texcoord;\n        v_Normal=worldMat*a_Normal;\n        #if defined(DIRECTIONLIGHT)\n        #ifdef BONE\n        v_PositionWorld=(u_WorldMat*position).xyz;\n        #else\n        v_PositionWorld=(u_WorldMat*a_Position).xyz;\n        #endif\n        #endif\n        gl_Position=remapGLPositionZ(gl_Position); \n        }','\n        #ifdef FSHIGHPRECISION\n            precision highp float;\n        #else\n            precision mediump float;\n        #endif\n        #include "Lighting.glsl";\n        varying vec2 v_Texcoord;\n        uniform sampler2D u_texture;\n        uniform vec3 u_marginalColor;\n        varying vec3 v_Normal;\n        #if defined(DIRECTIONLIGHT)\n            uniform vec3 u_CameraPos;\n            varying vec3 v_PositionWorld;\n            uniform DirectionLight u_SunLight;\n        #endif\n        void main()\n        {\n            gl_FragColor=texture2D(u_texture,v_Texcoord);\n            vec3 normal=normalize(v_Normal);\n            vec3 toEyeDir = normalize(u_CameraPos-v_PositionWorld);\n            float Rim = 1.0 - max(0.0,dot(toEyeDir, normal));\n            vec3 lightColor = u_SunLight.color;\n            vec3 Emissive = 2.0 * lightColor * u_marginalColor * pow(Rim,3.0);  \n            gl_FragColor = texture2D(u_texture, v_Texcoord) + vec4(Emissive,1.0);\n        }')}}wr.DIFFUSETEXTURE=Laya.Shader3D.propertyNameToID("u_texture"),wr.MARGINALCOLOR=Laya.Shader3D.propertyNameToID("u_marginalColor");class Tr extends Laya.Material{constructor(){super(),this.setShaderName(xi.MULTIPLEPASSOUTLINE),this._shaderValues.setNumber(Tr.OUTLINEWIDTH,.01581197),this._shaderValues.setNumber(Tr.OUTLINELIGHTNESS,1),this._shaderValues.setVector(Tr.OUTLINECOLOR,new Laya.Vector4(1,1,1,0))}get diffuseTexture(){return this._shaderValues.getTexture(Tr.DIFFUSETEXTURE)}set diffuseTexture(e){this._shaderValues.setTexture(Tr.DIFFUSETEXTURE,e)}set marginalColor(e){this._shaderValues.setVector3(Tr.MARGINALCOLOR,e)}static __init__(){}get albedoTexture(){return this._shaderValues.getTexture(Tr.ALBEDOTEXTURE)}set albedoTexture(e){this._shaderValues.setTexture(Tr.ALBEDOTEXTURE,e)}get outlineColor(){return this._shaderValues.getVector(Tr.OUTLINECOLOR)}set outlineColor(e){this._shaderValues.setVector(Tr.OUTLINECOLOR,e)}get outlineWidth(){return this._shaderValues.getNumber(Tr.OUTLINEWIDTH)}set outlineWidth(e){e=Math.max(0,Math.min(.05,e)),this._shaderValues.setNumber(Tr.OUTLINEWIDTH,e)}get outlineLightness(){return this._shaderValues.getNumber(Tr.OUTLINELIGHTNESS)}set outlineLightness(e){e=Math.max(0,Math.min(1,e)),this._shaderValues.setNumber(Tr.OUTLINELIGHTNESS,e)}static initShader(){var e={a_Position:Laya.VertexMesh.MESH_POSITION0,a_Normal:Laya.VertexMesh.MESH_NORMAL0,a_Texcoord:Laya.VertexMesh.MESH_TEXTURECOORDINATE0,a_BoneWeights:Laya.VertexMesh.MESH_BLENDWEIGHT0,a_BoneIndices:Laya.VertexMesh.MESH_BLENDINDICES0},t={u_Bones:Laya.Shader3D.PERIOD_CUSTOM,u_CameraPos:Laya.Shader3D.PERIOD_CAMERA,u_MvpMatrix:Laya.Shader3D.PERIOD_SPRITE,u_WorldMat:Laya.Shader3D.PERIOD_SPRITE,u_texture:Laya.Shader3D.PERIOD_MATERIAL,u_marginalColor:Laya.Shader3D.PERIOD_MATERIAL,"u_SunLight.color":Laya.Shader3D.PERIOD_SCENE},i=Laya.Shader3D.add(xi.MULTIPLEPASSOUTLINE),s=new Laya.SubShader(e,t);i.addSubShader(s),s.addShaderPass('\n        #include "Lighting.glsl";\n        attribute vec4 a_Position;\n        attribute vec2 a_Texcoord;\n        attribute vec3 a_Normal;\n        uniform mat4 u_MvpMatrix;\n        uniform mat4 u_WorldMat;\n        varying vec2 v_Texcoord;\n        varying vec3 v_Normal;\n        #ifdef BONE\n        attribute vec4 a_BoneIndices;\n        attribute vec4 a_BoneWeights;\n        const int c_MaxBoneCount = 24;\n        uniform mat4 u_Bones[c_MaxBoneCount];\n        #endif\n        #if defined(DIRECTIONLIGHT)\n        varying vec3 v_PositionWorld;\n        #endif\n        void main()\n        {\n        #ifdef BONE\n        mat4 skinTransform=mat4(0.0);\n        skinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n        skinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n        skinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n        skinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n        vec4 position = skinTransform * a_Position;\n        gl_Position=u_MvpMatrix * position;\n        mat3 worldMat=mat3(u_WorldMat * skinTransform);\n        #else\n        gl_Position=u_MvpMatrix * a_Position;\n        mat3 worldMat=mat3(u_WorldMat);\n        #endif\n        v_Texcoord=a_Texcoord;\n        v_Normal=worldMat*a_Normal;\n        #if defined(DIRECTIONLIGHT)\n        #ifdef BONE\n        v_PositionWorld=(u_WorldMat*position).xyz;\n        #else\n        v_PositionWorld=(u_WorldMat*a_Position).xyz;\n        #endif\n        #endif\n        gl_Position=remapGLPositionZ(gl_Position); \n        }','\n        #ifdef FSHIGHPRECISION\n            precision highp float;\n        #else\n            precision mediump float;\n        #endif\n        #include "Lighting.glsl";\n        varying vec2 v_Texcoord;\n        uniform sampler2D u_texture;\n        uniform vec3 u_marginalColor;\n        varying vec3 v_Normal;\n        #if defined(DIRECTIONLIGHT)\n            uniform vec3 u_CameraPos;\n            varying vec3 v_PositionWorld;\n            uniform DirectionLight u_SunLight;\n        #endif\n        void main()\n        {\n            gl_FragColor=texture2D(u_texture,v_Texcoord);\n            vec3 normal=normalize(v_Normal);\n            vec3 toEyeDir = normalize(u_CameraPos-v_PositionWorld);\n            float Rim = 1.4 - max(0.0,dot(toEyeDir, normal));\n            vec3 lightColor = u_SunLight.color;\n            vec3 Emissive = 1.0 * lightColor * u_marginalColor * pow(Rim,3.0);  \n            gl_FragColor = texture2D(u_texture, v_Texcoord) + vec4(Emissive,1.0);\n        }')}}Tr.DIFFUSETEXTURE=Laya.Shader3D.propertyNameToID("u_texture"),Tr.MARGINALCOLOR=Laya.Shader3D.propertyNameToID("u_marginalColor"),Tr.ALBEDOTEXTURE=Laya.Shader3D.propertyNameToID("u_AlbedoTexture"),Tr.OUTLINECOLOR=Laya.Shader3D.propertyNameToID("u_OutlineColor"),Tr.OUTLINEWIDTH=Laya.Shader3D.propertyNameToID("u_OutlineWidth"),Tr.OUTLINELIGHTNESS=Laya.Shader3D.propertyNameToID("u_OutlineLightness");class Ar{static init(){wr.initShader(),Tr.initShader()}static getMaterial(e,t,i){var s,a=e.skinnedMeshRenderer.material;switch(t){case xi.GLOW:var n=new wr;n.diffuseTexture=a.albedoTexture,n.marginalColor=i.v3color,s=n;break;case xi.MULTIPLEPASSOUTLINE:var o=new Tr;o.diffuseTexture=a.albedoTexture,o.marginalColor=i.v3color,s=o}return{show:()=>{e.skinnedMeshRenderer.material=s},hide:()=>{e.skinnedMeshRenderer.material=a}}}}class xr extends he{constructor(){super();cafe.mount.mountOn(se.TEST1,this.onTest1Handler,this),cafe.mount.mountOn(se.TEST2,this.onTest2Handler,this),cafe.mount.on(se.TEST1,this.onTest1,this),cafe.mount.on(se.TEST2,this.onTest2,this)}onTest1Handler(){return!1}onTest2Handler(){return!0}onTest1(e){slog("PanelMount.onTest1",e)}onTest2(e){slog("PanelMount.onTest2",e)}}class kr{static init(){cafe.mount.reg(se.CLOSE_PANEL,2),cafe.mount.reg(se.OPEN_PANEL,3),cafe.mount.reg(se.TEST1,2),cafe.mount.reg(se.TEST2,3),kr.panel=new xr,cafe.mount.dispatch(se.TEST2,12213),cafe.mount.dispatch(se.TEST1,123456)}}class Er{static resLoadPath(e){return e.replace(".scene",".json")}static init(){cafe.event.on(se.OPEN_PANEL,e=>{var t;switch(e.panelid){case Er.GameWin:t=we.EndWinPanel;break;case Er.GameLost:t=we.EndLostPanel;break;case Er.AlertTip:break;default:return void Ue.show(`模块${e.panelid}缺失！！！！`)}be.openpanel(t,e.params)},{}),cafe.event.on(se.CLOSE_PANEL,e=>{e&&be.closepanel(e.name)},{})}}Er.GameWin=1,Er.GameLost=2,Er.AlertTip=3,Er.GameWin2=4;class Ir{static init(){window&&window.addEventListener&&(window.addEventListener("keydown",Ir.onkeydown),window.addEventListener("keyup",Ir.onkeyup))}static onkeydown(e){var t=e.ctrlKey,i="run";e.altKey&&(i+="Alt"),e.shiftKey&&(i+="Shift"),t&&(i+="Ctrl"),cafe.event.dispatch(se.KEY_BOARD_LISTENER+`_${i}_${e.code}`,{key:`${i}${e.code}`,type:"keydown"})}static onkeyup(e){var t=e.ctrlKey,i="run";e.altKey&&(i+="Alt"),e.shiftKey&&(i+="Shift"),t&&(i+="Ctrl"),cafe.event.dispatch(se.KEY_BOARD_UP_LISTENER+`_${i}_${e.code}`,{key:`${i}${e.code}`,type:"keyup"})}}class Cr{static get_list(){return[]}}class Lr{static load_list(){return[{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_loadding_bg.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_boxbg.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_bg.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/bg.jpg"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_liaot.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_usehw.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_jiazaidi.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_jiazaitiao.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/p.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/biaoti.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/jinbi.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/img_guanka.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/xd.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/gbx.png"},{type:me.res2d,restype:pe.img2d_res,url:"localImg/zd.png"},{type:me.rescfg,restype:pe.rescfg_table,url:"uires.json"},{type:me.res2d,restype:pe.scene2d_res,url:"localui/loadding.scene"},{type:me.res2d,restype:pe.scene2d_res,url:"localui/smallloadding.scene"},{type:me.res2d,restype:pe.res2d_db,url:"localdb/jiazai/jiazai"},{type:me.res2d,restype:pe.res2d_db,url:"localdb/loaddingflash2/loaddingflash2"},{type:me.res2d,restype:pe.res2d_db,url:"localdb/xinshou/xinshou"}]}}class Mr{static init(){cafe.event.on("NETSWH_LOAD_END",Mr.on_net_swh_load_end,Mr.thisobj)}static initSystem(){yt.getInstance().onInit(()=>{yt.getInstance().onLogin()}),Me.init(),Ar.init(),cafe.event.on("ON_GAME_APP_HIDE",Mr.onHide,Mr.thisobj),cafe.event.on("ON_GAME_APP_SHOW",Mr.onShow,Mr.thisobj)}static init_L(){s.init(),ze.init(),Er.init(),Ir.init(),ea.init(),kr.init()}static init_G(){cafe.logType=1,cafe.isZip=!1,cafe.table_path=ce.fullPath("res/table/"),serror("Laya.System.name : ",Laya.System.name),Oi.exit=Ie.exit[0]}static on_net_swh_load_end(){Se.init()}static onShow(){}static onHide(){var e=0;Ve.level&&Ve.level.max_mission_id&&(e=Ve.level.max_mission_id%1e4),Lt.report({params:{type:"changePreviousStage",data:{level:e}}})}static reportEnter(e){Lt.reportEnter(e)}static tips(e){Ue.show(e)}static get LocalCacheLoad_1(){return Lr.load_list()}static get LoadingPreLoad_1(){return Cr.get_list()}static get BeginPreload_1(){return Ws.get_list()}static get BeginPreload_2(){return Ws.get_list2()}static setup_1(e){Tn.init(null),Tn.inst.localload(Mr.LocalCacheLoad_1,initHandler(Mr.thisobj,t=>{var s=Mr.loadBG();Mr.init_G(),t&&t();var a=readLocal("yszc"),n=initHandler(this,()=>{Mr.onStartInitSystem(s,e)});i.YSZC&&!a||n.run()}))}static onStartInitSystem(e,t){var i=Mr;br.initSystem(t),cafe.app.enter().then(()=>{console.log("启动程序"),Mr.incrementVersionLoaded(e,t)}).start(),Laya.stage.on(Laya.Event.RESIZE,i,()=>{serror("屏幕大小出现修改：",Laya.stage.width,Laya.stage.height),cafe.event.dispatch(Laya.Event.RESIZE)})}static incrementVersionLoaded(e,t){var i,s=Mr;slog("加载版本号"),(i=Laya.LocalStorage.getItem("fileVersion"))||(i=(new Date).valueOf()/1e3,Laya.LocalStorage.setItem("fileVersion",i.toString())),Laya.ResourceVersion.enable("version.json",initHandler(s,s.onVersionLoaded,[e,t]),Laya.ResourceVersion.FILENAME_VERSION)}static onVersionLoaded(e,t){var s=Mr;slog("设置加载版本号"),""!=i.RESURL&&(Laya.URL.basePath=i.RESURL),slog("加载版本号设置路径",Laya.URL.basePath),slog("设置加载版本号完成"),Laya.AtlasInfoManager.enable("fileconfig.json",initHandler(s,()=>{Mr.handleConfigLoad(e,t)}))}static handleConfigLoad(e,t){var i=Mr;slog("加载配置路径",Laya.URL.basePath),slog("LAYA配置加载完成"),Tn.inst.load(Mr.LoadingPreLoad_1,initHandler(i,i.preLoad,[e,t]))}static preLoad(e,t){var i=br;i.GlobalGame.reportEnter(1),be.showloadding(),slog("开始预加载"),i.GlobalGame.BeginPreload_1.length>0?Tn.inst.load(i.GlobalGame.BeginPreload_1,initHandler(i,()=>{i.GlobalGame.init_L(),Tn.inst.load(i.GlobalGame.BeginPreload_2,initHandler(i,()=>{be.hideloadding(),t&&t.run(),t=null}),null,be.prosshandler)}),null,be.prosshandler):(t&&t.run(),t=null)}static loadBG(){var e=new Laya.Image;return Tn.inst.setImageIcon(e,"localImg/img_loadding_bg.png"),Laya.stage.addChild(e),e.size(fe.sourceW,fe.sourceH),fe.SCREEN==fe.PAD?e.scale(fe.minScale,fe.minScale):e.scale(fe.maxScale,fe.maxScale),e.left=0,e.right=0,e.top=0,e.bottom=0,e}}Mr.thisobj={};class Sr{static init(){var e=Sr.thisobj;Sr.map=new Laya.Handler(e,Sr.map_init()),Sr.morelist=new Laya.Handler(e,Sr.morelist_init())}static morelist_init(){return e=>{ea.scene.ui}}static map_init(){return(e,t)=>{var i=a.mission.fetchMissionTb(e);if(i||(i=a.mission.fetchMissionTb(t)),!Ve.user.isUseAction(Ve.user.gq_action))return Lt.report({params:{type:"noActionLevel",data:{level:i.missionId}}}),void be.openTopTipPanel(we.AlertActionTipPanel);ea.hall.isEnterMission=!0,Ve.game.mission_id=e,Lt.logStageLoad(1),Ks.enterGame()}}}Sr.thisobj={};new class{constructor(){Mr.init(),br.initEngine(this,_r.width,_r.height,Mr,initHandler(this,this.handleConfigLoad)),i.RESURL=""}handleConfigLoad(){"1"==readLocal("Laya_Stat_State")&&Laya.Stat.show(0,0),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),window.TipsView=Ue,Sr.init(),We.openscene(we.HallScene).start(),io.getInstance().displayOpeningPrompt()}}}()}();